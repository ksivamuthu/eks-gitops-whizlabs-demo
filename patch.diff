From 3305822bfc5e1cd4ee57a0b1863067eb6bfe4467 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sat, 18 Sep 2021 23:07:50 -0400
Subject: [PATCH] Add app and infrastructure

---
 clusters/dev/flux-system/app.yaml            | 13 +++++++++++++
 clusters/dev/flux-system/infrastructure.yaml | 13 +++++++++++++
 clusters/dev/flux-system/kustomization.yaml  |  2 ++
 3 files changed, 28 insertions(+)
 create mode 100644 clusters/dev/flux-system/app.yaml
 create mode 100644 clusters/dev/flux-system/infrastructure.yaml

diff --git a/clusters/dev/flux-system/app.yaml b/clusters/dev/flux-system/app.yaml
new file mode 100644
index 0000000..a699c4c
--- /dev/null
+++ b/clusters/dev/flux-system/app.yaml
@@ -0,0 +1,13 @@
+apiVersion: kustomize.toolkit.fluxcd.io/v1beta1
+kind: Kustomization
+metadata:
+  name: app
+  namespace: flux-system
+spec:
+  interval: 1m0s
+  sourceRef:
+    kind: GitRepository
+    name: flux-system
+  path: ./app
+  prune: true
+  validation: client
\ No newline at end of file
diff --git a/clusters/dev/flux-system/infrastructure.yaml b/clusters/dev/flux-system/infrastructure.yaml
new file mode 100644
index 0000000..9481d67
--- /dev/null
+++ b/clusters/dev/flux-system/infrastructure.yaml
@@ -0,0 +1,13 @@
+apiVersion: kustomize.toolkit.fluxcd.io/v1beta1
+kind: Kustomization
+metadata:
+  name: infrastructure
+  namespace: flux-system
+spec:
+  interval: 1m0s
+  sourceRef:
+    kind: GitRepository
+    name: flux-system
+  path: ./infrastructure
+  prune: true
+  validation: client
\ No newline at end of file
diff --git a/clusters/dev/flux-system/kustomization.yaml b/clusters/dev/flux-system/kustomization.yaml
index 3842229..705bb94 100644
--- a/clusters/dev/flux-system/kustomization.yaml
+++ b/clusters/dev/flux-system/kustomization.yaml
@@ -3,3 +3,5 @@ kind: Kustomization
 resources:
 - gotk-components.yaml
 - gotk-sync.yaml
+- infrastructure.yaml
+- app.yaml
-- 
2.27.0

From 5c3976846242a9f2cb340c9466398c7dd282ea6e Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sat, 18 Sep 2021 23:12:59 -0400
Subject: [PATCH] Appmesh add

---
 app/dev.yaml                                  |  4 ++
 app/kustomization.yaml                        |  4 ++
 .../appmesh/appmesh-controller.yaml           | 37 +++++++++++++++++++
 infrastructure/appmesh/kustomization.yaml     |  5 +++
 infrastructure/appmesh/namespace.yaml         |  4 ++
 infrastructure/kustomization.yaml             |  4 ++
 6 files changed, 58 insertions(+)
 create mode 100644 app/dev.yaml
 create mode 100644 app/kustomization.yaml
 create mode 100644 infrastructure/appmesh/appmesh-controller.yaml
 create mode 100644 infrastructure/appmesh/kustomization.yaml
 create mode 100644 infrastructure/appmesh/namespace.yaml
 create mode 100644 infrastructure/kustomization.yaml

diff --git a/app/dev.yaml b/app/dev.yaml
new file mode 100644
index 0000000..fdeb1f7
--- /dev/null
+++ b/app/dev.yaml
@@ -0,0 +1,4 @@
+apiVersion: v1
+kind: Namespace
+metadata:
+  name:  dev
\ No newline at end of file
diff --git a/app/kustomization.yaml b/app/kustomization.yaml
new file mode 100644
index 0000000..3aa0d40
--- /dev/null
+++ b/app/kustomization.yaml
@@ -0,0 +1,4 @@
+apiVersion: kustomize.config.k8s.io/v1beta1
+kind: Kustomization
+resources:
+ - dev.yaml
\ No newline at end of file
diff --git a/infrastructure/appmesh/appmesh-controller.yaml b/infrastructure/appmesh/appmesh-controller.yaml
new file mode 100644
index 0000000..ddff977
--- /dev/null
+++ b/infrastructure/appmesh/appmesh-controller.yaml
@@ -0,0 +1,37 @@
+---
+apiVersion: helm.fluxcd.io/v1
+kind: HelmRelease
+metadata:
+  name: appmesh-controller
+  namespace: appmesh-system
+spec:
+  releaseName: appmesh-controller
+  chart:
+    repository: https://aws.github.io/eks-charts/
+    name: appmesh-controller
+---
+apiVersion: helm.fluxcd.io/v1
+kind: HelmRelease
+metadata:
+  name: appmesh-inject
+  namespace: appmesh-system
+spec:
+  releaseName: appmesh-inject
+  chart:
+    repository: https://aws.github.io/eks-charts/
+    name: appmesh-inject
+  values:
+    mesh:
+      create: true
+      name: apps    
+---
+apiVersion: helm.fluxcd.io/v1
+kind: HelmRelease
+metadata:
+  name: appmesh-prometheus
+  namespace: appmesh-system
+spec:
+  releaseName: appmesh-prometheus
+  chart:
+    repository: https://aws.github.io/eks-charts/
+    name: appmesh-prometheus
\ No newline at end of file
diff --git a/infrastructure/appmesh/kustomization.yaml b/infrastructure/appmesh/kustomization.yaml
new file mode 100644
index 0000000..e2d62c7
--- /dev/null
+++ b/infrastructure/appmesh/kustomization.yaml
@@ -0,0 +1,5 @@
+apiVersion: kustomize.config.k8s.io/v1beta1
+kind: Kustomization
+resources:
+  - namespace.yaml
+  - appmesh-controller.yaml
\ No newline at end of file
diff --git a/infrastructure/appmesh/namespace.yaml b/infrastructure/appmesh/namespace.yaml
new file mode 100644
index 0000000..c99fec1
--- /dev/null
+++ b/infrastructure/appmesh/namespace.yaml
@@ -0,0 +1,4 @@
+apiVersion: v1
+kind: Namespace
+metadata:
+  name: appmesh-system
\ No newline at end of file
diff --git a/infrastructure/kustomization.yaml b/infrastructure/kustomization.yaml
new file mode 100644
index 0000000..97ad349
--- /dev/null
+++ b/infrastructure/kustomization.yaml
@@ -0,0 +1,4 @@
+apiVersion: kustomize.config.k8s.io/v1beta1
+kind: Kustomization
+resources:
+ - appmesh
\ No newline at end of file
-- 
2.27.0

From 0c726d41262443fe2132b566a937a0bc0ff65d0e Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sat, 18 Sep 2021 23:16:04 -0400
Subject: [PATCH] Appmesh add

---
 infrastructure/appmesh/appmesh-controller.yaml | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/infrastructure/appmesh/appmesh-controller.yaml b/infrastructure/appmesh/appmesh-controller.yaml
index ddff977..1e7d47a 100644
--- a/infrastructure/appmesh/appmesh-controller.yaml
+++ b/infrastructure/appmesh/appmesh-controller.yaml
@@ -1,5 +1,5 @@
 ---
-apiVersion: helm.fluxcd.io/v1
+apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
 metadata:
   name: appmesh-controller
@@ -10,7 +10,7 @@ spec:
     repository: https://aws.github.io/eks-charts/
     name: appmesh-controller
 ---
-apiVersion: helm.fluxcd.io/v1
+apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
 metadata:
   name: appmesh-inject
@@ -25,7 +25,7 @@ spec:
       create: true
       name: apps    
 ---
-apiVersion: helm.fluxcd.io/v1
+apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
 metadata:
   name: appmesh-prometheus
-- 
2.27.0

From 6d844ed392fe06b34ab4692831349d67522fde06 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sat, 18 Sep 2021 23:18:00 -0400
Subject: [PATCH] Appmesh add

---
 infrastructure/appmesh/appmesh-controller.yaml | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/infrastructure/appmesh/appmesh-controller.yaml b/infrastructure/appmesh/appmesh-controller.yaml
index 1e7d47a..4a43895 100644
--- a/infrastructure/appmesh/appmesh-controller.yaml
+++ b/infrastructure/appmesh/appmesh-controller.yaml
@@ -5,6 +5,7 @@ metadata:
   name: appmesh-controller
   namespace: appmesh-system
 spec:
+  interval: 1m
   releaseName: appmesh-controller
   chart:
     repository: https://aws.github.io/eks-charts/
@@ -16,6 +17,7 @@ metadata:
   name: appmesh-inject
   namespace: appmesh-system
 spec:
+  interval: 1m
   releaseName: appmesh-inject
   chart:
     repository: https://aws.github.io/eks-charts/
@@ -31,6 +33,7 @@ metadata:
   name: appmesh-prometheus
   namespace: appmesh-system
 spec:
+  interval: 1m
   releaseName: appmesh-prometheus
   chart:
     repository: https://aws.github.io/eks-charts/
-- 
2.27.0

From 0567ec3db322db0457930356716badadf13100a4 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sat, 18 Sep 2021 23:24:06 -0400
Subject: [PATCH] Appmesh add

---
 .../appmesh/appmesh-controller.yaml           | 31 +++++++++----------
 infrastructure/appmesh/appmesh-repo.yaml      |  9 ++++++
 infrastructure/appmesh/kustomization.yaml     |  1 +
 3 files changed, 25 insertions(+), 16 deletions(-)
 create mode 100644 infrastructure/appmesh/appmesh-repo.yaml

diff --git a/infrastructure/appmesh/appmesh-controller.yaml b/infrastructure/appmesh/appmesh-controller.yaml
index 4a43895..6d66e90 100644
--- a/infrastructure/appmesh/appmesh-controller.yaml
+++ b/infrastructure/appmesh/appmesh-controller.yaml
@@ -5,11 +5,12 @@ metadata:
   name: appmesh-controller
   namespace: appmesh-system
 spec:
-  interval: 1m
-  releaseName: appmesh-controller
   chart:
-    repository: https://aws.github.io/eks-charts/
-    name: appmesh-controller
+     spec:
+       chart: appmesh-controller
+       sourceRef: 
+          kind: HelmRepository
+          name: appmesh    
 ---
 apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
@@ -17,15 +18,12 @@ metadata:
   name: appmesh-inject
   namespace: appmesh-system
 spec:
-  interval: 1m
-  releaseName: appmesh-inject
   chart:
-    repository: https://aws.github.io/eks-charts/
-    name: appmesh-inject
-  values:
-    mesh:
-      create: true
-      name: apps    
+     spec:
+       chart: appmesh-inject
+       sourceRef: 
+          kind: HelmRepository
+          name: appmesh      
 ---
 apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
@@ -33,8 +31,9 @@ metadata:
   name: appmesh-prometheus
   namespace: appmesh-system
 spec:
-  interval: 1m
-  releaseName: appmesh-prometheus
   chart:
-    repository: https://aws.github.io/eks-charts/
-    name: appmesh-prometheus
\ No newline at end of file
+     spec:
+       chart: appmesh-prometheus
+       sourceRef: 
+          kind: HelmRepository
+          name: appmesh   
\ No newline at end of file
diff --git a/infrastructure/appmesh/appmesh-repo.yaml b/infrastructure/appmesh/appmesh-repo.yaml
new file mode 100644
index 0000000..5680482
--- /dev/null
+++ b/infrastructure/appmesh/appmesh-repo.yaml
@@ -0,0 +1,9 @@
+# /flux/boot/traefik/helmrepo.yaml
+apiVersion: source.toolkit.fluxcd.io/v1beta1
+kind: HelmRepository
+metadata:
+  name: appmesh
+  namespace: appmesh-system
+spec:
+  interval: 1m0s
+  url: https://aws.github.io/eks-charts/
\ No newline at end of file
diff --git a/infrastructure/appmesh/kustomization.yaml b/infrastructure/appmesh/kustomization.yaml
index e2d62c7..7920327 100644
--- a/infrastructure/appmesh/kustomization.yaml
+++ b/infrastructure/appmesh/kustomization.yaml
@@ -2,4 +2,5 @@ apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
 resources:
   - namespace.yaml
+  - appmesh-repo.yaml
   - appmesh-controller.yaml
\ No newline at end of file
-- 
2.27.0

From 846d69bbeb6c5835edb2b9a94302675f2885e6a7 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sat, 18 Sep 2021 23:25:45 -0400
Subject: [PATCH] App mesh add interval

---
 infrastructure/appmesh/appmesh-controller.yaml | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/infrastructure/appmesh/appmesh-controller.yaml b/infrastructure/appmesh/appmesh-controller.yaml
index 6d66e90..8997590 100644
--- a/infrastructure/appmesh/appmesh-controller.yaml
+++ b/infrastructure/appmesh/appmesh-controller.yaml
@@ -5,6 +5,7 @@ metadata:
   name: appmesh-controller
   namespace: appmesh-system
 spec:
+  interval: 1m0s
   chart:
      spec:
        chart: appmesh-controller
@@ -18,6 +19,7 @@ metadata:
   name: appmesh-inject
   namespace: appmesh-system
 spec:
+  interval: 1m0s
   chart:
      spec:
        chart: appmesh-inject
@@ -31,6 +33,7 @@ metadata:
   name: appmesh-prometheus
   namespace: appmesh-system
 spec:
+  interval: 1m0s
   chart:
      spec:
        chart: appmesh-prometheus
-- 
2.27.0

From 3307cf87557d8c43410f76ac17c1f683919ff3f4 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sat, 18 Sep 2021 23:34:44 -0400
Subject: [PATCH] Add flagger in the app mesh

---
 infrastructure/appmesh/appmesh-repo.yaml  | 13 +++++++++++--
 infrastructure/appmesh/flagger.yaml       | 20 ++++++++++++++++++++
 infrastructure/appmesh/kustomization.yaml |  3 ++-
 3 files changed, 33 insertions(+), 3 deletions(-)
 create mode 100644 infrastructure/appmesh/flagger.yaml

diff --git a/infrastructure/appmesh/appmesh-repo.yaml b/infrastructure/appmesh/appmesh-repo.yaml
index 5680482..634d5f6 100644
--- a/infrastructure/appmesh/appmesh-repo.yaml
+++ b/infrastructure/appmesh/appmesh-repo.yaml
@@ -1,4 +1,3 @@
-# /flux/boot/traefik/helmrepo.yaml
 apiVersion: source.toolkit.fluxcd.io/v1beta1
 kind: HelmRepository
 metadata:
@@ -6,4 +5,14 @@ metadata:
   namespace: appmesh-system
 spec:
   interval: 1m0s
-  url: https://aws.github.io/eks-charts/
\ No newline at end of file
+  url: https://aws.github.io/eks-charts/
+---
+apiVersion: source.toolkit.fluxcd.io/v1beta1
+kind: HelmRepository
+metadata:
+  name: flagger
+  namespace: appmesh-system
+spec:
+  interval: 1m
+  url: https://flagger.app
+---
\ No newline at end of file
diff --git a/infrastructure/appmesh/flagger.yaml b/infrastructure/appmesh/flagger.yaml
new file mode 100644
index 0000000..89fc29e
--- /dev/null
+++ b/infrastructure/appmesh/flagger.yaml
@@ -0,0 +1,20 @@
+apiVersion: helm.toolkit.fluxcd.io/v2beta1
+kind: HelmRelease
+metadata:
+  name: flagger
+spec:
+  releaseName: flagger
+  chart:
+    spec:
+      chart: flagger
+      sourceRef:
+        kind: HelmRepository
+        name: flagger
+        namespace: appmesh-system
+  interval: 1m0s
+  install:
+    remediation:
+      retries: 3
+  values:
+    meshProvider: appmesh:v1beta2
+    metricsServer: http://appmesh-prometheus.appmesh-system.svc.cluster.local:9090
\ No newline at end of file
diff --git a/infrastructure/appmesh/kustomization.yaml b/infrastructure/appmesh/kustomization.yaml
index 7920327..49da191 100644
--- a/infrastructure/appmesh/kustomization.yaml
+++ b/infrastructure/appmesh/kustomization.yaml
@@ -3,4 +3,5 @@ kind: Kustomization
 resources:
   - namespace.yaml
   - appmesh-repo.yaml
-  - appmesh-controller.yaml
\ No newline at end of file
+  - appmesh-controller.yaml
+  - flagger.yaml
\ No newline at end of file
-- 
2.27.0

From 015be0fd227d623bd2808eba9fa01a3a72676e71 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sat, 18 Sep 2021 23:35:51 -0400
Subject: [PATCH] Add flagger in the app mesh

---
 infrastructure/appmesh/flagger.yaml | 1 +
 1 file changed, 1 insertion(+)

diff --git a/infrastructure/appmesh/flagger.yaml b/infrastructure/appmesh/flagger.yaml
index 89fc29e..13efdb6 100644
--- a/infrastructure/appmesh/flagger.yaml
+++ b/infrastructure/appmesh/flagger.yaml
@@ -2,6 +2,7 @@ apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
 metadata:
   name: flagger
+  namespace: appmesh-system
 spec:
   releaseName: flagger
   chart:
-- 
2.27.0

From 20c9d27e793403c80abe66337369b5dcf78150e2 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sat, 18 Sep 2021 23:41:20 -0400
Subject: [PATCH] Add app mesh config yaml

---
 infrastructure/appmesh/appmesh-config.yaml | 8 ++++++++
 infrastructure/appmesh/kustomization.yaml  | 1 +
 2 files changed, 9 insertions(+)
 create mode 100644 infrastructure/appmesh/appmesh-config.yaml

diff --git a/infrastructure/appmesh/appmesh-config.yaml b/infrastructure/appmesh/appmesh-config.yaml
new file mode 100644
index 0000000..119a756
--- /dev/null
+++ b/infrastructure/appmesh/appmesh-config.yaml
@@ -0,0 +1,8 @@
+apiVersion: appmesh.k8s.aws/v1beta2
+kind: Mesh
+metadata:
+  name: global
+spec:
+  namespaceSelector:
+    matchLabels:
+      appmesh.k8s.aws/sidecarInjectorWebhook: enabled
\ No newline at end of file
diff --git a/infrastructure/appmesh/kustomization.yaml b/infrastructure/appmesh/kustomization.yaml
index 49da191..cea3c6c 100644
--- a/infrastructure/appmesh/kustomization.yaml
+++ b/infrastructure/appmesh/kustomization.yaml
@@ -4,4 +4,5 @@ resources:
   - namespace.yaml
   - appmesh-repo.yaml
   - appmesh-controller.yaml
+  - appmesh-config.yaml
   - flagger.yaml
\ No newline at end of file
-- 
2.27.0

From 1cce123f40b308f0bae3cc29701e769b0e2e9af5 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sat, 18 Sep 2021 23:50:55 -0400
Subject: [PATCH] Add pod info

---
 app/dev.yaml           |  4 --
 app/kustomization.yaml |  2 +-
 app/podinfo.yaml       | 97 ++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 98 insertions(+), 5 deletions(-)
 delete mode 100644 app/dev.yaml
 create mode 100644 app/podinfo.yaml

diff --git a/app/dev.yaml b/app/dev.yaml
deleted file mode 100644
index fdeb1f7..0000000
--- a/app/dev.yaml
+++ /dev/null
@@ -1,4 +0,0 @@
-apiVersion: v1
-kind: Namespace
-metadata:
-  name:  dev
\ No newline at end of file
diff --git a/app/kustomization.yaml b/app/kustomization.yaml
index 3aa0d40..5e9f5f1 100644
--- a/app/kustomization.yaml
+++ b/app/kustomization.yaml
@@ -1,4 +1,4 @@
 apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
 resources:
- - dev.yaml
\ No newline at end of file
+ - podinfo.yaml
\ No newline at end of file
diff --git a/app/podinfo.yaml b/app/podinfo.yaml
new file mode 100644
index 0000000..6326381
--- /dev/null
+++ b/app/podinfo.yaml
@@ -0,0 +1,97 @@
+apiVersion: apps/v1
+kind: Deployment
+metadata:
+  name: podinfo
+  namespace: default
+spec:
+  minReadySeconds: 3
+  revisionHistoryLimit: 5
+  progressDeadlineSeconds: 60
+  strategy:
+    rollingUpdate:
+      maxUnavailable: 0
+    type: RollingUpdate
+  selector:
+    matchLabels:
+      app: podinfo
+  template:
+    metadata:
+      annotations:
+        prometheus.io/scrape: "true"
+        prometheus.io/port: "9797"
+      labels:
+        app: podinfo
+    spec:
+      containers:
+      - name: podinfod
+        image: ghcr.io/stefanprodan/podinfo:5.0.0 # {"$imagepolicy": "flux-system:podinfo"}
+        imagePullPolicy: IfNotPresent
+        ports:
+        - name: http
+          containerPort: 9898
+          protocol: TCP
+        - name: http-metrics
+          containerPort: 9797
+          protocol: TCP
+        - name: grpc
+          containerPort: 9999
+          protocol: TCP
+        command:
+        - ./podinfo
+        - --port=9898
+        - --port-metrics=9797
+        - --grpc-port=9999
+        - --grpc-service-name=podinfo
+        - --level=info
+        - --random-delay=false
+        - --random-error=false
+        env:
+        - name: PODINFO_UI_COLOR
+          value: "#34577c"
+        livenessProbe:
+          exec:
+            command:
+            - podcli
+            - check
+            - http
+            - localhost:9898/healthz
+          initialDelaySeconds: 5
+          timeoutSeconds: 5
+        readinessProbe:
+          exec:
+            command:
+            - podcli
+            - check
+            - http
+            - localhost:9898/readyz
+          initialDelaySeconds: 5
+          timeoutSeconds: 5
+        resources:
+          limits:
+            cpu: 2000m
+            memory: 512Mi
+          requests:
+            cpu: 100m
+            memory: 64Mi
+
+---
+apiVersion: autoscaling/v2beta2
+kind: HorizontalPodAutoscaler
+metadata:
+  name: podinfo
+spec:
+  scaleTargetRef:
+    apiVersion: apps/v1
+    kind: Deployment
+    name: podinfo
+  minReplicas: 2
+  maxReplicas: 4
+  metrics:
+    - type: Resource
+      resource:
+        name: cpu
+        target:
+          type: Utilization
+          # scale up if usage is above
+          # 99% of the requested CPU (100m)
+          averageUtilization: 99
\ No newline at end of file
-- 
2.27.0

From 71f0512e86db771682a9ece5ef8f1adb3b6ff52d Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sat, 18 Sep 2021 23:52:03 -0400
Subject: [PATCH] Add pod info

---
 app/podinfo.yaml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app/podinfo.yaml b/app/podinfo.yaml
index 6326381..03675b0 100644
--- a/app/podinfo.yaml
+++ b/app/podinfo.yaml
@@ -84,7 +84,7 @@ spec:
     apiVersion: apps/v1
     kind: Deployment
     name: podinfo
-  minReplicas: 2
+  minReplicas: 1
   maxReplicas: 4
   metrics:
     - type: Resource
-- 
2.27.0

From aeaaa95a51056d0bfdcb9f2f6f9b7d04a33d35a8 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sat, 18 Sep 2021 23:54:20 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/kustomization.yaml         |  2 +-
 app/podinfo/appmesh-route.yaml | 13 +++++++++++++
 app/podinfo/kustomization.yaml |  5 +++++
 app/{ => podinfo}/podinfo.yaml |  0
 4 files changed, 19 insertions(+), 1 deletion(-)
 create mode 100644 app/podinfo/appmesh-route.yaml
 create mode 100644 app/podinfo/kustomization.yaml
 rename app/{ => podinfo}/podinfo.yaml (100%)

diff --git a/app/kustomization.yaml b/app/kustomization.yaml
index 5e9f5f1..55657a4 100644
--- a/app/kustomization.yaml
+++ b/app/kustomization.yaml
@@ -1,4 +1,4 @@
 apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
 resources:
- - podinfo.yaml
\ No newline at end of file
+ - podinfo
\ No newline at end of file
diff --git a/app/podinfo/appmesh-route.yaml b/app/podinfo/appmesh-route.yaml
new file mode 100644
index 0000000..54ca9d6
--- /dev/null
+++ b/app/podinfo/appmesh-route.yaml
@@ -0,0 +1,13 @@
+apiVersion: appmesh.k8s.aws/v1beta2
+kind: GatewayRoute
+metadata:
+  name: podinfo
+spec:
+  httpRoute:
+    match:
+      prefix: "/"
+    action:
+      target:
+        virtualService:
+          virtualServiceRef:
+            name: podinfo
\ No newline at end of file
diff --git a/app/podinfo/kustomization.yaml b/app/podinfo/kustomization.yaml
new file mode 100644
index 0000000..5632614
--- /dev/null
+++ b/app/podinfo/kustomization.yaml
@@ -0,0 +1,5 @@
+apiVersion: kustomize.config.k8s.io/v1beta1
+kind: Kustomization
+resources:
+ - podinfo
+ - appmesh-route
\ No newline at end of file
diff --git a/app/podinfo.yaml b/app/podinfo/podinfo.yaml
similarity index 100%
rename from app/podinfo.yaml
rename to app/podinfo/podinfo.yaml
-- 
2.27.0

From 3204e3ef1e418df4881325b952e6613956749499 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sat, 18 Sep 2021 23:55:52 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/kustomization.yaml | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/podinfo/kustomization.yaml b/app/podinfo/kustomization.yaml
index 5632614..9c9642a 100644
--- a/app/podinfo/kustomization.yaml
+++ b/app/podinfo/kustomization.yaml
@@ -1,5 +1,5 @@
 apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
 resources:
- - podinfo
- - appmesh-route
\ No newline at end of file
+ - podinfo.yaml
+ - appmesh-route.yaml
\ No newline at end of file
-- 
2.27.0

From dd5ad20d61be11e21119f29dedfc01f6e20c87a7 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 00:01:03 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/kustomization.yaml | 1 +
 app/namespace.yaml     | 6 ++++++
 2 files changed, 7 insertions(+)
 create mode 100644 app/namespace.yaml

diff --git a/app/kustomization.yaml b/app/kustomization.yaml
index 55657a4..862a7c6 100644
--- a/app/kustomization.yaml
+++ b/app/kustomization.yaml
@@ -1,4 +1,5 @@
 apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
+namespace: dev
 resources:
  - podinfo
\ No newline at end of file
diff --git a/app/namespace.yaml b/app/namespace.yaml
new file mode 100644
index 0000000..45377a0
--- /dev/null
+++ b/app/namespace.yaml
@@ -0,0 +1,6 @@
+apiVersion: v1
+kind: Namespace
+metadata:
+  name: dev
+  labels:
+    appmesh.k8s.aws/sidecarInjectorWebhook: enabled
\ No newline at end of file
-- 
2.27.0

From 5dee7733a0ab2b5c665b4fd8ba502d93b5d8060c Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 00:01:46 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/kustomization.yaml | 1 +
 1 file changed, 1 insertion(+)

diff --git a/app/kustomization.yaml b/app/kustomization.yaml
index 862a7c6..a4aa37f 100644
--- a/app/kustomization.yaml
+++ b/app/kustomization.yaml
@@ -2,4 +2,5 @@ apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
 namespace: dev
 resources:
+ - namespace.yaml
  - podinfo
\ No newline at end of file
-- 
2.27.0

From eaf6be9367cae16b5aac2171290c71bd38baaf65 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 00:13:27 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/kustomization.yaml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app/podinfo/kustomization.yaml b/app/podinfo/kustomization.yaml
index 9c9642a..aaa5e9e 100644
--- a/app/podinfo/kustomization.yaml
+++ b/app/podinfo/kustomization.yaml
@@ -2,4 +2,4 @@ apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
 resources:
  - podinfo.yaml
- - appmesh-route.yaml
\ No newline at end of file
+#  - appmesh-route.yaml
\ No newline at end of file
-- 
2.27.0

From 94b3ca24bf5295104b49dee774f803ada74ca61c Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 00:15:34 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/podinfo.yaml | 1 -
 1 file changed, 1 deletion(-)

diff --git a/app/podinfo/podinfo.yaml b/app/podinfo/podinfo.yaml
index 03675b0..e564ea2 100644
--- a/app/podinfo/podinfo.yaml
+++ b/app/podinfo/podinfo.yaml
@@ -2,7 +2,6 @@ apiVersion: apps/v1
 kind: Deployment
 metadata:
   name: podinfo
-  namespace: default
 spec:
   minReadySeconds: 3
   revisionHistoryLimit: 5
-- 
2.27.0

From 87c043a1311bc2fe43dcc97b2ce4e68b0cef065f Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 00:17:37 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/kustomization.yaml | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/podinfo/kustomization.yaml b/app/podinfo/kustomization.yaml
index aaa5e9e..1d1b392 100644
--- a/app/podinfo/kustomization.yaml
+++ b/app/podinfo/kustomization.yaml
@@ -1,5 +1,5 @@
 apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
+namespace: dev
 resources:
- - podinfo.yaml
-#  - appmesh-route.yaml
\ No newline at end of file
+ - podinfo.yaml
\ No newline at end of file
-- 
2.27.0

From 3ff30793e0711c3aedb8e63988a01644c00d8312 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 00:20:01 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/kustomization.yaml | 1 -
 1 file changed, 1 deletion(-)

diff --git a/app/kustomization.yaml b/app/kustomization.yaml
index a4aa37f..98c6729 100644
--- a/app/kustomization.yaml
+++ b/app/kustomization.yaml
@@ -1,6 +1,5 @@
 apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
-namespace: dev
 resources:
  - namespace.yaml
  - podinfo
\ No newline at end of file
-- 
2.27.0

From 7755de08648c4c79bca18a4138c3f5419219833f Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 00:26:09 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/podinfo.yaml |  8 --------
 cluster.yaml             | 25 +++++++++++++++++++++++++
 2 files changed, 25 insertions(+), 8 deletions(-)
 create mode 100644 cluster.yaml

diff --git a/app/podinfo/podinfo.yaml b/app/podinfo/podinfo.yaml
index e564ea2..0df93dc 100644
--- a/app/podinfo/podinfo.yaml
+++ b/app/podinfo/podinfo.yaml
@@ -65,14 +65,6 @@ spec:
             - localhost:9898/readyz
           initialDelaySeconds: 5
           timeoutSeconds: 5
-        resources:
-          limits:
-            cpu: 2000m
-            memory: 512Mi
-          requests:
-            cpu: 100m
-            memory: 64Mi
-
 ---
 apiVersion: autoscaling/v2beta2
 kind: HorizontalPodAutoscaler
diff --git a/cluster.yaml b/cluster.yaml
new file mode 100644
index 0000000..2c99be8
--- /dev/null
+++ b/cluster.yaml
@@ -0,0 +1,25 @@
+apiVersion: eksctl.io/v1alpha5
+kind: ClusterConfig
+
+metadata:
+  name: eks-gitops-demo
+  region: us-east-1
+
+managedNodeGroups:
+  - name: eks-gitops-demo-ng
+    instanceType: t3.medium
+    minSize: 2
+    maxSize: 3
+
+gitops:
+  flux:
+    gitProvider: github
+    flags: 
+      owner: "ksivamuthu"
+      repository: "eks-gitops-whizlabs-demo"
+      private: "true"
+      branch: "main"
+      namespace: "flux-system"
+      path: "clusters/dev"
+      components: "source-controller,kustomize-controller,helm-controller,notification-controller"
+      components-extra: "image-reflector-controller,image-automation-controller"
\ No newline at end of file
-- 
2.27.0

From 02828fcaf4b7545dd6745b8766a00c0d77cfee30 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 00:30:14 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/namespace.yaml | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/namespace.yaml b/app/namespace.yaml
index 45377a0..934124b 100644
--- a/app/namespace.yaml
+++ b/app/namespace.yaml
@@ -2,5 +2,5 @@ apiVersion: v1
 kind: Namespace
 metadata:
   name: dev
-  labels:
-    appmesh.k8s.aws/sidecarInjectorWebhook: enabled
\ No newline at end of file
+  # labels:
+  #   appmesh.k8s.aws/sidecarInjectorWebhook: enabled
\ No newline at end of file
-- 
2.27.0

From b7db8e405ff8d461547932b37699e7b92dffc47f Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 00:53:17 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/kustomization.yaml  |  4 ++-
 app/podinfo/podinfo-canary.yaml | 63 +++++++++++++++++++++++++++++++++
 2 files changed, 66 insertions(+), 1 deletion(-)
 create mode 100644 app/podinfo/podinfo-canary.yaml

diff --git a/app/podinfo/kustomization.yaml b/app/podinfo/kustomization.yaml
index 1d1b392..2cccde9 100644
--- a/app/podinfo/kustomization.yaml
+++ b/app/podinfo/kustomization.yaml
@@ -2,4 +2,6 @@ apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
 namespace: dev
 resources:
- - podinfo.yaml
\ No newline at end of file
+ - podinfo.yaml
+ - podinfo-canary.yaml
+ - appmesh-route.yaml
\ No newline at end of file
diff --git a/app/podinfo/podinfo-canary.yaml b/app/podinfo/podinfo-canary.yaml
new file mode 100644
index 0000000..ff8b933
--- /dev/null
+++ b/app/podinfo/podinfo-canary.yaml
@@ -0,0 +1,63 @@
+apiVersion: flagger.app/v1beta1
+kind: Canary
+metadata:
+  name: podinfo
+spec:
+  provider: appmesh:v1beta2
+  targetRef:
+    apiVersion: apps/v1
+    kind: Deployment
+    name: podinfo
+  autoscalerRef:
+    apiVersion: autoscaling/v2beta2
+    kind: HorizontalPodAutoscaler
+    name: podinfo
+  progressDeadlineSeconds: 60
+  service:
+    port: 9898
+    timeout: 15s
+    retries:
+      attempts: 3
+      perTryTimeout: 5s
+      retryOn: "gateway-error,client-error,stream-error"
+    match:
+      - uri:
+          prefix: /
+    rewrite:
+      uri: /
+  # define the canary analysis timing and KPIs
+  analysis:
+    # schedule interval (default 60s)
+    interval: 5s
+    # max number of failed metric checks before rollback
+    threshold: 5
+    # max traffic percentage routed to canary
+    # percentage (0-100)
+    maxWeight: 30
+    # canary increment step
+    # percentage (0-100)
+    stepWeight: 5
+    # App Mesh Prometheus checks
+    metrics:
+      - name: request-success-rate
+        thresholdRange:
+          min: 99
+        interval: 1m
+      - name: request-duration
+        thresholdRange:
+          max: 500
+        interval: 30s
+    # testing (optional)
+    # webhooks:
+    #   - name: acceptance-test
+    #     type: pre-rollout
+    #     url: http://flagger-loadtester.$(NAMESPACE)/
+    #     timeout: 30s
+    #     metadata:
+    #       type: bash
+    #       cmd: "curl -sd 'test' http://podinfo-canary.$(NAMESPACE):9898/token | grep token"
+    #   - name: load-test
+    #     url: http://flagger-loadtester.$(NAMESPACE)/
+    #     timeout: 5s
+    #     metadata:
+    #       cmd: "hey -z 1m -q 10 -c 2 http://podinfo-canary.$(NAMESPACE):9898/"
\ No newline at end of file
-- 
2.27.0

From 4406b2851d30d9ab7a1c5129ef7de3b3d42153da Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 00:54:44 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/namespace.yaml | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/namespace.yaml b/app/namespace.yaml
index 934124b..45377a0 100644
--- a/app/namespace.yaml
+++ b/app/namespace.yaml
@@ -2,5 +2,5 @@ apiVersion: v1
 kind: Namespace
 metadata:
   name: dev
-  # labels:
-  #   appmesh.k8s.aws/sidecarInjectorWebhook: enabled
\ No newline at end of file
+  labels:
+    appmesh.k8s.aws/sidecarInjectorWebhook: enabled
\ No newline at end of file
-- 
2.27.0

From 66e61410aac33d45c3ced9d8d9926e1c67689a46 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 00:57:34 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/namespace.yaml             | 2 +-
 app/podinfo/kustomization.yaml | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/namespace.yaml b/app/namespace.yaml
index 45377a0..253a22a 100644
--- a/app/namespace.yaml
+++ b/app/namespace.yaml
@@ -1,6 +1,6 @@
 apiVersion: v1
 kind: Namespace
 metadata:
-  name: dev
+  name: develop
   labels:
     appmesh.k8s.aws/sidecarInjectorWebhook: enabled
\ No newline at end of file
diff --git a/app/podinfo/kustomization.yaml b/app/podinfo/kustomization.yaml
index 2cccde9..ec088da 100644
--- a/app/podinfo/kustomization.yaml
+++ b/app/podinfo/kustomization.yaml
@@ -1,6 +1,6 @@
 apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
-namespace: dev
+namespace: develop
 resources:
  - podinfo.yaml
  - podinfo-canary.yaml
-- 
2.27.0

From 3f5df5db64ef6d14668f37e900ed4ba8a99433d4 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 01:00:58 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/kustomization.yaml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app/podinfo/kustomization.yaml b/app/podinfo/kustomization.yaml
index ec088da..6d4fbd7 100644
--- a/app/podinfo/kustomization.yaml
+++ b/app/podinfo/kustomization.yaml
@@ -2,6 +2,6 @@ apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
 namespace: develop
 resources:
- - podinfo.yaml
  - podinfo-canary.yaml
+ - podinfo.yaml
  - appmesh-route.yaml
\ No newline at end of file
-- 
2.27.0

From bb1cd845df98d9c0d7d957be05df82e6541a6f05 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 01:07:23 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/appmesh-route.yaml | 13 -------------
 app/podinfo/kustomization.yaml |  3 +--
 2 files changed, 1 insertion(+), 15 deletions(-)
 delete mode 100644 app/podinfo/appmesh-route.yaml

diff --git a/app/podinfo/appmesh-route.yaml b/app/podinfo/appmesh-route.yaml
deleted file mode 100644
index 54ca9d6..0000000
--- a/app/podinfo/appmesh-route.yaml
+++ /dev/null
@@ -1,13 +0,0 @@
-apiVersion: appmesh.k8s.aws/v1beta2
-kind: GatewayRoute
-metadata:
-  name: podinfo
-spec:
-  httpRoute:
-    match:
-      prefix: "/"
-    action:
-      target:
-        virtualService:
-          virtualServiceRef:
-            name: podinfo
\ No newline at end of file
diff --git a/app/podinfo/kustomization.yaml b/app/podinfo/kustomization.yaml
index 6d4fbd7..d8afefd 100644
--- a/app/podinfo/kustomization.yaml
+++ b/app/podinfo/kustomization.yaml
@@ -3,5 +3,4 @@ kind: Kustomization
 namespace: develop
 resources:
  - podinfo-canary.yaml
- - podinfo.yaml
- - appmesh-route.yaml
\ No newline at end of file
+ - podinfo.yaml
\ No newline at end of file
-- 
2.27.0

From ecb43a1012bb2d70709633cc5cc345082f557c02 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 01:10:31 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/podinfo.yaml | 54 ++++++++++++++++------------------------
 1 file changed, 21 insertions(+), 33 deletions(-)

diff --git a/app/podinfo/podinfo.yaml b/app/podinfo/podinfo.yaml
index 0df93dc..c7d64c4 100644
--- a/app/podinfo/podinfo.yaml
+++ b/app/podinfo/podinfo.yaml
@@ -3,13 +3,6 @@ kind: Deployment
 metadata:
   name: podinfo
 spec:
-  minReadySeconds: 3
-  revisionHistoryLimit: 5
-  progressDeadlineSeconds: 60
-  strategy:
-    rollingUpdate:
-      maxUnavailable: 0
-    type: RollingUpdate
   selector:
     matchLabels:
       app: podinfo
@@ -32,15 +25,10 @@ spec:
         - name: http-metrics
           containerPort: 9797
           protocol: TCP
-        - name: grpc
-          containerPort: 9999
-          protocol: TCP
         command:
         - ./podinfo
         - --port=9898
         - --port-metrics=9797
-        - --grpc-port=9999
-        - --grpc-service-name=podinfo
         - --level=info
         - --random-delay=false
         - --random-error=false
@@ -65,24 +53,24 @@ spec:
             - localhost:9898/readyz
           initialDelaySeconds: 5
           timeoutSeconds: 5
----
-apiVersion: autoscaling/v2beta2
-kind: HorizontalPodAutoscaler
-metadata:
-  name: podinfo
-spec:
-  scaleTargetRef:
-    apiVersion: apps/v1
-    kind: Deployment
-    name: podinfo
-  minReplicas: 1
-  maxReplicas: 4
-  metrics:
-    - type: Resource
-      resource:
-        name: cpu
-        target:
-          type: Utilization
-          # scale up if usage is above
-          # 99% of the requested CPU (100m)
-          averageUtilization: 99
\ No newline at end of file
+# ---
+# apiVersion: autoscaling/v2beta2
+# kind: HorizontalPodAutoscaler
+# metadata:
+#   name: podinfo
+# spec:
+#   scaleTargetRef:
+#     apiVersion: apps/v1
+#     kind: Deployment
+#     name: podinfo
+#   minReplicas: 1
+#   maxReplicas: 4
+#   metrics:
+#     - type: Resource
+#       resource:
+#         name: cpu
+#         target:
+#           type: Utilization
+#           # scale up if usage is above
+#           # 99% of the requested CPU (100m)
+#           averageUtilization: 99
\ No newline at end of file
-- 
2.27.0

From 46187d4a7baab04d557f779c85f14bb7b4fbd4fd Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 01:15:04 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/namespace.yaml             | 2 +-
 app/podinfo/kustomization.yaml | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/namespace.yaml b/app/namespace.yaml
index 253a22a..45377a0 100644
--- a/app/namespace.yaml
+++ b/app/namespace.yaml
@@ -1,6 +1,6 @@
 apiVersion: v1
 kind: Namespace
 metadata:
-  name: develop
+  name: dev
   labels:
     appmesh.k8s.aws/sidecarInjectorWebhook: enabled
\ No newline at end of file
diff --git a/app/podinfo/kustomization.yaml b/app/podinfo/kustomization.yaml
index d8afefd..950e1c1 100644
--- a/app/podinfo/kustomization.yaml
+++ b/app/podinfo/kustomization.yaml
@@ -1,6 +1,6 @@
 apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
-namespace: develop
+namespace: dev
 resources:
  - podinfo-canary.yaml
  - podinfo.yaml
\ No newline at end of file
-- 
2.27.0

From 4c7b526992ce6138748414a2f2477dcabb087648 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 01:19:22 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/namespace.yaml              | 9 ++++++++-
 app/podinfo/podinfo-canary.yaml | 1 +
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/app/namespace.yaml b/app/namespace.yaml
index 45377a0..84c21f8 100644
--- a/app/namespace.yaml
+++ b/app/namespace.yaml
@@ -3,4 +3,11 @@ kind: Namespace
 metadata:
   name: dev
   labels:
-    appmesh.k8s.aws/sidecarInjectorWebhook: enabled
\ No newline at end of file
+    appmesh.k8s.aws/sidecarInjectorWebhook: enabled
+---    
+apiVersion: v1
+kind: Namespace
+metadata:
+  name: dev
+  labels:
+    appmesh.k8s.aws/sidecarInjectorWebhook: enabled    
\ No newline at end of file
diff --git a/app/podinfo/podinfo-canary.yaml b/app/podinfo/podinfo-canary.yaml
index ff8b933..962ec26 100644
--- a/app/podinfo/podinfo-canary.yaml
+++ b/app/podinfo/podinfo-canary.yaml
@@ -2,6 +2,7 @@ apiVersion: flagger.app/v1beta1
 kind: Canary
 metadata:
   name: podinfo
+  namespace: test
 spec:
   provider: appmesh:v1beta2
   targetRef:
-- 
2.27.0

From 530980b1165b5ac8fc3784081254b48c0b675a2d Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 01:20:03 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/namespace.yaml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app/namespace.yaml b/app/namespace.yaml
index 84c21f8..855d6b6 100644
--- a/app/namespace.yaml
+++ b/app/namespace.yaml
@@ -8,6 +8,6 @@ metadata:
 apiVersion: v1
 kind: Namespace
 metadata:
-  name: dev
+  name: test
   labels:
     appmesh.k8s.aws/sidecarInjectorWebhook: enabled    
\ No newline at end of file
-- 
2.27.0

From 10bbb7fc05e852cc09dad68169d85c56f78d213f Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 01:28:07 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/podinfo-canary.yaml                |  1 -
 infrastructure/appmesh/appmesh-controller.yaml | 14 +++++++++-----
 2 files changed, 9 insertions(+), 6 deletions(-)

diff --git a/app/podinfo/podinfo-canary.yaml b/app/podinfo/podinfo-canary.yaml
index 962ec26..ff8b933 100644
--- a/app/podinfo/podinfo-canary.yaml
+++ b/app/podinfo/podinfo-canary.yaml
@@ -2,7 +2,6 @@ apiVersion: flagger.app/v1beta1
 kind: Canary
 metadata:
   name: podinfo
-  namespace: test
 spec:
   provider: appmesh:v1beta2
   targetRef:
diff --git a/infrastructure/appmesh/appmesh-controller.yaml b/infrastructure/appmesh/appmesh-controller.yaml
index 8997590..3d392bf 100644
--- a/infrastructure/appmesh/appmesh-controller.yaml
+++ b/infrastructure/appmesh/appmesh-controller.yaml
@@ -21,11 +21,15 @@ metadata:
 spec:
   interval: 1m0s
   chart:
-     spec:
-       chart: appmesh-inject
-       sourceRef: 
-          kind: HelmRepository
-          name: appmesh      
+    spec:
+      chart: appmesh-inject
+      sourceRef: 
+        kind: HelmRepository
+        name: appmesh     
+    values:
+      mesh:
+        create: true
+        name: apps         
 ---
 apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
-- 
2.27.0

From e4b727e617cbb290d73d0d0bfe41612321de8b0f Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 01:29:06 -0400
Subject: [PATCH] Add app mesh config yaml

---
 infrastructure/appmesh/appmesh-controller.yaml | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/infrastructure/appmesh/appmesh-controller.yaml b/infrastructure/appmesh/appmesh-controller.yaml
index 3d392bf..32d6aba 100644
--- a/infrastructure/appmesh/appmesh-controller.yaml
+++ b/infrastructure/appmesh/appmesh-controller.yaml
@@ -26,10 +26,10 @@ spec:
       sourceRef: 
         kind: HelmRepository
         name: appmesh     
-    values:
-      mesh:
-        create: true
-        name: apps         
+      values:
+        mesh:
+          create: true
+          name: apps         
 ---
 apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
-- 
2.27.0

From 9d0d6b887c623bf332db7fb8cb26e12ca6015d0b Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 01:29:48 -0400
Subject: [PATCH] Add app mesh config yaml

---
 infrastructure/appmesh/appmesh-controller.yaml | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/infrastructure/appmesh/appmesh-controller.yaml b/infrastructure/appmesh/appmesh-controller.yaml
index 32d6aba..ea670a7 100644
--- a/infrastructure/appmesh/appmesh-controller.yaml
+++ b/infrastructure/appmesh/appmesh-controller.yaml
@@ -26,10 +26,10 @@ spec:
       sourceRef: 
         kind: HelmRepository
         name: appmesh     
-      values:
-        mesh:
-          create: true
-          name: apps         
+  values:
+    mesh:
+      create: true
+      name: apps         
 ---
 apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
-- 
2.27.0

From c704bcbc43f6c459da5c076261ab0eeaffb5f9a6 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 01:37:52 -0400
Subject: [PATCH] Add app mesh config yaml

---
 .../appmesh/appmesh-controller.yaml           |   2 +
 infrastructure/appmesh/appmesh-crds.yaml      | 673 ++++++++++++++++++
 infrastructure/appmesh/kustomization.yaml     |   1 +
 3 files changed, 676 insertions(+)
 create mode 100644 infrastructure/appmesh/appmesh-crds.yaml

diff --git a/infrastructure/appmesh/appmesh-controller.yaml b/infrastructure/appmesh/appmesh-controller.yaml
index ea670a7..cb6e021 100644
--- a/infrastructure/appmesh/appmesh-controller.yaml
+++ b/infrastructure/appmesh/appmesh-controller.yaml
@@ -12,6 +12,7 @@ spec:
        sourceRef: 
           kind: HelmRepository
           name: appmesh    
+       version: 0.6.1          
 ---
 apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
@@ -26,6 +27,7 @@ spec:
       sourceRef: 
         kind: HelmRepository
         name: appmesh     
+      version: 0.9.0 
   values:
     mesh:
       create: true
diff --git a/infrastructure/appmesh/appmesh-crds.yaml b/infrastructure/appmesh/appmesh-crds.yaml
new file mode 100644
index 0000000..7c8b027
--- /dev/null
+++ b/infrastructure/appmesh/appmesh-crds.yaml
@@ -0,0 +1,673 @@
+---
+apiVersion: apiextensions.k8s.io/v1beta1
+kind: CustomResourceDefinition
+metadata:
+  name: meshes.appmesh.k8s.aws
+spec:
+  group: appmesh.k8s.aws
+  versions:
+    - name: v1beta1
+      served: true
+      storage: true
+    - name: v1alpha1
+      served: true
+      storage: false
+  version: v1beta1
+  scope: Cluster
+  names:
+    plural: meshes
+    singular: mesh
+    kind: Mesh
+    categories:
+      - all
+      - appmesh
+  subresources:
+    status: {}
+  validation:
+    openAPIV3Schema:
+      properties:
+        spec:
+          properties:
+            egressFilter:
+              type: object
+              required:
+                - type
+              properties:
+                type:
+                  type: string
+                  enum:
+                    - ALLOW_ALL
+                    - DROP_ALL
+            serviceDiscoveryType:
+              type: string
+              enum:
+                - dns
+        status:
+          properties:
+            meshArn:
+              type: string
+            conditions:
+              type: array
+              items:
+                type: object
+                required:
+                  - type
+                properties:
+                  type:
+                    type: string
+                    enum:
+                      - MeshActive
+                  status:
+                    type: string
+                    enum:
+                      - "True"
+                      - "False"
+                      - Unknown
+                  lastTransitionTime:
+                    type: string
+                  reason:
+                    type: string
+                  message:
+                    type: string
+---
+apiVersion: apiextensions.k8s.io/v1beta1
+kind: CustomResourceDefinition
+metadata:
+  name: virtualnodes.appmesh.k8s.aws
+spec:
+  group: appmesh.k8s.aws
+  versions:
+    - name: v1beta1
+      served: true
+      storage: true
+    - name: v1alpha1
+      served: true
+      storage: false
+  version: v1beta1
+  scope: Namespaced
+  names:
+    plural: virtualnodes
+    singular: virtualnode
+    kind: VirtualNode
+    categories:
+      - all
+      - appmesh
+  subresources:
+    status: {}
+  validation:
+    openAPIV3Schema:
+      required:
+        - spec
+      properties:
+        spec:
+          required:
+            - meshName
+          properties:
+            meshName:
+              type: string
+            listeners:
+              type: array
+              items:
+                type: object
+                required:
+                  - portMapping
+                properties:
+                  portMapping:
+                    required:
+                      - port
+                      - protocol
+                    properties:
+                      port:
+                        type: integer
+                      protocol:
+                        type: string
+                        enum:
+                          - tcp
+                          - http
+                          - grpc
+                          - http2
+                          - https
+                  healthCheck:
+                    properties:
+                      healthyThreshold:
+                        type: integer
+                      intervalMillis:
+                        type: integer
+                      path:
+                        type: string
+                      port:
+                        type: integer
+                      protocol:
+                        type: string
+                        enum:
+                          - tcp
+                          - http
+                          - http2
+                          - grpc
+                      timeoutMillis:
+                        type: integer
+                      unhealthyThreshold:
+                        type: integer
+                  tls:
+                    type: object
+                    required:
+                      - mode
+                      - certificate
+                    properties:
+                      mode:
+                        type: string
+                        enum:
+                          - 'DISABLED'
+                          - 'PERMISSIVE'
+                          - 'STRICT'
+                      certificate:
+                        type: object
+                        properties:
+                          acm:
+                            type: object
+                            required:
+                              - certificateArn
+                            properties:
+                              certificateArn:
+                                type: string
+                          file:
+                            type: object
+                            required:
+                              - certificateChain
+                              - privateKey
+                            properties:
+                              certificateChain:
+                                type: string
+                              privateKey:
+                                type: string
+            serviceDiscovery:
+              type: object
+              properties:
+                cloudMap:
+                  type: object
+                  properties:
+                    serviceName:
+                      type: string
+                    namespaceName:
+                      type: string
+                dns:
+                  type: object
+                  properties:
+                    hostName:
+                      type: string
+            backends:
+              type: array
+              items:
+                oneOf:
+                  - type: object
+                    properties:
+                      backendService:
+                        type: object
+                        properties:
+                          name:
+                            type: string
+                          clientPolicy:
+                            type: object
+                            properties:
+                              tls:
+                                type: object
+                                required:
+                                  - validation
+                                properties:
+                                  enforce:
+                                    type: boolean
+                                  ports:
+                                    type: array
+                                    items:
+                                      type: integer
+                                  validation:
+                                    type: object
+                                    required:
+                                      - trust
+                                    properties:
+                                      trust:
+                                        type: object
+                                        properties:
+                                          acm:
+                                            type: object
+                                            required:
+                                              - certificateAuthorityArns
+                                            properties:
+                                              certificateAuthorityArns:
+                                                type: array
+                                                items:
+                                                  type: string
+                                          file:
+                                            type: object
+                                            required:
+                                              - certificateChain
+                                            properties:
+                                              certificateChain:
+                                                type: string
+            backendDefaults:
+              type: object
+              properties:
+                clientPolicy:
+                  type: object
+                  properties:
+                    tls:
+                      type: object
+                      required:
+                        - validation
+                      properties:
+                        enforce:
+                          type: boolean
+                        ports:
+                          type: array
+                          items:
+                            type: integer
+                        validation:
+                          type: object
+                          required:
+                            - trust
+                          properties:
+                            trust:
+                              type: object
+                              properties:
+                                acm:
+                                  type: object
+                                  required:
+                                    - certificateAuthorityArns
+                                  properties:
+                                    certificateAuthorityArns:
+                                      type: array
+                                      items:
+                                        type: string
+                                file:
+                                  type: object
+                                  required:
+                                    - certificateChain
+                                  properties:
+                                    certificateChain:
+                                      type: string
+            logging:
+              type: object
+              properties:
+                accessLog:
+                  type: object
+                  properties:
+                    file:
+                      type: object
+                      properties:
+                        path:
+                          type: string
+        status:
+          properties:
+            meshArn:
+              type: string
+            virtualNodeArn:
+              type: string
+            conditions:
+              type: array
+              items:
+                type: object
+                required:
+                  - type
+                properties:
+                  type:
+                    type: string
+                    enum:
+                      - VirtualNodeActive
+                      - MeshMarkedForDeletion
+                  status:
+                    type: string
+                    enum:
+                      - "True"
+                      - "False"
+                      - Unknown
+                  lastTransitionTime:
+                    type: string
+                  reason:
+                    type: string
+                  message:
+                    type: string
+---
+apiVersion: apiextensions.k8s.io/v1beta1
+kind: CustomResourceDefinition
+metadata:
+  name: virtualservices.appmesh.k8s.aws
+spec:
+  group: appmesh.k8s.aws
+  versions:
+    - name: v1beta1
+      served: true
+      storage: true
+    - name: v1alpha1
+      served: true
+      storage: false
+  version: v1beta1
+  scope: Namespaced
+  names:
+    plural: virtualservices
+    singular: virtualservice
+    kind: VirtualService
+    categories:
+      - all
+      - appmesh
+  subresources:
+    status: {}
+  validation:
+    openAPIV3Schema:
+      required:
+        - spec
+      properties:
+        spec:
+          properties:
+            meshName:
+              type: string
+            virtualRouter:
+              type: object
+              properties:
+                name:
+                  type: string
+                listeners:
+                  type: array
+                  items:
+                    type: object
+                    properties:
+                      portMapping:
+                        properties:
+                          port:
+                            type: integer
+                          protocol:
+                            type: string
+                            enum:
+                              - tcp
+                              - http
+                              - grpc
+                              - http2
+                              - https
+            routes:
+              type: array
+              items:
+                type: object
+                properties:
+                  http:
+                    type: object
+                    properties:
+                      priority:
+                        type: integer
+                      match:
+                        type: object
+                        properties:
+                          prefix:
+                            type: string
+                          method:
+                            type: string
+                          scheme:
+                            type: string
+                          headers:
+                            type: array
+                            items:
+                              type: object
+                              properties:
+                                name:
+                                  type: string
+                                invert:
+                                  type: boolean
+                                match:
+                                  type: object
+                                  properties:
+                                    exact:
+                                      type: string
+                                    prefix:
+                                      type: string
+                                    regex:
+                                      type: string
+                                    suffix:
+                                      type: string
+                                    range:
+                                      type: object
+                                      properties:
+                                        start:
+                                          type: integer
+                                        end:
+                                          type: integer
+                      action:
+                        type: object
+                        properties:
+                          weightedTargets:
+                            type: array
+                            items:
+                              type: object
+                              properties:
+                                virtualNodeName:
+                                  type: string
+                                weight:
+                                  type: integer
+                      retryPolicy:
+                        type: object
+                        properties:
+                          perRetryTimeoutMillis:
+                            type: integer
+                          maxRetries:
+                            type: integer
+                          httpRetryEvents:
+                            type: array
+                            items:
+                              type: string
+                              enum:
+                                - 'server-error' # HTTP status codes 500, 501, 502, 503, 504, 505, 506, 507, 508, 510, and 511
+                                - 'gateway-error' # HTTP status codes 502, 503, and 504
+                                - 'client-error' # HTTP status code 409
+                                - 'stream-error' # Retry on refused stream
+                          tcpRetryEvents:
+                            type: array
+                            items:
+                              type: string
+                              enum:
+                                - 'connection-error'
+                  tcp:
+                    type: object
+                    properties:
+                      action:
+                        type: object
+                        properties:
+                          weightedTargets:
+                            type: array
+                            items:
+                              type: object
+                              properties:
+                                virtualNodeName:
+                                  type: string
+                                weight:
+                                  type: integer
+                  http2:
+                    type: object
+                    properties:
+                      priority:
+                        type: integer
+                      match:
+                        type: object
+                        properties:
+                          prefix:
+                            type: string
+                          method:
+                            type: string
+                          scheme:
+                            type: string
+                          headers:
+                            type: array
+                            items:
+                              type: object
+                              properties:
+                                name:
+                                  type: string
+                                invert:
+                                  type: boolean
+                                match:
+                                  type: object
+                                  properties:
+                                    exact:
+                                      type: string
+                                    prefix:
+                                      type: string
+                                    regex:
+                                      type: string
+                                    suffix:
+                                      type: string
+                                    range:
+                                      type: object
+                                      properties:
+                                        start:
+                                          type: integer
+                                        end:
+                                          type: integer
+                      action:
+                        type: object
+                        properties:
+                          weightedTargets:
+                            type: array
+                            items:
+                              type: object
+                              properties:
+                                virtualNodeName:
+                                  type: string
+                                weight:
+                                  type: integer
+                      retryPolicy:
+                        type: object
+                        properties:
+                          perRetryTimeoutMillis:
+                            type: integer
+                          maxRetries:
+                            type: integer
+                          httpRetryEvents:
+                            type: array
+                            items:
+                              type: string
+                              enum:
+                                - 'server-error' # HTTP status codes 500, 501, 502, 503, 504, 505, 506, 507, 508, 510, and 511
+                                - 'gateway-error' # HTTP status codes 502, 503, and 504
+                                - 'client-error' # HTTP status code 409
+                                - 'stream-error' # Retry on refused stream
+                          tcpRetryEvents:
+                            type: array
+                            items:
+                              type: string
+                              enum:
+                                - 'connection-error'
+                  grpc: 
+                    type: object
+                    properties:
+                      priority:
+                        type: integer
+                      match:
+                        type: object
+                        properties:
+                          serviceName:
+                            type: string
+                          methodName:
+                            type: string
+                          metadata:
+                            type: array
+                            items:
+                              type: object
+                              properties:
+                                name:
+                                  type: string
+                                invert:
+                                  type: boolean
+                                match:
+                                  type: object
+                                  properties:
+                                    exact:
+                                      type: string
+                                    prefix:
+                                      type: string
+                                    regex:
+                                      type: string
+                                    suffix:
+                                      type: string
+                                    range:
+                                      type: object
+                                      properties:
+                                        start:
+                                          type: integer
+                                        end:
+                                          type: integer
+                      action:
+                        type: object
+                        properties:
+                          weightedTargets: 
+                            type: array
+                            items:
+                              type: object
+                              properties:
+                                virtualNodeName:
+                                  type: string
+                                weight:
+                                  type: integer 
+                      retryPolicy:
+                        type: object
+                        properties:
+                          perRetryTimeoutMillis:
+                            type: integer                        
+                          maxRetries:
+                            type: integer                         
+                          httpRetryEvents:
+                            type: array
+                            items:
+                              type: string   
+                              enum:
+                                - 'server-error' # HTTP status codes 500, 501, 502, 503, 504, 505, 506, 507, 508, 510, and 511
+                                - 'gateway-error' # HTTP status codes 502, 503, and 504
+                                - 'client-error' # HTTP status code 409
+                                - 'stream-error' # Retry on refused stream
+                          tcpRetryEvents:
+                            type: array
+                            items:
+                              type: string
+                              enum:
+                                - 'connection-error'                          
+                          grpcRetryEvents:
+                            type: array
+                            items:
+                              type: string
+                              enum: 
+                                - 'cancelled'
+                                - 'deadline-exceeded'
+                                - 'internal'
+                                - 'resource-exhausted'
+                                - 'unavailable'
+        status:
+          properties:
+            virtualServiceArn:
+              type: string
+            virtualRouterArn:
+              type: string
+            routeArns:
+              type: array
+              items:
+                type: string
+            conditions:
+              type: array
+              items:
+                type: object
+                required:
+                  - type
+                properties:
+                  type:
+                    type: string
+                    enum:
+                      - VirtualServiceActive
+                      - VirtualRouterActive
+                      - RoutesActive
+                      - MeshMarkedForDeletion
+                  status:
+                    type: string
+                    enum:
+                      - "True"
+                      - "False"
+                      - Unknown
+                  lastTransitionTime:
+                    type: string
+                  reason:
+                    type: string
+                  message:
+                    type: string
\ No newline at end of file
diff --git a/infrastructure/appmesh/kustomization.yaml b/infrastructure/appmesh/kustomization.yaml
index cea3c6c..2c64d55 100644
--- a/infrastructure/appmesh/kustomization.yaml
+++ b/infrastructure/appmesh/kustomization.yaml
@@ -3,6 +3,7 @@ kind: Kustomization
 resources:
   - namespace.yaml
   - appmesh-repo.yaml
+  - appmesh-crds.yaml
   - appmesh-controller.yaml
   - appmesh-config.yaml
   - flagger.yaml
\ No newline at end of file
-- 
2.27.0

From 83837974284fc321b58cea52b28c9c5b64b6289f Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 01:42:55 -0400
Subject: [PATCH] Add app mesh config yaml

---
 infrastructure/appmesh/appmesh-controller.yaml | 6 +-----
 1 file changed, 1 insertion(+), 5 deletions(-)

diff --git a/infrastructure/appmesh/appmesh-controller.yaml b/infrastructure/appmesh/appmesh-controller.yaml
index cb6e021..31cb91c 100644
--- a/infrastructure/appmesh/appmesh-controller.yaml
+++ b/infrastructure/appmesh/appmesh-controller.yaml
@@ -27,11 +27,7 @@ spec:
       sourceRef: 
         kind: HelmRepository
         name: appmesh     
-      version: 0.9.0 
-  values:
-    mesh:
-      create: true
-      name: apps         
+      version: 0.9.0         
 ---
 apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
-- 
2.27.0

From a706d062f3339d5162adcbb0ab50d2a49b48f66f Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 01:46:00 -0400
Subject: [PATCH] Add app mesh config yaml

---
 .../appmesh/appmesh-controller.yaml           |   2 -
 infrastructure/appmesh/appmesh-crds.yaml      | 673 ------------------
 infrastructure/appmesh/kustomization.yaml     |   1 -
 3 files changed, 676 deletions(-)
 delete mode 100644 infrastructure/appmesh/appmesh-crds.yaml

diff --git a/infrastructure/appmesh/appmesh-controller.yaml b/infrastructure/appmesh/appmesh-controller.yaml
index 31cb91c..0b1fb6b 100644
--- a/infrastructure/appmesh/appmesh-controller.yaml
+++ b/infrastructure/appmesh/appmesh-controller.yaml
@@ -12,7 +12,6 @@ spec:
        sourceRef: 
           kind: HelmRepository
           name: appmesh    
-       version: 0.6.1          
 ---
 apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
@@ -27,7 +26,6 @@ spec:
       sourceRef: 
         kind: HelmRepository
         name: appmesh     
-      version: 0.9.0         
 ---
 apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
diff --git a/infrastructure/appmesh/appmesh-crds.yaml b/infrastructure/appmesh/appmesh-crds.yaml
deleted file mode 100644
index 7c8b027..0000000
--- a/infrastructure/appmesh/appmesh-crds.yaml
+++ /dev/null
@@ -1,673 +0,0 @@
----
-apiVersion: apiextensions.k8s.io/v1beta1
-kind: CustomResourceDefinition
-metadata:
-  name: meshes.appmesh.k8s.aws
-spec:
-  group: appmesh.k8s.aws
-  versions:
-    - name: v1beta1
-      served: true
-      storage: true
-    - name: v1alpha1
-      served: true
-      storage: false
-  version: v1beta1
-  scope: Cluster
-  names:
-    plural: meshes
-    singular: mesh
-    kind: Mesh
-    categories:
-      - all
-      - appmesh
-  subresources:
-    status: {}
-  validation:
-    openAPIV3Schema:
-      properties:
-        spec:
-          properties:
-            egressFilter:
-              type: object
-              required:
-                - type
-              properties:
-                type:
-                  type: string
-                  enum:
-                    - ALLOW_ALL
-                    - DROP_ALL
-            serviceDiscoveryType:
-              type: string
-              enum:
-                - dns
-        status:
-          properties:
-            meshArn:
-              type: string
-            conditions:
-              type: array
-              items:
-                type: object
-                required:
-                  - type
-                properties:
-                  type:
-                    type: string
-                    enum:
-                      - MeshActive
-                  status:
-                    type: string
-                    enum:
-                      - "True"
-                      - "False"
-                      - Unknown
-                  lastTransitionTime:
-                    type: string
-                  reason:
-                    type: string
-                  message:
-                    type: string
----
-apiVersion: apiextensions.k8s.io/v1beta1
-kind: CustomResourceDefinition
-metadata:
-  name: virtualnodes.appmesh.k8s.aws
-spec:
-  group: appmesh.k8s.aws
-  versions:
-    - name: v1beta1
-      served: true
-      storage: true
-    - name: v1alpha1
-      served: true
-      storage: false
-  version: v1beta1
-  scope: Namespaced
-  names:
-    plural: virtualnodes
-    singular: virtualnode
-    kind: VirtualNode
-    categories:
-      - all
-      - appmesh
-  subresources:
-    status: {}
-  validation:
-    openAPIV3Schema:
-      required:
-        - spec
-      properties:
-        spec:
-          required:
-            - meshName
-          properties:
-            meshName:
-              type: string
-            listeners:
-              type: array
-              items:
-                type: object
-                required:
-                  - portMapping
-                properties:
-                  portMapping:
-                    required:
-                      - port
-                      - protocol
-                    properties:
-                      port:
-                        type: integer
-                      protocol:
-                        type: string
-                        enum:
-                          - tcp
-                          - http
-                          - grpc
-                          - http2
-                          - https
-                  healthCheck:
-                    properties:
-                      healthyThreshold:
-                        type: integer
-                      intervalMillis:
-                        type: integer
-                      path:
-                        type: string
-                      port:
-                        type: integer
-                      protocol:
-                        type: string
-                        enum:
-                          - tcp
-                          - http
-                          - http2
-                          - grpc
-                      timeoutMillis:
-                        type: integer
-                      unhealthyThreshold:
-                        type: integer
-                  tls:
-                    type: object
-                    required:
-                      - mode
-                      - certificate
-                    properties:
-                      mode:
-                        type: string
-                        enum:
-                          - 'DISABLED'
-                          - 'PERMISSIVE'
-                          - 'STRICT'
-                      certificate:
-                        type: object
-                        properties:
-                          acm:
-                            type: object
-                            required:
-                              - certificateArn
-                            properties:
-                              certificateArn:
-                                type: string
-                          file:
-                            type: object
-                            required:
-                              - certificateChain
-                              - privateKey
-                            properties:
-                              certificateChain:
-                                type: string
-                              privateKey:
-                                type: string
-            serviceDiscovery:
-              type: object
-              properties:
-                cloudMap:
-                  type: object
-                  properties:
-                    serviceName:
-                      type: string
-                    namespaceName:
-                      type: string
-                dns:
-                  type: object
-                  properties:
-                    hostName:
-                      type: string
-            backends:
-              type: array
-              items:
-                oneOf:
-                  - type: object
-                    properties:
-                      backendService:
-                        type: object
-                        properties:
-                          name:
-                            type: string
-                          clientPolicy:
-                            type: object
-                            properties:
-                              tls:
-                                type: object
-                                required:
-                                  - validation
-                                properties:
-                                  enforce:
-                                    type: boolean
-                                  ports:
-                                    type: array
-                                    items:
-                                      type: integer
-                                  validation:
-                                    type: object
-                                    required:
-                                      - trust
-                                    properties:
-                                      trust:
-                                        type: object
-                                        properties:
-                                          acm:
-                                            type: object
-                                            required:
-                                              - certificateAuthorityArns
-                                            properties:
-                                              certificateAuthorityArns:
-                                                type: array
-                                                items:
-                                                  type: string
-                                          file:
-                                            type: object
-                                            required:
-                                              - certificateChain
-                                            properties:
-                                              certificateChain:
-                                                type: string
-            backendDefaults:
-              type: object
-              properties:
-                clientPolicy:
-                  type: object
-                  properties:
-                    tls:
-                      type: object
-                      required:
-                        - validation
-                      properties:
-                        enforce:
-                          type: boolean
-                        ports:
-                          type: array
-                          items:
-                            type: integer
-                        validation:
-                          type: object
-                          required:
-                            - trust
-                          properties:
-                            trust:
-                              type: object
-                              properties:
-                                acm:
-                                  type: object
-                                  required:
-                                    - certificateAuthorityArns
-                                  properties:
-                                    certificateAuthorityArns:
-                                      type: array
-                                      items:
-                                        type: string
-                                file:
-                                  type: object
-                                  required:
-                                    - certificateChain
-                                  properties:
-                                    certificateChain:
-                                      type: string
-            logging:
-              type: object
-              properties:
-                accessLog:
-                  type: object
-                  properties:
-                    file:
-                      type: object
-                      properties:
-                        path:
-                          type: string
-        status:
-          properties:
-            meshArn:
-              type: string
-            virtualNodeArn:
-              type: string
-            conditions:
-              type: array
-              items:
-                type: object
-                required:
-                  - type
-                properties:
-                  type:
-                    type: string
-                    enum:
-                      - VirtualNodeActive
-                      - MeshMarkedForDeletion
-                  status:
-                    type: string
-                    enum:
-                      - "True"
-                      - "False"
-                      - Unknown
-                  lastTransitionTime:
-                    type: string
-                  reason:
-                    type: string
-                  message:
-                    type: string
----
-apiVersion: apiextensions.k8s.io/v1beta1
-kind: CustomResourceDefinition
-metadata:
-  name: virtualservices.appmesh.k8s.aws
-spec:
-  group: appmesh.k8s.aws
-  versions:
-    - name: v1beta1
-      served: true
-      storage: true
-    - name: v1alpha1
-      served: true
-      storage: false
-  version: v1beta1
-  scope: Namespaced
-  names:
-    plural: virtualservices
-    singular: virtualservice
-    kind: VirtualService
-    categories:
-      - all
-      - appmesh
-  subresources:
-    status: {}
-  validation:
-    openAPIV3Schema:
-      required:
-        - spec
-      properties:
-        spec:
-          properties:
-            meshName:
-              type: string
-            virtualRouter:
-              type: object
-              properties:
-                name:
-                  type: string
-                listeners:
-                  type: array
-                  items:
-                    type: object
-                    properties:
-                      portMapping:
-                        properties:
-                          port:
-                            type: integer
-                          protocol:
-                            type: string
-                            enum:
-                              - tcp
-                              - http
-                              - grpc
-                              - http2
-                              - https
-            routes:
-              type: array
-              items:
-                type: object
-                properties:
-                  http:
-                    type: object
-                    properties:
-                      priority:
-                        type: integer
-                      match:
-                        type: object
-                        properties:
-                          prefix:
-                            type: string
-                          method:
-                            type: string
-                          scheme:
-                            type: string
-                          headers:
-                            type: array
-                            items:
-                              type: object
-                              properties:
-                                name:
-                                  type: string
-                                invert:
-                                  type: boolean
-                                match:
-                                  type: object
-                                  properties:
-                                    exact:
-                                      type: string
-                                    prefix:
-                                      type: string
-                                    regex:
-                                      type: string
-                                    suffix:
-                                      type: string
-                                    range:
-                                      type: object
-                                      properties:
-                                        start:
-                                          type: integer
-                                        end:
-                                          type: integer
-                      action:
-                        type: object
-                        properties:
-                          weightedTargets:
-                            type: array
-                            items:
-                              type: object
-                              properties:
-                                virtualNodeName:
-                                  type: string
-                                weight:
-                                  type: integer
-                      retryPolicy:
-                        type: object
-                        properties:
-                          perRetryTimeoutMillis:
-                            type: integer
-                          maxRetries:
-                            type: integer
-                          httpRetryEvents:
-                            type: array
-                            items:
-                              type: string
-                              enum:
-                                - 'server-error' # HTTP status codes 500, 501, 502, 503, 504, 505, 506, 507, 508, 510, and 511
-                                - 'gateway-error' # HTTP status codes 502, 503, and 504
-                                - 'client-error' # HTTP status code 409
-                                - 'stream-error' # Retry on refused stream
-                          tcpRetryEvents:
-                            type: array
-                            items:
-                              type: string
-                              enum:
-                                - 'connection-error'
-                  tcp:
-                    type: object
-                    properties:
-                      action:
-                        type: object
-                        properties:
-                          weightedTargets:
-                            type: array
-                            items:
-                              type: object
-                              properties:
-                                virtualNodeName:
-                                  type: string
-                                weight:
-                                  type: integer
-                  http2:
-                    type: object
-                    properties:
-                      priority:
-                        type: integer
-                      match:
-                        type: object
-                        properties:
-                          prefix:
-                            type: string
-                          method:
-                            type: string
-                          scheme:
-                            type: string
-                          headers:
-                            type: array
-                            items:
-                              type: object
-                              properties:
-                                name:
-                                  type: string
-                                invert:
-                                  type: boolean
-                                match:
-                                  type: object
-                                  properties:
-                                    exact:
-                                      type: string
-                                    prefix:
-                                      type: string
-                                    regex:
-                                      type: string
-                                    suffix:
-                                      type: string
-                                    range:
-                                      type: object
-                                      properties:
-                                        start:
-                                          type: integer
-                                        end:
-                                          type: integer
-                      action:
-                        type: object
-                        properties:
-                          weightedTargets:
-                            type: array
-                            items:
-                              type: object
-                              properties:
-                                virtualNodeName:
-                                  type: string
-                                weight:
-                                  type: integer
-                      retryPolicy:
-                        type: object
-                        properties:
-                          perRetryTimeoutMillis:
-                            type: integer
-                          maxRetries:
-                            type: integer
-                          httpRetryEvents:
-                            type: array
-                            items:
-                              type: string
-                              enum:
-                                - 'server-error' # HTTP status codes 500, 501, 502, 503, 504, 505, 506, 507, 508, 510, and 511
-                                - 'gateway-error' # HTTP status codes 502, 503, and 504
-                                - 'client-error' # HTTP status code 409
-                                - 'stream-error' # Retry on refused stream
-                          tcpRetryEvents:
-                            type: array
-                            items:
-                              type: string
-                              enum:
-                                - 'connection-error'
-                  grpc: 
-                    type: object
-                    properties:
-                      priority:
-                        type: integer
-                      match:
-                        type: object
-                        properties:
-                          serviceName:
-                            type: string
-                          methodName:
-                            type: string
-                          metadata:
-                            type: array
-                            items:
-                              type: object
-                              properties:
-                                name:
-                                  type: string
-                                invert:
-                                  type: boolean
-                                match:
-                                  type: object
-                                  properties:
-                                    exact:
-                                      type: string
-                                    prefix:
-                                      type: string
-                                    regex:
-                                      type: string
-                                    suffix:
-                                      type: string
-                                    range:
-                                      type: object
-                                      properties:
-                                        start:
-                                          type: integer
-                                        end:
-                                          type: integer
-                      action:
-                        type: object
-                        properties:
-                          weightedTargets: 
-                            type: array
-                            items:
-                              type: object
-                              properties:
-                                virtualNodeName:
-                                  type: string
-                                weight:
-                                  type: integer 
-                      retryPolicy:
-                        type: object
-                        properties:
-                          perRetryTimeoutMillis:
-                            type: integer                        
-                          maxRetries:
-                            type: integer                         
-                          httpRetryEvents:
-                            type: array
-                            items:
-                              type: string   
-                              enum:
-                                - 'server-error' # HTTP status codes 500, 501, 502, 503, 504, 505, 506, 507, 508, 510, and 511
-                                - 'gateway-error' # HTTP status codes 502, 503, and 504
-                                - 'client-error' # HTTP status code 409
-                                - 'stream-error' # Retry on refused stream
-                          tcpRetryEvents:
-                            type: array
-                            items:
-                              type: string
-                              enum:
-                                - 'connection-error'                          
-                          grpcRetryEvents:
-                            type: array
-                            items:
-                              type: string
-                              enum: 
-                                - 'cancelled'
-                                - 'deadline-exceeded'
-                                - 'internal'
-                                - 'resource-exhausted'
-                                - 'unavailable'
-        status:
-          properties:
-            virtualServiceArn:
-              type: string
-            virtualRouterArn:
-              type: string
-            routeArns:
-              type: array
-              items:
-                type: string
-            conditions:
-              type: array
-              items:
-                type: object
-                required:
-                  - type
-                properties:
-                  type:
-                    type: string
-                    enum:
-                      - VirtualServiceActive
-                      - VirtualRouterActive
-                      - RoutesActive
-                      - MeshMarkedForDeletion
-                  status:
-                    type: string
-                    enum:
-                      - "True"
-                      - "False"
-                      - Unknown
-                  lastTransitionTime:
-                    type: string
-                  reason:
-                    type: string
-                  message:
-                    type: string
\ No newline at end of file
diff --git a/infrastructure/appmesh/kustomization.yaml b/infrastructure/appmesh/kustomization.yaml
index 2c64d55..cea3c6c 100644
--- a/infrastructure/appmesh/kustomization.yaml
+++ b/infrastructure/appmesh/kustomization.yaml
@@ -3,7 +3,6 @@ kind: Kustomization
 resources:
   - namespace.yaml
   - appmesh-repo.yaml
-  - appmesh-crds.yaml
   - appmesh-controller.yaml
   - appmesh-config.yaml
   - flagger.yaml
\ No newline at end of file
-- 
2.27.0

From 6d14bc9f40112babaa3ecbc898e93ed8ab4bcdb0 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 02:34:41 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/podinfo-canary.yaml            |    4 +-
 cluster.yaml                               |    8 +
 infrastructure/appmesh/appmesh-config.yaml |    2 +-
 infrastructure/appmesh/appmesh-crds.yaml   | 3345 ++++++++++++++++++++
 infrastructure/appmesh/kustomization.yaml  |    1 +
 5 files changed, 3357 insertions(+), 3 deletions(-)
 create mode 100644 infrastructure/appmesh/appmesh-crds.yaml

diff --git a/app/podinfo/podinfo-canary.yaml b/app/podinfo/podinfo-canary.yaml
index ff8b933..0405433 100644
--- a/app/podinfo/podinfo-canary.yaml
+++ b/app/podinfo/podinfo-canary.yaml
@@ -42,11 +42,11 @@ spec:
       - name: request-success-rate
         thresholdRange:
           min: 99
-        interval: 1m
+        interval: 5s
       - name: request-duration
         thresholdRange:
           max: 500
-        interval: 30s
+        interval: 5s
     # testing (optional)
     # webhooks:
     #   - name: acceptance-test
diff --git a/cluster.yaml b/cluster.yaml
index 2c99be8..d255e92 100644
--- a/cluster.yaml
+++ b/cluster.yaml
@@ -5,11 +5,19 @@ metadata:
   name: eks-gitops-demo
   region: us-east-1
 
+availabilityZones: 
+  - us-east-1a
+  - us-east-1b
+
 managedNodeGroups:
   - name: eks-gitops-demo-ng
     instanceType: t3.medium
     minSize: 2
     maxSize: 3
+    iam:
+      withAddonPolicies:
+        appMesh: true
+        appMeshPreview: true
 
 gitops:
   flux:
diff --git a/infrastructure/appmesh/appmesh-config.yaml b/infrastructure/appmesh/appmesh-config.yaml
index 119a756..888d6d4 100644
--- a/infrastructure/appmesh/appmesh-config.yaml
+++ b/infrastructure/appmesh/appmesh-config.yaml
@@ -1,7 +1,7 @@
 apiVersion: appmesh.k8s.aws/v1beta2
 kind: Mesh
 metadata:
-  name: global
+  name: apps
 spec:
   namespaceSelector:
     matchLabels:
diff --git a/infrastructure/appmesh/appmesh-crds.yaml b/infrastructure/appmesh/appmesh-crds.yaml
new file mode 100644
index 0000000..6dbef78
--- /dev/null
+++ b/infrastructure/appmesh/appmesh-crds.yaml
@@ -0,0 +1,3345 @@
+apiVersion: apiextensions.k8s.io/v1beta1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: v0.4.1
+  creationTimestamp: null
+  name: gatewayroutes.appmesh.k8s.aws
+spec:
+  additionalPrinterColumns:
+  - JSONPath: .status.gatewayRouteARN
+    description: The AppMesh GatewayRoute object's Amazon Resource Name
+    name: ARN
+    type: string
+  - JSONPath: .metadata.creationTimestamp
+    name: AGE
+    type: date
+  group: appmesh.k8s.aws
+  names:
+    categories:
+    - all
+    kind: GatewayRoute
+    listKind: GatewayRouteList
+    plural: gatewayroutes
+    singular: gatewayroute
+  scope: Namespaced
+  subresources:
+    status: {}
+  validation:
+    openAPIV3Schema:
+      description: GatewayRoute is the Schema for the gatewayroutes API
+      properties:
+        apiVersion:
+          description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+          type: string
+        kind:
+          description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+          type: string
+        metadata:
+          type: object
+        spec:
+          description: GatewayRouteSpec defines the desired state of GatewayRoute refers to https://docs.aws.amazon.com/app-mesh/latest/userguide/virtual_gateways.html
+          properties:
+            awsName:
+              description: AWSName is the AppMesh GatewayRoute object's name. If unspecified or empty, it defaults to be "${name}_${namespace}" of k8s GatewayRoute
+              type: string
+            grpcRoute:
+              description: An object that represents the specification of a gRPC gatewayRoute.
+              properties:
+                action:
+                  description: An object that represents the action to take if a match is determined.
+                  properties:
+                    rewrite:
+                      properties:
+                        hostname:
+                          description: ENABLE or DISABLE default behavior for Hostname rewrite
+                          properties:
+                            defaultTargetHostname:
+                              enum:
+                              - ENABLED
+                              - DISABLED
+                              type: string
+                          type: object
+                      type: object
+                    target:
+                      description: An object that represents the target that traffic is routed to when a request matches the route.
+                      properties:
+                        virtualService:
+                          description: The virtual service to associate with the gateway route target.
+                          properties:
+                            virtualServiceARN:
+                              description: Amazon Resource Name to AppMesh VirtualService object to associate with the gateway route virtual service target. Exactly one of 'virtualServiceRef' or 'virtualServiceARN' must be specified.
+                              type: string
+                            virtualServiceRef:
+                              description: Reference to Kubernetes VirtualService CR in cluster to associate with the gateway route virtual service target. Exactly one of 'virtualServiceRef' or 'virtualServiceARN' must be specified.
+                              properties:
+                                name:
+                                  description: Name is the name of VirtualService CR
+                                  type: string
+                                namespace:
+                                  description: Namespace is the namespace of VirtualService CR. If unspecified, defaults to the referencing object's namespace
+                                  type: string
+                              required:
+                              - name
+                              type: object
+                          type: object
+                      required:
+                      - virtualService
+                      type: object
+                  required:
+                  - target
+                  type: object
+                match:
+                  description: An object that represents the criteria for determining a request match.
+                  properties:
+                    hostname:
+                      description: The client specified Hostname to match on.
+                      properties:
+                        exact:
+                          description: The value sent by the client must match the specified value exactly.
+                          maxLength: 253
+                          minLength: 1
+                          type: string
+                        suffix:
+                          description: The value sent by the client must end with the specified characters.
+                          maxLength: 253
+                          minLength: 1
+                          type: string
+                      type: object
+                    metadata:
+                      description: An object that represents the data to match from the request.
+                      items:
+                        description: GRPCGatewayRouteMetadata refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_GrpcRouteMetadata.html
+                        properties:
+                          invert:
+                            description: Specify True to match anything except the match criteria. The default value is False.
+                            type: boolean
+                          match:
+                            description: An object that represents the data to match from the request.
+                            properties:
+                              exact:
+                                description: The value sent by the client must match the specified value exactly.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                              prefix:
+                                description: The value sent by the client must begin with the specified characters.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                              range:
+                                description: An object that represents the range of values to match on
+                                properties:
+                                  end:
+                                    description: The end of the range.
+                                    format: int64
+                                    type: integer
+                                  start:
+                                    description: The start of the range.
+                                    format: int64
+                                    type: integer
+                                required:
+                                - end
+                                - start
+                                type: object
+                              regex:
+                                description: The value sent by the client must include the specified characters.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                              suffix:
+                                description: The value sent by the client must end with the specified characters.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                            type: object
+                          name:
+                            description: The name of the route.
+                            maxLength: 50
+                            minLength: 1
+                            type: string
+                        required:
+                        - name
+                        type: object
+                      maxItems: 10
+                      minItems: 1
+                      type: array
+                    serviceName:
+                      description: Either ServiceName or Hostname must be specified. Both are allowed as well The fully qualified domain name for the service to match from the request.
+                      type: string
+                  type: object
+              required:
+              - action
+              - match
+              type: object
+            http2Route:
+              description: An object that represents the specification of an HTTP/2 gatewayRoute.
+              properties:
+                action:
+                  description: An object that represents the action to take if a match is determined.
+                  properties:
+                    rewrite:
+                      properties:
+                        hostname:
+                          description: ENABLE or DISABLE default behavior for Hostname rewrite
+                          properties:
+                            defaultTargetHostname:
+                              enum:
+                              - ENABLED
+                              - DISABLED
+                              type: string
+                          type: object
+                        path:
+                          properties:
+                            exact:
+                              maxLength: 255
+                              minLength: 1
+                              type: string
+                          type: object
+                        prefix:
+                          properties:
+                            defaultPrefix:
+                              enum:
+                              - ENABLED
+                              - DISABLED
+                              type: string
+                            value:
+                              description: When DefaultPrefix is specified, Value cannot be set
+                              maxLength: 255
+                              minLength: 1
+                              type: string
+                          type: object
+                      type: object
+                    target:
+                      description: An object that represents the target that traffic is routed to when a request matches the route.
+                      properties:
+                        virtualService:
+                          description: The virtual service to associate with the gateway route target.
+                          properties:
+                            virtualServiceARN:
+                              description: Amazon Resource Name to AppMesh VirtualService object to associate with the gateway route virtual service target. Exactly one of 'virtualServiceRef' or 'virtualServiceARN' must be specified.
+                              type: string
+                            virtualServiceRef:
+                              description: Reference to Kubernetes VirtualService CR in cluster to associate with the gateway route virtual service target. Exactly one of 'virtualServiceRef' or 'virtualServiceARN' must be specified.
+                              properties:
+                                name:
+                                  description: Name is the name of VirtualService CR
+                                  type: string
+                                namespace:
+                                  description: Namespace is the namespace of VirtualService CR. If unspecified, defaults to the referencing object's namespace
+                                  type: string
+                              required:
+                              - name
+                              type: object
+                          type: object
+                      required:
+                      - virtualService
+                      type: object
+                  required:
+                  - target
+                  type: object
+                match:
+                  description: An object that represents the criteria for determining a request match.
+                  properties:
+                    headers:
+                      description: An object that represents the client request headers to match on.
+                      items:
+                        description: HTTPGatewayRouteHeader refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_HttpRouteHeader.html
+                        properties:
+                          invert:
+                            description: Specify True to match anything except the match criteria. The default value is False.
+                            type: boolean
+                          match:
+                            description: The HeaderMatchMethod object.
+                            properties:
+                              exact:
+                                description: The value sent by the client must match the specified value exactly.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                              prefix:
+                                description: The value sent by the client must begin with the specified characters.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                              range:
+                                description: An object that represents the range of values to match on.
+                                properties:
+                                  end:
+                                    description: The end of the range.
+                                    format: int64
+                                    type: integer
+                                  start:
+                                    description: The start of the range.
+                                    format: int64
+                                    type: integer
+                                required:
+                                - end
+                                - start
+                                type: object
+                              regex:
+                                description: The value sent by the client must include the specified characters.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                              suffix:
+                                description: The value sent by the client must end with the specified characters.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                            type: object
+                          name:
+                            description: A name for the HTTP header in the client request that will be matched on.
+                            maxLength: 50
+                            minLength: 1
+                            type: string
+                        required:
+                        - name
+                        type: object
+                      maxItems: 10
+                      minItems: 1
+                      type: array
+                    hostname:
+                      description: The client specified Hostname to match on.
+                      properties:
+                        exact:
+                          description: The value sent by the client must match the specified value exactly.
+                          maxLength: 253
+                          minLength: 1
+                          type: string
+                        suffix:
+                          description: The value sent by the client must end with the specified characters.
+                          maxLength: 253
+                          minLength: 1
+                          type: string
+                      type: object
+                    method:
+                      description: The client request method to match on.
+                      enum:
+                      - CONNECT
+                      - DELETE
+                      - GET
+                      - HEAD
+                      - OPTIONS
+                      - PATCH
+                      - POST
+                      - PUT
+                      - TRACE
+                      type: string
+                    path:
+                      properties:
+                        exact:
+                          description: The value sent by the client must match the specified value exactly.
+                          maxLength: 255
+                          minLength: 1
+                          type: string
+                        regex:
+                          description: The value sent by the client must end with the specified characters.
+                          maxLength: 255
+                          minLength: 1
+                          type: string
+                      type: object
+                    prefix:
+                      description: Either Prefix or Hostname must be specified. Both are allowed as well. Specifies the path to match requests with
+                      type: string
+                    queryParameters:
+                      items:
+                        properties:
+                          match:
+                            description: The HTTPQueryMatchMethod object.
+                            properties:
+                              exact:
+                                type: string
+                            type: object
+                          name:
+                            type: string
+                        required:
+                        - name
+                        type: object
+                      maxItems: 10
+                      minItems: 1
+                      type: array
+                  type: object
+              required:
+              - action
+              - match
+              type: object
+            httpRoute:
+              description: An object that represents the specification of an HTTP gatewayRoute.
+              properties:
+                action:
+                  description: An object that represents the action to take if a match is determined.
+                  properties:
+                    rewrite:
+                      properties:
+                        hostname:
+                          description: ENABLE or DISABLE default behavior for Hostname rewrite
+                          properties:
+                            defaultTargetHostname:
+                              enum:
+                              - ENABLED
+                              - DISABLED
+                              type: string
+                          type: object
+                        path:
+                          properties:
+                            exact:
+                              maxLength: 255
+                              minLength: 1
+                              type: string
+                          type: object
+                        prefix:
+                          properties:
+                            defaultPrefix:
+                              enum:
+                              - ENABLED
+                              - DISABLED
+                              type: string
+                            value:
+                              description: When DefaultPrefix is specified, Value cannot be set
+                              maxLength: 255
+                              minLength: 1
+                              type: string
+                          type: object
+                      type: object
+                    target:
+                      description: An object that represents the target that traffic is routed to when a request matches the route.
+                      properties:
+                        virtualService:
+                          description: The virtual service to associate with the gateway route target.
+                          properties:
+                            virtualServiceARN:
+                              description: Amazon Resource Name to AppMesh VirtualService object to associate with the gateway route virtual service target. Exactly one of 'virtualServiceRef' or 'virtualServiceARN' must be specified.
+                              type: string
+                            virtualServiceRef:
+                              description: Reference to Kubernetes VirtualService CR in cluster to associate with the gateway route virtual service target. Exactly one of 'virtualServiceRef' or 'virtualServiceARN' must be specified.
+                              properties:
+                                name:
+                                  description: Name is the name of VirtualService CR
+                                  type: string
+                                namespace:
+                                  description: Namespace is the namespace of VirtualService CR. If unspecified, defaults to the referencing object's namespace
+                                  type: string
+                              required:
+                              - name
+                              type: object
+                          type: object
+                      required:
+                      - virtualService
+                      type: object
+                  required:
+                  - target
+                  type: object
+                match:
+                  description: An object that represents the criteria for determining a request match.
+                  properties:
+                    headers:
+                      description: An object that represents the client request headers to match on.
+                      items:
+                        description: HTTPGatewayRouteHeader refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_HttpRouteHeader.html
+                        properties:
+                          invert:
+                            description: Specify True to match anything except the match criteria. The default value is False.
+                            type: boolean
+                          match:
+                            description: The HeaderMatchMethod object.
+                            properties:
+                              exact:
+                                description: The value sent by the client must match the specified value exactly.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                              prefix:
+                                description: The value sent by the client must begin with the specified characters.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                              range:
+                                description: An object that represents the range of values to match on.
+                                properties:
+                                  end:
+                                    description: The end of the range.
+                                    format: int64
+                                    type: integer
+                                  start:
+                                    description: The start of the range.
+                                    format: int64
+                                    type: integer
+                                required:
+                                - end
+                                - start
+                                type: object
+                              regex:
+                                description: The value sent by the client must include the specified characters.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                              suffix:
+                                description: The value sent by the client must end with the specified characters.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                            type: object
+                          name:
+                            description: A name for the HTTP header in the client request that will be matched on.
+                            maxLength: 50
+                            minLength: 1
+                            type: string
+                        required:
+                        - name
+                        type: object
+                      maxItems: 10
+                      minItems: 1
+                      type: array
+                    hostname:
+                      description: The client specified Hostname to match on.
+                      properties:
+                        exact:
+                          description: The value sent by the client must match the specified value exactly.
+                          maxLength: 253
+                          minLength: 1
+                          type: string
+                        suffix:
+                          description: The value sent by the client must end with the specified characters.
+                          maxLength: 253
+                          minLength: 1
+                          type: string
+                      type: object
+                    method:
+                      description: The client request method to match on.
+                      enum:
+                      - CONNECT
+                      - DELETE
+                      - GET
+                      - HEAD
+                      - OPTIONS
+                      - PATCH
+                      - POST
+                      - PUT
+                      - TRACE
+                      type: string
+                    path:
+                      properties:
+                        exact:
+                          description: The value sent by the client must match the specified value exactly.
+                          maxLength: 255
+                          minLength: 1
+                          type: string
+                        regex:
+                          description: The value sent by the client must end with the specified characters.
+                          maxLength: 255
+                          minLength: 1
+                          type: string
+                      type: object
+                    prefix:
+                      description: Either Prefix or Hostname must be specified. Both are allowed as well. Specifies the path to match requests with
+                      type: string
+                    queryParameters:
+                      items:
+                        properties:
+                          match:
+                            description: The HTTPQueryMatchMethod object.
+                            properties:
+                              exact:
+                                type: string
+                            type: object
+                          name:
+                            type: string
+                        required:
+                        - name
+                        type: object
+                      maxItems: 10
+                      minItems: 1
+                      type: array
+                  type: object
+              required:
+              - action
+              - match
+              type: object
+            meshRef:
+              description: "A reference to k8s Mesh CR that this GatewayRoute belongs to. The admission controller populates it using Meshes's selector, and prevents users from setting this field. \n Populated by the system. Read-only."
+              properties:
+                name:
+                  description: Name is the name of Mesh CR
+                  type: string
+                uid:
+                  description: UID is the UID of Mesh CR
+                  type: string
+              required:
+              - name
+              - uid
+              type: object
+            priority:
+              description: Priority for the gatewayroute. Default Priority is 1000 which is lowest priority
+              format: int64
+              maximum: 1000
+              minimum: 0
+              type: integer
+            virtualGatewayRef:
+              description: "A reference to k8s VirtualGateway CR that this GatewayRoute belongs to. The admission controller populates it using VirtualGateway's selector, and prevents users from setting this field. \n Populated by the system. Read-only."
+              properties:
+                name:
+                  description: Name is the name of VirtualGateway CR
+                  type: string
+                namespace:
+                  description: Namespace is the namespace of VirtualGateway CR. If unspecified, defaults to the referencing object's namespace
+                  type: string
+                uid:
+                  description: UID is the UID of VirtualGateway CR
+                  type: string
+              required:
+              - name
+              - uid
+              type: object
+          type: object
+        status:
+          description: GatewayRouteStatus defines the observed state of GatewayRoute
+          properties:
+            conditions:
+              description: The current GatewayRoute status.
+              items:
+                properties:
+                  lastTransitionTime:
+                    description: Last time the condition transitioned from one status to another.
+                    format: date-time
+                    type: string
+                  message:
+                    description: A human readable message indicating details about the transition.
+                    type: string
+                  reason:
+                    description: The reason for the condition's last transition.
+                    type: string
+                  status:
+                    description: Status of the condition, one of True, False, Unknown.
+                    type: string
+                  type:
+                    description: Type of GatewayRoute condition.
+                    type: string
+                required:
+                - status
+                - type
+                type: object
+              type: array
+            gatewayRouteARN:
+              description: GatewayRouteARN is the AppMesh GatewayRoute object's Amazon Resource Name
+              type: string
+            observedGeneration:
+              description: The generation observed by the GatewayRoute controller.
+              format: int64
+              type: integer
+          type: object
+      type: object
+  version: v1beta2
+  versions:
+  - name: v1beta2
+    served: true
+    storage: true
+status:
+  acceptedNames:
+    kind: ""
+    plural: ""
+  conditions: []
+  storedVersions: []
+---
+apiVersion: apiextensions.k8s.io/v1beta1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: v0.4.1
+  creationTimestamp: null
+  name: meshes.appmesh.k8s.aws
+spec:
+  additionalPrinterColumns:
+  - JSONPath: .status.meshARN
+    description: The AppMesh Mesh object's Amazon Resource Name
+    name: ARN
+    type: string
+  - JSONPath: .metadata.creationTimestamp
+    name: AGE
+    type: date
+  group: appmesh.k8s.aws
+  names:
+    kind: Mesh
+    listKind: MeshList
+    plural: meshes
+    singular: mesh
+  scope: Cluster
+  subresources:
+    status: {}
+  validation:
+    openAPIV3Schema:
+      description: Mesh is the Schema for the meshes API
+      properties:
+        apiVersion:
+          description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+          type: string
+        kind:
+          description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+          type: string
+        metadata:
+          type: object
+        spec:
+          description: MeshSpec defines the desired state of Mesh refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_MeshSpec.html
+          properties:
+            awsName:
+              description: AWSName is the AppMesh Mesh object's name. If unspecified or empty, it defaults to be "${name}" of k8s Mesh
+              type: string
+            egressFilter:
+              description: The egress filter rules for the service mesh. If unspecified, default settings from AWS API will be applied. Refer to AWS Docs for default settings.
+              properties:
+                type:
+                  description: The egress filter type.
+                  enum:
+                  - ALLOW_ALL
+                  - DROP_ALL
+                  type: string
+              required:
+              - type
+              type: object
+            meshOwner:
+              description: The AWS IAM account ID of the service mesh owner. Required if the account ID is not your own.
+              type: string
+            namespaceSelector:
+              description: "NamespaceSelector selects Namespaces using labels to designate mesh membership. This field follows standard label selector semantics: \tif present but empty, it selects all namespaces. \tif absent, it selects no namespace."
+              properties:
+                matchExpressions:
+                  description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
+                  items:
+                    description: A label selector requirement is a selector that contains values, a key, and an operator that relates the key and values.
+                    properties:
+                      key:
+                        description: key is the label key that the selector applies to.
+                        type: string
+                      operator:
+                        description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
+                        type: string
+                      values:
+                        description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
+                        items:
+                          type: string
+                        type: array
+                    required:
+                    - key
+                    - operator
+                    type: object
+                  type: array
+                matchLabels:
+                  additionalProperties:
+                    type: string
+                  description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
+                  type: object
+              type: object
+          type: object
+        status:
+          description: MeshStatus defines the observed state of Mesh
+          properties:
+            conditions:
+              description: The current Mesh status.
+              items:
+                properties:
+                  lastTransitionTime:
+                    description: Last time the condition transitioned from one status to another.
+                    format: date-time
+                    type: string
+                  message:
+                    description: A human readable message indicating details about the transition.
+                    type: string
+                  reason:
+                    description: The reason for the condition's last transition.
+                    type: string
+                  status:
+                    description: Status of the condition, one of True, False, Unknown.
+                    type: string
+                  type:
+                    description: Type of mesh condition.
+                    type: string
+                required:
+                - status
+                - type
+                type: object
+              type: array
+            meshARN:
+              description: MeshARN is the AppMesh Mesh object's Amazon Resource Name
+              type: string
+            observedGeneration:
+              description: The generation observed by the Mesh controller.
+              format: int64
+              type: integer
+          type: object
+      type: object
+  version: v1beta2
+  versions:
+  - name: v1beta2
+    served: true
+    storage: true
+status:
+  acceptedNames:
+    kind: ""
+    plural: ""
+  conditions: []
+  storedVersions: []
+---
+apiVersion: apiextensions.k8s.io/v1beta1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: v0.4.1
+  creationTimestamp: null
+  name: virtualgateways.appmesh.k8s.aws
+spec:
+  additionalPrinterColumns:
+  - JSONPath: .status.virtualGatewayARN
+    description: The AppMesh VirtualGateway object's Amazon Resource Name
+    name: ARN
+    type: string
+  - JSONPath: .metadata.creationTimestamp
+    name: AGE
+    type: date
+  group: appmesh.k8s.aws
+  names:
+    categories:
+    - all
+    kind: VirtualGateway
+    listKind: VirtualGatewayList
+    plural: virtualgateways
+    singular: virtualgateway
+  scope: Namespaced
+  subresources:
+    status: {}
+  validation:
+    openAPIV3Schema:
+      description: VirtualGateway is the Schema for the virtualgateways API
+      properties:
+        apiVersion:
+          description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+          type: string
+        kind:
+          description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+          type: string
+        metadata:
+          type: object
+        spec:
+          description: VirtualGatewaySpec defines the desired state of VirtualGateway refers to https://docs.aws.amazon.com/app-mesh/latest/userguide/virtual_gateways.html
+          properties:
+            awsName:
+              description: AWSName is the AppMesh VirtualGateway object's name. If unspecified or empty, it defaults to be "${name}_${namespace}" of k8s VirtualGateway
+              type: string
+            backendDefaults:
+              description: A reference to an object that represents the defaults for backend GatewayRoutes.
+              properties:
+                clientPolicy:
+                  description: A reference to an object that represents a client policy.
+                  properties:
+                    tls:
+                      description: A reference to an object that represents a Transport Layer Security (TLS) client policy.
+                      properties:
+                        certificate:
+                          description: A reference to an object that represents TLS certificate.
+                          properties:
+                            file:
+                              description: An object that represents a TLS cert via a local file
+                              properties:
+                                certificateChain:
+                                  description: The certificate chain for the certificate.
+                                  maxLength: 255
+                                  minLength: 1
+                                  type: string
+                                privateKey:
+                                  description: The private key for a certificate stored on the file system of the virtual Gateway.
+                                  maxLength: 255
+                                  minLength: 1
+                                  type: string
+                              required:
+                              - certificateChain
+                              - privateKey
+                              type: object
+                            sds:
+                              description: An object that represents a TLS cert via SDS entry
+                              properties:
+                                secretName:
+                                  description: The certificate trust chain for a certificate issued via SDS cluster
+                                  type: string
+                              required:
+                              - secretName
+                              type: object
+                          type: object
+                        enforce:
+                          description: Whether the policy is enforced. If unspecified, default settings from AWS API will be applied. Refer to AWS Docs for default settings.
+                          type: boolean
+                        ports:
+                          description: The range of ports that the policy is enforced for.
+                          items:
+                            format: int64
+                            maximum: 65535
+                            minimum: 1
+                            type: integer
+                          type: array
+                        validation:
+                          description: A reference to an object that represents a TLS validation context.
+                          properties:
+                            subjectAlternativeNames:
+                              description: Possible alternative names to consider
+                              properties:
+                                match:
+                                  description: Match is a required field
+                                  properties:
+                                    exact:
+                                      description: Exact is a required field
+                                      items:
+                                        type: string
+                                      type: array
+                                  required:
+                                  - exact
+                                  type: object
+                              required:
+                              - match
+                              type: object
+                            trust:
+                              description: A reference to an object that represents a TLS validation context trust
+                              properties:
+                                acm:
+                                  description: A reference to an object that represents a TLS validation context trust for an AWS Certicate Manager (ACM) certificate.
+                                  properties:
+                                    certificateAuthorityARNs:
+                                      description: One or more ACM Amazon Resource Name (ARN)s.
+                                      items:
+                                        type: string
+                                      maxItems: 3
+                                      minItems: 1
+                                      type: array
+                                  required:
+                                  - certificateAuthorityARNs
+                                  type: object
+                                file:
+                                  description: An object that represents a TLS validation context trust for a local file.
+                                  properties:
+                                    certificateChain:
+                                      description: The certificate trust chain for a certificate stored on the file system of the virtual Gateway.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                  required:
+                                  - certificateChain
+                                  type: object
+                                sds:
+                                  description: An object that represents a TLS validation context trust for a SDS certificate
+                                  properties:
+                                    secretName:
+                                      description: The certificate trust chain for a certificate issued via SDS.
+                                      type: string
+                                  required:
+                                  - secretName
+                                  type: object
+                              type: object
+                          required:
+                          - trust
+                          type: object
+                      required:
+                      - validation
+                      type: object
+                  type: object
+              type: object
+            gatewayRouteSelector:
+              description: GatewayRouteSelector selects GatewayRoutes using labels to designate GatewayRoute membership. If not specified it selects all GatewayRoutes in that namespace.
+              properties:
+                matchExpressions:
+                  description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
+                  items:
+                    description: A label selector requirement is a selector that contains values, a key, and an operator that relates the key and values.
+                    properties:
+                      key:
+                        description: key is the label key that the selector applies to.
+                        type: string
+                      operator:
+                        description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
+                        type: string
+                      values:
+                        description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
+                        items:
+                          type: string
+                        type: array
+                    required:
+                    - key
+                    - operator
+                    type: object
+                  type: array
+                matchLabels:
+                  additionalProperties:
+                    type: string
+                  description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
+                  type: object
+              type: object
+            listeners:
+              description: The listener that the virtual gateway is expected to receive inbound traffic from
+              items:
+                description: VirtualGatewayListener refers to https://docs.aws.amazon.com/app-mesh/latest/userguide/virtual_gateways.html
+                properties:
+                  connectionPool:
+                    description: The connection pool settings for the listener
+                    properties:
+                      grpc:
+                        description: Specifies grpc connection pool settings for the virtual gateway listener
+                        properties:
+                          maxRequests:
+                            description: Represents the maximum number of inflight requests that an envoy can concurrently support across all the hosts in the upstream cluster
+                            format: int64
+                            minimum: 1
+                            type: integer
+                        required:
+                        - maxRequests
+                        type: object
+                      http:
+                        description: Specifies http connection pool settings for the virtual gateway listener
+                        properties:
+                          maxConnections:
+                            description: Represents the maximum number of outbound TCP connections the envoy can establish concurrently with all the hosts in the upstream cluster.
+                            format: int64
+                            minimum: 1
+                            type: integer
+                          maxPendingRequests:
+                            description: Represents the number of overflowing requests after max_connections that an envoy will queue to an upstream cluster.
+                            format: int64
+                            minimum: 1
+                            type: integer
+                        required:
+                        - maxConnections
+                        type: object
+                      http2:
+                        description: Specifies http2 connection pool settings for the virtual gateway listener
+                        properties:
+                          maxRequests:
+                            description: Represents the maximum number of inflight requests that an envoy can concurrently support across all the hosts in the upstream cluster
+                            format: int64
+                            minimum: 1
+                            type: integer
+                        required:
+                        - maxRequests
+                        type: object
+                    type: object
+                  healthCheck:
+                    description: The health check information for the listener.
+                    properties:
+                      healthyThreshold:
+                        description: The number of consecutive successful health checks that must occur before declaring listener healthy.
+                        format: int64
+                        maximum: 10
+                        minimum: 2
+                        type: integer
+                      intervalMillis:
+                        description: The time period in milliseconds between each health check execution.
+                        format: int64
+                        maximum: 300000
+                        minimum: 5000
+                        type: integer
+                      path:
+                        description: The destination path for the health check request. This value is only used if the specified protocol is http or http2. For any other protocol, this value is ignored.
+                        type: string
+                      port:
+                        description: The destination port for the health check request.
+                        format: int64
+                        maximum: 65535
+                        minimum: 1
+                        type: integer
+                      protocol:
+                        description: The protocol for the health check request
+                        enum:
+                        - grpc
+                        - http
+                        - http2
+                        type: string
+                      timeoutMillis:
+                        description: The amount of time to wait when receiving a response from the health check, in milliseconds.
+                        format: int64
+                        maximum: 60000
+                        minimum: 2000
+                        type: integer
+                      unhealthyThreshold:
+                        description: The number of consecutive failed health checks that must occur before declaring a virtual Gateway unhealthy.
+                        format: int64
+                        maximum: 10
+                        minimum: 2
+                        type: integer
+                    required:
+                    - intervalMillis
+                    - protocol
+                    - timeoutMillis
+                    - unhealthyThreshold
+                    type: object
+                  portMapping:
+                    description: The port mapping information for the listener.
+                    properties:
+                      port:
+                        description: The port used for the port mapping.
+                        format: int64
+                        maximum: 65535
+                        minimum: 1
+                        type: integer
+                      protocol:
+                        description: The protocol used for the port mapping.
+                        enum:
+                        - grpc
+                        - http
+                        - http2
+                        type: string
+                    required:
+                    - port
+                    - protocol
+                    type: object
+                  tls:
+                    description: A reference to an object that represents the Transport Layer Security (TLS) properties for a listener.
+                    properties:
+                      certificate:
+                        description: A reference to an object that represents a listener's TLS certificate.
+                        properties:
+                          acm:
+                            description: A reference to an object that represents an AWS Certificate Manager (ACM) certificate.
+                            properties:
+                              certificateARN:
+                                description: The Amazon Resource Name (ARN) for the certificate.
+                                type: string
+                            required:
+                            - certificateARN
+                            type: object
+                          file:
+                            description: A reference to an object that represents a local file certificate.
+                            properties:
+                              certificateChain:
+                                description: The certificate chain for the certificate.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                              privateKey:
+                                description: The private key for a certificate stored on the file system of the virtual Gateway.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                            required:
+                            - certificateChain
+                            - privateKey
+                            type: object
+                          sds:
+                            description: A reference to an object that represents an SDS issued certificate
+                            properties:
+                              secretName:
+                                description: The certificate trust chain for a certificate issued via SDS cluster
+                                type: string
+                            required:
+                            - secretName
+                            type: object
+                        type: object
+                      mode:
+                        description: ListenerTLS mode
+                        enum:
+                        - DISABLED
+                        - PERMISSIVE
+                        - STRICT
+                        type: string
+                      validation:
+                        description: A reference to an object that represents Validation context
+                        properties:
+                          subjectAlternativeNames:
+                            description: Possible alternate names to consider
+                            properties:
+                              match:
+                                description: Match is a required field
+                                properties:
+                                  exact:
+                                    description: Exact is a required field
+                                    items:
+                                      type: string
+                                    type: array
+                                required:
+                                - exact
+                                type: object
+                            required:
+                            - match
+                            type: object
+                          trust:
+                            properties:
+                              acm:
+                                description: A reference to an object that represents a TLS validation context trust for an AWS Certicate Manager (ACM) certificate.
+                                properties:
+                                  certificateAuthorityARNs:
+                                    description: One or more ACM Amazon Resource Name (ARN)s.
+                                    items:
+                                      type: string
+                                    maxItems: 3
+                                    minItems: 1
+                                    type: array
+                                required:
+                                - certificateAuthorityARNs
+                                type: object
+                              file:
+                                description: An object that represents a TLS validation context trust for a local file.
+                                properties:
+                                  certificateChain:
+                                    description: The certificate trust chain for a certificate stored on the file system of the virtual Gateway.
+                                    maxLength: 255
+                                    minLength: 1
+                                    type: string
+                                required:
+                                - certificateChain
+                                type: object
+                              sds:
+                                description: An object that represents a TLS validation context trust for an SDS system
+                                properties:
+                                  secretName:
+                                    description: The certificate trust chain for a certificate issued via SDS.
+                                    type: string
+                                required:
+                                - secretName
+                                type: object
+                            type: object
+                        required:
+                        - trust
+                        type: object
+                    required:
+                    - certificate
+                    - mode
+                    type: object
+                required:
+                - portMapping
+                type: object
+              maxItems: 1
+              minItems: 0
+              type: array
+            logging:
+              description: The inbound and outbound access logging information for the virtual gateway.
+              properties:
+                accessLog:
+                  description: The access log configuration for a virtual Gateway.
+                  properties:
+                    file:
+                      description: The file object to send virtual gateway access logs to.
+                      properties:
+                        path:
+                          description: The file path to write access logs to.
+                          maxLength: 255
+                          minLength: 1
+                          type: string
+                      required:
+                      - path
+                      type: object
+                  type: object
+              type: object
+            meshRef:
+              description: "A reference to k8s Mesh CR that this VirtualGateway belongs to. The admission controller populates it using Meshes's selector, and prevents users from setting this field. \n Populated by the system. Read-only."
+              properties:
+                name:
+                  description: Name is the name of Mesh CR
+                  type: string
+                uid:
+                  description: UID is the UID of Mesh CR
+                  type: string
+              required:
+              - name
+              - uid
+              type: object
+            namespaceSelector:
+              description: NamespaceSelector selects Namespaces using labels to designate GatewayRoute membership. This field follows standard label selector semantics; if present but empty, it selects all namespaces.
+              properties:
+                matchExpressions:
+                  description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
+                  items:
+                    description: A label selector requirement is a selector that contains values, a key, and an operator that relates the key and values.
+                    properties:
+                      key:
+                        description: key is the label key that the selector applies to.
+                        type: string
+                      operator:
+                        description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
+                        type: string
+                      values:
+                        description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
+                        items:
+                          type: string
+                        type: array
+                    required:
+                    - key
+                    - operator
+                    type: object
+                  type: array
+                matchLabels:
+                  additionalProperties:
+                    type: string
+                  description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
+                  type: object
+              type: object
+            podSelector:
+              description: "PodSelector selects Pods using labels to designate VirtualGateway membership. This field follows standard label selector semantics: \tif present but empty, it selects all pods within namespace. \tif absent, it selects no pod."
+              properties:
+                matchExpressions:
+                  description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
+                  items:
+                    description: A label selector requirement is a selector that contains values, a key, and an operator that relates the key and values.
+                    properties:
+                      key:
+                        description: key is the label key that the selector applies to.
+                        type: string
+                      operator:
+                        description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
+                        type: string
+                      values:
+                        description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
+                        items:
+                          type: string
+                        type: array
+                    required:
+                    - key
+                    - operator
+                    type: object
+                  type: array
+                matchLabels:
+                  additionalProperties:
+                    type: string
+                  description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
+                  type: object
+              type: object
+          type: object
+        status:
+          description: VirtualGatewayStatus defines the observed state of VirtualGateway
+          properties:
+            conditions:
+              description: The current VirtualGateway status.
+              items:
+                properties:
+                  lastTransitionTime:
+                    description: Last time the condition transitioned from one status to another.
+                    format: date-time
+                    type: string
+                  message:
+                    description: A human readable message indicating details about the transition.
+                    type: string
+                  reason:
+                    description: The reason for the condition's last transition.
+                    type: string
+                  status:
+                    description: Status of the condition, one of True, False, Unknown.
+                    type: string
+                  type:
+                    description: Type of VirtualGateway condition.
+                    type: string
+                required:
+                - status
+                - type
+                type: object
+              type: array
+            observedGeneration:
+              description: The generation observed by the VirtualGateway controller.
+              format: int64
+              type: integer
+            virtualGatewayARN:
+              description: VirtualGatewayARN is the AppMesh VirtualGateway object's Amazon Resource Name
+              type: string
+          type: object
+      type: object
+  version: v1beta2
+  versions:
+  - name: v1beta2
+    served: true
+    storage: true
+status:
+  acceptedNames:
+    kind: ""
+    plural: ""
+  conditions: []
+  storedVersions: []
+---
+apiVersion: apiextensions.k8s.io/v1beta1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: v0.4.1
+  creationTimestamp: null
+  name: virtualnodes.appmesh.k8s.aws
+spec:
+  additionalPrinterColumns:
+  - JSONPath: .status.virtualNodeARN
+    description: The AppMesh VirtualNode object's Amazon Resource Name
+    name: ARN
+    type: string
+  - JSONPath: .metadata.creationTimestamp
+    name: AGE
+    type: date
+  group: appmesh.k8s.aws
+  names:
+    categories:
+    - all
+    kind: VirtualNode
+    listKind: VirtualNodeList
+    plural: virtualnodes
+    singular: virtualnode
+  scope: Namespaced
+  subresources:
+    status: {}
+  validation:
+    openAPIV3Schema:
+      description: VirtualNode is the Schema for the virtualnodes API
+      properties:
+        apiVersion:
+          description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+          type: string
+        kind:
+          description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+          type: string
+        metadata:
+          type: object
+        spec:
+          description: VirtualNodeSpec defines the desired state of VirtualNode refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_VirtualNodeSpec.html
+          properties:
+            awsName:
+              description: AWSName is the AppMesh VirtualNode object's name. If unspecified or empty, it defaults to be "${name}_${namespace}" of k8s VirtualNode
+              type: string
+            backendDefaults:
+              description: A reference to an object that represents the defaults for backends.
+              properties:
+                clientPolicy:
+                  description: A reference to an object that represents a client policy.
+                  properties:
+                    tls:
+                      description: A reference to an object that represents a Transport Layer Security (TLS) client policy.
+                      properties:
+                        certificate:
+                          description: A reference to an object that represents TLS certificate.
+                          properties:
+                            file:
+                              description: An object that represents a TLS cert via a local file
+                              properties:
+                                certificateChain:
+                                  description: The certificate chain for the certificate.
+                                  maxLength: 255
+                                  minLength: 1
+                                  type: string
+                                privateKey:
+                                  description: The private key for a certificate stored on the file system of the virtual node that the proxy is running on.
+                                  maxLength: 255
+                                  minLength: 1
+                                  type: string
+                              required:
+                              - certificateChain
+                              - privateKey
+                              type: object
+                            sds:
+                              description: An object that represents a TLS cert via SDS entry
+                              properties:
+                                secretName:
+                                  description: The certificate trust chain for a certificate issued via SDS cluster
+                                  type: string
+                              required:
+                              - secretName
+                              type: object
+                          type: object
+                        enforce:
+                          description: Whether the policy is enforced. If unspecified, default settings from AWS API will be applied. Refer to AWS Docs for default settings.
+                          type: boolean
+                        ports:
+                          description: The range of ports that the policy is enforced for.
+                          items:
+                            format: int64
+                            maximum: 65535
+                            minimum: 1
+                            type: integer
+                          type: array
+                        validation:
+                          description: A reference to an object that represents a TLS validation context.
+                          properties:
+                            subjectAlternativeNames:
+                              description: Possible Alternative names to consider
+                              properties:
+                                match:
+                                  description: Match is a required field
+                                  properties:
+                                    exact:
+                                      description: Exact is a required field
+                                      items:
+                                        type: string
+                                      type: array
+                                  required:
+                                  - exact
+                                  type: object
+                              required:
+                              - match
+                              type: object
+                            trust:
+                              description: A reference to an object that represents a TLS validation context trust
+                              properties:
+                                acm:
+                                  description: A reference to an object that represents a TLS validation context trust for an AWS Certicate Manager (ACM) certificate.
+                                  properties:
+                                    certificateAuthorityARNs:
+                                      description: One or more ACM Amazon Resource Name (ARN)s.
+                                      items:
+                                        type: string
+                                      maxItems: 3
+                                      minItems: 1
+                                      type: array
+                                  required:
+                                  - certificateAuthorityARNs
+                                  type: object
+                                file:
+                                  description: An object that represents a TLS validation context trust for a local file.
+                                  properties:
+                                    certificateChain:
+                                      description: The certificate trust chain for a certificate stored on the file system of the virtual node that the proxy is running on.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                  required:
+                                  - certificateChain
+                                  type: object
+                                sds:
+                                  description: An object that represents a TLS validation context trust for a SDS.
+                                  properties:
+                                    secretName:
+                                      description: The certificate trust chain for a certificate obtained via SDS
+                                      type: string
+                                  required:
+                                  - secretName
+                                  type: object
+                              type: object
+                          required:
+                          - trust
+                          type: object
+                      required:
+                      - validation
+                      type: object
+                  type: object
+              type: object
+            backends:
+              description: The backends that the virtual node is expected to send outbound traffic to.
+              items:
+                description: Backend refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_Backend.html
+                properties:
+                  virtualService:
+                    description: Specifies a virtual service to use as a backend for a virtual node.
+                    properties:
+                      clientPolicy:
+                        description: A reference to an object that represents the client policy for a backend.
+                        properties:
+                          tls:
+                            description: A reference to an object that represents a Transport Layer Security (TLS) client policy.
+                            properties:
+                              certificate:
+                                description: A reference to an object that represents TLS certificate.
+                                properties:
+                                  file:
+                                    description: An object that represents a TLS cert via a local file
+                                    properties:
+                                      certificateChain:
+                                        description: The certificate chain for the certificate.
+                                        maxLength: 255
+                                        minLength: 1
+                                        type: string
+                                      privateKey:
+                                        description: The private key for a certificate stored on the file system of the virtual node that the proxy is running on.
+                                        maxLength: 255
+                                        minLength: 1
+                                        type: string
+                                    required:
+                                    - certificateChain
+                                    - privateKey
+                                    type: object
+                                  sds:
+                                    description: An object that represents a TLS cert via SDS entry
+                                    properties:
+                                      secretName:
+                                        description: The certificate trust chain for a certificate issued via SDS cluster
+                                        type: string
+                                    required:
+                                    - secretName
+                                    type: object
+                                type: object
+                              enforce:
+                                description: Whether the policy is enforced. If unspecified, default settings from AWS API will be applied. Refer to AWS Docs for default settings.
+                                type: boolean
+                              ports:
+                                description: The range of ports that the policy is enforced for.
+                                items:
+                                  format: int64
+                                  maximum: 65535
+                                  minimum: 1
+                                  type: integer
+                                type: array
+                              validation:
+                                description: A reference to an object that represents a TLS validation context.
+                                properties:
+                                  subjectAlternativeNames:
+                                    description: Possible Alternative names to consider
+                                    properties:
+                                      match:
+                                        description: Match is a required field
+                                        properties:
+                                          exact:
+                                            description: Exact is a required field
+                                            items:
+                                              type: string
+                                            type: array
+                                        required:
+                                        - exact
+                                        type: object
+                                    required:
+                                    - match
+                                    type: object
+                                  trust:
+                                    description: A reference to an object that represents a TLS validation context trust
+                                    properties:
+                                      acm:
+                                        description: A reference to an object that represents a TLS validation context trust for an AWS Certicate Manager (ACM) certificate.
+                                        properties:
+                                          certificateAuthorityARNs:
+                                            description: One or more ACM Amazon Resource Name (ARN)s.
+                                            items:
+                                              type: string
+                                            maxItems: 3
+                                            minItems: 1
+                                            type: array
+                                        required:
+                                        - certificateAuthorityARNs
+                                        type: object
+                                      file:
+                                        description: An object that represents a TLS validation context trust for a local file.
+                                        properties:
+                                          certificateChain:
+                                            description: The certificate trust chain for a certificate stored on the file system of the virtual node that the proxy is running on.
+                                            maxLength: 255
+                                            minLength: 1
+                                            type: string
+                                        required:
+                                        - certificateChain
+                                        type: object
+                                      sds:
+                                        description: An object that represents a TLS validation context trust for a SDS.
+                                        properties:
+                                          secretName:
+                                            description: The certificate trust chain for a certificate obtained via SDS
+                                            type: string
+                                        required:
+                                        - secretName
+                                        type: object
+                                    type: object
+                                required:
+                                - trust
+                                type: object
+                            required:
+                            - validation
+                            type: object
+                        type: object
+                      virtualServiceARN:
+                        description: Amazon Resource Name to AppMesh VirtualService object that is acting as a virtual node backend. Exactly one of 'virtualServiceRef' or 'virtualServiceARN' must be specified.
+                        type: string
+                      virtualServiceRef:
+                        description: Reference to Kubernetes VirtualService CR in cluster that is acting as a virtual node backend. Exactly one of 'virtualServiceRef' or 'virtualServiceARN' must be specified.
+                        properties:
+                          name:
+                            description: Name is the name of VirtualService CR
+                            type: string
+                          namespace:
+                            description: Namespace is the namespace of VirtualService CR. If unspecified, defaults to the referencing object's namespace
+                            type: string
+                        required:
+                        - name
+                        type: object
+                    type: object
+                required:
+                - virtualService
+                type: object
+              type: array
+            listeners:
+              description: The listener that the virtual node is expected to receive inbound traffic from
+              items:
+                description: Listener refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_Listener.html
+                properties:
+                  connectionPool:
+                    description: The connection pool settings for the listener
+                    properties:
+                      grpc:
+                        description: Specifies grpc connection pool settings for the virtual node listener
+                        properties:
+                          maxRequests:
+                            description: Represents the maximum number of inflight requests that an envoy can concurrently support across all the hosts in the upstream cluster
+                            format: int64
+                            minimum: 1
+                            type: integer
+                        required:
+                        - maxRequests
+                        type: object
+                      http:
+                        description: Specifies http connection pool settings for the virtual node listener
+                        properties:
+                          maxConnections:
+                            description: Represents the maximum number of outbound TCP connections the envoy can establish concurrently with all the hosts in the upstream cluster.
+                            format: int64
+                            minimum: 1
+                            type: integer
+                          maxPendingRequests:
+                            description: Represents the number of overflowing requests after max_connections that an envoy will queue to an upstream cluster.
+                            format: int64
+                            minimum: 1
+                            type: integer
+                        required:
+                        - maxConnections
+                        type: object
+                      http2:
+                        description: Specifies http2 connection pool settings for the virtual node listener
+                        properties:
+                          maxRequests:
+                            description: Represents the maximum number of inflight requests that an envoy can concurrently support across all the hosts in the upstream cluster
+                            format: int64
+                            minimum: 1
+                            type: integer
+                        required:
+                        - maxRequests
+                        type: object
+                      tcp:
+                        description: Specifies tcp connection pool settings for the virtual node listener
+                        properties:
+                          maxConnections:
+                            description: Represents the maximum number of outbound TCP connections the envoy can establish concurrently with all the hosts in the upstream cluster.
+                            format: int64
+                            minimum: 1
+                            type: integer
+                        required:
+                        - maxConnections
+                        type: object
+                    type: object
+                  healthCheck:
+                    description: The health check information for the listener.
+                    properties:
+                      healthyThreshold:
+                        description: The number of consecutive successful health checks that must occur before declaring listener healthy.
+                        format: int64
+                        maximum: 10
+                        minimum: 2
+                        type: integer
+                      intervalMillis:
+                        description: The time period in milliseconds between each health check execution.
+                        format: int64
+                        maximum: 300000
+                        minimum: 5000
+                        type: integer
+                      path:
+                        description: The destination path for the health check request. This value is only used if the specified protocol is http or http2. For any other protocol, this value is ignored.
+                        type: string
+                      port:
+                        description: The destination port for the health check request.
+                        format: int64
+                        maximum: 65535
+                        minimum: 1
+                        type: integer
+                      protocol:
+                        description: The protocol for the health check request
+                        enum:
+                        - grpc
+                        - http
+                        - http2
+                        - tcp
+                        type: string
+                      timeoutMillis:
+                        description: The amount of time to wait when receiving a response from the health check, in milliseconds.
+                        format: int64
+                        maximum: 60000
+                        minimum: 2000
+                        type: integer
+                      unhealthyThreshold:
+                        description: The number of consecutive failed health checks that must occur before declaring a virtual node unhealthy.
+                        format: int64
+                        maximum: 10
+                        minimum: 2
+                        type: integer
+                    required:
+                    - healthyThreshold
+                    - intervalMillis
+                    - protocol
+                    - timeoutMillis
+                    - unhealthyThreshold
+                    type: object
+                  outlierDetection:
+                    description: The outlier detection for the listener
+                    properties:
+                      baseEjectionDuration:
+                        description: The base time that a host is ejected for. The real time is equal to the base time multiplied by the number of times the host has been ejected
+                        properties:
+                          unit:
+                            description: A unit of time.
+                            enum:
+                            - s
+                            - ms
+                            type: string
+                          value:
+                            description: A number of time units.
+                            format: int64
+                            minimum: 0
+                            type: integer
+                        required:
+                        - unit
+                        - value
+                        type: object
+                      interval:
+                        description: The time interval between ejection analysis sweeps. This can result in both new ejections as well as hosts being returned to service
+                        properties:
+                          unit:
+                            description: A unit of time.
+                            enum:
+                            - s
+                            - ms
+                            type: string
+                          value:
+                            description: A number of time units.
+                            format: int64
+                            minimum: 0
+                            type: integer
+                        required:
+                        - unit
+                        - value
+                        type: object
+                      maxEjectionPercent:
+                        description: The threshold for the max percentage of outlier hosts that can be ejected from the load balancing set. maxEjectionPercent=100 means outlier detection can potentially eject all of the hosts from the upstream service if they are all considered outliers, leaving the load balancing set with zero hosts
+                        format: int64
+                        maximum: 100
+                        minimum: 0
+                        type: integer
+                      maxServerErrors:
+                        description: The threshold for the number of server errors returned by a given host during an outlier detection interval. If the server error count meets/exceeds this threshold the host is ejected. A server error is defined as any HTTP 5xx response (or the equivalent for gRPC and TCP connections)
+                        format: int64
+                        minimum: 1
+                        type: integer
+                    required:
+                    - baseEjectionDuration
+                    - interval
+                    - maxEjectionPercent
+                    - maxServerErrors
+                    type: object
+                  portMapping:
+                    description: The port mapping information for the listener.
+                    properties:
+                      port:
+                        description: The port used for the port mapping.
+                        format: int64
+                        maximum: 65535
+                        minimum: 1
+                        type: integer
+                      protocol:
+                        description: The protocol used for the port mapping.
+                        enum:
+                        - grpc
+                        - http
+                        - http2
+                        - tcp
+                        type: string
+                    required:
+                    - port
+                    - protocol
+                    type: object
+                  timeout:
+                    description: A reference to an object that represents
+                    properties:
+                      grpc:
+                        description: Specifies grpc timeout information for the virtual node.
+                        properties:
+                          idle:
+                            description: An object that represents idle timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                          perRequest:
+                            description: An object that represents per request timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                        type: object
+                      http:
+                        description: Specifies http timeout information for the virtual node.
+                        properties:
+                          idle:
+                            description: An object that represents idle timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                          perRequest:
+                            description: An object that represents per request timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                        type: object
+                      http2:
+                        description: Specifies http2 information for the virtual node.
+                        properties:
+                          idle:
+                            description: An object that represents idle timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                          perRequest:
+                            description: An object that represents per request timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                        type: object
+                      tcp:
+                        description: Specifies tcp timeout information for the virtual node.
+                        properties:
+                          idle:
+                            description: An object that represents idle timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                        type: object
+                    type: object
+                  tls:
+                    description: A reference to an object that represents the Transport Layer Security (TLS) properties for a listener.
+                    properties:
+                      certificate:
+                        description: A reference to an object that represents a listener's TLS certificate.
+                        properties:
+                          acm:
+                            description: A reference to an object that represents an AWS Certificate Manager (ACM) certificate.
+                            properties:
+                              certificateARN:
+                                description: The Amazon Resource Name (ARN) for the certificate.
+                                type: string
+                            required:
+                            - certificateARN
+                            type: object
+                          file:
+                            description: A reference to an object that represents a local file certificate.
+                            properties:
+                              certificateChain:
+                                description: The certificate chain for the certificate.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                              privateKey:
+                                description: The private key for a certificate stored on the file system of the virtual node that the proxy is running on.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                            required:
+                            - certificateChain
+                            - privateKey
+                            type: object
+                          sds:
+                            description: A reference to an object that represents an SDS certificate.
+                            properties:
+                              secretName:
+                                description: The certificate trust chain for a certificate issued via SDS cluster
+                                type: string
+                            required:
+                            - secretName
+                            type: object
+                        type: object
+                      mode:
+                        description: ListenerTLS mode
+                        enum:
+                        - DISABLED
+                        - PERMISSIVE
+                        - STRICT
+                        type: string
+                      validation:
+                        description: A reference to an object that represents an SDS Trust Domain
+                        properties:
+                          subjectAlternativeNames:
+                            description: Possible alternative names to consider
+                            properties:
+                              match:
+                                description: Match is a required field
+                                properties:
+                                  exact:
+                                    description: Exact is a required field
+                                    items:
+                                      type: string
+                                    type: array
+                                required:
+                                - exact
+                                type: object
+                            required:
+                            - match
+                            type: object
+                          trust:
+                            properties:
+                              file:
+                                description: An object that represents a TLS validation context trust for a local file.
+                                properties:
+                                  certificateChain:
+                                    description: The certificate trust chain for a certificate stored on the file system of the virtual node that the proxy is running on.
+                                    maxLength: 255
+                                    minLength: 1
+                                    type: string
+                                required:
+                                - certificateChain
+                                type: object
+                              sds:
+                                description: An object that represents a TLS validation context trust for an SDS server
+                                properties:
+                                  secretName:
+                                    description: The certificate trust chain for a certificate obtained via SDS
+                                    type: string
+                                required:
+                                - secretName
+                                type: object
+                            type: object
+                        required:
+                        - trust
+                        type: object
+                    required:
+                    - certificate
+                    - mode
+                    type: object
+                required:
+                - portMapping
+                type: object
+              maxItems: 1
+              minItems: 0
+              type: array
+            logging:
+              description: The inbound and outbound access logging information for the virtual node.
+              properties:
+                accessLog:
+                  description: The access log configuration for a virtual node.
+                  properties:
+                    file:
+                      description: The file object to send virtual node access logs to.
+                      properties:
+                        path:
+                          description: The file path to write access logs to.
+                          maxLength: 255
+                          minLength: 1
+                          type: string
+                      required:
+                      - path
+                      type: object
+                  type: object
+              type: object
+            meshRef:
+              description: "A reference to k8s Mesh CR that this VirtualNode belongs to. The admission controller populates it using Meshes's selector, and prevents users from setting this field. \n Populated by the system. Read-only."
+              properties:
+                name:
+                  description: Name is the name of Mesh CR
+                  type: string
+                uid:
+                  description: UID is the UID of Mesh CR
+                  type: string
+              required:
+              - name
+              - uid
+              type: object
+            podSelector:
+              description: "PodSelector selects Pods using labels to designate VirtualNode membership. This field follows standard label selector semantics: \tif present but empty, it selects all pods within namespace. \tif absent, it selects no pod."
+              properties:
+                matchExpressions:
+                  description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
+                  items:
+                    description: A label selector requirement is a selector that contains values, a key, and an operator that relates the key and values.
+                    properties:
+                      key:
+                        description: key is the label key that the selector applies to.
+                        type: string
+                      operator:
+                        description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
+                        type: string
+                      values:
+                        description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
+                        items:
+                          type: string
+                        type: array
+                    required:
+                    - key
+                    - operator
+                    type: object
+                  type: array
+                matchLabels:
+                  additionalProperties:
+                    type: string
+                  description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
+                  type: object
+              type: object
+            serviceDiscovery:
+              description: The service discovery information for the virtual node. Optional if there is no inbound traffic(no listeners). Mandatory if a listener is specified.
+              properties:
+                awsCloudMap:
+                  description: Specifies any AWS Cloud Map information for the virtual node.
+                  properties:
+                    attributes:
+                      description: A string map that contains attributes with values that you can use to filter instances by any custom attribute that you specified when you registered the instance
+                      items:
+                        description: AWSCloudMapInstanceAttribute refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_AwsCloudMapInstanceAttribute.html
+                        properties:
+                          key:
+                            description: The name of an AWS Cloud Map service instance attribute key.
+                            maxLength: 255
+                            minLength: 1
+                            type: string
+                          value:
+                            description: The value of an AWS Cloud Map service instance attribute key.
+                            maxLength: 1024
+                            minLength: 1
+                            type: string
+                        required:
+                        - key
+                        - value
+                        type: object
+                      type: array
+                    namespaceName:
+                      description: The name of the AWS Cloud Map namespace to use.
+                      maxLength: 1024
+                      minLength: 1
+                      type: string
+                    serviceName:
+                      description: The name of the AWS Cloud Map service to use.
+                      maxLength: 1024
+                      minLength: 1
+                      type: string
+                  required:
+                  - namespaceName
+                  - serviceName
+                  type: object
+                dns:
+                  description: Specifies the DNS information for the virtual node.
+                  properties:
+                    hostname:
+                      description: Specifies the DNS service discovery hostname for the virtual node.
+                      type: string
+                    responseType:
+                      description: Choose between ENDPOINTS (strict DNS) and LOADBALANCER (logical DNS) mode in Envoy sidecar
+                      enum:
+                      - ENDPOINTS
+                      - LOADBALANCER
+                      type: string
+                  required:
+                  - hostname
+                  type: object
+              type: object
+          type: object
+        status:
+          description: VirtualNodeStatus defines the observed state of VirtualNode
+          properties:
+            conditions:
+              description: The current VirtualNode status.
+              items:
+                properties:
+                  lastTransitionTime:
+                    description: Last time the condition transitioned from one status to another.
+                    format: date-time
+                    type: string
+                  message:
+                    description: A human readable message indicating details about the transition.
+                    type: string
+                  reason:
+                    description: The reason for the condition's last transition.
+                    type: string
+                  status:
+                    description: Status of the condition, one of True, False, Unknown.
+                    type: string
+                  type:
+                    description: Type of VirtualNode condition.
+                    type: string
+                required:
+                - status
+                - type
+                type: object
+              type: array
+            observedGeneration:
+              description: The generation observed by the VirtualNode controller.
+              format: int64
+              type: integer
+            virtualNodeARN:
+              description: VirtualNodeARN is the AppMesh VirtualNode object's Amazon Resource Name
+              type: string
+          type: object
+      type: object
+  version: v1beta2
+  versions:
+  - name: v1beta2
+    served: true
+    storage: true
+status:
+  acceptedNames:
+    kind: ""
+    plural: ""
+  conditions: []
+  storedVersions: []
+---
+apiVersion: apiextensions.k8s.io/v1beta1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: v0.4.1
+  creationTimestamp: null
+  name: virtualrouters.appmesh.k8s.aws
+spec:
+  additionalPrinterColumns:
+  - JSONPath: .status.virtualRouterARN
+    description: The AppMesh VirtualRouter object's Amazon Resource Name
+    name: ARN
+    type: string
+  - JSONPath: .metadata.creationTimestamp
+    name: AGE
+    type: date
+  group: appmesh.k8s.aws
+  names:
+    categories:
+    - all
+    kind: VirtualRouter
+    listKind: VirtualRouterList
+    plural: virtualrouters
+    singular: virtualrouter
+  scope: Namespaced
+  subresources:
+    status: {}
+  validation:
+    openAPIV3Schema:
+      description: VirtualRouter is the Schema for the virtualrouters API
+      properties:
+        apiVersion:
+          description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+          type: string
+        kind:
+          description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+          type: string
+        metadata:
+          type: object
+        spec:
+          description: VirtualRouterSpec defines the desired state of VirtualRouter refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_VirtualRouterSpec.html
+          properties:
+            awsName:
+              description: AWSName is the AppMesh VirtualRouter object's name. If unspecified or empty, it defaults to be "${name}_${namespace}" of k8s VirtualRouter
+              type: string
+            listeners:
+              description: The listeners that the virtual router is expected to receive inbound traffic from
+              items:
+                description: VirtualRouterListener refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_VirtualRouterListener.html
+                properties:
+                  portMapping:
+                    description: The port mapping information for the listener.
+                    properties:
+                      port:
+                        description: The port used for the port mapping.
+                        format: int64
+                        maximum: 65535
+                        minimum: 1
+                        type: integer
+                      protocol:
+                        description: The protocol used for the port mapping.
+                        enum:
+                        - grpc
+                        - http
+                        - http2
+                        - tcp
+                        type: string
+                    required:
+                    - port
+                    - protocol
+                    type: object
+                required:
+                - portMapping
+                type: object
+              maxItems: 1
+              minItems: 1
+              type: array
+            meshRef:
+              description: "A reference to k8s Mesh CR that this VirtualRouter belongs to. The admission controller populates it using Meshes's selector, and prevents users from setting this field. \n Populated by the system. Read-only."
+              properties:
+                name:
+                  description: Name is the name of Mesh CR
+                  type: string
+                uid:
+                  description: UID is the UID of Mesh CR
+                  type: string
+              required:
+              - name
+              - uid
+              type: object
+            routes:
+              description: The routes associated with VirtualRouter
+              items:
+                description: Route refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_RouteSpec.html
+                properties:
+                  grpcRoute:
+                    description: An object that represents the specification of a gRPC route.
+                    properties:
+                      action:
+                        description: An object that represents the action to take if a match is determined.
+                        properties:
+                          weightedTargets:
+                            description: An object that represents the targets that traffic is routed to when a request matches the route.
+                            items:
+                              description: WeightedTarget refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_WeightedTarget.html
+                              properties:
+                                virtualNodeARN:
+                                  description: Amazon Resource Name to AppMesh VirtualNode object to associate with the weighted target. Exactly one of 'virtualNodeRef' or 'virtualNodeARN' must be specified.
+                                  type: string
+                                virtualNodeRef:
+                                  description: Reference to Kubernetes VirtualNode CR in cluster to associate with the weighted target. Exactly one of 'virtualNodeRef' or 'virtualNodeARN' must be specified.
+                                  properties:
+                                    name:
+                                      description: Name is the name of VirtualNode CR
+                                      type: string
+                                    namespace:
+                                      description: Namespace is the namespace of VirtualNode CR. If unspecified, defaults to the referencing object's namespace
+                                      type: string
+                                  required:
+                                  - name
+                                  type: object
+                                weight:
+                                  description: The relative weight of the weighted target.
+                                  format: int64
+                                  maximum: 100
+                                  minimum: 0
+                                  type: integer
+                              required:
+                              - weight
+                              type: object
+                            maxItems: 10
+                            minItems: 1
+                            type: array
+                        required:
+                        - weightedTargets
+                        type: object
+                      match:
+                        description: An object that represents the criteria for determining a request match.
+                        properties:
+                          metadata:
+                            description: An object that represents the data to match from the request.
+                            items:
+                              description: GRPCRouteMetadata refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_GrpcRouteMetadata.html
+                              properties:
+                                invert:
+                                  description: Specify True to match anything except the match criteria. The default value is False.
+                                  type: boolean
+                                match:
+                                  description: An object that represents the data to match from the request.
+                                  properties:
+                                    exact:
+                                      description: The value sent by the client must match the specified value exactly.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                    prefix:
+                                      description: The value sent by the client must begin with the specified characters.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                    range:
+                                      description: An object that represents the range of values to match on
+                                      properties:
+                                        end:
+                                          description: The end of the range.
+                                          format: int64
+                                          type: integer
+                                        start:
+                                          description: The start of the range.
+                                          format: int64
+                                          type: integer
+                                      required:
+                                      - end
+                                      - start
+                                      type: object
+                                    regex:
+                                      description: The value sent by the client must include the specified characters.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                    suffix:
+                                      description: The value sent by the client must end with the specified characters.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                  type: object
+                                name:
+                                  description: The name of the route.
+                                  maxLength: 50
+                                  minLength: 1
+                                  type: string
+                              required:
+                              - name
+                              type: object
+                            maxItems: 10
+                            minItems: 1
+                            type: array
+                          methodName:
+                            description: The method name to match from the request. If you specify a name, you must also specify a serviceName.
+                            maxLength: 50
+                            minLength: 1
+                            type: string
+                          serviceName:
+                            description: The fully qualified domain name for the service to match from the request.
+                            type: string
+                        type: object
+                      retryPolicy:
+                        description: An object that represents a retry policy.
+                        properties:
+                          grpcRetryEvents:
+                            items:
+                              enum:
+                              - cancelled
+                              - deadline-exceeded
+                              - internal
+                              - resource-exhausted
+                              - unavailable
+                              type: string
+                            maxItems: 5
+                            minItems: 1
+                            type: array
+                          httpRetryEvents:
+                            items:
+                              enum:
+                              - server-error
+                              - gateway-error
+                              - client-error
+                              - stream-error
+                              type: string
+                            maxItems: 25
+                            minItems: 1
+                            type: array
+                          maxRetries:
+                            description: The maximum number of retry attempts.
+                            format: int64
+                            minimum: 0
+                            type: integer
+                          perRetryTimeout:
+                            description: An object that represents a duration of time.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                          tcpRetryEvents:
+                            items:
+                              enum:
+                              - connection-error
+                              type: string
+                            maxItems: 1
+                            minItems: 1
+                            type: array
+                        required:
+                        - maxRetries
+                        - perRetryTimeout
+                        type: object
+                      timeout:
+                        description: An object that represents a grpc timeout.
+                        properties:
+                          idle:
+                            description: An object that represents idle timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                          perRequest:
+                            description: An object that represents per request timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                        type: object
+                    required:
+                    - action
+                    - match
+                    type: object
+                  http2Route:
+                    description: An object that represents the specification of an HTTP/2 route.
+                    properties:
+                      action:
+                        description: An object that represents the action to take if a match is determined.
+                        properties:
+                          weightedTargets:
+                            description: An object that represents the targets that traffic is routed to when a request matches the route.
+                            items:
+                              description: WeightedTarget refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_WeightedTarget.html
+                              properties:
+                                virtualNodeARN:
+                                  description: Amazon Resource Name to AppMesh VirtualNode object to associate with the weighted target. Exactly one of 'virtualNodeRef' or 'virtualNodeARN' must be specified.
+                                  type: string
+                                virtualNodeRef:
+                                  description: Reference to Kubernetes VirtualNode CR in cluster to associate with the weighted target. Exactly one of 'virtualNodeRef' or 'virtualNodeARN' must be specified.
+                                  properties:
+                                    name:
+                                      description: Name is the name of VirtualNode CR
+                                      type: string
+                                    namespace:
+                                      description: Namespace is the namespace of VirtualNode CR. If unspecified, defaults to the referencing object's namespace
+                                      type: string
+                                  required:
+                                  - name
+                                  type: object
+                                weight:
+                                  description: The relative weight of the weighted target.
+                                  format: int64
+                                  maximum: 100
+                                  minimum: 0
+                                  type: integer
+                              required:
+                              - weight
+                              type: object
+                            maxItems: 10
+                            minItems: 1
+                            type: array
+                        required:
+                        - weightedTargets
+                        type: object
+                      match:
+                        description: An object that represents the criteria for determining a request match.
+                        properties:
+                          headers:
+                            description: An object that represents the client request headers to match on.
+                            items:
+                              description: HTTPRouteHeader refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_HttpRouteHeader.html
+                              properties:
+                                invert:
+                                  description: Specify True to match anything except the match criteria. The default value is False.
+                                  type: boolean
+                                match:
+                                  description: The HeaderMatchMethod object.
+                                  properties:
+                                    exact:
+                                      description: The value sent by the client must match the specified value exactly.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                    prefix:
+                                      description: The value sent by the client must begin with the specified characters.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                    range:
+                                      description: An object that represents the range of values to match on.
+                                      properties:
+                                        end:
+                                          description: The end of the range.
+                                          format: int64
+                                          type: integer
+                                        start:
+                                          description: The start of the range.
+                                          format: int64
+                                          type: integer
+                                      required:
+                                      - end
+                                      - start
+                                      type: object
+                                    regex:
+                                      description: The value sent by the client must include the specified characters.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                    suffix:
+                                      description: The value sent by the client must end with the specified characters.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                  type: object
+                                name:
+                                  description: A name for the HTTP header in the client request that will be matched on.
+                                  maxLength: 50
+                                  minLength: 1
+                                  type: string
+                              required:
+                              - name
+                              type: object
+                            maxItems: 10
+                            minItems: 1
+                            type: array
+                          method:
+                            description: The client request method to match on.
+                            enum:
+                            - CONNECT
+                            - DELETE
+                            - GET
+                            - HEAD
+                            - OPTIONS
+                            - PATCH
+                            - POST
+                            - PUT
+                            - TRACE
+                            type: string
+                          path:
+                            description: The client specified Path to match on.
+                            properties:
+                              exact:
+                                description: The value sent by the client must match the specified value exactly.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                              regex:
+                                description: The value sent by the client must end with the specified characters.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                            type: object
+                          prefix:
+                            description: Specifies the prefix to match requests with
+                            type: string
+                          queryParameters:
+                            description: The client specified queryParameters to match on
+                            items:
+                              properties:
+                                match:
+                                  description: The HTTPQueryMatchMethod object.
+                                  properties:
+                                    exact:
+                                      type: string
+                                  type: object
+                                name:
+                                  type: string
+                              required:
+                              - name
+                              type: object
+                            maxItems: 10
+                            minItems: 1
+                            type: array
+                          scheme:
+                            description: The client request scheme to match on
+                            enum:
+                            - http
+                            - https
+                            type: string
+                        type: object
+                      retryPolicy:
+                        description: An object that represents a retry policy.
+                        properties:
+                          httpRetryEvents:
+                            items:
+                              enum:
+                              - server-error
+                              - gateway-error
+                              - client-error
+                              - stream-error
+                              type: string
+                            maxItems: 25
+                            minItems: 1
+                            type: array
+                          maxRetries:
+                            description: The maximum number of retry attempts.
+                            format: int64
+                            minimum: 0
+                            type: integer
+                          perRetryTimeout:
+                            description: An object that represents a duration of time
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                          tcpRetryEvents:
+                            items:
+                              enum:
+                              - connection-error
+                              type: string
+                            maxItems: 1
+                            minItems: 1
+                            type: array
+                        required:
+                        - maxRetries
+                        - perRetryTimeout
+                        type: object
+                      timeout:
+                        description: An object that represents a http timeout.
+                        properties:
+                          idle:
+                            description: An object that represents idle timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                          perRequest:
+                            description: An object that represents per request timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                        type: object
+                    required:
+                    - action
+                    - match
+                    type: object
+                  httpRoute:
+                    description: An object that represents the specification of an HTTP route.
+                    properties:
+                      action:
+                        description: An object that represents the action to take if a match is determined.
+                        properties:
+                          weightedTargets:
+                            description: An object that represents the targets that traffic is routed to when a request matches the route.
+                            items:
+                              description: WeightedTarget refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_WeightedTarget.html
+                              properties:
+                                virtualNodeARN:
+                                  description: Amazon Resource Name to AppMesh VirtualNode object to associate with the weighted target. Exactly one of 'virtualNodeRef' or 'virtualNodeARN' must be specified.
+                                  type: string
+                                virtualNodeRef:
+                                  description: Reference to Kubernetes VirtualNode CR in cluster to associate with the weighted target. Exactly one of 'virtualNodeRef' or 'virtualNodeARN' must be specified.
+                                  properties:
+                                    name:
+                                      description: Name is the name of VirtualNode CR
+                                      type: string
+                                    namespace:
+                                      description: Namespace is the namespace of VirtualNode CR. If unspecified, defaults to the referencing object's namespace
+                                      type: string
+                                  required:
+                                  - name
+                                  type: object
+                                weight:
+                                  description: The relative weight of the weighted target.
+                                  format: int64
+                                  maximum: 100
+                                  minimum: 0
+                                  type: integer
+                              required:
+                              - weight
+                              type: object
+                            maxItems: 10
+                            minItems: 1
+                            type: array
+                        required:
+                        - weightedTargets
+                        type: object
+                      match:
+                        description: An object that represents the criteria for determining a request match.
+                        properties:
+                          headers:
+                            description: An object that represents the client request headers to match on.
+                            items:
+                              description: HTTPRouteHeader refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_HttpRouteHeader.html
+                              properties:
+                                invert:
+                                  description: Specify True to match anything except the match criteria. The default value is False.
+                                  type: boolean
+                                match:
+                                  description: The HeaderMatchMethod object.
+                                  properties:
+                                    exact:
+                                      description: The value sent by the client must match the specified value exactly.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                    prefix:
+                                      description: The value sent by the client must begin with the specified characters.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                    range:
+                                      description: An object that represents the range of values to match on.
+                                      properties:
+                                        end:
+                                          description: The end of the range.
+                                          format: int64
+                                          type: integer
+                                        start:
+                                          description: The start of the range.
+                                          format: int64
+                                          type: integer
+                                      required:
+                                      - end
+                                      - start
+                                      type: object
+                                    regex:
+                                      description: The value sent by the client must include the specified characters.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                    suffix:
+                                      description: The value sent by the client must end with the specified characters.
+                                      maxLength: 255
+                                      minLength: 1
+                                      type: string
+                                  type: object
+                                name:
+                                  description: A name for the HTTP header in the client request that will be matched on.
+                                  maxLength: 50
+                                  minLength: 1
+                                  type: string
+                              required:
+                              - name
+                              type: object
+                            maxItems: 10
+                            minItems: 1
+                            type: array
+                          method:
+                            description: The client request method to match on.
+                            enum:
+                            - CONNECT
+                            - DELETE
+                            - GET
+                            - HEAD
+                            - OPTIONS
+                            - PATCH
+                            - POST
+                            - PUT
+                            - TRACE
+                            type: string
+                          path:
+                            description: The client specified Path to match on.
+                            properties:
+                              exact:
+                                description: The value sent by the client must match the specified value exactly.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                              regex:
+                                description: The value sent by the client must end with the specified characters.
+                                maxLength: 255
+                                minLength: 1
+                                type: string
+                            type: object
+                          prefix:
+                            description: Specifies the prefix to match requests with
+                            type: string
+                          queryParameters:
+                            description: The client specified queryParameters to match on
+                            items:
+                              properties:
+                                match:
+                                  description: The HTTPQueryMatchMethod object.
+                                  properties:
+                                    exact:
+                                      type: string
+                                  type: object
+                                name:
+                                  type: string
+                              required:
+                              - name
+                              type: object
+                            maxItems: 10
+                            minItems: 1
+                            type: array
+                          scheme:
+                            description: The client request scheme to match on
+                            enum:
+                            - http
+                            - https
+                            type: string
+                        type: object
+                      retryPolicy:
+                        description: An object that represents a retry policy.
+                        properties:
+                          httpRetryEvents:
+                            items:
+                              enum:
+                              - server-error
+                              - gateway-error
+                              - client-error
+                              - stream-error
+                              type: string
+                            maxItems: 25
+                            minItems: 1
+                            type: array
+                          maxRetries:
+                            description: The maximum number of retry attempts.
+                            format: int64
+                            minimum: 0
+                            type: integer
+                          perRetryTimeout:
+                            description: An object that represents a duration of time
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                          tcpRetryEvents:
+                            items:
+                              enum:
+                              - connection-error
+                              type: string
+                            maxItems: 1
+                            minItems: 1
+                            type: array
+                        required:
+                        - maxRetries
+                        - perRetryTimeout
+                        type: object
+                      timeout:
+                        description: An object that represents a http timeout.
+                        properties:
+                          idle:
+                            description: An object that represents idle timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                          perRequest:
+                            description: An object that represents per request timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                        type: object
+                    required:
+                    - action
+                    - match
+                    type: object
+                  name:
+                    description: Route's name
+                    type: string
+                  priority:
+                    description: The priority for the route.
+                    format: int64
+                    maximum: 1000
+                    minimum: 0
+                    type: integer
+                  tcpRoute:
+                    description: An object that represents the specification of a TCP route.
+                    properties:
+                      action:
+                        description: The action to take if a match is determined.
+                        properties:
+                          weightedTargets:
+                            description: An object that represents the targets that traffic is routed to when a request matches the route.
+                            items:
+                              description: WeightedTarget refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_WeightedTarget.html
+                              properties:
+                                virtualNodeARN:
+                                  description: Amazon Resource Name to AppMesh VirtualNode object to associate with the weighted target. Exactly one of 'virtualNodeRef' or 'virtualNodeARN' must be specified.
+                                  type: string
+                                virtualNodeRef:
+                                  description: Reference to Kubernetes VirtualNode CR in cluster to associate with the weighted target. Exactly one of 'virtualNodeRef' or 'virtualNodeARN' must be specified.
+                                  properties:
+                                    name:
+                                      description: Name is the name of VirtualNode CR
+                                      type: string
+                                    namespace:
+                                      description: Namespace is the namespace of VirtualNode CR. If unspecified, defaults to the referencing object's namespace
+                                      type: string
+                                  required:
+                                  - name
+                                  type: object
+                                weight:
+                                  description: The relative weight of the weighted target.
+                                  format: int64
+                                  maximum: 100
+                                  minimum: 0
+                                  type: integer
+                              required:
+                              - weight
+                              type: object
+                            maxItems: 10
+                            minItems: 1
+                            type: array
+                        required:
+                        - weightedTargets
+                        type: object
+                      timeout:
+                        description: An object that represents a tcp timeout.
+                        properties:
+                          idle:
+                            description: An object that represents idle timeout duration.
+                            properties:
+                              unit:
+                                description: A unit of time.
+                                enum:
+                                - s
+                                - ms
+                                type: string
+                              value:
+                                description: A number of time units.
+                                format: int64
+                                minimum: 0
+                                type: integer
+                            required:
+                            - unit
+                            - value
+                            type: object
+                        type: object
+                    required:
+                    - action
+                    type: object
+                required:
+                - name
+                type: object
+              type: array
+          type: object
+        status:
+          description: VirtualRouterStatus defines the observed state of VirtualRouter
+          properties:
+            conditions:
+              description: The current VirtualRouter status.
+              items:
+                properties:
+                  lastTransitionTime:
+                    description: Last time the condition transitioned from one status to another.
+                    format: date-time
+                    type: string
+                  message:
+                    description: A human readable message indicating details about the transition.
+                    type: string
+                  reason:
+                    description: The reason for the condition's last transition.
+                    type: string
+                  status:
+                    description: Status of the condition, one of True, False, Unknown.
+                    type: string
+                  type:
+                    description: Type of VirtualRouter condition.
+                    type: string
+                required:
+                - status
+                - type
+                type: object
+              type: array
+            observedGeneration:
+              description: The generation observed by the VirtualRouter controller.
+              format: int64
+              type: integer
+            routeARNs:
+              additionalProperties:
+                type: string
+              description: RouteARNs is a map of AppMesh Route objects' Amazon Resource Names, indexed by route name.
+              type: object
+            virtualRouterARN:
+              description: VirtualRouterARN is the AppMesh VirtualRouter object's Amazon Resource Name.
+              type: string
+          type: object
+      type: object
+  version: v1beta2
+  versions:
+  - name: v1beta2
+    served: true
+    storage: true
+status:
+  acceptedNames:
+    kind: ""
+    plural: ""
+  conditions: []
+  storedVersions: []
+---
+apiVersion: apiextensions.k8s.io/v1beta1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    controller-gen.kubebuilder.io/version: v0.4.1
+  creationTimestamp: null
+  name: virtualservices.appmesh.k8s.aws
+spec:
+  additionalPrinterColumns:
+  - JSONPath: .status.virtualServiceARN
+    description: The AppMesh VirtualService object's Amazon Resource Name
+    name: ARN
+    type: string
+  - JSONPath: .metadata.creationTimestamp
+    name: AGE
+    type: date
+  group: appmesh.k8s.aws
+  names:
+    categories:
+    - all
+    kind: VirtualService
+    listKind: VirtualServiceList
+    plural: virtualservices
+    singular: virtualservice
+  scope: Namespaced
+  subresources:
+    status: {}
+  validation:
+    openAPIV3Schema:
+      description: VirtualService is the Schema for the virtualservices API
+      properties:
+        apiVersion:
+          description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
+          type: string
+        kind:
+          description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
+          type: string
+        metadata:
+          type: object
+        spec:
+          description: VirtualServiceSpec defines the desired state of VirtualService refers to https://docs.aws.amazon.com/app-mesh/latest/APIReference/API_VirtualServiceSpec.html
+          properties:
+            awsName:
+              description: AWSName is the AppMesh VirtualService object's name. If unspecified or empty, it defaults to be "${name}.${namespace}" of k8s VirtualService
+              type: string
+            meshRef:
+              description: "A reference to k8s Mesh CR that this VirtualService belongs to. The admission controller populates it using Meshes's selector, and prevents users from setting this field. \n Populated by the system. Read-only."
+              properties:
+                name:
+                  description: Name is the name of Mesh CR
+                  type: string
+                uid:
+                  description: UID is the UID of Mesh CR
+                  type: string
+              required:
+              - name
+              - uid
+              type: object
+            provider:
+              description: The provider for virtual services. You can specify a single virtual node or virtual router.
+              properties:
+                virtualNode:
+                  description: The virtual node associated with a virtual service.
+                  properties:
+                    virtualNodeARN:
+                      description: Amazon Resource Name to AppMesh VirtualNode object that is acting as a service provider. Exactly one of 'virtualNodeRef' or 'virtualNodeARN' must be specified.
+                      type: string
+                    virtualNodeRef:
+                      description: Reference to Kubernetes VirtualNode CR in cluster that is acting as a service provider. Exactly one of 'virtualNodeRef' or 'virtualNodeARN' must be specified.
+                      properties:
+                        name:
+                          description: Name is the name of VirtualNode CR
+                          type: string
+                        namespace:
+                          description: Namespace is the namespace of VirtualNode CR. If unspecified, defaults to the referencing object's namespace
+                          type: string
+                      required:
+                      - name
+                      type: object
+                  type: object
+                virtualRouter:
+                  description: The virtual router associated with a virtual service.
+                  properties:
+                    virtualRouterARN:
+                      description: Amazon Resource Name to AppMesh VirtualRouter object that is acting as a service provider. Exactly one of 'virtualRouterRef' or 'virtualRouterARN' must be specified.
+                      type: string
+                    virtualRouterRef:
+                      description: Reference to Kubernetes VirtualRouter CR in cluster that is acting as a service provider. Exactly one of 'virtualRouterRef' or 'virtualRouterARN' must be specified.
+                      properties:
+                        name:
+                          description: Name is the name of VirtualRouter CR
+                          type: string
+                        namespace:
+                          description: Namespace is the namespace of VirtualRouter CR. If unspecified, defaults to the referencing object's namespace
+                          type: string
+                      required:
+                      - name
+                      type: object
+                  type: object
+              type: object
+          type: object
+        status:
+          description: VirtualServiceStatus defines the observed state of VirtualService
+          properties:
+            conditions:
+              description: The current VirtualService status.
+              items:
+                properties:
+                  lastTransitionTime:
+                    description: Last time the condition transitioned from one status to another.
+                    format: date-time
+                    type: string
+                  message:
+                    description: A human readable message indicating details about the transition.
+                    type: string
+                  reason:
+                    description: The reason for the condition's last transition.
+                    type: string
+                  status:
+                    description: Status of the condition, one of True, False, Unknown.
+                    type: string
+                  type:
+                    description: Type of VirtualService condition.
+                    type: string
+                required:
+                - status
+                - type
+                type: object
+              type: array
+            observedGeneration:
+              description: The generation observed by the VirtualService controller.
+              format: int64
+              type: integer
+            virtualServiceARN:
+              description: VirtualServiceARN is the AppMesh VirtualService object's Amazon Resource Name.
+              type: string
+          type: object
+      type: object
+  version: v1beta2
+  versions:
+  - name: v1beta2
+    served: true
+    storage: true
+status:
+  acceptedNames:
+    kind: ""
+    plural: ""
+  conditions: []
+  storedVersions: []
\ No newline at end of file
diff --git a/infrastructure/appmesh/kustomization.yaml b/infrastructure/appmesh/kustomization.yaml
index cea3c6c..2c64d55 100644
--- a/infrastructure/appmesh/kustomization.yaml
+++ b/infrastructure/appmesh/kustomization.yaml
@@ -3,6 +3,7 @@ kind: Kustomization
 resources:
   - namespace.yaml
   - appmesh-repo.yaml
+  - appmesh-crds.yaml
   - appmesh-controller.yaml
   - appmesh-config.yaml
   - flagger.yaml
\ No newline at end of file
-- 
2.27.0

From 2a1fd2b28c2bbb2487efeaf09c2515a3c4b598f7 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 02:42:49 -0400
Subject: [PATCH] Add app mesh config yaml

---
 infrastructure/appmesh/kustomization.yaml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/infrastructure/appmesh/kustomization.yaml b/infrastructure/appmesh/kustomization.yaml
index 2c64d55..1d1210a 100644
--- a/infrastructure/appmesh/kustomization.yaml
+++ b/infrastructure/appmesh/kustomization.yaml
@@ -2,8 +2,8 @@ apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
 resources:
   - namespace.yaml
-  - appmesh-repo.yaml
   - appmesh-crds.yaml
+  - appmesh-repo.yaml
   - appmesh-controller.yaml
   - appmesh-config.yaml
   - flagger.yaml
\ No newline at end of file
-- 
2.27.0

From 9d8dd33433825cefc8f653837991f8539fcbc0b7 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 03:01:22 -0400
Subject: [PATCH] Add app mesh config yaml

---
 infrastructure/istio/flagger.yaml       |   21 +
 infrastructure/istio/istio-repo.yaml    |    8 +
 infrastructure/istio/istio.yaml         | 8873 +++++++++++++++++++++++
 infrastructure/istio/kustomization.yaml |    6 +
 infrastructure/istio/namespace.yaml     |    4 +
 infrastructure/istio/prometheus.yaml    |  478 ++
 infrastructure/kustomization.yaml       |    2 +-
 prometheus.yaml                         |  478 ++
 8 files changed, 9869 insertions(+), 1 deletion(-)
 create mode 100644 infrastructure/istio/flagger.yaml
 create mode 100644 infrastructure/istio/istio-repo.yaml
 create mode 100644 infrastructure/istio/istio.yaml
 create mode 100644 infrastructure/istio/kustomization.yaml
 create mode 100644 infrastructure/istio/namespace.yaml
 create mode 100644 infrastructure/istio/prometheus.yaml
 create mode 100644 prometheus.yaml

diff --git a/infrastructure/istio/flagger.yaml b/infrastructure/istio/flagger.yaml
new file mode 100644
index 0000000..e79117b
--- /dev/null
+++ b/infrastructure/istio/flagger.yaml
@@ -0,0 +1,21 @@
+apiVersion: helm.toolkit.fluxcd.io/v2beta1
+kind: HelmRelease
+metadata:
+  name: flagger
+  namespace: istio-system
+spec:
+  releaseName: flagger
+  chart:
+    spec:
+      chart: flagger
+      sourceRef:
+        kind: HelmRepository
+        name: flagger
+        namespace: istio-system
+  interval: 1m0s
+  install:
+    remediation:
+      retries: 3
+  values:
+    meshProvider:istio
+    metricsServer: http://prometheus.istio-system.svc.cluster.local:9090
\ No newline at end of file
diff --git a/infrastructure/istio/istio-repo.yaml b/infrastructure/istio/istio-repo.yaml
new file mode 100644
index 0000000..47c5804
--- /dev/null
+++ b/infrastructure/istio/istio-repo.yaml
@@ -0,0 +1,8 @@
+apiVersion: source.toolkit.fluxcd.io/v1beta1
+kind: HelmRepository
+metadata:
+  name: flagger
+  namespace: istio-system
+spec:
+  interval: 1m
+  url: https://flagger.app
\ No newline at end of file
diff --git a/infrastructure/istio/istio.yaml b/infrastructure/istio/istio.yaml
new file mode 100644
index 0000000..81ee60d
--- /dev/null
+++ b/infrastructure/istio/istio.yaml
@@ -0,0 +1,8873 @@
+kind: CustomResourceDefinition
+apiVersion: apiextensions.k8s.io/v1
+metadata:
+  name: adapters.config.istio.io
+  labels:
+    app: mixer
+    package: adapter
+    istio: mixer-adapter
+    chart: istio
+    heritage: Tiller
+    release: istio
+  annotations:
+    "helm.sh/resource-policy": keep
+spec:
+  group: config.istio.io
+  names:
+    kind: adapter
+    plural: adapters
+    singular: adapter
+    categories:
+      - istio-io
+      - policy-istio-io
+  scope: Namespaced
+  versions:
+    - name: v1alpha2
+      schema:
+        openAPIV3Schema:
+          properties:
+            spec:
+              x-kubernetes-preserve-unknown-fields: true
+              type: object
+            status:
+              x-kubernetes-preserve-unknown-fields: true
+              type: object
+          type: object
+      served: true
+      storage: true
+      subresources:
+        status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: mixer
+    chart: istio
+    heritage: Tiller
+    istio: core
+    package: istio.io.mixer
+    release: istio
+  name: attributemanifests.config.istio.io
+spec:
+  group: config.istio.io
+  names:
+    categories:
+    - istio-io
+    - policy-istio-io
+    kind: attributemanifest
+    listKind: attributemanifestList
+    plural: attributemanifests
+    singular: attributemanifest
+  scope: Namespaced
+  versions:
+  - name: v1alpha2
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Describes the rules used to configure Mixer''s policy and
+              telemetry features. See more details at: https://istio.io/docs/reference/config/policy-and-telemetry/istio.policy.v1beta1.html'
+            properties:
+              attributes:
+                additionalProperties:
+                  properties:
+                    description:
+                      description: A human-readable description of the attribute's
+                        purpose.
+                      format: string
+                      type: string
+                    valueType:
+                      description: The type of data carried by this attribute.
+                      enum:
+                      - VALUE_TYPE_UNSPECIFIED
+                      - STRING
+                      - INT64
+                      - DOUBLE
+                      - BOOL
+                      - TIMESTAMP
+                      - IP_ADDRESS
+                      - EMAIL_ADDRESS
+                      - URI
+                      - DNS_NAME
+                      - DURATION
+                      - STRING_MAP
+                      type: string
+                  type: object
+                description: The set of attributes this Istio component will be responsible
+                  for producing at runtime.
+                type: object
+              name:
+                description: Name of the component producing these attributes.
+                format: string
+                type: string
+              revision:
+                description: The revision of this document.
+                format: string
+                type: string
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-pilot
+    chart: istio
+    heritage: Tiller
+    istio: security
+    release: istio
+  name: authorizationpolicies.security.istio.io
+spec:
+  group: security.istio.io
+  names:
+    categories:
+    - istio-io
+    - security-istio-io
+    kind: AuthorizationPolicy
+    listKind: AuthorizationPolicyList
+    plural: authorizationpolicies
+    singular: authorizationpolicy
+  scope: Namespaced
+  versions:
+  - name: v1beta1
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Configuration for access control on workloads. See more
+              details at: https://istio.io/docs/reference/config/security/authorization-policy.html'
+            properties:
+              action:
+                description: Optional.
+                enum:
+                - ALLOW
+                - DENY
+                - AUDIT
+                type: string
+              rules:
+                description: Optional.
+                items:
+                  properties:
+                    from:
+                      description: Optional.
+                      items:
+                        properties:
+                          source:
+                            description: Source specifies the source of a request.
+                            properties:
+                              ipBlocks:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              namespaces:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              notIpBlocks:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              notNamespaces:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              notPrincipals:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              notRequestPrincipals:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              principals:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              requestPrincipals:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                            type: object
+                        type: object
+                      type: array
+                    to:
+                      description: Optional.
+                      items:
+                        properties:
+                          operation:
+                            description: Operation specifies the operation of a request.
+                            properties:
+                              hosts:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              methods:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              notHosts:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              notMethods:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              notPaths:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              notPorts:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              paths:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              ports:
+                                description: Optional.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                            type: object
+                        type: object
+                      type: array
+                    when:
+                      description: Optional.
+                      items:
+                        properties:
+                          key:
+                            description: The name of an Istio attribute.
+                            format: string
+                            type: string
+                          notValues:
+                            description: Optional.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                          values:
+                            description: Optional.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                        type: object
+                      type: array
+                  type: object
+                type: array
+              selector:
+                description: Optional.
+                properties:
+                  matchLabels:
+                    additionalProperties:
+                      format: string
+                      type: string
+                    type: object
+                type: object
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-pilot
+    chart: istio
+    heritage: Tiller
+    release: istio
+  name: destinationrules.networking.istio.io
+spec:
+  group: networking.istio.io
+  names:
+    categories:
+    - istio-io
+    - networking-istio-io
+    kind: DestinationRule
+    listKind: DestinationRuleList
+    plural: destinationrules
+    shortNames:
+    - dr
+    singular: destinationrule
+  scope: Namespaced
+  versions:
+  - additionalPrinterColumns:
+    - description: The name of a service from the service registry
+      jsonPath: .spec.host
+      name: Host
+      type: string
+    - description: 'CreationTimestamp is a timestamp representing the server time
+        when this object was created. It is not guaranteed to be set in happens-before
+        order across separate operations. Clients may not set this value. It is represented
+        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
+        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
+      jsonPath: .metadata.creationTimestamp
+      name: Age
+      type: date
+    name: v1alpha3
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Configuration affecting load balancing, outlier detection,
+              etc. See more details at: https://istio.io/docs/reference/config/networking/destination-rule.html'
+            properties:
+              exportTo:
+                description: A list of namespaces to which this destination rule is
+                  exported.
+                items:
+                  format: string
+                  type: string
+                type: array
+              host:
+                description: The name of a service from the service registry.
+                format: string
+                type: string
+              subsets:
+                items:
+                  properties:
+                    labels:
+                      additionalProperties:
+                        format: string
+                        type: string
+                      type: object
+                    name:
+                      description: Name of the subset.
+                      format: string
+                      type: string
+                    trafficPolicy:
+                      description: Traffic policies that apply to this subset.
+                      properties:
+                        connectionPool:
+                          properties:
+                            http:
+                              description: HTTP connection pool settings.
+                              properties:
+                                h2UpgradePolicy:
+                                  description: Specify if http1.1 connection should
+                                    be upgraded to http2 for the associated destination.
+                                  enum:
+                                  - DEFAULT
+                                  - DO_NOT_UPGRADE
+                                  - UPGRADE
+                                  type: string
+                                http1MaxPendingRequests:
+                                  description: Maximum number of pending HTTP requests
+                                    to a destination.
+                                  format: int32
+                                  type: integer
+                                http2MaxRequests:
+                                  description: Maximum number of requests to a backend.
+                                  format: int32
+                                  type: integer
+                                idleTimeout:
+                                  description: The idle timeout for upstream connection
+                                    pool connections.
+                                  type: string
+                                maxRequestsPerConnection:
+                                  description: Maximum number of requests per connection
+                                    to a backend.
+                                  format: int32
+                                  type: integer
+                                maxRetries:
+                                  format: int32
+                                  type: integer
+                              type: object
+                            tcp:
+                              description: Settings common to both HTTP and TCP upstream
+                                connections.
+                              properties:
+                                connectTimeout:
+                                  description: TCP connection timeout.
+                                  type: string
+                                maxConnections:
+                                  description: Maximum number of HTTP1 /TCP connections
+                                    to a destination host.
+                                  format: int32
+                                  type: integer
+                                tcpKeepalive:
+                                  description: If set then set SO_KEEPALIVE on the
+                                    socket to enable TCP Keepalives.
+                                  properties:
+                                    interval:
+                                      description: The time duration between keep-alive
+                                        probes.
+                                      type: string
+                                    probes:
+                                      type: integer
+                                    time:
+                                      type: string
+                                  type: object
+                              type: object
+                          type: object
+                        loadBalancer:
+                          description: Settings controlling the load balancer algorithms.
+                          oneOf:
+                          - not:
+                              anyOf:
+                              - required:
+                                - simple
+                              - properties:
+                                  consistentHash:
+                                    oneOf:
+                                    - not:
+                                        anyOf:
+                                        - required:
+                                          - httpHeaderName
+                                        - required:
+                                          - httpCookie
+                                        - required:
+                                          - useSourceIp
+                                        - required:
+                                          - httpQueryParameterName
+                                    - required:
+                                      - httpHeaderName
+                                    - required:
+                                      - httpCookie
+                                    - required:
+                                      - useSourceIp
+                                    - required:
+                                      - httpQueryParameterName
+                                required:
+                                - consistentHash
+                          - required:
+                            - simple
+                          - properties:
+                              consistentHash:
+                                oneOf:
+                                - not:
+                                    anyOf:
+                                    - required:
+                                      - httpHeaderName
+                                    - required:
+                                      - httpCookie
+                                    - required:
+                                      - useSourceIp
+                                    - required:
+                                      - httpQueryParameterName
+                                - required:
+                                  - httpHeaderName
+                                - required:
+                                  - httpCookie
+                                - required:
+                                  - useSourceIp
+                                - required:
+                                  - httpQueryParameterName
+                            required:
+                            - consistentHash
+                          properties:
+                            consistentHash:
+                              properties:
+                                httpCookie:
+                                  description: Hash based on HTTP cookie.
+                                  properties:
+                                    name:
+                                      description: Name of the cookie.
+                                      format: string
+                                      type: string
+                                    path:
+                                      description: Path to set for the cookie.
+                                      format: string
+                                      type: string
+                                    ttl:
+                                      description: Lifetime of the cookie.
+                                      type: string
+                                  type: object
+                                httpHeaderName:
+                                  description: Hash based on a specific HTTP header.
+                                  format: string
+                                  type: string
+                                httpQueryParameterName:
+                                  description: Hash based on a specific HTTP query
+                                    parameter.
+                                  format: string
+                                  type: string
+                                minimumRingSize:
+                                  type: integer
+                                useSourceIp:
+                                  description: Hash based on the source IP address.
+                                  type: boolean
+                              type: object
+                            localityLbSetting:
+                              properties:
+                                distribute:
+                                  description: 'Optional: only one of distribute or
+                                    failover can be set.'
+                                  items:
+                                    properties:
+                                      from:
+                                        description: Originating locality, '/' separated,
+                                          e.g.
+                                        format: string
+                                        type: string
+                                      to:
+                                        additionalProperties:
+                                          type: integer
+                                        description: Map of upstream localities to
+                                          traffic distribution weights.
+                                        type: object
+                                    type: object
+                                  type: array
+                                enabled:
+                                  description: enable locality load balancing, this
+                                    is DestinationRule-level and will override mesh
+                                    wide settings in entirety.
+                                  nullable: true
+                                  type: boolean
+                                failover:
+                                  description: 'Optional: only failover or distribute
+                                    can be set.'
+                                  items:
+                                    properties:
+                                      from:
+                                        description: Originating region.
+                                        format: string
+                                        type: string
+                                      to:
+                                        format: string
+                                        type: string
+                                    type: object
+                                  type: array
+                              type: object
+                            simple:
+                              enum:
+                              - ROUND_ROBIN
+                              - LEAST_CONN
+                              - RANDOM
+                              - PASSTHROUGH
+                              type: string
+                          type: object
+                        outlierDetection:
+                          properties:
+                            baseEjectionTime:
+                              description: Minimum ejection duration.
+                              type: string
+                            consecutive5xxErrors:
+                              description: Number of 5xx errors before a host is ejected
+                                from the connection pool.
+                              nullable: true
+                              type: integer
+                            consecutiveErrors:
+                              format: int32
+                              type: integer
+                            consecutiveGatewayErrors:
+                              description: Number of gateway errors before a host
+                                is ejected from the connection pool.
+                              nullable: true
+                              type: integer
+                            interval:
+                              description: Time interval between ejection sweep analysis.
+                              type: string
+                            maxEjectionPercent:
+                              format: int32
+                              type: integer
+                            minHealthPercent:
+                              format: int32
+                              type: integer
+                          type: object
+                        portLevelSettings:
+                          description: Traffic policies specific to individual ports.
+                          items:
+                            properties:
+                              connectionPool:
+                                properties:
+                                  http:
+                                    description: HTTP connection pool settings.
+                                    properties:
+                                      h2UpgradePolicy:
+                                        description: Specify if http1.1 connection
+                                          should be upgraded to http2 for the associated
+                                          destination.
+                                        enum:
+                                        - DEFAULT
+                                        - DO_NOT_UPGRADE
+                                        - UPGRADE
+                                        type: string
+                                      http1MaxPendingRequests:
+                                        description: Maximum number of pending HTTP
+                                          requests to a destination.
+                                        format: int32
+                                        type: integer
+                                      http2MaxRequests:
+                                        description: Maximum number of requests to
+                                          a backend.
+                                        format: int32
+                                        type: integer
+                                      idleTimeout:
+                                        description: The idle timeout for upstream
+                                          connection pool connections.
+                                        type: string
+                                      maxRequestsPerConnection:
+                                        description: Maximum number of requests per
+                                          connection to a backend.
+                                        format: int32
+                                        type: integer
+                                      maxRetries:
+                                        format: int32
+                                        type: integer
+                                    type: object
+                                  tcp:
+                                    description: Settings common to both HTTP and
+                                      TCP upstream connections.
+                                    properties:
+                                      connectTimeout:
+                                        description: TCP connection timeout.
+                                        type: string
+                                      maxConnections:
+                                        description: Maximum number of HTTP1 /TCP
+                                          connections to a destination host.
+                                        format: int32
+                                        type: integer
+                                      tcpKeepalive:
+                                        description: If set then set SO_KEEPALIVE
+                                          on the socket to enable TCP Keepalives.
+                                        properties:
+                                          interval:
+                                            description: The time duration between
+                                              keep-alive probes.
+                                            type: string
+                                          probes:
+                                            type: integer
+                                          time:
+                                            type: string
+                                        type: object
+                                    type: object
+                                type: object
+                              loadBalancer:
+                                description: Settings controlling the load balancer
+                                  algorithms.
+                                oneOf:
+                                - not:
+                                    anyOf:
+                                    - required:
+                                      - simple
+                                    - properties:
+                                        consistentHash:
+                                          oneOf:
+                                          - not:
+                                              anyOf:
+                                              - required:
+                                                - httpHeaderName
+                                              - required:
+                                                - httpCookie
+                                              - required:
+                                                - useSourceIp
+                                              - required:
+                                                - httpQueryParameterName
+                                          - required:
+                                            - httpHeaderName
+                                          - required:
+                                            - httpCookie
+                                          - required:
+                                            - useSourceIp
+                                          - required:
+                                            - httpQueryParameterName
+                                      required:
+                                      - consistentHash
+                                - required:
+                                  - simple
+                                - properties:
+                                    consistentHash:
+                                      oneOf:
+                                      - not:
+                                          anyOf:
+                                          - required:
+                                            - httpHeaderName
+                                          - required:
+                                            - httpCookie
+                                          - required:
+                                            - useSourceIp
+                                          - required:
+                                            - httpQueryParameterName
+                                      - required:
+                                        - httpHeaderName
+                                      - required:
+                                        - httpCookie
+                                      - required:
+                                        - useSourceIp
+                                      - required:
+                                        - httpQueryParameterName
+                                  required:
+                                  - consistentHash
+                                properties:
+                                  consistentHash:
+                                    properties:
+                                      httpCookie:
+                                        description: Hash based on HTTP cookie.
+                                        properties:
+                                          name:
+                                            description: Name of the cookie.
+                                            format: string
+                                            type: string
+                                          path:
+                                            description: Path to set for the cookie.
+                                            format: string
+                                            type: string
+                                          ttl:
+                                            description: Lifetime of the cookie.
+                                            type: string
+                                        type: object
+                                      httpHeaderName:
+                                        description: Hash based on a specific HTTP
+                                          header.
+                                        format: string
+                                        type: string
+                                      httpQueryParameterName:
+                                        description: Hash based on a specific HTTP
+                                          query parameter.
+                                        format: string
+                                        type: string
+                                      minimumRingSize:
+                                        type: integer
+                                      useSourceIp:
+                                        description: Hash based on the source IP address.
+                                        type: boolean
+                                    type: object
+                                  localityLbSetting:
+                                    properties:
+                                      distribute:
+                                        description: 'Optional: only one of distribute
+                                          or failover can be set.'
+                                        items:
+                                          properties:
+                                            from:
+                                              description: Originating locality, '/'
+                                                separated, e.g.
+                                              format: string
+                                              type: string
+                                            to:
+                                              additionalProperties:
+                                                type: integer
+                                              description: Map of upstream localities
+                                                to traffic distribution weights.
+                                              type: object
+                                          type: object
+                                        type: array
+                                      enabled:
+                                        description: enable locality load balancing,
+                                          this is DestinationRule-level and will override
+                                          mesh wide settings in entirety.
+                                        nullable: true
+                                        type: boolean
+                                      failover:
+                                        description: 'Optional: only failover or distribute
+                                          can be set.'
+                                        items:
+                                          properties:
+                                            from:
+                                              description: Originating region.
+                                              format: string
+                                              type: string
+                                            to:
+                                              format: string
+                                              type: string
+                                          type: object
+                                        type: array
+                                    type: object
+                                  simple:
+                                    enum:
+                                    - ROUND_ROBIN
+                                    - LEAST_CONN
+                                    - RANDOM
+                                    - PASSTHROUGH
+                                    type: string
+                                type: object
+                              outlierDetection:
+                                properties:
+                                  baseEjectionTime:
+                                    description: Minimum ejection duration.
+                                    type: string
+                                  consecutive5xxErrors:
+                                    description: Number of 5xx errors before a host
+                                      is ejected from the connection pool.
+                                    nullable: true
+                                    type: integer
+                                  consecutiveErrors:
+                                    format: int32
+                                    type: integer
+                                  consecutiveGatewayErrors:
+                                    description: Number of gateway errors before a
+                                      host is ejected from the connection pool.
+                                    nullable: true
+                                    type: integer
+                                  interval:
+                                    description: Time interval between ejection sweep
+                                      analysis.
+                                    type: string
+                                  maxEjectionPercent:
+                                    format: int32
+                                    type: integer
+                                  minHealthPercent:
+                                    format: int32
+                                    type: integer
+                                type: object
+                              port:
+                                properties:
+                                  number:
+                                    type: integer
+                                type: object
+                              tls:
+                                description: TLS related settings for connections
+                                  to the upstream service.
+                                properties:
+                                  caCertificates:
+                                    format: string
+                                    type: string
+                                  clientCertificate:
+                                    description: REQUIRED if mode is `MUTUAL`.
+                                    format: string
+                                    type: string
+                                  credentialName:
+                                    format: string
+                                    type: string
+                                  mode:
+                                    enum:
+                                    - DISABLE
+                                    - SIMPLE
+                                    - MUTUAL
+                                    - ISTIO_MUTUAL
+                                    type: string
+                                  privateKey:
+                                    description: REQUIRED if mode is `MUTUAL`.
+                                    format: string
+                                    type: string
+                                  sni:
+                                    description: SNI string to present to the server
+                                      during TLS handshake.
+                                    format: string
+                                    type: string
+                                  subjectAltNames:
+                                    items:
+                                      format: string
+                                      type: string
+                                    type: array
+                                type: object
+                            type: object
+                          type: array
+                        tls:
+                          description: TLS related settings for connections to the
+                            upstream service.
+                          properties:
+                            caCertificates:
+                              format: string
+                              type: string
+                            clientCertificate:
+                              description: REQUIRED if mode is `MUTUAL`.
+                              format: string
+                              type: string
+                            credentialName:
+                              format: string
+                              type: string
+                            mode:
+                              enum:
+                              - DISABLE
+                              - SIMPLE
+                              - MUTUAL
+                              - ISTIO_MUTUAL
+                              type: string
+                            privateKey:
+                              description: REQUIRED if mode is `MUTUAL`.
+                              format: string
+                              type: string
+                            sni:
+                              description: SNI string to present to the server during
+                                TLS handshake.
+                              format: string
+                              type: string
+                            subjectAltNames:
+                              items:
+                                format: string
+                                type: string
+                              type: array
+                          type: object
+                      type: object
+                  type: object
+                type: array
+              trafficPolicy:
+                properties:
+                  connectionPool:
+                    properties:
+                      http:
+                        description: HTTP connection pool settings.
+                        properties:
+                          h2UpgradePolicy:
+                            description: Specify if http1.1 connection should be upgraded
+                              to http2 for the associated destination.
+                            enum:
+                            - DEFAULT
+                            - DO_NOT_UPGRADE
+                            - UPGRADE
+                            type: string
+                          http1MaxPendingRequests:
+                            description: Maximum number of pending HTTP requests to
+                              a destination.
+                            format: int32
+                            type: integer
+                          http2MaxRequests:
+                            description: Maximum number of requests to a backend.
+                            format: int32
+                            type: integer
+                          idleTimeout:
+                            description: The idle timeout for upstream connection
+                              pool connections.
+                            type: string
+                          maxRequestsPerConnection:
+                            description: Maximum number of requests per connection
+                              to a backend.
+                            format: int32
+                            type: integer
+                          maxRetries:
+                            format: int32
+                            type: integer
+                        type: object
+                      tcp:
+                        description: Settings common to both HTTP and TCP upstream
+                          connections.
+                        properties:
+                          connectTimeout:
+                            description: TCP connection timeout.
+                            type: string
+                          maxConnections:
+                            description: Maximum number of HTTP1 /TCP connections
+                              to a destination host.
+                            format: int32
+                            type: integer
+                          tcpKeepalive:
+                            description: If set then set SO_KEEPALIVE on the socket
+                              to enable TCP Keepalives.
+                            properties:
+                              interval:
+                                description: The time duration between keep-alive
+                                  probes.
+                                type: string
+                              probes:
+                                type: integer
+                              time:
+                                type: string
+                            type: object
+                        type: object
+                    type: object
+                  loadBalancer:
+                    description: Settings controlling the load balancer algorithms.
+                    oneOf:
+                    - not:
+                        anyOf:
+                        - required:
+                          - simple
+                        - properties:
+                            consistentHash:
+                              oneOf:
+                              - not:
+                                  anyOf:
+                                  - required:
+                                    - httpHeaderName
+                                  - required:
+                                    - httpCookie
+                                  - required:
+                                    - useSourceIp
+                                  - required:
+                                    - httpQueryParameterName
+                              - required:
+                                - httpHeaderName
+                              - required:
+                                - httpCookie
+                              - required:
+                                - useSourceIp
+                              - required:
+                                - httpQueryParameterName
+                          required:
+                          - consistentHash
+                    - required:
+                      - simple
+                    - properties:
+                        consistentHash:
+                          oneOf:
+                          - not:
+                              anyOf:
+                              - required:
+                                - httpHeaderName
+                              - required:
+                                - httpCookie
+                              - required:
+                                - useSourceIp
+                              - required:
+                                - httpQueryParameterName
+                          - required:
+                            - httpHeaderName
+                          - required:
+                            - httpCookie
+                          - required:
+                            - useSourceIp
+                          - required:
+                            - httpQueryParameterName
+                      required:
+                      - consistentHash
+                    properties:
+                      consistentHash:
+                        properties:
+                          httpCookie:
+                            description: Hash based on HTTP cookie.
+                            properties:
+                              name:
+                                description: Name of the cookie.
+                                format: string
+                                type: string
+                              path:
+                                description: Path to set for the cookie.
+                                format: string
+                                type: string
+                              ttl:
+                                description: Lifetime of the cookie.
+                                type: string
+                            type: object
+                          httpHeaderName:
+                            description: Hash based on a specific HTTP header.
+                            format: string
+                            type: string
+                          httpQueryParameterName:
+                            description: Hash based on a specific HTTP query parameter.
+                            format: string
+                            type: string
+                          minimumRingSize:
+                            type: integer
+                          useSourceIp:
+                            description: Hash based on the source IP address.
+                            type: boolean
+                        type: object
+                      localityLbSetting:
+                        properties:
+                          distribute:
+                            description: 'Optional: only one of distribute or failover
+                              can be set.'
+                            items:
+                              properties:
+                                from:
+                                  description: Originating locality, '/' separated,
+                                    e.g.
+                                  format: string
+                                  type: string
+                                to:
+                                  additionalProperties:
+                                    type: integer
+                                  description: Map of upstream localities to traffic
+                                    distribution weights.
+                                  type: object
+                              type: object
+                            type: array
+                          enabled:
+                            description: enable locality load balancing, this is DestinationRule-level
+                              and will override mesh wide settings in entirety.
+                            nullable: true
+                            type: boolean
+                          failover:
+                            description: 'Optional: only failover or distribute can
+                              be set.'
+                            items:
+                              properties:
+                                from:
+                                  description: Originating region.
+                                  format: string
+                                  type: string
+                                to:
+                                  format: string
+                                  type: string
+                              type: object
+                            type: array
+                        type: object
+                      simple:
+                        enum:
+                        - ROUND_ROBIN
+                        - LEAST_CONN
+                        - RANDOM
+                        - PASSTHROUGH
+                        type: string
+                    type: object
+                  outlierDetection:
+                    properties:
+                      baseEjectionTime:
+                        description: Minimum ejection duration.
+                        type: string
+                      consecutive5xxErrors:
+                        description: Number of 5xx errors before a host is ejected
+                          from the connection pool.
+                        nullable: true
+                        type: integer
+                      consecutiveErrors:
+                        format: int32
+                        type: integer
+                      consecutiveGatewayErrors:
+                        description: Number of gateway errors before a host is ejected
+                          from the connection pool.
+                        nullable: true
+                        type: integer
+                      interval:
+                        description: Time interval between ejection sweep analysis.
+                        type: string
+                      maxEjectionPercent:
+                        format: int32
+                        type: integer
+                      minHealthPercent:
+                        format: int32
+                        type: integer
+                    type: object
+                  portLevelSettings:
+                    description: Traffic policies specific to individual ports.
+                    items:
+                      properties:
+                        connectionPool:
+                          properties:
+                            http:
+                              description: HTTP connection pool settings.
+                              properties:
+                                h2UpgradePolicy:
+                                  description: Specify if http1.1 connection should
+                                    be upgraded to http2 for the associated destination.
+                                  enum:
+                                  - DEFAULT
+                                  - DO_NOT_UPGRADE
+                                  - UPGRADE
+                                  type: string
+                                http1MaxPendingRequests:
+                                  description: Maximum number of pending HTTP requests
+                                    to a destination.
+                                  format: int32
+                                  type: integer
+                                http2MaxRequests:
+                                  description: Maximum number of requests to a backend.
+                                  format: int32
+                                  type: integer
+                                idleTimeout:
+                                  description: The idle timeout for upstream connection
+                                    pool connections.
+                                  type: string
+                                maxRequestsPerConnection:
+                                  description: Maximum number of requests per connection
+                                    to a backend.
+                                  format: int32
+                                  type: integer
+                                maxRetries:
+                                  format: int32
+                                  type: integer
+                              type: object
+                            tcp:
+                              description: Settings common to both HTTP and TCP upstream
+                                connections.
+                              properties:
+                                connectTimeout:
+                                  description: TCP connection timeout.
+                                  type: string
+                                maxConnections:
+                                  description: Maximum number of HTTP1 /TCP connections
+                                    to a destination host.
+                                  format: int32
+                                  type: integer
+                                tcpKeepalive:
+                                  description: If set then set SO_KEEPALIVE on the
+                                    socket to enable TCP Keepalives.
+                                  properties:
+                                    interval:
+                                      description: The time duration between keep-alive
+                                        probes.
+                                      type: string
+                                    probes:
+                                      type: integer
+                                    time:
+                                      type: string
+                                  type: object
+                              type: object
+                          type: object
+                        loadBalancer:
+                          description: Settings controlling the load balancer algorithms.
+                          oneOf:
+                          - not:
+                              anyOf:
+                              - required:
+                                - simple
+                              - properties:
+                                  consistentHash:
+                                    oneOf:
+                                    - not:
+                                        anyOf:
+                                        - required:
+                                          - httpHeaderName
+                                        - required:
+                                          - httpCookie
+                                        - required:
+                                          - useSourceIp
+                                        - required:
+                                          - httpQueryParameterName
+                                    - required:
+                                      - httpHeaderName
+                                    - required:
+                                      - httpCookie
+                                    - required:
+                                      - useSourceIp
+                                    - required:
+                                      - httpQueryParameterName
+                                required:
+                                - consistentHash
+                          - required:
+                            - simple
+                          - properties:
+                              consistentHash:
+                                oneOf:
+                                - not:
+                                    anyOf:
+                                    - required:
+                                      - httpHeaderName
+                                    - required:
+                                      - httpCookie
+                                    - required:
+                                      - useSourceIp
+                                    - required:
+                                      - httpQueryParameterName
+                                - required:
+                                  - httpHeaderName
+                                - required:
+                                  - httpCookie
+                                - required:
+                                  - useSourceIp
+                                - required:
+                                  - httpQueryParameterName
+                            required:
+                            - consistentHash
+                          properties:
+                            consistentHash:
+                              properties:
+                                httpCookie:
+                                  description: Hash based on HTTP cookie.
+                                  properties:
+                                    name:
+                                      description: Name of the cookie.
+                                      format: string
+                                      type: string
+                                    path:
+                                      description: Path to set for the cookie.
+                                      format: string
+                                      type: string
+                                    ttl:
+                                      description: Lifetime of the cookie.
+                                      type: string
+                                  type: object
+                                httpHeaderName:
+                                  description: Hash based on a specific HTTP header.
+                                  format: string
+                                  type: string
+                                httpQueryParameterName:
+                                  description: Hash based on a specific HTTP query
+                                    parameter.
+                                  format: string
+                                  type: string
+                                minimumRingSize:
+                                  type: integer
+                                useSourceIp:
+                                  description: Hash based on the source IP address.
+                                  type: boolean
+                              type: object
+                            localityLbSetting:
+                              properties:
+                                distribute:
+                                  description: 'Optional: only one of distribute or
+                                    failover can be set.'
+                                  items:
+                                    properties:
+                                      from:
+                                        description: Originating locality, '/' separated,
+                                          e.g.
+                                        format: string
+                                        type: string
+                                      to:
+                                        additionalProperties:
+                                          type: integer
+                                        description: Map of upstream localities to
+                                          traffic distribution weights.
+                                        type: object
+                                    type: object
+                                  type: array
+                                enabled:
+                                  description: enable locality load balancing, this
+                                    is DestinationRule-level and will override mesh
+                                    wide settings in entirety.
+                                  nullable: true
+                                  type: boolean
+                                failover:
+                                  description: 'Optional: only failover or distribute
+                                    can be set.'
+                                  items:
+                                    properties:
+                                      from:
+                                        description: Originating region.
+                                        format: string
+                                        type: string
+                                      to:
+                                        format: string
+                                        type: string
+                                    type: object
+                                  type: array
+                              type: object
+                            simple:
+                              enum:
+                              - ROUND_ROBIN
+                              - LEAST_CONN
+                              - RANDOM
+                              - PASSTHROUGH
+                              type: string
+                          type: object
+                        outlierDetection:
+                          properties:
+                            baseEjectionTime:
+                              description: Minimum ejection duration.
+                              type: string
+                            consecutive5xxErrors:
+                              description: Number of 5xx errors before a host is ejected
+                                from the connection pool.
+                              nullable: true
+                              type: integer
+                            consecutiveErrors:
+                              format: int32
+                              type: integer
+                            consecutiveGatewayErrors:
+                              description: Number of gateway errors before a host
+                                is ejected from the connection pool.
+                              nullable: true
+                              type: integer
+                            interval:
+                              description: Time interval between ejection sweep analysis.
+                              type: string
+                            maxEjectionPercent:
+                              format: int32
+                              type: integer
+                            minHealthPercent:
+                              format: int32
+                              type: integer
+                          type: object
+                        port:
+                          properties:
+                            number:
+                              type: integer
+                          type: object
+                        tls:
+                          description: TLS related settings for connections to the
+                            upstream service.
+                          properties:
+                            caCertificates:
+                              format: string
+                              type: string
+                            clientCertificate:
+                              description: REQUIRED if mode is `MUTUAL`.
+                              format: string
+                              type: string
+                            credentialName:
+                              format: string
+                              type: string
+                            mode:
+                              enum:
+                              - DISABLE
+                              - SIMPLE
+                              - MUTUAL
+                              - ISTIO_MUTUAL
+                              type: string
+                            privateKey:
+                              description: REQUIRED if mode is `MUTUAL`.
+                              format: string
+                              type: string
+                            sni:
+                              description: SNI string to present to the server during
+                                TLS handshake.
+                              format: string
+                              type: string
+                            subjectAltNames:
+                              items:
+                                format: string
+                                type: string
+                              type: array
+                          type: object
+                      type: object
+                    type: array
+                  tls:
+                    description: TLS related settings for connections to the upstream
+                      service.
+                    properties:
+                      caCertificates:
+                        format: string
+                        type: string
+                      clientCertificate:
+                        description: REQUIRED if mode is `MUTUAL`.
+                        format: string
+                        type: string
+                      credentialName:
+                        format: string
+                        type: string
+                      mode:
+                        enum:
+                        - DISABLE
+                        - SIMPLE
+                        - MUTUAL
+                        - ISTIO_MUTUAL
+                        type: string
+                      privateKey:
+                        description: REQUIRED if mode is `MUTUAL`.
+                        format: string
+                        type: string
+                      sni:
+                        description: SNI string to present to the server during TLS
+                          handshake.
+                        format: string
+                        type: string
+                      subjectAltNames:
+                        items:
+                          format: string
+                          type: string
+                        type: array
+                    type: object
+                type: object
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+  - additionalPrinterColumns:
+    - description: The name of a service from the service registry
+      jsonPath: .spec.host
+      name: Host
+      type: string
+    - description: 'CreationTimestamp is a timestamp representing the server time
+        when this object was created. It is not guaranteed to be set in happens-before
+        order across separate operations. Clients may not set this value. It is represented
+        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
+        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
+      jsonPath: .metadata.creationTimestamp
+      name: Age
+      type: date
+    name: v1beta1
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Configuration affecting load balancing, outlier detection,
+              etc. See more details at: https://istio.io/docs/reference/config/networking/destination-rule.html'
+            properties:
+              exportTo:
+                description: A list of namespaces to which this destination rule is
+                  exported.
+                items:
+                  format: string
+                  type: string
+                type: array
+              host:
+                description: The name of a service from the service registry.
+                format: string
+                type: string
+              subsets:
+                items:
+                  properties:
+                    labels:
+                      additionalProperties:
+                        format: string
+                        type: string
+                      type: object
+                    name:
+                      description: Name of the subset.
+                      format: string
+                      type: string
+                    trafficPolicy:
+                      description: Traffic policies that apply to this subset.
+                      properties:
+                        connectionPool:
+                          properties:
+                            http:
+                              description: HTTP connection pool settings.
+                              properties:
+                                h2UpgradePolicy:
+                                  description: Specify if http1.1 connection should
+                                    be upgraded to http2 for the associated destination.
+                                  enum:
+                                  - DEFAULT
+                                  - DO_NOT_UPGRADE
+                                  - UPGRADE
+                                  type: string
+                                http1MaxPendingRequests:
+                                  description: Maximum number of pending HTTP requests
+                                    to a destination.
+                                  format: int32
+                                  type: integer
+                                http2MaxRequests:
+                                  description: Maximum number of requests to a backend.
+                                  format: int32
+                                  type: integer
+                                idleTimeout:
+                                  description: The idle timeout for upstream connection
+                                    pool connections.
+                                  type: string
+                                maxRequestsPerConnection:
+                                  description: Maximum number of requests per connection
+                                    to a backend.
+                                  format: int32
+                                  type: integer
+                                maxRetries:
+                                  format: int32
+                                  type: integer
+                              type: object
+                            tcp:
+                              description: Settings common to both HTTP and TCP upstream
+                                connections.
+                              properties:
+                                connectTimeout:
+                                  description: TCP connection timeout.
+                                  type: string
+                                maxConnections:
+                                  description: Maximum number of HTTP1 /TCP connections
+                                    to a destination host.
+                                  format: int32
+                                  type: integer
+                                tcpKeepalive:
+                                  description: If set then set SO_KEEPALIVE on the
+                                    socket to enable TCP Keepalives.
+                                  properties:
+                                    interval:
+                                      description: The time duration between keep-alive
+                                        probes.
+                                      type: string
+                                    probes:
+                                      type: integer
+                                    time:
+                                      type: string
+                                  type: object
+                              type: object
+                          type: object
+                        loadBalancer:
+                          description: Settings controlling the load balancer algorithms.
+                          oneOf:
+                          - not:
+                              anyOf:
+                              - required:
+                                - simple
+                              - properties:
+                                  consistentHash:
+                                    oneOf:
+                                    - not:
+                                        anyOf:
+                                        - required:
+                                          - httpHeaderName
+                                        - required:
+                                          - httpCookie
+                                        - required:
+                                          - useSourceIp
+                                        - required:
+                                          - httpQueryParameterName
+                                    - required:
+                                      - httpHeaderName
+                                    - required:
+                                      - httpCookie
+                                    - required:
+                                      - useSourceIp
+                                    - required:
+                                      - httpQueryParameterName
+                                required:
+                                - consistentHash
+                          - required:
+                            - simple
+                          - properties:
+                              consistentHash:
+                                oneOf:
+                                - not:
+                                    anyOf:
+                                    - required:
+                                      - httpHeaderName
+                                    - required:
+                                      - httpCookie
+                                    - required:
+                                      - useSourceIp
+                                    - required:
+                                      - httpQueryParameterName
+                                - required:
+                                  - httpHeaderName
+                                - required:
+                                  - httpCookie
+                                - required:
+                                  - useSourceIp
+                                - required:
+                                  - httpQueryParameterName
+                            required:
+                            - consistentHash
+                          properties:
+                            consistentHash:
+                              properties:
+                                httpCookie:
+                                  description: Hash based on HTTP cookie.
+                                  properties:
+                                    name:
+                                      description: Name of the cookie.
+                                      format: string
+                                      type: string
+                                    path:
+                                      description: Path to set for the cookie.
+                                      format: string
+                                      type: string
+                                    ttl:
+                                      description: Lifetime of the cookie.
+                                      type: string
+                                  type: object
+                                httpHeaderName:
+                                  description: Hash based on a specific HTTP header.
+                                  format: string
+                                  type: string
+                                httpQueryParameterName:
+                                  description: Hash based on a specific HTTP query
+                                    parameter.
+                                  format: string
+                                  type: string
+                                minimumRingSize:
+                                  type: integer
+                                useSourceIp:
+                                  description: Hash based on the source IP address.
+                                  type: boolean
+                              type: object
+                            localityLbSetting:
+                              properties:
+                                distribute:
+                                  description: 'Optional: only one of distribute or
+                                    failover can be set.'
+                                  items:
+                                    properties:
+                                      from:
+                                        description: Originating locality, '/' separated,
+                                          e.g.
+                                        format: string
+                                        type: string
+                                      to:
+                                        additionalProperties:
+                                          type: integer
+                                        description: Map of upstream localities to
+                                          traffic distribution weights.
+                                        type: object
+                                    type: object
+                                  type: array
+                                enabled:
+                                  description: enable locality load balancing, this
+                                    is DestinationRule-level and will override mesh
+                                    wide settings in entirety.
+                                  nullable: true
+                                  type: boolean
+                                failover:
+                                  description: 'Optional: only failover or distribute
+                                    can be set.'
+                                  items:
+                                    properties:
+                                      from:
+                                        description: Originating region.
+                                        format: string
+                                        type: string
+                                      to:
+                                        format: string
+                                        type: string
+                                    type: object
+                                  type: array
+                              type: object
+                            simple:
+                              enum:
+                              - ROUND_ROBIN
+                              - LEAST_CONN
+                              - RANDOM
+                              - PASSTHROUGH
+                              type: string
+                          type: object
+                        outlierDetection:
+                          properties:
+                            baseEjectionTime:
+                              description: Minimum ejection duration.
+                              type: string
+                            consecutive5xxErrors:
+                              description: Number of 5xx errors before a host is ejected
+                                from the connection pool.
+                              nullable: true
+                              type: integer
+                            consecutiveErrors:
+                              format: int32
+                              type: integer
+                            consecutiveGatewayErrors:
+                              description: Number of gateway errors before a host
+                                is ejected from the connection pool.
+                              nullable: true
+                              type: integer
+                            interval:
+                              description: Time interval between ejection sweep analysis.
+                              type: string
+                            maxEjectionPercent:
+                              format: int32
+                              type: integer
+                            minHealthPercent:
+                              format: int32
+                              type: integer
+                          type: object
+                        portLevelSettings:
+                          description: Traffic policies specific to individual ports.
+                          items:
+                            properties:
+                              connectionPool:
+                                properties:
+                                  http:
+                                    description: HTTP connection pool settings.
+                                    properties:
+                                      h2UpgradePolicy:
+                                        description: Specify if http1.1 connection
+                                          should be upgraded to http2 for the associated
+                                          destination.
+                                        enum:
+                                        - DEFAULT
+                                        - DO_NOT_UPGRADE
+                                        - UPGRADE
+                                        type: string
+                                      http1MaxPendingRequests:
+                                        description: Maximum number of pending HTTP
+                                          requests to a destination.
+                                        format: int32
+                                        type: integer
+                                      http2MaxRequests:
+                                        description: Maximum number of requests to
+                                          a backend.
+                                        format: int32
+                                        type: integer
+                                      idleTimeout:
+                                        description: The idle timeout for upstream
+                                          connection pool connections.
+                                        type: string
+                                      maxRequestsPerConnection:
+                                        description: Maximum number of requests per
+                                          connection to a backend.
+                                        format: int32
+                                        type: integer
+                                      maxRetries:
+                                        format: int32
+                                        type: integer
+                                    type: object
+                                  tcp:
+                                    description: Settings common to both HTTP and
+                                      TCP upstream connections.
+                                    properties:
+                                      connectTimeout:
+                                        description: TCP connection timeout.
+                                        type: string
+                                      maxConnections:
+                                        description: Maximum number of HTTP1 /TCP
+                                          connections to a destination host.
+                                        format: int32
+                                        type: integer
+                                      tcpKeepalive:
+                                        description: If set then set SO_KEEPALIVE
+                                          on the socket to enable TCP Keepalives.
+                                        properties:
+                                          interval:
+                                            description: The time duration between
+                                              keep-alive probes.
+                                            type: string
+                                          probes:
+                                            type: integer
+                                          time:
+                                            type: string
+                                        type: object
+                                    type: object
+                                type: object
+                              loadBalancer:
+                                description: Settings controlling the load balancer
+                                  algorithms.
+                                oneOf:
+                                - not:
+                                    anyOf:
+                                    - required:
+                                      - simple
+                                    - properties:
+                                        consistentHash:
+                                          oneOf:
+                                          - not:
+                                              anyOf:
+                                              - required:
+                                                - httpHeaderName
+                                              - required:
+                                                - httpCookie
+                                              - required:
+                                                - useSourceIp
+                                              - required:
+                                                - httpQueryParameterName
+                                          - required:
+                                            - httpHeaderName
+                                          - required:
+                                            - httpCookie
+                                          - required:
+                                            - useSourceIp
+                                          - required:
+                                            - httpQueryParameterName
+                                      required:
+                                      - consistentHash
+                                - required:
+                                  - simple
+                                - properties:
+                                    consistentHash:
+                                      oneOf:
+                                      - not:
+                                          anyOf:
+                                          - required:
+                                            - httpHeaderName
+                                          - required:
+                                            - httpCookie
+                                          - required:
+                                            - useSourceIp
+                                          - required:
+                                            - httpQueryParameterName
+                                      - required:
+                                        - httpHeaderName
+                                      - required:
+                                        - httpCookie
+                                      - required:
+                                        - useSourceIp
+                                      - required:
+                                        - httpQueryParameterName
+                                  required:
+                                  - consistentHash
+                                properties:
+                                  consistentHash:
+                                    properties:
+                                      httpCookie:
+                                        description: Hash based on HTTP cookie.
+                                        properties:
+                                          name:
+                                            description: Name of the cookie.
+                                            format: string
+                                            type: string
+                                          path:
+                                            description: Path to set for the cookie.
+                                            format: string
+                                            type: string
+                                          ttl:
+                                            description: Lifetime of the cookie.
+                                            type: string
+                                        type: object
+                                      httpHeaderName:
+                                        description: Hash based on a specific HTTP
+                                          header.
+                                        format: string
+                                        type: string
+                                      httpQueryParameterName:
+                                        description: Hash based on a specific HTTP
+                                          query parameter.
+                                        format: string
+                                        type: string
+                                      minimumRingSize:
+                                        type: integer
+                                      useSourceIp:
+                                        description: Hash based on the source IP address.
+                                        type: boolean
+                                    type: object
+                                  localityLbSetting:
+                                    properties:
+                                      distribute:
+                                        description: 'Optional: only one of distribute
+                                          or failover can be set.'
+                                        items:
+                                          properties:
+                                            from:
+                                              description: Originating locality, '/'
+                                                separated, e.g.
+                                              format: string
+                                              type: string
+                                            to:
+                                              additionalProperties:
+                                                type: integer
+                                              description: Map of upstream localities
+                                                to traffic distribution weights.
+                                              type: object
+                                          type: object
+                                        type: array
+                                      enabled:
+                                        description: enable locality load balancing,
+                                          this is DestinationRule-level and will override
+                                          mesh wide settings in entirety.
+                                        nullable: true
+                                        type: boolean
+                                      failover:
+                                        description: 'Optional: only failover or distribute
+                                          can be set.'
+                                        items:
+                                          properties:
+                                            from:
+                                              description: Originating region.
+                                              format: string
+                                              type: string
+                                            to:
+                                              format: string
+                                              type: string
+                                          type: object
+                                        type: array
+                                    type: object
+                                  simple:
+                                    enum:
+                                    - ROUND_ROBIN
+                                    - LEAST_CONN
+                                    - RANDOM
+                                    - PASSTHROUGH
+                                    type: string
+                                type: object
+                              outlierDetection:
+                                properties:
+                                  baseEjectionTime:
+                                    description: Minimum ejection duration.
+                                    type: string
+                                  consecutive5xxErrors:
+                                    description: Number of 5xx errors before a host
+                                      is ejected from the connection pool.
+                                    nullable: true
+                                    type: integer
+                                  consecutiveErrors:
+                                    format: int32
+                                    type: integer
+                                  consecutiveGatewayErrors:
+                                    description: Number of gateway errors before a
+                                      host is ejected from the connection pool.
+                                    nullable: true
+                                    type: integer
+                                  interval:
+                                    description: Time interval between ejection sweep
+                                      analysis.
+                                    type: string
+                                  maxEjectionPercent:
+                                    format: int32
+                                    type: integer
+                                  minHealthPercent:
+                                    format: int32
+                                    type: integer
+                                type: object
+                              port:
+                                properties:
+                                  number:
+                                    type: integer
+                                type: object
+                              tls:
+                                description: TLS related settings for connections
+                                  to the upstream service.
+                                properties:
+                                  caCertificates:
+                                    format: string
+                                    type: string
+                                  clientCertificate:
+                                    description: REQUIRED if mode is `MUTUAL`.
+                                    format: string
+                                    type: string
+                                  credentialName:
+                                    format: string
+                                    type: string
+                                  mode:
+                                    enum:
+                                    - DISABLE
+                                    - SIMPLE
+                                    - MUTUAL
+                                    - ISTIO_MUTUAL
+                                    type: string
+                                  privateKey:
+                                    description: REQUIRED if mode is `MUTUAL`.
+                                    format: string
+                                    type: string
+                                  sni:
+                                    description: SNI string to present to the server
+                                      during TLS handshake.
+                                    format: string
+                                    type: string
+                                  subjectAltNames:
+                                    items:
+                                      format: string
+                                      type: string
+                                    type: array
+                                type: object
+                            type: object
+                          type: array
+                        tls:
+                          description: TLS related settings for connections to the
+                            upstream service.
+                          properties:
+                            caCertificates:
+                              format: string
+                              type: string
+                            clientCertificate:
+                              description: REQUIRED if mode is `MUTUAL`.
+                              format: string
+                              type: string
+                            credentialName:
+                              format: string
+                              type: string
+                            mode:
+                              enum:
+                              - DISABLE
+                              - SIMPLE
+                              - MUTUAL
+                              - ISTIO_MUTUAL
+                              type: string
+                            privateKey:
+                              description: REQUIRED if mode is `MUTUAL`.
+                              format: string
+                              type: string
+                            sni:
+                              description: SNI string to present to the server during
+                                TLS handshake.
+                              format: string
+                              type: string
+                            subjectAltNames:
+                              items:
+                                format: string
+                                type: string
+                              type: array
+                          type: object
+                      type: object
+                  type: object
+                type: array
+              trafficPolicy:
+                properties:
+                  connectionPool:
+                    properties:
+                      http:
+                        description: HTTP connection pool settings.
+                        properties:
+                          h2UpgradePolicy:
+                            description: Specify if http1.1 connection should be upgraded
+                              to http2 for the associated destination.
+                            enum:
+                            - DEFAULT
+                            - DO_NOT_UPGRADE
+                            - UPGRADE
+                            type: string
+                          http1MaxPendingRequests:
+                            description: Maximum number of pending HTTP requests to
+                              a destination.
+                            format: int32
+                            type: integer
+                          http2MaxRequests:
+                            description: Maximum number of requests to a backend.
+                            format: int32
+                            type: integer
+                          idleTimeout:
+                            description: The idle timeout for upstream connection
+                              pool connections.
+                            type: string
+                          maxRequestsPerConnection:
+                            description: Maximum number of requests per connection
+                              to a backend.
+                            format: int32
+                            type: integer
+                          maxRetries:
+                            format: int32
+                            type: integer
+                        type: object
+                      tcp:
+                        description: Settings common to both HTTP and TCP upstream
+                          connections.
+                        properties:
+                          connectTimeout:
+                            description: TCP connection timeout.
+                            type: string
+                          maxConnections:
+                            description: Maximum number of HTTP1 /TCP connections
+                              to a destination host.
+                            format: int32
+                            type: integer
+                          tcpKeepalive:
+                            description: If set then set SO_KEEPALIVE on the socket
+                              to enable TCP Keepalives.
+                            properties:
+                              interval:
+                                description: The time duration between keep-alive
+                                  probes.
+                                type: string
+                              probes:
+                                type: integer
+                              time:
+                                type: string
+                            type: object
+                        type: object
+                    type: object
+                  loadBalancer:
+                    description: Settings controlling the load balancer algorithms.
+                    oneOf:
+                    - not:
+                        anyOf:
+                        - required:
+                          - simple
+                        - properties:
+                            consistentHash:
+                              oneOf:
+                              - not:
+                                  anyOf:
+                                  - required:
+                                    - httpHeaderName
+                                  - required:
+                                    - httpCookie
+                                  - required:
+                                    - useSourceIp
+                                  - required:
+                                    - httpQueryParameterName
+                              - required:
+                                - httpHeaderName
+                              - required:
+                                - httpCookie
+                              - required:
+                                - useSourceIp
+                              - required:
+                                - httpQueryParameterName
+                          required:
+                          - consistentHash
+                    - required:
+                      - simple
+                    - properties:
+                        consistentHash:
+                          oneOf:
+                          - not:
+                              anyOf:
+                              - required:
+                                - httpHeaderName
+                              - required:
+                                - httpCookie
+                              - required:
+                                - useSourceIp
+                              - required:
+                                - httpQueryParameterName
+                          - required:
+                            - httpHeaderName
+                          - required:
+                            - httpCookie
+                          - required:
+                            - useSourceIp
+                          - required:
+                            - httpQueryParameterName
+                      required:
+                      - consistentHash
+                    properties:
+                      consistentHash:
+                        properties:
+                          httpCookie:
+                            description: Hash based on HTTP cookie.
+                            properties:
+                              name:
+                                description: Name of the cookie.
+                                format: string
+                                type: string
+                              path:
+                                description: Path to set for the cookie.
+                                format: string
+                                type: string
+                              ttl:
+                                description: Lifetime of the cookie.
+                                type: string
+                            type: object
+                          httpHeaderName:
+                            description: Hash based on a specific HTTP header.
+                            format: string
+                            type: string
+                          httpQueryParameterName:
+                            description: Hash based on a specific HTTP query parameter.
+                            format: string
+                            type: string
+                          minimumRingSize:
+                            type: integer
+                          useSourceIp:
+                            description: Hash based on the source IP address.
+                            type: boolean
+                        type: object
+                      localityLbSetting:
+                        properties:
+                          distribute:
+                            description: 'Optional: only one of distribute or failover
+                              can be set.'
+                            items:
+                              properties:
+                                from:
+                                  description: Originating locality, '/' separated,
+                                    e.g.
+                                  format: string
+                                  type: string
+                                to:
+                                  additionalProperties:
+                                    type: integer
+                                  description: Map of upstream localities to traffic
+                                    distribution weights.
+                                  type: object
+                              type: object
+                            type: array
+                          enabled:
+                            description: enable locality load balancing, this is DestinationRule-level
+                              and will override mesh wide settings in entirety.
+                            nullable: true
+                            type: boolean
+                          failover:
+                            description: 'Optional: only failover or distribute can
+                              be set.'
+                            items:
+                              properties:
+                                from:
+                                  description: Originating region.
+                                  format: string
+                                  type: string
+                                to:
+                                  format: string
+                                  type: string
+                              type: object
+                            type: array
+                        type: object
+                      simple:
+                        enum:
+                        - ROUND_ROBIN
+                        - LEAST_CONN
+                        - RANDOM
+                        - PASSTHROUGH
+                        type: string
+                    type: object
+                  outlierDetection:
+                    properties:
+                      baseEjectionTime:
+                        description: Minimum ejection duration.
+                        type: string
+                      consecutive5xxErrors:
+                        description: Number of 5xx errors before a host is ejected
+                          from the connection pool.
+                        nullable: true
+                        type: integer
+                      consecutiveErrors:
+                        format: int32
+                        type: integer
+                      consecutiveGatewayErrors:
+                        description: Number of gateway errors before a host is ejected
+                          from the connection pool.
+                        nullable: true
+                        type: integer
+                      interval:
+                        description: Time interval between ejection sweep analysis.
+                        type: string
+                      maxEjectionPercent:
+                        format: int32
+                        type: integer
+                      minHealthPercent:
+                        format: int32
+                        type: integer
+                    type: object
+                  portLevelSettings:
+                    description: Traffic policies specific to individual ports.
+                    items:
+                      properties:
+                        connectionPool:
+                          properties:
+                            http:
+                              description: HTTP connection pool settings.
+                              properties:
+                                h2UpgradePolicy:
+                                  description: Specify if http1.1 connection should
+                                    be upgraded to http2 for the associated destination.
+                                  enum:
+                                  - DEFAULT
+                                  - DO_NOT_UPGRADE
+                                  - UPGRADE
+                                  type: string
+                                http1MaxPendingRequests:
+                                  description: Maximum number of pending HTTP requests
+                                    to a destination.
+                                  format: int32
+                                  type: integer
+                                http2MaxRequests:
+                                  description: Maximum number of requests to a backend.
+                                  format: int32
+                                  type: integer
+                                idleTimeout:
+                                  description: The idle timeout for upstream connection
+                                    pool connections.
+                                  type: string
+                                maxRequestsPerConnection:
+                                  description: Maximum number of requests per connection
+                                    to a backend.
+                                  format: int32
+                                  type: integer
+                                maxRetries:
+                                  format: int32
+                                  type: integer
+                              type: object
+                            tcp:
+                              description: Settings common to both HTTP and TCP upstream
+                                connections.
+                              properties:
+                                connectTimeout:
+                                  description: TCP connection timeout.
+                                  type: string
+                                maxConnections:
+                                  description: Maximum number of HTTP1 /TCP connections
+                                    to a destination host.
+                                  format: int32
+                                  type: integer
+                                tcpKeepalive:
+                                  description: If set then set SO_KEEPALIVE on the
+                                    socket to enable TCP Keepalives.
+                                  properties:
+                                    interval:
+                                      description: The time duration between keep-alive
+                                        probes.
+                                      type: string
+                                    probes:
+                                      type: integer
+                                    time:
+                                      type: string
+                                  type: object
+                              type: object
+                          type: object
+                        loadBalancer:
+                          description: Settings controlling the load balancer algorithms.
+                          oneOf:
+                          - not:
+                              anyOf:
+                              - required:
+                                - simple
+                              - properties:
+                                  consistentHash:
+                                    oneOf:
+                                    - not:
+                                        anyOf:
+                                        - required:
+                                          - httpHeaderName
+                                        - required:
+                                          - httpCookie
+                                        - required:
+                                          - useSourceIp
+                                        - required:
+                                          - httpQueryParameterName
+                                    - required:
+                                      - httpHeaderName
+                                    - required:
+                                      - httpCookie
+                                    - required:
+                                      - useSourceIp
+                                    - required:
+                                      - httpQueryParameterName
+                                required:
+                                - consistentHash
+                          - required:
+                            - simple
+                          - properties:
+                              consistentHash:
+                                oneOf:
+                                - not:
+                                    anyOf:
+                                    - required:
+                                      - httpHeaderName
+                                    - required:
+                                      - httpCookie
+                                    - required:
+                                      - useSourceIp
+                                    - required:
+                                      - httpQueryParameterName
+                                - required:
+                                  - httpHeaderName
+                                - required:
+                                  - httpCookie
+                                - required:
+                                  - useSourceIp
+                                - required:
+                                  - httpQueryParameterName
+                            required:
+                            - consistentHash
+                          properties:
+                            consistentHash:
+                              properties:
+                                httpCookie:
+                                  description: Hash based on HTTP cookie.
+                                  properties:
+                                    name:
+                                      description: Name of the cookie.
+                                      format: string
+                                      type: string
+                                    path:
+                                      description: Path to set for the cookie.
+                                      format: string
+                                      type: string
+                                    ttl:
+                                      description: Lifetime of the cookie.
+                                      type: string
+                                  type: object
+                                httpHeaderName:
+                                  description: Hash based on a specific HTTP header.
+                                  format: string
+                                  type: string
+                                httpQueryParameterName:
+                                  description: Hash based on a specific HTTP query
+                                    parameter.
+                                  format: string
+                                  type: string
+                                minimumRingSize:
+                                  type: integer
+                                useSourceIp:
+                                  description: Hash based on the source IP address.
+                                  type: boolean
+                              type: object
+                            localityLbSetting:
+                              properties:
+                                distribute:
+                                  description: 'Optional: only one of distribute or
+                                    failover can be set.'
+                                  items:
+                                    properties:
+                                      from:
+                                        description: Originating locality, '/' separated,
+                                          e.g.
+                                        format: string
+                                        type: string
+                                      to:
+                                        additionalProperties:
+                                          type: integer
+                                        description: Map of upstream localities to
+                                          traffic distribution weights.
+                                        type: object
+                                    type: object
+                                  type: array
+                                enabled:
+                                  description: enable locality load balancing, this
+                                    is DestinationRule-level and will override mesh
+                                    wide settings in entirety.
+                                  nullable: true
+                                  type: boolean
+                                failover:
+                                  description: 'Optional: only failover or distribute
+                                    can be set.'
+                                  items:
+                                    properties:
+                                      from:
+                                        description: Originating region.
+                                        format: string
+                                        type: string
+                                      to:
+                                        format: string
+                                        type: string
+                                    type: object
+                                  type: array
+                              type: object
+                            simple:
+                              enum:
+                              - ROUND_ROBIN
+                              - LEAST_CONN
+                              - RANDOM
+                              - PASSTHROUGH
+                              type: string
+                          type: object
+                        outlierDetection:
+                          properties:
+                            baseEjectionTime:
+                              description: Minimum ejection duration.
+                              type: string
+                            consecutive5xxErrors:
+                              description: Number of 5xx errors before a host is ejected
+                                from the connection pool.
+                              nullable: true
+                              type: integer
+                            consecutiveErrors:
+                              format: int32
+                              type: integer
+                            consecutiveGatewayErrors:
+                              description: Number of gateway errors before a host
+                                is ejected from the connection pool.
+                              nullable: true
+                              type: integer
+                            interval:
+                              description: Time interval between ejection sweep analysis.
+                              type: string
+                            maxEjectionPercent:
+                              format: int32
+                              type: integer
+                            minHealthPercent:
+                              format: int32
+                              type: integer
+                          type: object
+                        port:
+                          properties:
+                            number:
+                              type: integer
+                          type: object
+                        tls:
+                          description: TLS related settings for connections to the
+                            upstream service.
+                          properties:
+                            caCertificates:
+                              format: string
+                              type: string
+                            clientCertificate:
+                              description: REQUIRED if mode is `MUTUAL`.
+                              format: string
+                              type: string
+                            credentialName:
+                              format: string
+                              type: string
+                            mode:
+                              enum:
+                              - DISABLE
+                              - SIMPLE
+                              - MUTUAL
+                              - ISTIO_MUTUAL
+                              type: string
+                            privateKey:
+                              description: REQUIRED if mode is `MUTUAL`.
+                              format: string
+                              type: string
+                            sni:
+                              description: SNI string to present to the server during
+                                TLS handshake.
+                              format: string
+                              type: string
+                            subjectAltNames:
+                              items:
+                                format: string
+                                type: string
+                              type: array
+                          type: object
+                      type: object
+                    type: array
+                  tls:
+                    description: TLS related settings for connections to the upstream
+                      service.
+                    properties:
+                      caCertificates:
+                        format: string
+                        type: string
+                      clientCertificate:
+                        description: REQUIRED if mode is `MUTUAL`.
+                        format: string
+                        type: string
+                      credentialName:
+                        format: string
+                        type: string
+                      mode:
+                        enum:
+                        - DISABLE
+                        - SIMPLE
+                        - MUTUAL
+                        - ISTIO_MUTUAL
+                        type: string
+                      privateKey:
+                        description: REQUIRED if mode is `MUTUAL`.
+                        format: string
+                        type: string
+                      sni:
+                        description: SNI string to present to the server during TLS
+                          handshake.
+                        format: string
+                        type: string
+                      subjectAltNames:
+                        items:
+                          format: string
+                          type: string
+                        type: array
+                    type: object
+                type: object
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: false
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-pilot
+    chart: istio
+    heritage: Tiller
+    release: istio
+  name: envoyfilters.networking.istio.io
+spec:
+  group: networking.istio.io
+  names:
+    categories:
+    - istio-io
+    - networking-istio-io
+    kind: EnvoyFilter
+    listKind: EnvoyFilterList
+    plural: envoyfilters
+    singular: envoyfilter
+  scope: Namespaced
+  versions:
+  - name: v1alpha3
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Customizing Envoy configuration generated by Istio. See
+              more details at: https://istio.io/docs/reference/config/networking/envoy-filter.html'
+            properties:
+              configPatches:
+                description: One or more patches with match conditions.
+                items:
+                  properties:
+                    applyTo:
+                      enum:
+                      - INVALID
+                      - LISTENER
+                      - FILTER_CHAIN
+                      - NETWORK_FILTER
+                      - HTTP_FILTER
+                      - ROUTE_CONFIGURATION
+                      - VIRTUAL_HOST
+                      - HTTP_ROUTE
+                      - CLUSTER
+                      type: string
+                    match:
+                      description: Match on listener/route configuration/cluster.
+                      oneOf:
+                      - not:
+                          anyOf:
+                          - required:
+                            - listener
+                          - required:
+                            - routeConfiguration
+                          - required:
+                            - cluster
+                      - required:
+                        - listener
+                      - required:
+                        - routeConfiguration
+                      - required:
+                        - cluster
+                      properties:
+                        cluster:
+                          description: Match on envoy cluster attributes.
+                          properties:
+                            name:
+                              description: The exact name of the cluster to match.
+                              format: string
+                              type: string
+                            portNumber:
+                              description: The service port for which this cluster
+                                was generated.
+                              type: integer
+                            service:
+                              description: The fully qualified service name for this
+                                cluster.
+                              format: string
+                              type: string
+                            subset:
+                              description: The subset associated with the service.
+                              format: string
+                              type: string
+                          type: object
+                        context:
+                          description: The specific config generation context to match
+                            on.
+                          enum:
+                          - ANY
+                          - SIDECAR_INBOUND
+                          - SIDECAR_OUTBOUND
+                          - GATEWAY
+                          type: string
+                        listener:
+                          description: Match on envoy listener attributes.
+                          properties:
+                            filterChain:
+                              description: Match a specific filter chain in a listener.
+                              properties:
+                                applicationProtocols:
+                                  description: Applies only to sidecars.
+                                  format: string
+                                  type: string
+                                filter:
+                                  description: The name of a specific filter to apply
+                                    the patch to.
+                                  properties:
+                                    name:
+                                      description: The filter name to match on.
+                                      format: string
+                                      type: string
+                                    subFilter:
+                                      properties:
+                                        name:
+                                          description: The filter name to match on.
+                                          format: string
+                                          type: string
+                                      type: object
+                                  type: object
+                                name:
+                                  description: The name assigned to the filter chain.
+                                  format: string
+                                  type: string
+                                sni:
+                                  description: The SNI value used by a filter chain's
+                                    match condition.
+                                  format: string
+                                  type: string
+                                transportProtocol:
+                                  description: Applies only to SIDECAR_INBOUND context.
+                                  format: string
+                                  type: string
+                              type: object
+                            name:
+                              description: Match a specific listener by its name.
+                              format: string
+                              type: string
+                            portName:
+                              format: string
+                              type: string
+                            portNumber:
+                              type: integer
+                          type: object
+                        proxy:
+                          description: Match on properties associated with a proxy.
+                          properties:
+                            metadata:
+                              additionalProperties:
+                                format: string
+                                type: string
+                              type: object
+                            proxyVersion:
+                              format: string
+                              type: string
+                          type: object
+                        routeConfiguration:
+                          description: Match on envoy HTTP route configuration attributes.
+                          properties:
+                            gateway:
+                              format: string
+                              type: string
+                            name:
+                              description: Route configuration name to match on.
+                              format: string
+                              type: string
+                            portName:
+                              description: Applicable only for GATEWAY context.
+                              format: string
+                              type: string
+                            portNumber:
+                              type: integer
+                            vhost:
+                              properties:
+                                name:
+                                  format: string
+                                  type: string
+                                route:
+                                  description: Match a specific route within the virtual
+                                    host.
+                                  properties:
+                                    action:
+                                      description: Match a route with specific action
+                                        type.
+                                      enum:
+                                      - ANY
+                                      - ROUTE
+                                      - REDIRECT
+                                      - DIRECT_RESPONSE
+                                      type: string
+                                    name:
+                                      format: string
+                                      type: string
+                                  type: object
+                              type: object
+                          type: object
+                      type: object
+                    patch:
+                      description: The patch to apply along with the operation.
+                      properties:
+                        operation:
+                          description: Determines how the patch should be applied.
+                          enum:
+                          - INVALID
+                          - MERGE
+                          - ADD
+                          - REMOVE
+                          - INSERT_BEFORE
+                          - INSERT_AFTER
+                          - INSERT_FIRST
+                          type: string
+                        value:
+                          description: The JSON config of the object being patched.
+                          type: object
+                          x-kubernetes-preserve-unknown-fields: true
+                      type: object
+                  type: object
+                type: array
+              workloadSelector:
+                properties:
+                  labels:
+                    additionalProperties:
+                      format: string
+                      type: string
+                    type: object
+                type: object
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-pilot
+    chart: istio
+    heritage: Tiller
+    release: istio
+  name: gateways.networking.istio.io
+spec:
+  group: networking.istio.io
+  names:
+    categories:
+    - istio-io
+    - networking-istio-io
+    kind: Gateway
+    listKind: GatewayList
+    plural: gateways
+    shortNames:
+    - gw
+    singular: gateway
+  scope: Namespaced
+  versions:
+  - name: v1alpha3
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Configuration affecting edge load balancer. See more details
+              at: https://istio.io/docs/reference/config/networking/gateway.html'
+            properties:
+              selector:
+                additionalProperties:
+                  format: string
+                  type: string
+                type: object
+              servers:
+                description: A list of server specifications.
+                items:
+                  properties:
+                    bind:
+                      format: string
+                      type: string
+                    defaultEndpoint:
+                      format: string
+                      type: string
+                    hosts:
+                      description: One or more hosts exposed by this gateway.
+                      items:
+                        format: string
+                        type: string
+                      type: array
+                    name:
+                      description: An optional name of the server, when set must be
+                        unique across all servers.
+                      format: string
+                      type: string
+                    port:
+                      properties:
+                        name:
+                          description: Label assigned to the port.
+                          format: string
+                          type: string
+                        number:
+                          description: A valid non-negative integer port number.
+                          type: integer
+                        protocol:
+                          description: The protocol exposed on the port.
+                          format: string
+                          type: string
+                        targetPort:
+                          type: integer
+                      type: object
+                    tls:
+                      description: Set of TLS related options that govern the server's
+                        behavior.
+                      properties:
+                        caCertificates:
+                          description: REQUIRED if mode is `MUTUAL`.
+                          format: string
+                          type: string
+                        cipherSuites:
+                          description: 'Optional: If specified, only support the specified
+                            cipher list.'
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        credentialName:
+                          format: string
+                          type: string
+                        httpsRedirect:
+                          type: boolean
+                        maxProtocolVersion:
+                          description: 'Optional: Maximum TLS protocol version.'
+                          enum:
+                          - TLS_AUTO
+                          - TLSV1_0
+                          - TLSV1_1
+                          - TLSV1_2
+                          - TLSV1_3
+                          type: string
+                        minProtocolVersion:
+                          description: 'Optional: Minimum TLS protocol version.'
+                          enum:
+                          - TLS_AUTO
+                          - TLSV1_0
+                          - TLSV1_1
+                          - TLSV1_2
+                          - TLSV1_3
+                          type: string
+                        mode:
+                          enum:
+                          - PASSTHROUGH
+                          - SIMPLE
+                          - MUTUAL
+                          - AUTO_PASSTHROUGH
+                          - ISTIO_MUTUAL
+                          type: string
+                        privateKey:
+                          description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
+                          format: string
+                          type: string
+                        serverCertificate:
+                          description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
+                          format: string
+                          type: string
+                        subjectAltNames:
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        verifyCertificateHash:
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        verifyCertificateSpki:
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                      type: object
+                  type: object
+                type: array
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+  - name: v1beta1
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Configuration affecting edge load balancer. See more details
+              at: https://istio.io/docs/reference/config/networking/gateway.html'
+            properties:
+              selector:
+                additionalProperties:
+                  format: string
+                  type: string
+                type: object
+              servers:
+                description: A list of server specifications.
+                items:
+                  properties:
+                    bind:
+                      format: string
+                      type: string
+                    defaultEndpoint:
+                      format: string
+                      type: string
+                    hosts:
+                      description: One or more hosts exposed by this gateway.
+                      items:
+                        format: string
+                        type: string
+                      type: array
+                    name:
+                      description: An optional name of the server, when set must be
+                        unique across all servers.
+                      format: string
+                      type: string
+                    port:
+                      properties:
+                        name:
+                          description: Label assigned to the port.
+                          format: string
+                          type: string
+                        number:
+                          description: A valid non-negative integer port number.
+                          type: integer
+                        protocol:
+                          description: The protocol exposed on the port.
+                          format: string
+                          type: string
+                        targetPort:
+                          type: integer
+                      type: object
+                    tls:
+                      description: Set of TLS related options that govern the server's
+                        behavior.
+                      properties:
+                        caCertificates:
+                          description: REQUIRED if mode is `MUTUAL`.
+                          format: string
+                          type: string
+                        cipherSuites:
+                          description: 'Optional: If specified, only support the specified
+                            cipher list.'
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        credentialName:
+                          format: string
+                          type: string
+                        httpsRedirect:
+                          type: boolean
+                        maxProtocolVersion:
+                          description: 'Optional: Maximum TLS protocol version.'
+                          enum:
+                          - TLS_AUTO
+                          - TLSV1_0
+                          - TLSV1_1
+                          - TLSV1_2
+                          - TLSV1_3
+                          type: string
+                        minProtocolVersion:
+                          description: 'Optional: Minimum TLS protocol version.'
+                          enum:
+                          - TLS_AUTO
+                          - TLSV1_0
+                          - TLSV1_1
+                          - TLSV1_2
+                          - TLSV1_3
+                          type: string
+                        mode:
+                          enum:
+                          - PASSTHROUGH
+                          - SIMPLE
+                          - MUTUAL
+                          - AUTO_PASSTHROUGH
+                          - ISTIO_MUTUAL
+                          type: string
+                        privateKey:
+                          description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
+                          format: string
+                          type: string
+                        serverCertificate:
+                          description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
+                          format: string
+                          type: string
+                        subjectAltNames:
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        verifyCertificateHash:
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        verifyCertificateSpki:
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                      type: object
+                  type: object
+                type: array
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: false
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: mixer
+    chart: istio
+    heritage: Tiller
+    istio: mixer-handler
+    package: handler
+    release: istio
+  name: handlers.config.istio.io
+spec:
+  group: config.istio.io
+  names:
+    categories:
+    - istio-io
+    - policy-istio-io
+    kind: handler
+    listKind: handlerList
+    plural: handlers
+    singular: handler
+  scope: Namespaced
+  versions:
+  - name: v1alpha2
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: Handler allows the operator to configure a specific adapter
+              implementation.
+            properties:
+              adapter:
+                description: The name of a specific adapter implementation.
+                format: string
+                type: string
+              compiledAdapter:
+                description: The name of the compiled in adapter this handler instantiates.
+                format: string
+                type: string
+              connection:
+                description: Information on how to connect to the out-of-process adapter.
+                properties:
+                  address:
+                    description: The address of the backend.
+                    format: string
+                    type: string
+                  authentication:
+                    description: Auth config for the connection to the backend.
+                    oneOf:
+                    - not:
+                        anyOf:
+                        - properties:
+                            tls:
+                              allOf:
+                              - oneOf:
+                                - not:
+                                    anyOf:
+                                    - required:
+                                      - tokenPath
+                                    - required:
+                                      - oauth
+                                - required:
+                                  - tokenPath
+                                - required:
+                                  - oauth
+                              - oneOf:
+                                - not:
+                                    anyOf:
+                                    - required:
+                                      - authHeader
+                                    - required:
+                                      - customHeader
+                                - required:
+                                  - authHeader
+                                - required:
+                                  - customHeader
+                          required:
+                          - tls
+                        - required:
+                          - mutual
+                    - properties:
+                        tls:
+                          allOf:
+                          - oneOf:
+                            - not:
+                                anyOf:
+                                - required:
+                                  - tokenPath
+                                - required:
+                                  - oauth
+                            - required:
+                              - tokenPath
+                            - required:
+                              - oauth
+                          - oneOf:
+                            - not:
+                                anyOf:
+                                - required:
+                                  - authHeader
+                                - required:
+                                  - customHeader
+                            - required:
+                              - authHeader
+                            - required:
+                              - customHeader
+                      required:
+                      - tls
+                    - required:
+                      - mutual
+                    properties:
+                      mutual:
+                        properties:
+                          caCertificates:
+                            format: string
+                            type: string
+                          clientCertificate:
+                            description: The path to the file holding client certificate
+                              for mutual TLS.
+                            format: string
+                            type: string
+                          privateKey:
+                            description: The path to the file holding the private
+                              key for mutual TLS.
+                            format: string
+                            type: string
+                          serverName:
+                            description: Used to configure mixer mutual TLS client
+                              to supply server name for SNI.
+                            format: string
+                            type: string
+                        type: object
+                      tls:
+                        properties:
+                          authHeader:
+                            description: Access token is passed as authorization header.
+                            enum:
+                            - PLAIN
+                            - BEARER
+                            type: string
+                          caCertificates:
+                            format: string
+                            type: string
+                          customHeader:
+                            description: Customized header key to hold access token,
+                              e.g.
+                            format: string
+                            type: string
+                          oauth:
+                            description: Oauth config to fetch access token from auth
+                              provider.
+                            properties:
+                              clientId:
+                                description: OAuth client id for mixer.
+                                format: string
+                                type: string
+                              clientSecret:
+                                description: The path to the file holding the client
+                                  secret for oauth.
+                                format: string
+                                type: string
+                              endpointParams:
+                                additionalProperties:
+                                  format: string
+                                  type: string
+                                description: Additional parameters for requests to
+                                  the token endpoint.
+                                type: object
+                              scopes:
+                                description: List of requested permissions.
+                                items:
+                                  format: string
+                                  type: string
+                                type: array
+                              tokenUrl:
+                                description: The Resource server's token endpoint
+                                  URL.
+                                format: string
+                                type: string
+                            type: object
+                          serverName:
+                            format: string
+                            type: string
+                          tokenPath:
+                            format: string
+                            type: string
+                        type: object
+                    type: object
+                  timeout:
+                    description: Timeout for remote calls to the backend.
+                    type: string
+                type: object
+              name:
+                description: Must be unique in the entire Mixer configuration.
+                format: string
+                type: string
+              params:
+                description: Depends on adapter implementation.
+                type: object
+                x-kubernetes-preserve-unknown-fields: true
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-mixer
+    chart: istio
+    heritage: Tiller
+    release: istio
+  name: httpapispecbindings.config.istio.io
+spec:
+  group: config.istio.io
+  names:
+    categories:
+    - istio-io
+    - apim-istio-io
+    kind: HTTPAPISpecBinding
+    listKind: HTTPAPISpecBindingList
+    plural: httpapispecbindings
+    singular: httpapispecbinding
+  scope: Namespaced
+  versions:
+  - name: v1alpha2
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            properties:
+              api_specs:
+                items:
+                  properties:
+                    name:
+                      description: The short name of the HTTPAPISpec.
+                      format: string
+                      type: string
+                    namespace:
+                      description: Optional namespace of the HTTPAPISpec.
+                      format: string
+                      type: string
+                  type: object
+                type: array
+              apiSpecs:
+                items:
+                  properties:
+                    name:
+                      description: The short name of the HTTPAPISpec.
+                      format: string
+                      type: string
+                    namespace:
+                      description: Optional namespace of the HTTPAPISpec.
+                      format: string
+                      type: string
+                  type: object
+                type: array
+              services:
+                description: One or more services to map the listed HTTPAPISpec onto.
+                items:
+                  properties:
+                    domain:
+                      description: Domain suffix used to construct the service FQDN
+                        in implementations that support such specification.
+                      format: string
+                      type: string
+                    labels:
+                      additionalProperties:
+                        format: string
+                        type: string
+                      description: Optional one or more labels that uniquely identify
+                        the service version.
+                      type: object
+                    name:
+                      description: The short name of the service such as "foo".
+                      format: string
+                      type: string
+                    namespace:
+                      description: Optional namespace of the service.
+                      format: string
+                      type: string
+                    service:
+                      description: The service FQDN.
+                      format: string
+                      type: string
+                  type: object
+                type: array
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-mixer
+    chart: istio
+    heritage: Tiller
+    release: istio
+  name: httpapispecs.config.istio.io
+spec:
+  group: config.istio.io
+  names:
+    categories:
+    - istio-io
+    - apim-istio-io
+    kind: HTTPAPISpec
+    listKind: HTTPAPISpecList
+    plural: httpapispecs
+    singular: httpapispec
+  scope: Namespaced
+  versions:
+  - name: v1alpha2
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            properties:
+              api_keys:
+                items:
+                  oneOf:
+                  - not:
+                      anyOf:
+                      - required:
+                        - query
+                      - required:
+                        - header
+                      - required:
+                        - cookie
+                  - required:
+                    - query
+                  - required:
+                    - header
+                  - required:
+                    - cookie
+                  properties:
+                    cookie:
+                      format: string
+                      type: string
+                    header:
+                      description: API key is sent in a request header.
+                      format: string
+                      type: string
+                    query:
+                      description: API Key is sent as a query parameter.
+                      format: string
+                      type: string
+                  type: object
+                type: array
+              apiKeys:
+                items:
+                  oneOf:
+                  - not:
+                      anyOf:
+                      - required:
+                        - query
+                      - required:
+                        - header
+                      - required:
+                        - cookie
+                  - required:
+                    - query
+                  - required:
+                    - header
+                  - required:
+                    - cookie
+                  properties:
+                    cookie:
+                      format: string
+                      type: string
+                    header:
+                      description: API key is sent in a request header.
+                      format: string
+                      type: string
+                    query:
+                      description: API Key is sent as a query parameter.
+                      format: string
+                      type: string
+                  type: object
+                type: array
+              attributes:
+                properties:
+                  attributes:
+                    additionalProperties:
+                      oneOf:
+                      - not:
+                          anyOf:
+                          - required:
+                            - stringValue
+                          - required:
+                            - int64Value
+                          - required:
+                            - doubleValue
+                          - required:
+                            - boolValue
+                          - required:
+                            - bytesValue
+                          - required:
+                            - timestampValue
+                          - required:
+                            - durationValue
+                          - required:
+                            - stringMapValue
+                      - required:
+                        - stringValue
+                      - required:
+                        - int64Value
+                      - required:
+                        - doubleValue
+                      - required:
+                        - boolValue
+                      - required:
+                        - bytesValue
+                      - required:
+                        - timestampValue
+                      - required:
+                        - durationValue
+                      - required:
+                        - stringMapValue
+                      properties:
+                        boolValue:
+                          type: boolean
+                        bytesValue:
+                          format: binary
+                          type: string
+                        doubleValue:
+                          format: double
+                          type: number
+                        durationValue:
+                          type: string
+                        int64Value:
+                          format: int64
+                          type: integer
+                        stringMapValue:
+                          properties:
+                            entries:
+                              additionalProperties:
+                                format: string
+                                type: string
+                              description: Holds a set of name/value pairs.
+                              type: object
+                          type: object
+                        stringValue:
+                          format: string
+                          type: string
+                        timestampValue:
+                          format: dateTime
+                          type: string
+                      type: object
+                    description: A map of attribute name to its value.
+                    type: object
+                type: object
+              patterns:
+                description: List of HTTP patterns to match.
+                items:
+                  oneOf:
+                  - not:
+                      anyOf:
+                      - required:
+                        - uriTemplate
+                      - required:
+                        - regex
+                  - required:
+                    - uriTemplate
+                  - required:
+                    - regex
+                  properties:
+                    attributes:
+                      properties:
+                        attributes:
+                          additionalProperties:
+                            oneOf:
+                            - not:
+                                anyOf:
+                                - required:
+                                  - stringValue
+                                - required:
+                                  - int64Value
+                                - required:
+                                  - doubleValue
+                                - required:
+                                  - boolValue
+                                - required:
+                                  - bytesValue
+                                - required:
+                                  - timestampValue
+                                - required:
+                                  - durationValue
+                                - required:
+                                  - stringMapValue
+                            - required:
+                              - stringValue
+                            - required:
+                              - int64Value
+                            - required:
+                              - doubleValue
+                            - required:
+                              - boolValue
+                            - required:
+                              - bytesValue
+                            - required:
+                              - timestampValue
+                            - required:
+                              - durationValue
+                            - required:
+                              - stringMapValue
+                            properties:
+                              boolValue:
+                                type: boolean
+                              bytesValue:
+                                format: binary
+                                type: string
+                              doubleValue:
+                                format: double
+                                type: number
+                              durationValue:
+                                type: string
+                              int64Value:
+                                format: int64
+                                type: integer
+                              stringMapValue:
+                                properties:
+                                  entries:
+                                    additionalProperties:
+                                      format: string
+                                      type: string
+                                    description: Holds a set of name/value pairs.
+                                    type: object
+                                type: object
+                              stringValue:
+                                format: string
+                                type: string
+                              timestampValue:
+                                format: dateTime
+                                type: string
+                            type: object
+                          description: A map of attribute name to its value.
+                          type: object
+                      type: object
+                    httpMethod:
+                      format: string
+                      type: string
+                    regex:
+                      format: string
+                      type: string
+                    uriTemplate:
+                      format: string
+                      type: string
+                  type: object
+                type: array
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: mixer
+    chart: istio
+    heritage: Tiller
+    istio: mixer-instance
+    package: instance
+    release: istio
+  name: instances.config.istio.io
+spec:
+  group: config.istio.io
+  names:
+    categories:
+    - istio-io
+    - policy-istio-io
+    kind: instance
+    listKind: instanceList
+    plural: instances
+    singular: instance
+  scope: Namespaced
+  versions:
+  - name: v1alpha2
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: An Instance tells Mixer how to create instances for particular
+              template.
+            properties:
+              attributeBindings:
+                additionalProperties:
+                  format: string
+                  type: string
+                type: object
+              compiledTemplate:
+                description: The name of the compiled in template this instance creates
+                  instances for.
+                format: string
+                type: string
+              name:
+                format: string
+                type: string
+              params:
+                description: Depends on referenced template.
+                type: object
+                x-kubernetes-preserve-unknown-fields: true
+              template:
+                description: The name of the template this instance creates instances
+                  for.
+                format: string
+                type: string
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  name: istiooperators.install.istio.io
+  labels:
+    release: istio
+spec:
+  group: install.istio.io
+  names:
+    kind: IstioOperator
+    plural: istiooperators
+    singular: istiooperator
+    shortNames:
+      - iop
+  scope: Namespaced
+  versions:
+    - additionalPrinterColumns:
+        - description: Istio control plane revision
+          jsonPath: .spec.revision
+          name: Revision
+          type: string
+        - description: IOP current state
+          jsonPath: .status.status
+          type: string
+          name: Status
+        - jsonPath: .metadata.creationTimestamp
+          description:
+            "CreationTimestamp is a timestamp representing the server time when
+            this object was created. It is not guaranteed to be set in happens-before order
+            across separate operations. Clients may not set this value. It is represented
+            in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
+            lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata"
+          name: Age
+          type: date
+      name: v1alpha1
+      schema:
+        openAPIV3Schema:
+          properties:
+            apiVersion:
+              description:
+                "APIVersion defines the versioned schema of this representation
+                of an object. Servers should convert recognized schemas to the latest
+                internal value, and may reject unrecognized values.
+                More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#resources"
+              type: string
+            kind:
+              description:
+                "Kind is a string value representing the REST resource this
+                object represents. Servers may infer this from the endpoint the client
+                submits requests to. Cannot be updated. In CamelCase.
+                More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#types-kinds"
+              type: string
+            spec:
+              description:
+                "Specification of the desired state of the istio control plane resource.
+                More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status"
+              x-kubernetes-preserve-unknown-fields: true
+              type: object
+            status:
+              description:
+                "Status describes each of istio control plane component status at the current time.
+                0 means NONE, 1 means UPDATING, 2 means HEALTHY, 3 means ERROR, 4 means RECONCILING.
+                More info: https://github.com/istio/api/blob/master/operator/v1alpha1/istio.operator.v1alpha1.pb.html &
+                https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status"
+              x-kubernetes-preserve-unknown-fields: true
+              type: object
+          type: object
+      served: true
+      storage: true
+      subresources:
+        status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-pilot
+    chart: istio
+    heritage: Tiller
+    istio: security
+    release: istio
+  name: peerauthentications.security.istio.io
+spec:
+  group: security.istio.io
+  names:
+    categories:
+    - istio-io
+    - security-istio-io
+    kind: PeerAuthentication
+    listKind: PeerAuthenticationList
+    plural: peerauthentications
+    shortNames:
+    - pa
+    singular: peerauthentication
+  scope: Namespaced
+  versions:
+  - name: v1beta1
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: PeerAuthentication defines how traffic will be tunneled (or
+              not) to the sidecar.
+            properties:
+              mtls:
+                description: Mutual TLS settings for workload.
+                properties:
+                  mode:
+                    description: Defines the mTLS mode used for peer authentication.
+                    enum:
+                    - UNSET
+                    - DISABLE
+                    - PERMISSIVE
+                    - STRICT
+                    type: string
+                type: object
+              portLevelMtls:
+                additionalProperties:
+                  properties:
+                    mode:
+                      description: Defines the mTLS mode used for peer authentication.
+                      enum:
+                      - UNSET
+                      - DISABLE
+                      - PERMISSIVE
+                      - STRICT
+                      type: string
+                  type: object
+                description: Port specific mutual TLS settings.
+                type: object
+              selector:
+                description: The selector determines the workloads to apply the ChannelAuthentication
+                  on.
+                properties:
+                  matchLabels:
+                    additionalProperties:
+                      format: string
+                      type: string
+                    type: object
+                type: object
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-mixer
+    chart: istio
+    heritage: Tiller
+    release: istio
+  name: quotaspecbindings.config.istio.io
+spec:
+  group: config.istio.io
+  names:
+    categories:
+    - istio-io
+    - apim-istio-io
+    kind: QuotaSpecBinding
+    listKind: QuotaSpecBindingList
+    plural: quotaspecbindings
+    singular: quotaspecbinding
+  scope: Namespaced
+  versions:
+  - name: v1alpha2
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            properties:
+              quotaSpecs:
+                items:
+                  properties:
+                    name:
+                      description: The short name of the QuotaSpec.
+                      format: string
+                      type: string
+                    namespace:
+                      description: Optional namespace of the QuotaSpec.
+                      format: string
+                      type: string
+                  type: object
+                type: array
+              services:
+                description: One or more services to map the listed QuotaSpec onto.
+                items:
+                  properties:
+                    domain:
+                      description: Domain suffix used to construct the service FQDN
+                        in implementations that support such specification.
+                      format: string
+                      type: string
+                    labels:
+                      additionalProperties:
+                        format: string
+                        type: string
+                      description: Optional one or more labels that uniquely identify
+                        the service version.
+                      type: object
+                    name:
+                      description: The short name of the service such as "foo".
+                      format: string
+                      type: string
+                    namespace:
+                      description: Optional namespace of the service.
+                      format: string
+                      type: string
+                    service:
+                      description: The service FQDN.
+                      format: string
+                      type: string
+                  type: object
+                type: array
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-mixer
+    chart: istio
+    heritage: Tiller
+    release: istio
+  name: quotaspecs.config.istio.io
+spec:
+  group: config.istio.io
+  names:
+    categories:
+    - istio-io
+    - apim-istio-io
+    kind: QuotaSpec
+    listKind: QuotaSpecList
+    plural: quotaspecs
+    singular: quotaspec
+  scope: Namespaced
+  versions:
+  - name: v1alpha2
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: Determines the quotas used for individual requests.
+            properties:
+              rules:
+                description: A list of Quota rules.
+                items:
+                  properties:
+                    match:
+                      description: If empty, match all request.
+                      items:
+                        properties:
+                          clause:
+                            additionalProperties:
+                              oneOf:
+                              - not:
+                                  anyOf:
+                                  - required:
+                                    - exact
+                                  - required:
+                                    - prefix
+                                  - required:
+                                    - regex
+                              - required:
+                                - exact
+                              - required:
+                                - prefix
+                              - required:
+                                - regex
+                              properties:
+                                exact:
+                                  format: string
+                                  type: string
+                                prefix:
+                                  format: string
+                                  type: string
+                                regex:
+                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                  format: string
+                                  type: string
+                              type: object
+                            description: Map of attribute names to StringMatch type.
+                            type: object
+                        type: object
+                      type: array
+                    quotas:
+                      description: The list of quotas to charge.
+                      items:
+                        properties:
+                          charge:
+                            format: int32
+                            type: integer
+                          quota:
+                            format: string
+                            type: string
+                        type: object
+                      type: array
+                  type: object
+                type: array
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-pilot
+    chart: istio
+    heritage: Tiller
+    istio: security
+    release: istio
+  name: requestauthentications.security.istio.io
+spec:
+  group: security.istio.io
+  names:
+    categories:
+    - istio-io
+    - security-istio-io
+    kind: RequestAuthentication
+    listKind: RequestAuthenticationList
+    plural: requestauthentications
+    shortNames:
+    - ra
+    singular: requestauthentication
+  scope: Namespaced
+  versions:
+  - name: v1beta1
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: RequestAuthentication defines what request authentication
+              methods are supported by a workload.
+            properties:
+              jwtRules:
+                description: Define the list of JWTs that can be validated at the
+                  selected workloads' proxy.
+                items:
+                  properties:
+                    audiences:
+                      items:
+                        format: string
+                        type: string
+                      type: array
+                    forwardOriginalToken:
+                      description: If set to true, the orginal token will be kept
+                        for the ustream request.
+                      type: boolean
+                    fromHeaders:
+                      description: List of header locations from which JWT is expected.
+                      items:
+                        properties:
+                          name:
+                            description: The HTTP header name.
+                            format: string
+                            type: string
+                          prefix:
+                            description: The prefix that should be stripped before
+                              decoding the token.
+                            format: string
+                            type: string
+                        type: object
+                      type: array
+                    fromParams:
+                      description: List of query parameters from which JWT is expected.
+                      items:
+                        format: string
+                        type: string
+                      type: array
+                    issuer:
+                      description: Identifies the issuer that issued the JWT.
+                      format: string
+                      type: string
+                    jwks:
+                      description: JSON Web Key Set of public keys to validate signature
+                        of the JWT.
+                      format: string
+                      type: string
+                    jwks_uri:
+                      format: string
+                      type: string
+                    jwksUri:
+                      format: string
+                      type: string
+                    outputPayloadToHeader:
+                      format: string
+                      type: string
+                  type: object
+                type: array
+              selector:
+                description: The selector determines the workloads to apply the RequestAuthentication
+                  on.
+                properties:
+                  matchLabels:
+                    additionalProperties:
+                      format: string
+                      type: string
+                    type: object
+                type: object
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: mixer
+    chart: istio
+    heritage: Tiller
+    istio: core
+    package: istio.io.mixer
+    release: istio
+  name: rules.config.istio.io
+spec:
+  group: config.istio.io
+  names:
+    categories:
+    - istio-io
+    - policy-istio-io
+    kind: rule
+    listKind: ruleList
+    plural: rules
+    singular: rule
+  scope: Namespaced
+  versions:
+  - name: v1alpha2
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Describes the rules used to configure Mixer''s policy and
+              telemetry features. See more details at: https://istio.io/docs/reference/config/policy-and-telemetry/istio.policy.v1beta1.html'
+            properties:
+              actions:
+                description: The actions that will be executed when match evaluates
+                  to `true`.
+                items:
+                  properties:
+                    handler:
+                      description: Fully qualified name of the handler to invoke.
+                      format: string
+                      type: string
+                    instances:
+                      items:
+                        format: string
+                        type: string
+                      type: array
+                    name:
+                      description: A handle to refer to the results of the action.
+                      format: string
+                      type: string
+                  type: object
+                type: array
+              match:
+                description: Match is an attribute based predicate.
+                format: string
+                type: string
+              requestHeaderOperations:
+                items:
+                  properties:
+                    name:
+                      description: Header name literal value.
+                      format: string
+                      type: string
+                    operation:
+                      description: Header operation type.
+                      enum:
+                      - REPLACE
+                      - REMOVE
+                      - APPEND
+                      type: string
+                    values:
+                      description: Header value expressions.
+                      items:
+                        format: string
+                        type: string
+                      type: array
+                  type: object
+                type: array
+              responseHeaderOperations:
+                items:
+                  properties:
+                    name:
+                      description: Header name literal value.
+                      format: string
+                      type: string
+                    operation:
+                      description: Header operation type.
+                      enum:
+                      - REPLACE
+                      - REMOVE
+                      - APPEND
+                      type: string
+                    values:
+                      description: Header value expressions.
+                      items:
+                        format: string
+                        type: string
+                      type: array
+                  type: object
+                type: array
+              sampling:
+                properties:
+                  random:
+                    description: Provides filtering of actions based on random selection
+                      per request.
+                    properties:
+                      attributeExpression:
+                        description: Specifies an attribute expression to use to override
+                          the numerator in the `percent_sampled` field.
+                        format: string
+                        type: string
+                      percentSampled:
+                        description: The default sampling rate, expressed as a percentage.
+                        properties:
+                          denominator:
+                            description: Specifies the denominator.
+                            enum:
+                            - HUNDRED
+                            - TEN_THOUSAND
+                            type: string
+                          numerator:
+                            description: Specifies the numerator.
+                            type: integer
+                        type: object
+                      useIndependentRandomness:
+                        description: By default sampling will be based on the value
+                          of the request header `x-request-id`.
+                        type: boolean
+                    type: object
+                  rateLimit:
+                    properties:
+                      maxUnsampledEntries:
+                        description: Number of entries to allow during the `sampling_duration`
+                          before sampling is enforced.
+                        format: int64
+                        type: integer
+                      samplingDuration:
+                        description: Window in which to enforce the sampling rate.
+                        type: string
+                      samplingRate:
+                        description: The rate at which to sample entries once the
+                          unsampled limit has been reached.
+                        format: int64
+                        type: integer
+                    type: object
+                type: object
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-pilot
+    chart: istio
+    heritage: Tiller
+    release: istio
+  name: serviceentries.networking.istio.io
+spec:
+  group: networking.istio.io
+  names:
+    categories:
+    - istio-io
+    - networking-istio-io
+    kind: ServiceEntry
+    listKind: ServiceEntryList
+    plural: serviceentries
+    shortNames:
+    - se
+    singular: serviceentry
+  scope: Namespaced
+  versions:
+  - additionalPrinterColumns:
+    - description: The hosts associated with the ServiceEntry
+      jsonPath: .spec.hosts
+      name: Hosts
+      type: string
+    - description: Whether the service is external to the mesh or part of the mesh
+        (MESH_EXTERNAL or MESH_INTERNAL)
+      jsonPath: .spec.location
+      name: Location
+      type: string
+    - description: Service discovery mode for the hosts (NONE, STATIC, or DNS)
+      jsonPath: .spec.resolution
+      name: Resolution
+      type: string
+    - description: 'CreationTimestamp is a timestamp representing the server time
+        when this object was created. It is not guaranteed to be set in happens-before
+        order across separate operations. Clients may not set this value. It is represented
+        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
+        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
+      jsonPath: .metadata.creationTimestamp
+      name: Age
+      type: date
+    name: v1alpha3
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Configuration affecting service registry. See more details
+              at: https://istio.io/docs/reference/config/networking/service-entry.html'
+            properties:
+              addresses:
+                description: The virtual IP addresses associated with the service.
+                items:
+                  format: string
+                  type: string
+                type: array
+              endpoints:
+                description: One or more endpoints associated with the service.
+                items:
+                  properties:
+                    address:
+                      format: string
+                      type: string
+                    labels:
+                      additionalProperties:
+                        format: string
+                        type: string
+                      description: One or more labels associated with the endpoint.
+                      type: object
+                    locality:
+                      description: The locality associated with the endpoint.
+                      format: string
+                      type: string
+                    network:
+                      format: string
+                      type: string
+                    ports:
+                      additionalProperties:
+                        type: integer
+                      description: Set of ports associated with the endpoint.
+                      type: object
+                    serviceAccount:
+                      format: string
+                      type: string
+                    weight:
+                      description: The load balancing weight associated with the endpoint.
+                      type: integer
+                  type: object
+                type: array
+              exportTo:
+                description: A list of namespaces to which this service is exported.
+                items:
+                  format: string
+                  type: string
+                type: array
+              hosts:
+                description: The hosts associated with the ServiceEntry.
+                items:
+                  format: string
+                  type: string
+                type: array
+              location:
+                enum:
+                - MESH_EXTERNAL
+                - MESH_INTERNAL
+                type: string
+              ports:
+                description: The ports associated with the external service.
+                items:
+                  properties:
+                    name:
+                      description: Label assigned to the port.
+                      format: string
+                      type: string
+                    number:
+                      description: A valid non-negative integer port number.
+                      type: integer
+                    protocol:
+                      description: The protocol exposed on the port.
+                      format: string
+                      type: string
+                    targetPort:
+                      type: integer
+                  type: object
+                type: array
+              resolution:
+                description: Service discovery mode for the hosts.
+                enum:
+                - NONE
+                - STATIC
+                - DNS
+                type: string
+              subjectAltNames:
+                items:
+                  format: string
+                  type: string
+                type: array
+              workloadSelector:
+                description: Applicable only for MESH_INTERNAL services.
+                properties:
+                  labels:
+                    additionalProperties:
+                      format: string
+                      type: string
+                    type: object
+                type: object
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+  - additionalPrinterColumns:
+    - description: The hosts associated with the ServiceEntry
+      jsonPath: .spec.hosts
+      name: Hosts
+      type: string
+    - description: Whether the service is external to the mesh or part of the mesh
+        (MESH_EXTERNAL or MESH_INTERNAL)
+      jsonPath: .spec.location
+      name: Location
+      type: string
+    - description: Service discovery mode for the hosts (NONE, STATIC, or DNS)
+      jsonPath: .spec.resolution
+      name: Resolution
+      type: string
+    - description: 'CreationTimestamp is a timestamp representing the server time
+        when this object was created. It is not guaranteed to be set in happens-before
+        order across separate operations. Clients may not set this value. It is represented
+        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
+        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
+      jsonPath: .metadata.creationTimestamp
+      name: Age
+      type: date
+    name: v1beta1
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Configuration affecting service registry. See more details
+              at: https://istio.io/docs/reference/config/networking/service-entry.html'
+            properties:
+              addresses:
+                description: The virtual IP addresses associated with the service.
+                items:
+                  format: string
+                  type: string
+                type: array
+              endpoints:
+                description: One or more endpoints associated with the service.
+                items:
+                  properties:
+                    address:
+                      format: string
+                      type: string
+                    labels:
+                      additionalProperties:
+                        format: string
+                        type: string
+                      description: One or more labels associated with the endpoint.
+                      type: object
+                    locality:
+                      description: The locality associated with the endpoint.
+                      format: string
+                      type: string
+                    network:
+                      format: string
+                      type: string
+                    ports:
+                      additionalProperties:
+                        type: integer
+                      description: Set of ports associated with the endpoint.
+                      type: object
+                    serviceAccount:
+                      format: string
+                      type: string
+                    weight:
+                      description: The load balancing weight associated with the endpoint.
+                      type: integer
+                  type: object
+                type: array
+              exportTo:
+                description: A list of namespaces to which this service is exported.
+                items:
+                  format: string
+                  type: string
+                type: array
+              hosts:
+                description: The hosts associated with the ServiceEntry.
+                items:
+                  format: string
+                  type: string
+                type: array
+              location:
+                enum:
+                - MESH_EXTERNAL
+                - MESH_INTERNAL
+                type: string
+              ports:
+                description: The ports associated with the external service.
+                items:
+                  properties:
+                    name:
+                      description: Label assigned to the port.
+                      format: string
+                      type: string
+                    number:
+                      description: A valid non-negative integer port number.
+                      type: integer
+                    protocol:
+                      description: The protocol exposed on the port.
+                      format: string
+                      type: string
+                    targetPort:
+                      type: integer
+                  type: object
+                type: array
+              resolution:
+                description: Service discovery mode for the hosts.
+                enum:
+                - NONE
+                - STATIC
+                - DNS
+                type: string
+              subjectAltNames:
+                items:
+                  format: string
+                  type: string
+                type: array
+              workloadSelector:
+                description: Applicable only for MESH_INTERNAL services.
+                properties:
+                  labels:
+                    additionalProperties:
+                      format: string
+                      type: string
+                    type: object
+                type: object
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: false
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-pilot
+    chart: istio
+    heritage: Tiller
+    release: istio
+  name: sidecars.networking.istio.io
+spec:
+  group: networking.istio.io
+  names:
+    categories:
+    - istio-io
+    - networking-istio-io
+    kind: Sidecar
+    listKind: SidecarList
+    plural: sidecars
+    singular: sidecar
+  scope: Namespaced
+  versions:
+  - name: v1alpha3
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Configuration affecting network reachability of a sidecar.
+              See more details at: https://istio.io/docs/reference/config/networking/sidecar.html'
+            properties:
+              egress:
+                items:
+                  properties:
+                    bind:
+                      format: string
+                      type: string
+                    captureMode:
+                      enum:
+                      - DEFAULT
+                      - IPTABLES
+                      - NONE
+                      type: string
+                    hosts:
+                      items:
+                        format: string
+                        type: string
+                      type: array
+                    port:
+                      description: The port associated with the listener.
+                      properties:
+                        name:
+                          description: Label assigned to the port.
+                          format: string
+                          type: string
+                        number:
+                          description: A valid non-negative integer port number.
+                          type: integer
+                        protocol:
+                          description: The protocol exposed on the port.
+                          format: string
+                          type: string
+                        targetPort:
+                          type: integer
+                      type: object
+                  type: object
+                type: array
+              ingress:
+                items:
+                  properties:
+                    bind:
+                      description: The IP to which the listener should be bound.
+                      format: string
+                      type: string
+                    captureMode:
+                      enum:
+                      - DEFAULT
+                      - IPTABLES
+                      - NONE
+                      type: string
+                    defaultEndpoint:
+                      format: string
+                      type: string
+                    port:
+                      description: The port associated with the listener.
+                      properties:
+                        name:
+                          description: Label assigned to the port.
+                          format: string
+                          type: string
+                        number:
+                          description: A valid non-negative integer port number.
+                          type: integer
+                        protocol:
+                          description: The protocol exposed on the port.
+                          format: string
+                          type: string
+                        targetPort:
+                          type: integer
+                      type: object
+                  type: object
+                type: array
+              outboundTrafficPolicy:
+                description: Configuration for the outbound traffic policy.
+                properties:
+                  egressProxy:
+                    properties:
+                      host:
+                        description: The name of a service from the service registry.
+                        format: string
+                        type: string
+                      port:
+                        description: Specifies the port on the host that is being
+                          addressed.
+                        properties:
+                          number:
+                            type: integer
+                        type: object
+                      subset:
+                        description: The name of a subset within the service.
+                        format: string
+                        type: string
+                    type: object
+                  mode:
+                    enum:
+                    - REGISTRY_ONLY
+                    - ALLOW_ANY
+                    type: string
+                type: object
+              workloadSelector:
+                properties:
+                  labels:
+                    additionalProperties:
+                      format: string
+                      type: string
+                    type: object
+                type: object
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+  - name: v1beta1
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Configuration affecting network reachability of a sidecar.
+              See more details at: https://istio.io/docs/reference/config/networking/sidecar.html'
+            properties:
+              egress:
+                items:
+                  properties:
+                    bind:
+                      format: string
+                      type: string
+                    captureMode:
+                      enum:
+                      - DEFAULT
+                      - IPTABLES
+                      - NONE
+                      type: string
+                    hosts:
+                      items:
+                        format: string
+                        type: string
+                      type: array
+                    port:
+                      description: The port associated with the listener.
+                      properties:
+                        name:
+                          description: Label assigned to the port.
+                          format: string
+                          type: string
+                        number:
+                          description: A valid non-negative integer port number.
+                          type: integer
+                        protocol:
+                          description: The protocol exposed on the port.
+                          format: string
+                          type: string
+                        targetPort:
+                          type: integer
+                      type: object
+                  type: object
+                type: array
+              ingress:
+                items:
+                  properties:
+                    bind:
+                      description: The IP to which the listener should be bound.
+                      format: string
+                      type: string
+                    captureMode:
+                      enum:
+                      - DEFAULT
+                      - IPTABLES
+                      - NONE
+                      type: string
+                    defaultEndpoint:
+                      format: string
+                      type: string
+                    port:
+                      description: The port associated with the listener.
+                      properties:
+                        name:
+                          description: Label assigned to the port.
+                          format: string
+                          type: string
+                        number:
+                          description: A valid non-negative integer port number.
+                          type: integer
+                        protocol:
+                          description: The protocol exposed on the port.
+                          format: string
+                          type: string
+                        targetPort:
+                          type: integer
+                      type: object
+                  type: object
+                type: array
+              outboundTrafficPolicy:
+                description: Configuration for the outbound traffic policy.
+                properties:
+                  egressProxy:
+                    properties:
+                      host:
+                        description: The name of a service from the service registry.
+                        format: string
+                        type: string
+                      port:
+                        description: Specifies the port on the host that is being
+                          addressed.
+                        properties:
+                          number:
+                            type: integer
+                        type: object
+                      subset:
+                        description: The name of a subset within the service.
+                        format: string
+                        type: string
+                    type: object
+                  mode:
+                    enum:
+                    - REGISTRY_ONLY
+                    - ALLOW_ANY
+                    type: string
+                type: object
+              workloadSelector:
+                properties:
+                  labels:
+                    additionalProperties:
+                      format: string
+                      type: string
+                    type: object
+                type: object
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: false
+    subresources:
+      status: {}
+---
+kind: CustomResourceDefinition
+apiVersion: apiextensions.k8s.io/v1
+metadata:
+  name: templates.config.istio.io
+  labels:
+    app: mixer
+    package: template
+    istio: mixer-template
+    chart: istio
+    heritage: Tiller
+    release: istio
+  annotations:
+    "helm.sh/resource-policy": keep
+spec:
+  group: config.istio.io
+  names:
+    kind: template
+    plural: templates
+    singular: template
+    categories:
+      - istio-io
+      - policy-istio-io
+  scope: Namespaced
+  versions:
+    - name: v1alpha2
+      schema:
+        openAPIV3Schema:
+          properties:
+            spec:
+              x-kubernetes-preserve-unknown-fields: true
+              type: object
+            status:
+              x-kubernetes-preserve-unknown-fields: true
+              type: object
+          type: object
+      served: true
+      storage: true
+      subresources:
+        status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-pilot
+    chart: istio
+    heritage: Tiller
+    release: istio
+  name: virtualservices.networking.istio.io
+spec:
+  group: networking.istio.io
+  names:
+    categories:
+    - istio-io
+    - networking-istio-io
+    kind: VirtualService
+    listKind: VirtualServiceList
+    plural: virtualservices
+    shortNames:
+    - vs
+    singular: virtualservice
+  scope: Namespaced
+  versions:
+  - additionalPrinterColumns:
+    - description: The names of gateways and sidecars that should apply these routes
+      jsonPath: .spec.gateways
+      name: Gateways
+      type: string
+    - description: The destination hosts to which traffic is being sent
+      jsonPath: .spec.hosts
+      name: Hosts
+      type: string
+    - description: 'CreationTimestamp is a timestamp representing the server time
+        when this object was created. It is not guaranteed to be set in happens-before
+        order across separate operations. Clients may not set this value. It is represented
+        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
+        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
+      jsonPath: .metadata.creationTimestamp
+      name: Age
+      type: date
+    name: v1alpha3
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Configuration affecting label/content routing, sni routing,
+              etc. See more details at: https://istio.io/docs/reference/config/networking/virtual-service.html'
+            properties:
+              exportTo:
+                description: A list of namespaces to which this virtual service is
+                  exported.
+                items:
+                  format: string
+                  type: string
+                type: array
+              gateways:
+                description: The names of gateways and sidecars that should apply
+                  these routes.
+                items:
+                  format: string
+                  type: string
+                type: array
+              hosts:
+                description: The destination hosts to which traffic is being sent.
+                items:
+                  format: string
+                  type: string
+                type: array
+              http:
+                description: An ordered list of route rules for HTTP traffic.
+                items:
+                  properties:
+                    corsPolicy:
+                      description: Cross-Origin Resource Sharing policy (CORS).
+                      properties:
+                        allowCredentials:
+                          nullable: true
+                          type: boolean
+                        allowHeaders:
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        allowMethods:
+                          description: List of HTTP methods allowed to access the
+                            resource.
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        allowOrigin:
+                          description: The list of origins that are allowed to perform
+                            CORS requests.
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        allowOrigins:
+                          description: String patterns that match allowed origins.
+                          items:
+                            oneOf:
+                            - not:
+                                anyOf:
+                                - required:
+                                  - exact
+                                - required:
+                                  - prefix
+                                - required:
+                                  - regex
+                            - required:
+                              - exact
+                            - required:
+                              - prefix
+                            - required:
+                              - regex
+                            properties:
+                              exact:
+                                format: string
+                                type: string
+                              prefix:
+                                format: string
+                                type: string
+                              regex:
+                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                format: string
+                                type: string
+                            type: object
+                          type: array
+                        exposeHeaders:
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        maxAge:
+                          type: string
+                      type: object
+                    delegate:
+                      properties:
+                        name:
+                          description: Name specifies the name of the delegate VirtualService.
+                          format: string
+                          type: string
+                        namespace:
+                          description: Namespace specifies the namespace where the
+                            delegate VirtualService resides.
+                          format: string
+                          type: string
+                      type: object
+                    fault:
+                      description: Fault injection policy to apply on HTTP traffic
+                        at the client side.
+                      properties:
+                        abort:
+                          oneOf:
+                          - not:
+                              anyOf:
+                              - required:
+                                - httpStatus
+                              - required:
+                                - grpcStatus
+                              - required:
+                                - http2Error
+                          - required:
+                            - httpStatus
+                          - required:
+                            - grpcStatus
+                          - required:
+                            - http2Error
+                          properties:
+                            grpcStatus:
+                              format: string
+                              type: string
+                            http2Error:
+                              format: string
+                              type: string
+                            httpStatus:
+                              description: HTTP status code to use to abort the Http
+                                request.
+                              format: int32
+                              type: integer
+                            percentage:
+                              description: Percentage of requests to be aborted with
+                                the error code provided.
+                              properties:
+                                value:
+                                  format: double
+                                  type: number
+                              type: object
+                          type: object
+                        delay:
+                          oneOf:
+                          - not:
+                              anyOf:
+                              - required:
+                                - fixedDelay
+                              - required:
+                                - exponentialDelay
+                          - required:
+                            - fixedDelay
+                          - required:
+                            - exponentialDelay
+                          properties:
+                            exponentialDelay:
+                              type: string
+                            fixedDelay:
+                              description: Add a fixed delay before forwarding the
+                                request.
+                              type: string
+                            percent:
+                              description: Percentage of requests on which the delay
+                                will be injected (0-100).
+                              format: int32
+                              type: integer
+                            percentage:
+                              description: Percentage of requests on which the delay
+                                will be injected.
+                              properties:
+                                value:
+                                  format: double
+                                  type: number
+                              type: object
+                          type: object
+                      type: object
+                    headers:
+                      properties:
+                        request:
+                          properties:
+                            add:
+                              additionalProperties:
+                                format: string
+                                type: string
+                              type: object
+                            remove:
+                              items:
+                                format: string
+                                type: string
+                              type: array
+                            set:
+                              additionalProperties:
+                                format: string
+                                type: string
+                              type: object
+                          type: object
+                        response:
+                          properties:
+                            add:
+                              additionalProperties:
+                                format: string
+                                type: string
+                              type: object
+                            remove:
+                              items:
+                                format: string
+                                type: string
+                              type: array
+                            set:
+                              additionalProperties:
+                                format: string
+                                type: string
+                              type: object
+                          type: object
+                      type: object
+                    match:
+                      items:
+                        properties:
+                          authority:
+                            oneOf:
+                            - not:
+                                anyOf:
+                                - required:
+                                  - exact
+                                - required:
+                                  - prefix
+                                - required:
+                                  - regex
+                            - required:
+                              - exact
+                            - required:
+                              - prefix
+                            - required:
+                              - regex
+                            properties:
+                              exact:
+                                format: string
+                                type: string
+                              prefix:
+                                format: string
+                                type: string
+                              regex:
+                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                format: string
+                                type: string
+                            type: object
+                          gateways:
+                            description: Names of gateways where the rule should be
+                              applied.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                          headers:
+                            additionalProperties:
+                              oneOf:
+                              - not:
+                                  anyOf:
+                                  - required:
+                                    - exact
+                                  - required:
+                                    - prefix
+                                  - required:
+                                    - regex
+                              - required:
+                                - exact
+                              - required:
+                                - prefix
+                              - required:
+                                - regex
+                              properties:
+                                exact:
+                                  format: string
+                                  type: string
+                                prefix:
+                                  format: string
+                                  type: string
+                                regex:
+                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                  format: string
+                                  type: string
+                              type: object
+                            type: object
+                          ignoreUriCase:
+                            description: Flag to specify whether the URI matching
+                              should be case-insensitive.
+                            type: boolean
+                          method:
+                            oneOf:
+                            - not:
+                                anyOf:
+                                - required:
+                                  - exact
+                                - required:
+                                  - prefix
+                                - required:
+                                  - regex
+                            - required:
+                              - exact
+                            - required:
+                              - prefix
+                            - required:
+                              - regex
+                            properties:
+                              exact:
+                                format: string
+                                type: string
+                              prefix:
+                                format: string
+                                type: string
+                              regex:
+                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                format: string
+                                type: string
+                            type: object
+                          name:
+                            description: The name assigned to a match.
+                            format: string
+                            type: string
+                          port:
+                            description: Specifies the ports on the host that is being
+                              addressed.
+                            type: integer
+                          queryParams:
+                            additionalProperties:
+                              oneOf:
+                              - not:
+                                  anyOf:
+                                  - required:
+                                    - exact
+                                  - required:
+                                    - prefix
+                                  - required:
+                                    - regex
+                              - required:
+                                - exact
+                              - required:
+                                - prefix
+                              - required:
+                                - regex
+                              properties:
+                                exact:
+                                  format: string
+                                  type: string
+                                prefix:
+                                  format: string
+                                  type: string
+                                regex:
+                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                  format: string
+                                  type: string
+                              type: object
+                            description: Query parameters for matching.
+                            type: object
+                          scheme:
+                            oneOf:
+                            - not:
+                                anyOf:
+                                - required:
+                                  - exact
+                                - required:
+                                  - prefix
+                                - required:
+                                  - regex
+                            - required:
+                              - exact
+                            - required:
+                              - prefix
+                            - required:
+                              - regex
+                            properties:
+                              exact:
+                                format: string
+                                type: string
+                              prefix:
+                                format: string
+                                type: string
+                              regex:
+                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                format: string
+                                type: string
+                            type: object
+                          sourceLabels:
+                            additionalProperties:
+                              format: string
+                              type: string
+                            type: object
+                          sourceNamespace:
+                            description: Source namespace constraining the applicability
+                              of a rule to workloads in that namespace.
+                            format: string
+                            type: string
+                          uri:
+                            oneOf:
+                            - not:
+                                anyOf:
+                                - required:
+                                  - exact
+                                - required:
+                                  - prefix
+                                - required:
+                                  - regex
+                            - required:
+                              - exact
+                            - required:
+                              - prefix
+                            - required:
+                              - regex
+                            properties:
+                              exact:
+                                format: string
+                                type: string
+                              prefix:
+                                format: string
+                                type: string
+                              regex:
+                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                format: string
+                                type: string
+                            type: object
+                          withoutHeaders:
+                            additionalProperties:
+                              oneOf:
+                              - not:
+                                  anyOf:
+                                  - required:
+                                    - exact
+                                  - required:
+                                    - prefix
+                                  - required:
+                                    - regex
+                              - required:
+                                - exact
+                              - required:
+                                - prefix
+                              - required:
+                                - regex
+                              properties:
+                                exact:
+                                  format: string
+                                  type: string
+                                prefix:
+                                  format: string
+                                  type: string
+                                regex:
+                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                  format: string
+                                  type: string
+                              type: object
+                            description: withoutHeader has the same syntax with the
+                              header, but has opposite meaning.
+                            type: object
+                        type: object
+                      type: array
+                    mirror:
+                      properties:
+                        host:
+                          description: The name of a service from the service registry.
+                          format: string
+                          type: string
+                        port:
+                          description: Specifies the port on the host that is being
+                            addressed.
+                          properties:
+                            number:
+                              type: integer
+                          type: object
+                        subset:
+                          description: The name of a subset within the service.
+                          format: string
+                          type: string
+                      type: object
+                    mirror_percent:
+                      description: Percentage of the traffic to be mirrored by the
+                        `mirror` field.
+                      nullable: true
+                      type: integer
+                    mirrorPercent:
+                      description: Percentage of the traffic to be mirrored by the
+                        `mirror` field.
+                      nullable: true
+                      type: integer
+                    mirrorPercentage:
+                      description: Percentage of the traffic to be mirrored by the
+                        `mirror` field.
+                      properties:
+                        value:
+                          format: double
+                          type: number
+                      type: object
+                    name:
+                      description: The name assigned to the route for debugging purposes.
+                      format: string
+                      type: string
+                    redirect:
+                      description: A HTTP rule can either redirect or forward (default)
+                        traffic.
+                      properties:
+                        authority:
+                          format: string
+                          type: string
+                        redirectCode:
+                          type: integer
+                        uri:
+                          format: string
+                          type: string
+                      type: object
+                    retries:
+                      description: Retry policy for HTTP requests.
+                      properties:
+                        attempts:
+                          description: Number of retries to be allowed for a given
+                            request.
+                          format: int32
+                          type: integer
+                        perTryTimeout:
+                          description: Timeout per retry attempt for a given request.
+                          type: string
+                        retryOn:
+                          description: Specifies the conditions under which retry
+                            takes place.
+                          format: string
+                          type: string
+                        retryRemoteLocalities:
+                          description: Flag to specify whether the retries should
+                            retry to other localities.
+                          nullable: true
+                          type: boolean
+                      type: object
+                    rewrite:
+                      description: Rewrite HTTP URIs and Authority headers.
+                      properties:
+                        authority:
+                          description: rewrite the Authority/Host header with this
+                            value.
+                          format: string
+                          type: string
+                        uri:
+                          format: string
+                          type: string
+                      type: object
+                    route:
+                      description: A HTTP rule can either redirect or forward (default)
+                        traffic.
+                      items:
+                        properties:
+                          destination:
+                            properties:
+                              host:
+                                description: The name of a service from the service
+                                  registry.
+                                format: string
+                                type: string
+                              port:
+                                description: Specifies the port on the host that is
+                                  being addressed.
+                                properties:
+                                  number:
+                                    type: integer
+                                type: object
+                              subset:
+                                description: The name of a subset within the service.
+                                format: string
+                                type: string
+                            type: object
+                          headers:
+                            properties:
+                              request:
+                                properties:
+                                  add:
+                                    additionalProperties:
+                                      format: string
+                                      type: string
+                                    type: object
+                                  remove:
+                                    items:
+                                      format: string
+                                      type: string
+                                    type: array
+                                  set:
+                                    additionalProperties:
+                                      format: string
+                                      type: string
+                                    type: object
+                                type: object
+                              response:
+                                properties:
+                                  add:
+                                    additionalProperties:
+                                      format: string
+                                      type: string
+                                    type: object
+                                  remove:
+                                    items:
+                                      format: string
+                                      type: string
+                                    type: array
+                                  set:
+                                    additionalProperties:
+                                      format: string
+                                      type: string
+                                    type: object
+                                type: object
+                            type: object
+                          weight:
+                            format: int32
+                            type: integer
+                        type: object
+                      type: array
+                    timeout:
+                      description: Timeout for HTTP requests, default is disabled.
+                      type: string
+                  type: object
+                type: array
+              tcp:
+                description: An ordered list of route rules for opaque TCP traffic.
+                items:
+                  properties:
+                    match:
+                      items:
+                        properties:
+                          destinationSubnets:
+                            description: IPv4 or IPv6 ip addresses of destination
+                              with optional subnet.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                          gateways:
+                            description: Names of gateways where the rule should be
+                              applied.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                          port:
+                            description: Specifies the port on the host that is being
+                              addressed.
+                            type: integer
+                          sourceLabels:
+                            additionalProperties:
+                              format: string
+                              type: string
+                            type: object
+                          sourceNamespace:
+                            description: Source namespace constraining the applicability
+                              of a rule to workloads in that namespace.
+                            format: string
+                            type: string
+                          sourceSubnet:
+                            description: IPv4 or IPv6 ip address of source with optional
+                              subnet.
+                            format: string
+                            type: string
+                        type: object
+                      type: array
+                    route:
+                      description: The destination to which the connection should
+                        be forwarded to.
+                      items:
+                        properties:
+                          destination:
+                            properties:
+                              host:
+                                description: The name of a service from the service
+                                  registry.
+                                format: string
+                                type: string
+                              port:
+                                description: Specifies the port on the host that is
+                                  being addressed.
+                                properties:
+                                  number:
+                                    type: integer
+                                type: object
+                              subset:
+                                description: The name of a subset within the service.
+                                format: string
+                                type: string
+                            type: object
+                          weight:
+                            format: int32
+                            type: integer
+                        type: object
+                      type: array
+                  type: object
+                type: array
+              tls:
+                items:
+                  properties:
+                    match:
+                      items:
+                        properties:
+                          destinationSubnets:
+                            description: IPv4 or IPv6 ip addresses of destination
+                              with optional subnet.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                          gateways:
+                            description: Names of gateways where the rule should be
+                              applied.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                          port:
+                            description: Specifies the port on the host that is being
+                              addressed.
+                            type: integer
+                          sniHosts:
+                            description: SNI (server name indicator) to match on.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                          sourceLabels:
+                            additionalProperties:
+                              format: string
+                              type: string
+                            type: object
+                          sourceNamespace:
+                            description: Source namespace constraining the applicability
+                              of a rule to workloads in that namespace.
+                            format: string
+                            type: string
+                        type: object
+                      type: array
+                    route:
+                      description: The destination to which the connection should
+                        be forwarded to.
+                      items:
+                        properties:
+                          destination:
+                            properties:
+                              host:
+                                description: The name of a service from the service
+                                  registry.
+                                format: string
+                                type: string
+                              port:
+                                description: Specifies the port on the host that is
+                                  being addressed.
+                                properties:
+                                  number:
+                                    type: integer
+                                type: object
+                              subset:
+                                description: The name of a subset within the service.
+                                format: string
+                                type: string
+                            type: object
+                          weight:
+                            format: int32
+                            type: integer
+                        type: object
+                      type: array
+                  type: object
+                type: array
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+  - additionalPrinterColumns:
+    - description: The names of gateways and sidecars that should apply these routes
+      jsonPath: .spec.gateways
+      name: Gateways
+      type: string
+    - description: The destination hosts to which traffic is being sent
+      jsonPath: .spec.hosts
+      name: Hosts
+      type: string
+    - description: 'CreationTimestamp is a timestamp representing the server time
+        when this object was created. It is not guaranteed to be set in happens-before
+        order across separate operations. Clients may not set this value. It is represented
+        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
+        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
+      jsonPath: .metadata.creationTimestamp
+      name: Age
+      type: date
+    name: v1beta1
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Configuration affecting label/content routing, sni routing,
+              etc. See more details at: https://istio.io/docs/reference/config/networking/virtual-service.html'
+            properties:
+              exportTo:
+                description: A list of namespaces to which this virtual service is
+                  exported.
+                items:
+                  format: string
+                  type: string
+                type: array
+              gateways:
+                description: The names of gateways and sidecars that should apply
+                  these routes.
+                items:
+                  format: string
+                  type: string
+                type: array
+              hosts:
+                description: The destination hosts to which traffic is being sent.
+                items:
+                  format: string
+                  type: string
+                type: array
+              http:
+                description: An ordered list of route rules for HTTP traffic.
+                items:
+                  properties:
+                    corsPolicy:
+                      description: Cross-Origin Resource Sharing policy (CORS).
+                      properties:
+                        allowCredentials:
+                          nullable: true
+                          type: boolean
+                        allowHeaders:
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        allowMethods:
+                          description: List of HTTP methods allowed to access the
+                            resource.
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        allowOrigin:
+                          description: The list of origins that are allowed to perform
+                            CORS requests.
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        allowOrigins:
+                          description: String patterns that match allowed origins.
+                          items:
+                            oneOf:
+                            - not:
+                                anyOf:
+                                - required:
+                                  - exact
+                                - required:
+                                  - prefix
+                                - required:
+                                  - regex
+                            - required:
+                              - exact
+                            - required:
+                              - prefix
+                            - required:
+                              - regex
+                            properties:
+                              exact:
+                                format: string
+                                type: string
+                              prefix:
+                                format: string
+                                type: string
+                              regex:
+                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                format: string
+                                type: string
+                            type: object
+                          type: array
+                        exposeHeaders:
+                          items:
+                            format: string
+                            type: string
+                          type: array
+                        maxAge:
+                          type: string
+                      type: object
+                    delegate:
+                      properties:
+                        name:
+                          description: Name specifies the name of the delegate VirtualService.
+                          format: string
+                          type: string
+                        namespace:
+                          description: Namespace specifies the namespace where the
+                            delegate VirtualService resides.
+                          format: string
+                          type: string
+                      type: object
+                    fault:
+                      description: Fault injection policy to apply on HTTP traffic
+                        at the client side.
+                      properties:
+                        abort:
+                          oneOf:
+                          - not:
+                              anyOf:
+                              - required:
+                                - httpStatus
+                              - required:
+                                - grpcStatus
+                              - required:
+                                - http2Error
+                          - required:
+                            - httpStatus
+                          - required:
+                            - grpcStatus
+                          - required:
+                            - http2Error
+                          properties:
+                            grpcStatus:
+                              format: string
+                              type: string
+                            http2Error:
+                              format: string
+                              type: string
+                            httpStatus:
+                              description: HTTP status code to use to abort the Http
+                                request.
+                              format: int32
+                              type: integer
+                            percentage:
+                              description: Percentage of requests to be aborted with
+                                the error code provided.
+                              properties:
+                                value:
+                                  format: double
+                                  type: number
+                              type: object
+                          type: object
+                        delay:
+                          oneOf:
+                          - not:
+                              anyOf:
+                              - required:
+                                - fixedDelay
+                              - required:
+                                - exponentialDelay
+                          - required:
+                            - fixedDelay
+                          - required:
+                            - exponentialDelay
+                          properties:
+                            exponentialDelay:
+                              type: string
+                            fixedDelay:
+                              description: Add a fixed delay before forwarding the
+                                request.
+                              type: string
+                            percent:
+                              description: Percentage of requests on which the delay
+                                will be injected (0-100).
+                              format: int32
+                              type: integer
+                            percentage:
+                              description: Percentage of requests on which the delay
+                                will be injected.
+                              properties:
+                                value:
+                                  format: double
+                                  type: number
+                              type: object
+                          type: object
+                      type: object
+                    headers:
+                      properties:
+                        request:
+                          properties:
+                            add:
+                              additionalProperties:
+                                format: string
+                                type: string
+                              type: object
+                            remove:
+                              items:
+                                format: string
+                                type: string
+                              type: array
+                            set:
+                              additionalProperties:
+                                format: string
+                                type: string
+                              type: object
+                          type: object
+                        response:
+                          properties:
+                            add:
+                              additionalProperties:
+                                format: string
+                                type: string
+                              type: object
+                            remove:
+                              items:
+                                format: string
+                                type: string
+                              type: array
+                            set:
+                              additionalProperties:
+                                format: string
+                                type: string
+                              type: object
+                          type: object
+                      type: object
+                    match:
+                      items:
+                        properties:
+                          authority:
+                            oneOf:
+                            - not:
+                                anyOf:
+                                - required:
+                                  - exact
+                                - required:
+                                  - prefix
+                                - required:
+                                  - regex
+                            - required:
+                              - exact
+                            - required:
+                              - prefix
+                            - required:
+                              - regex
+                            properties:
+                              exact:
+                                format: string
+                                type: string
+                              prefix:
+                                format: string
+                                type: string
+                              regex:
+                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                format: string
+                                type: string
+                            type: object
+                          gateways:
+                            description: Names of gateways where the rule should be
+                              applied.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                          headers:
+                            additionalProperties:
+                              oneOf:
+                              - not:
+                                  anyOf:
+                                  - required:
+                                    - exact
+                                  - required:
+                                    - prefix
+                                  - required:
+                                    - regex
+                              - required:
+                                - exact
+                              - required:
+                                - prefix
+                              - required:
+                                - regex
+                              properties:
+                                exact:
+                                  format: string
+                                  type: string
+                                prefix:
+                                  format: string
+                                  type: string
+                                regex:
+                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                  format: string
+                                  type: string
+                              type: object
+                            type: object
+                          ignoreUriCase:
+                            description: Flag to specify whether the URI matching
+                              should be case-insensitive.
+                            type: boolean
+                          method:
+                            oneOf:
+                            - not:
+                                anyOf:
+                                - required:
+                                  - exact
+                                - required:
+                                  - prefix
+                                - required:
+                                  - regex
+                            - required:
+                              - exact
+                            - required:
+                              - prefix
+                            - required:
+                              - regex
+                            properties:
+                              exact:
+                                format: string
+                                type: string
+                              prefix:
+                                format: string
+                                type: string
+                              regex:
+                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                format: string
+                                type: string
+                            type: object
+                          name:
+                            description: The name assigned to a match.
+                            format: string
+                            type: string
+                          port:
+                            description: Specifies the ports on the host that is being
+                              addressed.
+                            type: integer
+                          queryParams:
+                            additionalProperties:
+                              oneOf:
+                              - not:
+                                  anyOf:
+                                  - required:
+                                    - exact
+                                  - required:
+                                    - prefix
+                                  - required:
+                                    - regex
+                              - required:
+                                - exact
+                              - required:
+                                - prefix
+                              - required:
+                                - regex
+                              properties:
+                                exact:
+                                  format: string
+                                  type: string
+                                prefix:
+                                  format: string
+                                  type: string
+                                regex:
+                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                  format: string
+                                  type: string
+                              type: object
+                            description: Query parameters for matching.
+                            type: object
+                          scheme:
+                            oneOf:
+                            - not:
+                                anyOf:
+                                - required:
+                                  - exact
+                                - required:
+                                  - prefix
+                                - required:
+                                  - regex
+                            - required:
+                              - exact
+                            - required:
+                              - prefix
+                            - required:
+                              - regex
+                            properties:
+                              exact:
+                                format: string
+                                type: string
+                              prefix:
+                                format: string
+                                type: string
+                              regex:
+                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                format: string
+                                type: string
+                            type: object
+                          sourceLabels:
+                            additionalProperties:
+                              format: string
+                              type: string
+                            type: object
+                          sourceNamespace:
+                            description: Source namespace constraining the applicability
+                              of a rule to workloads in that namespace.
+                            format: string
+                            type: string
+                          uri:
+                            oneOf:
+                            - not:
+                                anyOf:
+                                - required:
+                                  - exact
+                                - required:
+                                  - prefix
+                                - required:
+                                  - regex
+                            - required:
+                              - exact
+                            - required:
+                              - prefix
+                            - required:
+                              - regex
+                            properties:
+                              exact:
+                                format: string
+                                type: string
+                              prefix:
+                                format: string
+                                type: string
+                              regex:
+                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                format: string
+                                type: string
+                            type: object
+                          withoutHeaders:
+                            additionalProperties:
+                              oneOf:
+                              - not:
+                                  anyOf:
+                                  - required:
+                                    - exact
+                                  - required:
+                                    - prefix
+                                  - required:
+                                    - regex
+                              - required:
+                                - exact
+                              - required:
+                                - prefix
+                              - required:
+                                - regex
+                              properties:
+                                exact:
+                                  format: string
+                                  type: string
+                                prefix:
+                                  format: string
+                                  type: string
+                                regex:
+                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
+                                  format: string
+                                  type: string
+                              type: object
+                            description: withoutHeader has the same syntax with the
+                              header, but has opposite meaning.
+                            type: object
+                        type: object
+                      type: array
+                    mirror:
+                      properties:
+                        host:
+                          description: The name of a service from the service registry.
+                          format: string
+                          type: string
+                        port:
+                          description: Specifies the port on the host that is being
+                            addressed.
+                          properties:
+                            number:
+                              type: integer
+                          type: object
+                        subset:
+                          description: The name of a subset within the service.
+                          format: string
+                          type: string
+                      type: object
+                    mirror_percent:
+                      description: Percentage of the traffic to be mirrored by the
+                        `mirror` field.
+                      nullable: true
+                      type: integer
+                    mirrorPercent:
+                      description: Percentage of the traffic to be mirrored by the
+                        `mirror` field.
+                      nullable: true
+                      type: integer
+                    mirrorPercentage:
+                      description: Percentage of the traffic to be mirrored by the
+                        `mirror` field.
+                      properties:
+                        value:
+                          format: double
+                          type: number
+                      type: object
+                    name:
+                      description: The name assigned to the route for debugging purposes.
+                      format: string
+                      type: string
+                    redirect:
+                      description: A HTTP rule can either redirect or forward (default)
+                        traffic.
+                      properties:
+                        authority:
+                          format: string
+                          type: string
+                        redirectCode:
+                          type: integer
+                        uri:
+                          format: string
+                          type: string
+                      type: object
+                    retries:
+                      description: Retry policy for HTTP requests.
+                      properties:
+                        attempts:
+                          description: Number of retries to be allowed for a given
+                            request.
+                          format: int32
+                          type: integer
+                        perTryTimeout:
+                          description: Timeout per retry attempt for a given request.
+                          type: string
+                        retryOn:
+                          description: Specifies the conditions under which retry
+                            takes place.
+                          format: string
+                          type: string
+                        retryRemoteLocalities:
+                          description: Flag to specify whether the retries should
+                            retry to other localities.
+                          nullable: true
+                          type: boolean
+                      type: object
+                    rewrite:
+                      description: Rewrite HTTP URIs and Authority headers.
+                      properties:
+                        authority:
+                          description: rewrite the Authority/Host header with this
+                            value.
+                          format: string
+                          type: string
+                        uri:
+                          format: string
+                          type: string
+                      type: object
+                    route:
+                      description: A HTTP rule can either redirect or forward (default)
+                        traffic.
+                      items:
+                        properties:
+                          destination:
+                            properties:
+                              host:
+                                description: The name of a service from the service
+                                  registry.
+                                format: string
+                                type: string
+                              port:
+                                description: Specifies the port on the host that is
+                                  being addressed.
+                                properties:
+                                  number:
+                                    type: integer
+                                type: object
+                              subset:
+                                description: The name of a subset within the service.
+                                format: string
+                                type: string
+                            type: object
+                          headers:
+                            properties:
+                              request:
+                                properties:
+                                  add:
+                                    additionalProperties:
+                                      format: string
+                                      type: string
+                                    type: object
+                                  remove:
+                                    items:
+                                      format: string
+                                      type: string
+                                    type: array
+                                  set:
+                                    additionalProperties:
+                                      format: string
+                                      type: string
+                                    type: object
+                                type: object
+                              response:
+                                properties:
+                                  add:
+                                    additionalProperties:
+                                      format: string
+                                      type: string
+                                    type: object
+                                  remove:
+                                    items:
+                                      format: string
+                                      type: string
+                                    type: array
+                                  set:
+                                    additionalProperties:
+                                      format: string
+                                      type: string
+                                    type: object
+                                type: object
+                            type: object
+                          weight:
+                            format: int32
+                            type: integer
+                        type: object
+                      type: array
+                    timeout:
+                      description: Timeout for HTTP requests, default is disabled.
+                      type: string
+                  type: object
+                type: array
+              tcp:
+                description: An ordered list of route rules for opaque TCP traffic.
+                items:
+                  properties:
+                    match:
+                      items:
+                        properties:
+                          destinationSubnets:
+                            description: IPv4 or IPv6 ip addresses of destination
+                              with optional subnet.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                          gateways:
+                            description: Names of gateways where the rule should be
+                              applied.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                          port:
+                            description: Specifies the port on the host that is being
+                              addressed.
+                            type: integer
+                          sourceLabels:
+                            additionalProperties:
+                              format: string
+                              type: string
+                            type: object
+                          sourceNamespace:
+                            description: Source namespace constraining the applicability
+                              of a rule to workloads in that namespace.
+                            format: string
+                            type: string
+                          sourceSubnet:
+                            description: IPv4 or IPv6 ip address of source with optional
+                              subnet.
+                            format: string
+                            type: string
+                        type: object
+                      type: array
+                    route:
+                      description: The destination to which the connection should
+                        be forwarded to.
+                      items:
+                        properties:
+                          destination:
+                            properties:
+                              host:
+                                description: The name of a service from the service
+                                  registry.
+                                format: string
+                                type: string
+                              port:
+                                description: Specifies the port on the host that is
+                                  being addressed.
+                                properties:
+                                  number:
+                                    type: integer
+                                type: object
+                              subset:
+                                description: The name of a subset within the service.
+                                format: string
+                                type: string
+                            type: object
+                          weight:
+                            format: int32
+                            type: integer
+                        type: object
+                      type: array
+                  type: object
+                type: array
+              tls:
+                items:
+                  properties:
+                    match:
+                      items:
+                        properties:
+                          destinationSubnets:
+                            description: IPv4 or IPv6 ip addresses of destination
+                              with optional subnet.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                          gateways:
+                            description: Names of gateways where the rule should be
+                              applied.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                          port:
+                            description: Specifies the port on the host that is being
+                              addressed.
+                            type: integer
+                          sniHosts:
+                            description: SNI (server name indicator) to match on.
+                            items:
+                              format: string
+                              type: string
+                            type: array
+                          sourceLabels:
+                            additionalProperties:
+                              format: string
+                              type: string
+                            type: object
+                          sourceNamespace:
+                            description: Source namespace constraining the applicability
+                              of a rule to workloads in that namespace.
+                            format: string
+                            type: string
+                        type: object
+                      type: array
+                    route:
+                      description: The destination to which the connection should
+                        be forwarded to.
+                      items:
+                        properties:
+                          destination:
+                            properties:
+                              host:
+                                description: The name of a service from the service
+                                  registry.
+                                format: string
+                                type: string
+                              port:
+                                description: Specifies the port on the host that is
+                                  being addressed.
+                                properties:
+                                  number:
+                                    type: integer
+                                type: object
+                              subset:
+                                description: The name of a subset within the service.
+                                format: string
+                                type: string
+                            type: object
+                          weight:
+                            format: int32
+                            type: integer
+                        type: object
+                      type: array
+                  type: object
+                type: array
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: false
+    subresources:
+      status: {}
+---
+apiVersion: apiextensions.k8s.io/v1
+kind: CustomResourceDefinition
+metadata:
+  annotations:
+    "helm.sh/resource-policy": keep
+  labels:
+    app: istio-pilot
+    chart: istio
+    heritage: Tiller
+    release: istio
+  name: workloadentries.networking.istio.io
+spec:
+  group: networking.istio.io
+  names:
+    categories:
+    - istio-io
+    - networking-istio-io
+    kind: WorkloadEntry
+    listKind: WorkloadEntryList
+    plural: workloadentries
+    shortNames:
+    - we
+    singular: workloadentry
+  scope: Namespaced
+  versions:
+  - additionalPrinterColumns:
+    - description: 'CreationTimestamp is a timestamp representing the server time
+        when this object was created. It is not guaranteed to be set in happens-before
+        order across separate operations. Clients may not set this value. It is represented
+        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
+        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
+      jsonPath: .metadata.creationTimestamp
+      name: Age
+      type: date
+    - description: Address associated with the network endpoint.
+      jsonPath: .spec.address
+      name: Address
+      type: string
+    name: v1alpha3
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Configuration affecting VMs onboarded into the mesh. See
+              more details at: https://istio.io/docs/reference/config/networking/workload-entry.html'
+            properties:
+              address:
+                format: string
+                type: string
+              labels:
+                additionalProperties:
+                  format: string
+                  type: string
+                description: One or more labels associated with the endpoint.
+                type: object
+              locality:
+                description: The locality associated with the endpoint.
+                format: string
+                type: string
+              network:
+                format: string
+                type: string
+              ports:
+                additionalProperties:
+                  type: integer
+                description: Set of ports associated with the endpoint.
+                type: object
+              serviceAccount:
+                format: string
+                type: string
+              weight:
+                description: The load balancing weight associated with the endpoint.
+                type: integer
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: true
+    subresources:
+      status: {}
+  - additionalPrinterColumns:
+    - description: 'CreationTimestamp is a timestamp representing the server time
+        when this object was created. It is not guaranteed to be set in happens-before
+        order across separate operations. Clients may not set this value. It is represented
+        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
+        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
+      jsonPath: .metadata.creationTimestamp
+      name: Age
+      type: date
+    - description: Address associated with the network endpoint.
+      jsonPath: .spec.address
+      name: Address
+      type: string
+    name: v1beta1
+    schema:
+      openAPIV3Schema:
+        properties:
+          spec:
+            description: 'Configuration affecting VMs onboarded into the mesh. See
+              more details at: https://istio.io/docs/reference/config/networking/workload-entry.html'
+            properties:
+              address:
+                format: string
+                type: string
+              labels:
+                additionalProperties:
+                  format: string
+                  type: string
+                description: One or more labels associated with the endpoint.
+                type: object
+              locality:
+                description: The locality associated with the endpoint.
+                format: string
+                type: string
+              network:
+                format: string
+                type: string
+              ports:
+                additionalProperties:
+                  type: integer
+                description: Set of ports associated with the endpoint.
+                type: object
+              serviceAccount:
+                format: string
+                type: string
+              weight:
+                description: The load balancing weight associated with the endpoint.
+                type: integer
+            type: object
+          status:
+            type: object
+            x-kubernetes-preserve-unknown-fields: true
+        type: object
+    served: true
+    storage: false
+    subresources:
+      status: {}
+---
+apiVersion: v1
+kind: ServiceAccount
+metadata:
+  name: istio-ingressgateway-service-account
+  namespace: istio-system
+  labels:
+    app: istio-ingressgateway
+    istio: ingressgateway
+    release: istio
+---
+apiVersion: v1
+kind: ServiceAccount
+metadata:
+  name: istio-reader-service-account
+  namespace: istio-system
+  labels:
+    app: istio-reader
+    release: istio
+---
+apiVersion: v1
+kind: ServiceAccount
+metadata:
+  name: istiod-service-account
+  namespace: istio-system
+  labels:
+    app: istiod
+    release: istio
+---
+apiVersion: rbac.authorization.k8s.io/v1
+kind: ClusterRole
+metadata:
+  name: istio-reader-istio-system
+  labels:
+    app: istio-reader
+    release: istio
+rules:
+  - apiGroups:
+      - "config.istio.io"
+      - "security.istio.io"
+      - "networking.istio.io"
+      - "authentication.istio.io"
+    resources: ["*"]
+    verbs: ["get", "list", "watch"]
+  - apiGroups: [""]
+    resources: ["endpoints", "pods", "services", "nodes", "replicationcontrollers", "namespaces"]
+    verbs: ["get", "list", "watch"]
+  - apiGroups: ["apps"]
+    resources: ["replicasets"]
+    verbs: ["get", "list", "watch"]
+---
+apiVersion: rbac.authorization.k8s.io/v1
+kind: ClusterRole
+metadata:
+  name: istiod-istio-system
+  labels:
+    app: istiod
+    release: istio
+rules:
+  # sidecar injection controller
+  - apiGroups: ["admissionregistration.k8s.io"]
+    resources: ["mutatingwebhookconfigurations"]
+    verbs: ["get", "list", "watch", "patch"]
+
+  # configuration validation webhook controller
+  - apiGroups: ["admissionregistration.k8s.io"]
+    resources: ["validatingwebhookconfigurations"]
+    verbs: ["get", "list", "watch", "update"]
+
+  # istio configuration
+  - apiGroups: ["config.istio.io", "security.istio.io", "networking.istio.io", "authentication.istio.io"]
+    verbs: ["get", "watch", "list"]
+    resources: ["*"]
+
+  # auto-detect installed CRD definitions
+  - apiGroups: ["apiextensions.k8s.io"]
+    resources: ["customresourcedefinitions"]
+    verbs: ["get", "list", "watch"]
+
+  # discovery and routing
+  - apiGroups: [""]
+    resources: ["pods", "nodes", "services", "namespaces", "endpoints"]
+    verbs: ["get", "list", "watch"]
+  - apiGroups: ["discovery.k8s.io"]
+    resources: ["endpointslices"]
+    verbs: ["get", "list", "watch"]
+
+  # ingress controller
+  - apiGroups: ["networking.k8s.io"]
+    resources: ["ingresses", "ingressclasses"]
+    verbs: ["get", "list", "watch"]
+  - apiGroups: ["networking.k8s.io"]
+    resources: ["ingresses/status"]
+    verbs: ["*"]
+
+  # required for CA's namespace controller
+  - apiGroups: [""]
+    resources: ["configmaps"]
+    verbs: ["create", "get", "list", "watch", "update"]
+
+  # Istiod and bootstrap.
+  - apiGroups: ["certificates.k8s.io"]
+    resources:
+      - "certificatesigningrequests"
+      - "certificatesigningrequests/approval"
+      - "certificatesigningrequests/status"
+    verbs: ["update", "create", "get", "delete", "watch"]
+  - apiGroups: ["certificates.k8s.io"]
+    resources:
+      - "signers"
+    resourceNames:
+    - "kubernetes.io/legacy-unknown"
+    verbs: ["approve"]
+
+  # Used by Istiod to verify the JWT tokens
+  - apiGroups: ["authentication.k8s.io"]
+    resources: ["tokenreviews"]
+    verbs: ["create"]
+
+  # Use for Kubernetes Service APIs
+  - apiGroups: ["networking.x-k8s.io"]
+    resources: ["*"]
+    verbs: ["get", "watch", "list"]
+
+  # Needed for multicluster secret reading, possibly ingress certs in the future
+  - apiGroups: [""]
+    resources: ["secrets"]
+    verbs: ["get", "watch", "list"]
+---
+apiVersion: rbac.authorization.k8s.io/v1
+kind: ClusterRoleBinding
+metadata:
+  name: istio-reader-istio-system
+  labels:
+    app: istio-reader
+    release: istio
+roleRef:
+  apiGroup: rbac.authorization.k8s.io
+  kind: ClusterRole
+  name: istio-reader-istio-system
+subjects:
+  - kind: ServiceAccount
+    name: istio-reader-service-account
+    namespace: istio-system
+---
+apiVersion: rbac.authorization.k8s.io/v1
+kind: ClusterRoleBinding
+metadata:
+  name: istiod-pilot-istio-system
+  labels:
+    app: pilot
+    release: istio
+roleRef:
+  apiGroup: rbac.authorization.k8s.io
+  kind: ClusterRole
+  name: istiod-istio-system
+subjects:
+  - kind: ServiceAccount
+    name: istiod-service-account
+    namespace: istio-system
+---
+apiVersion: admissionregistration.k8s.io/v1beta1
+kind: ValidatingWebhookConfiguration
+metadata:
+  name: istiod-istio-system
+  labels:
+    app: istiod
+    release: istio
+    istio: istiod
+webhooks:
+  - name: validation.istio.io
+    clientConfig:
+      service:
+        name: istiod
+        namespace: istio-system
+        path: "/validate"
+      caBundle: "" # patched at runtime when the webhook is ready.
+    rules:
+      - operations:
+        - CREATE
+        - UPDATE
+        apiGroups:
+        - config.istio.io
+        - security.istio.io
+        - authentication.istio.io
+        - networking.istio.io
+        apiVersions:
+        - "*"
+        resources:
+        - "*"
+    # Fail open until the validation webhook is ready. The webhook controller
+    # will update this to `Fail` and patch in the `caBundle` when the webhook
+    # endpoint is ready.
+    failurePolicy: Ignore
+    sideEffects: None
+    admissionReviewVersions: ["v1beta1", "v1"]
+---
+apiVersion: networking.istio.io/v1alpha3
+kind: EnvoyFilter
+metadata:
+  name: metadata-exchange-1.6
+  namespace: istio-system
+  labels:
+    istio.io/rev: default
+spec:
+  configPatches:
+    - applyTo: HTTP_FILTER
+      match:
+        context: ANY # inbound, outbound, and gateway
+        proxy:
+          proxyVersion: '^1\.6.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.http_connection_manager"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.metadata_exchange
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
+            value:
+              config:
+                configuration: |
+                  {}
+                vm_config:
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: envoy.wasm.metadata_exchange
+---
+apiVersion: networking.istio.io/v1alpha3
+kind: EnvoyFilter
+metadata:
+  name: metadata-exchange-1.7
+  namespace: istio-system
+  labels:
+    istio.io/rev: default
+spec:
+  configPatches:
+    - applyTo: HTTP_FILTER
+      match:
+        context: SIDECAR_INBOUND
+        proxy:
+          proxyVersion: '^1\.7.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.http_connection_manager"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.metadata_exchange
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
+            value:
+              config:
+                configuration:
+                  "@type": "type.googleapis.com/google.protobuf.StringValue"
+                  value: |
+                    {}
+                vm_config:
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: envoy.wasm.metadata_exchange
+    - applyTo: HTTP_FILTER
+      match:
+        context: SIDECAR_OUTBOUND
+        proxy:
+          proxyVersion: '^1\.7.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.http_connection_manager"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.metadata_exchange
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
+            value:
+              config:
+                configuration:
+                  "@type": "type.googleapis.com/google.protobuf.StringValue"
+                  value: |
+                    {}
+                vm_config:
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: envoy.wasm.metadata_exchange
+    - applyTo: HTTP_FILTER
+      match:
+        context: GATEWAY
+        proxy:
+          proxyVersion: '^1\.7.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.http_connection_manager"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.metadata_exchange
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
+            value:
+              config:
+                configuration:
+                  "@type": "type.googleapis.com/google.protobuf.StringValue"
+                  value: |
+                    {}
+                vm_config:
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: envoy.wasm.metadata_exchange
+---
+apiVersion: networking.istio.io/v1alpha3
+kind: EnvoyFilter
+metadata:
+  name: stats-filter-1.6
+  namespace: istio-system
+  labels:
+    istio.io/rev: default
+spec:
+  configPatches:
+    - applyTo: HTTP_FILTER
+      match:
+        context: SIDECAR_OUTBOUND
+        proxy:
+          proxyVersion: '^1\.6.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.http_connection_manager"
+              subFilter:
+                name: "envoy.router"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.stats
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
+            value:
+              config:
+                root_id: stats_outbound
+                configuration: |
+                  {
+                    "debug": "false",
+                    "stat_prefix": "istio"
+                  }
+                vm_config:
+                  vm_id: stats_outbound
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: envoy.wasm.stats
+    - applyTo: HTTP_FILTER
+      match:
+        context: SIDECAR_INBOUND
+        proxy:
+          proxyVersion: '^1\.6.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.http_connection_manager"
+              subFilter:
+                name: "envoy.router"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.stats
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
+            value:
+              config:
+                root_id: stats_inbound
+                configuration: |
+                  {
+                    "debug": "false",
+                    "stat_prefix": "istio"
+                  }
+                vm_config:
+                  vm_id: stats_inbound
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: envoy.wasm.stats
+    - applyTo: HTTP_FILTER
+      match:
+        context: GATEWAY
+        proxy:
+          proxyVersion: '^1\.6.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.http_connection_manager"
+              subFilter:
+                name: "envoy.router"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.stats
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
+            value:
+              config:
+                root_id: stats_outbound
+                configuration: |
+                  {
+                    "debug": "false",
+                    "stat_prefix": "istio",
+                    "disable_host_header_fallback": true
+                  }
+                vm_config:
+                  vm_id: stats_outbound
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: envoy.wasm.stats
+---
+apiVersion: networking.istio.io/v1alpha3
+kind: EnvoyFilter
+metadata:
+  name: stats-filter-1.7
+  namespace: istio-system
+  labels:
+    istio.io/rev: default
+spec:
+  configPatches:
+    - applyTo: HTTP_FILTER
+      match:
+        context: SIDECAR_OUTBOUND
+        proxy:
+          proxyVersion: '^1\.7.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.http_connection_manager"
+              subFilter:
+                name: "envoy.router"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.stats
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
+            value:
+              config:
+                root_id: stats_outbound
+                configuration:
+                  "@type": "type.googleapis.com/google.protobuf.StringValue"
+                  value: |
+                    {
+                      "debug": "false",
+                      "stat_prefix": "istio"
+                    }
+                vm_config:
+                  vm_id: stats_outbound
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: envoy.wasm.stats
+    - applyTo: HTTP_FILTER
+      match:
+        context: SIDECAR_INBOUND
+        proxy:
+          proxyVersion: '^1\.7.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.http_connection_manager"
+              subFilter:
+                name: "envoy.router"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.stats
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
+            value:
+              config:
+                root_id: stats_inbound
+                configuration:
+                  "@type": "type.googleapis.com/google.protobuf.StringValue"
+                  value: |
+                    {
+                      "debug": "false",
+                      "stat_prefix": "istio"
+                    }
+                vm_config:
+                  vm_id: stats_inbound
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: envoy.wasm.stats
+    - applyTo: HTTP_FILTER
+      match:
+        context: GATEWAY
+        proxy:
+          proxyVersion: '^1\.7.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.http_connection_manager"
+              subFilter:
+                name: "envoy.router"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.stats
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
+            value:
+              config:
+                root_id: stats_outbound
+                configuration:
+                  "@type": "type.googleapis.com/google.protobuf.StringValue"
+                  value: |
+                    {
+                      "debug": "false",
+                      "stat_prefix": "istio",
+                      "disable_host_header_fallback": true
+                    }
+                vm_config:
+                  vm_id: stats_outbound
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: envoy.wasm.stats
+---
+apiVersion: networking.istio.io/v1alpha3
+kind: EnvoyFilter
+metadata:
+  name: tcp-metadata-exchange-1.6
+  namespace: istio-system
+  labels:
+    istio.io/rev: default
+spec:
+  configPatches:
+    - applyTo: NETWORK_FILTER
+      match:
+        context: SIDECAR_INBOUND
+        proxy:
+          proxyVersion: '^1\.6.*'
+        listener: {}
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.metadata_exchange
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
+            value:
+              protocol: istio-peer-exchange
+    - applyTo: CLUSTER
+      match:
+        context: SIDECAR_OUTBOUND
+        proxy:
+          proxyVersion: '^1\.6.*'
+        cluster: {}
+      patch:
+        operation: MERGE
+        value:
+          filters:
+          - name: istio.metadata_exchange
+            typed_config:
+              "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+              type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
+              value:
+                protocol: istio-peer-exchange
+    - applyTo: CLUSTER
+      match:
+        context: GATEWAY
+        proxy:
+          proxyVersion: '^1\.6.*'
+        cluster: {}
+      patch:
+        operation: MERGE
+        value:
+          filters:
+          - name: istio.metadata_exchange
+            typed_config:
+              "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+              type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
+              value:
+                protocol: istio-peer-exchange
+---
+apiVersion: networking.istio.io/v1alpha3
+kind: EnvoyFilter
+metadata:
+  name: tcp-metadata-exchange-1.7
+  namespace: istio-system
+  labels:
+    istio.io/rev: default
+spec:
+  configPatches:
+    - applyTo: NETWORK_FILTER
+      match:
+        context: SIDECAR_INBOUND
+        proxy:
+          proxyVersion: '^1\.7.*'
+        listener: {}
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.metadata_exchange
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
+            value:
+              protocol: istio-peer-exchange
+    - applyTo: CLUSTER
+      match:
+        context: SIDECAR_OUTBOUND
+        proxy:
+          proxyVersion: '^1\.7.*'
+        cluster: {}
+      patch:
+        operation: MERGE
+        value:
+          filters:
+          - name: istio.metadata_exchange
+            typed_config:
+              "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+              type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
+              value:
+                protocol: istio-peer-exchange
+    - applyTo: CLUSTER
+      match:
+        context: GATEWAY
+        proxy:
+          proxyVersion: '^1\.7.*'
+        cluster: {}
+      patch:
+        operation: MERGE
+        value:
+          filters:
+          - name: istio.metadata_exchange
+            typed_config:
+              "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+              type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
+              value:
+                protocol: istio-peer-exchange
+---
+apiVersion: networking.istio.io/v1alpha3
+kind: EnvoyFilter
+metadata:
+  name: tcp-stats-filter-1.6
+  namespace: istio-system
+  labels:
+    istio.io/rev: default
+spec:
+  configPatches:
+    - applyTo: NETWORK_FILTER
+      match:
+        context: SIDECAR_INBOUND
+        proxy:
+          proxyVersion: '^1\.6.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.tcp_proxy"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.stats
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
+            value:
+              config:
+                root_id: stats_inbound
+                configuration: |
+                  {
+                    "debug": "false",
+                    "stat_prefix": "istio"
+                  }
+                vm_config:
+                  vm_id: tcp_stats_inbound
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: "envoy.wasm.stats"
+    - applyTo: NETWORK_FILTER
+      match:
+        context: SIDECAR_OUTBOUND
+        proxy:
+          proxyVersion: '^1\.6.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.tcp_proxy"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.stats
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
+            value:
+              config:
+                root_id: stats_outbound
+                configuration: |
+                  {
+                    "debug": "false",
+                    "stat_prefix": "istio"
+                  }
+                vm_config:
+                  vm_id: tcp_stats_outbound
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: "envoy.wasm.stats"
+    - applyTo: NETWORK_FILTER
+      match:
+        context: GATEWAY
+        proxy:
+          proxyVersion: '^1\.6.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.tcp_proxy"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.stats
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
+            value:
+              config:
+                root_id: stats_outbound
+                configuration: |
+                  {
+                    "debug": "false",
+                    "stat_prefix": "istio"
+                  }
+                vm_config:
+                  vm_id: tcp_stats_outbound
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: "envoy.wasm.stats"
+---
+apiVersion: networking.istio.io/v1alpha3
+kind: EnvoyFilter
+metadata:
+  name: tcp-stats-filter-1.7
+  namespace: istio-system
+  labels:
+    istio.io/rev: default
+spec:
+  configPatches:
+    - applyTo: NETWORK_FILTER
+      match:
+        context: SIDECAR_INBOUND
+        proxy:
+          proxyVersion: '^1\.7.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.tcp_proxy"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.stats
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
+            value:
+              config:
+                root_id: stats_inbound
+                configuration:
+                  "@type": "type.googleapis.com/google.protobuf.StringValue"
+                  value: |
+                    {
+                      "debug": "false",
+                      "stat_prefix": "istio"
+                    }
+                vm_config:
+                  vm_id: tcp_stats_inbound
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: "envoy.wasm.stats"
+    - applyTo: NETWORK_FILTER
+      match:
+        context: SIDECAR_OUTBOUND
+        proxy:
+          proxyVersion: '^1\.7.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.tcp_proxy"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.stats
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
+            value:
+              config:
+                root_id: stats_outbound
+                configuration:
+                  "@type": "type.googleapis.com/google.protobuf.StringValue"
+                  value: |
+                    {
+                      "debug": "false",
+                      "stat_prefix": "istio"
+                    }
+                vm_config:
+                  vm_id: tcp_stats_outbound
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: "envoy.wasm.stats"
+    - applyTo: NETWORK_FILTER
+      match:
+        context: GATEWAY
+        proxy:
+          proxyVersion: '^1\.7.*'
+        listener:
+          filterChain:
+            filter:
+              name: "envoy.tcp_proxy"
+      patch:
+        operation: INSERT_BEFORE
+        value:
+          name: istio.stats
+          typed_config:
+            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
+            type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
+            value:
+              config:
+                root_id: stats_outbound
+                configuration:
+                  "@type": "type.googleapis.com/google.protobuf.StringValue"
+                  value: |
+                    {
+                      "debug": "false",
+                      "stat_prefix": "istio"
+                    }
+                vm_config:
+                  vm_id: tcp_stats_outbound
+                  runtime: envoy.wasm.runtime.null
+                  code:
+                    local:
+                      inline_string: "envoy.wasm.stats"
+---
+apiVersion: v1
+kind: ConfigMap
+metadata:
+  name: istio
+  namespace: istio-system
+  labels:
+    istio.io/rev: default
+    release: istio
+data:
+
+  # Configuration file for the mesh networks to be used by the Split Horizon EDS.
+  meshNetworks: |-
+    networks: {}
+
+  mesh: |-
+    defaultConfig:
+      discoveryAddress: istiod.istio-system.svc:15012
+      proxyMetadata:
+        DNS_AGENT: ""
+      tracing:
+        zipkin:
+          address: zipkin.istio-system:9411
+    disableMixerHttpReports: true
+    enablePrometheusMerge: true
+    rootNamespace: istio-system
+    trustDomain: cluster.local
+---
+apiVersion: v1
+kind: ConfigMap
+metadata:
+  name: istio-sidecar-injector
+  namespace: istio-system
+  labels:
+    istio.io/rev: default
+    release: istio
+data:
+
+  values: |-
+    {
+      "global": {
+        "arch": {
+          "amd64": 2,
+          "ppc64le": 2,
+          "s390x": 2
+        },
+        "caAddress": "",
+        "centralIstiod": false,
+        "configValidation": true,
+        "controlPlaneSecurityEnabled": true,
+        "createRemoteSvcEndpoints": false,
+        "defaultNodeSelector": {},
+        "defaultPodDisruptionBudget": {
+          "enabled": true
+        },
+        "defaultResources": {
+          "requests": {
+            "cpu": "10m"
+          }
+        },
+        "enableHelmTest": false,
+        "enabled": true,
+        "hub": "docker.io/istio",
+        "imagePullPolicy": "",
+        "imagePullSecrets": [],
+        "istioNamespace": "istio-system",
+        "istiod": {
+          "enableAnalysis": false
+        },
+        "jwtPolicy": "third-party-jwt",
+        "logAsJson": false,
+        "logging": {
+          "level": "default:info"
+        },
+        "meshExpansion": {
+          "enabled": false,
+          "useILB": false
+        },
+        "meshID": "",
+        "meshNetworks": {},
+        "mountMtlsCerts": false,
+        "multiCluster": {
+          "clusterName": "",
+          "enabled": false
+        },
+        "namespace": "istio-system",
+        "network": "",
+        "omitSidecarInjectorConfigMap": false,
+        "oneNamespace": false,
+        "operatorManageWebhooks": false,
+        "pilotCertProvider": "istiod",
+        "policyNamespace": "istio-system",
+        "priorityClassName": "",
+        "proxy": {
+          "autoInject": "enabled",
+          "clusterDomain": "cluster.local",
+          "componentLogLevel": "misc:error",
+          "enableCoreDump": false,
+          "excludeIPRanges": "",
+          "excludeInboundPorts": "",
+          "excludeOutboundPorts": "",
+          "holdApplicationUntilProxyStarts": false,
+          "image": "proxyv2",
+          "includeIPRanges": "*",
+          "logLevel": "warning",
+          "privileged": false,
+          "readinessFailureThreshold": 30,
+          "readinessInitialDelaySeconds": 1,
+          "readinessPeriodSeconds": 2,
+          "resources": {
+            "limits": {
+              "cpu": "2000m",
+              "memory": "1024Mi"
+            },
+            "requests": {
+              "cpu": "100m",
+              "memory": "128Mi"
+            }
+          },
+          "statusPort": 15020,
+          "tracer": "zipkin"
+        },
+        "proxy_init": {
+          "image": "proxyv2",
+          "resources": {
+            "limits": {
+              "cpu": "2000m",
+              "memory": "1024Mi"
+            },
+            "requests": {
+              "cpu": "10m",
+              "memory": "10Mi"
+            }
+          }
+        },
+        "remotePilotAddress": "",
+        "remotePolicyAddress": "",
+        "remoteTelemetryAddress": "",
+        "sds": {
+          "token": {
+            "aud": "istio-ca"
+          }
+        },
+        "sts": {
+          "servicePort": 0
+        },
+        "tag": "1.7.4",
+        "telemetryNamespace": "istio-system",
+        "tracer": {
+          "datadog": {
+            "address": "$(HOST_IP):8126"
+          },
+          "lightstep": {
+            "accessToken": "",
+            "address": ""
+          },
+          "stackdriver": {
+            "debug": false,
+            "maxNumberOfAnnotations": 200,
+            "maxNumberOfAttributes": 200,
+            "maxNumberOfMessageEvents": 200
+          },
+          "zipkin": {
+            "address": ""
+          }
+        },
+        "trustDomain": "cluster.local",
+        "useMCP": false
+      },
+      "istio_cni": {
+        "enabled": false
+      },
+      "revision": "",
+      "sidecarInjectorWebhook": {
+        "alwaysInjectSelector": [],
+        "enableNamespacesByDefault": false,
+        "injectLabel": "istio-injection",
+        "injectedAnnotations": {},
+        "neverInjectSelector": [],
+        "objectSelector": {
+          "autoInject": true,
+          "enabled": false
+        },
+        "rewriteAppHTTPProbe": true
+      }
+    }
+
+  # To disable injection: use omitSidecarInjectorConfigMap, which disables the webhook patching
+  # and istiod webhook functionality.
+  #
+  # New fields should not use Values - it is a 'primary' config object, users should be able
+  # to fine tune it or use it with kube-inject.
+  config: |-
+    policy: enabled
+    alwaysInjectSelector:
+      []
+    neverInjectSelector:
+      []
+    injectedAnnotations:
+
+    template: |
+      rewriteAppHTTPProbe: {{ valueOrDefault .Values.sidecarInjectorWebhook.rewriteAppHTTPProbe false }}
+      initContainers:
+      {{ if ne (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `NONE` }}
+      {{ if .Values.istio_cni.enabled -}}
+      - name: istio-validation
+      {{ else -}}
+      - name: istio-init
+      {{ end -}}
+      {{- if contains "/" .Values.global.proxy_init.image }}
+        image: "{{ .Values.global.proxy_init.image }}"
+      {{- else }}
+        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy_init.image }}:{{ .Values.global.tag }}"
+      {{- end }}
+        args:
+        - istio-iptables
+        - "-p"
+        - 15001
+        - "-z"
+        - "15006"
+        - "-u"
+        - 1337
+        - "-m"
+        - "{{ annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode }}"
+        - "-i"
+        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundIPRanges` .Values.global.proxy.includeIPRanges }}"
+        - "-x"
+        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundIPRanges` .Values.global.proxy.excludeIPRanges }}"
+        - "-b"
+        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeInboundPorts` `*` }}"
+        - "-d"
+      {{- if excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}
+        - "15090,15021,{{ excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}"
+      {{- else }}
+        - "15090,15021"
+      {{- end }}
+        {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/includeOutboundPorts`) (ne (valueOrDefault .Values.global.proxy.includeOutboundPorts "") "") -}}
+        - "-q"
+        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundPorts` .Values.global.proxy.includeOutboundPorts }}"
+        {{ end -}}
+        {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/excludeOutboundPorts`) (ne (valueOrDefault .Values.global.proxy.excludeOutboundPorts "") "") -}}
+        - "-o"
+        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundPorts` .Values.global.proxy.excludeOutboundPorts }}"
+        {{ end -}}
+        {{ if (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces`) -}}
+        - "-k"
+        - "{{ index .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces` }}"
+        {{ end -}}
+        {{ if .Values.istio_cni.enabled -}}
+        - "--run-validation"
+        - "--skip-rule-apply"
+        {{ end -}}
+        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
+      {{- if .ProxyConfig.ProxyMetadata }}
+        env:
+        {{- range $key, $value := .ProxyConfig.ProxyMetadata }}
+        - name: {{ $key }}
+          value: "{{ $value }}"
+        {{- end }}
+      {{- end }}
+      {{- if .Values.global.proxy_init.resources }}
+        resources:
+          {{ toYaml .Values.global.proxy_init.resources | indent 4 }}
+      {{- else }}
+        resources: {}
+      {{- end }}
+        securityContext:
+          allowPrivilegeEscalation: {{ .Values.global.proxy.privileged }}
+          privileged: {{ .Values.global.proxy.privileged }}
+          capabilities:
+        {{- if not .Values.istio_cni.enabled }}
+            add:
+            - NET_ADMIN
+            - NET_RAW
+        {{- end }}
+            drop:
+            - ALL
+        {{- if not .Values.istio_cni.enabled }}
+          readOnlyRootFilesystem: false
+          runAsGroup: 0
+          runAsNonRoot: false
+          runAsUser: 0
+        {{- else }}
+          readOnlyRootFilesystem: true
+          runAsGroup: 1337
+          runAsUser: 1337
+          runAsNonRoot: true
+        {{- end }}
+        restartPolicy: Always
+      {{ end -}}
+      {{- if eq .Values.global.proxy.enableCoreDump true }}
+      - name: enable-core-dump
+        args:
+        - -c
+        - sysctl -w kernel.core_pattern=/var/lib/istio/data/core.proxy && ulimit -c unlimited
+        command:
+          - /bin/sh
+      {{- if contains "/" .Values.global.proxy_init.image }}
+        image: "{{ .Values.global.proxy_init.image }}"
+      {{- else }}
+        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy_init.image }}:{{ .Values.global.tag }}"
+      {{- end }}
+        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
+        resources: {}
+        securityContext:
+          allowPrivilegeEscalation: true
+          capabilities:
+            add:
+            - SYS_ADMIN
+            drop:
+            - ALL
+          privileged: true
+          readOnlyRootFilesystem: false
+          runAsGroup: 0
+          runAsNonRoot: false
+          runAsUser: 0
+      {{ end }}
+      containers:
+      - name: istio-proxy
+      {{- if contains "/" (annotation .ObjectMeta `sidecar.istio.io/proxyImage` .Values.global.proxy.image) }}
+        image: "{{ annotation .ObjectMeta `sidecar.istio.io/proxyImage` .Values.global.proxy.image }}"
+      {{- else }}
+        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy.image }}:{{ .Values.global.tag }}"
+      {{- end }}
+        ports:
+        - containerPort: 15090
+          protocol: TCP
+          name: http-envoy-prom
+        args:
+        - proxy
+        - sidecar
+        - --domain
+        - $(POD_NAMESPACE).svc.{{ .Values.global.proxy.clusterDomain }}
+        - --serviceCluster
+        {{ if ne "" (index .ObjectMeta.Labels "app") -}}
+        - "{{ index .ObjectMeta.Labels `app` }}.$(POD_NAMESPACE)"
+        {{ else -}}
+        - "{{ valueOrDefault .DeploymentMeta.Name `istio-proxy` }}.{{ valueOrDefault .DeploymentMeta.Namespace `default` }}"
+        {{ end -}}
+        - --proxyLogLevel={{ annotation .ObjectMeta `sidecar.istio.io/logLevel` .Values.global.proxy.logLevel}}
+        - --proxyComponentLogLevel={{ annotation .ObjectMeta `sidecar.istio.io/componentLogLevel` .Values.global.proxy.componentLogLevel}}
+      {{- if .Values.global.sts.servicePort }}
+        - --stsPort={{ .Values.global.sts.servicePort }}
+      {{- end }}
+      {{- if .Values.global.trustDomain }}
+        - --trust-domain={{ .Values.global.trustDomain }}
+      {{- end }}
+      {{- if .Values.global.logAsJson }}
+        - --log_as_json
+      {{- end }}
+      {{- if gt .ProxyConfig.Concurrency.GetValue 0 }}
+        - --concurrency
+        - "{{ .ProxyConfig.Concurrency.GetValue }}"
+      {{- end -}}
+      {{- if .Values.global.proxy.lifecycle }}
+        lifecycle:
+          {{ toYaml .Values.global.proxy.lifecycle | indent 4 }}
+      {{- else if .Values.global.proxy.holdApplicationUntilProxyStarts}}
+        lifecycle:
+          postStart:
+            exec:
+              command:
+              - pilot-agent
+              - wait
+      {{- end }}
+        env:
+        - name: JWT_POLICY
+          value: {{ .Values.global.jwtPolicy }}
+        - name: PILOT_CERT_PROVIDER
+          value: {{ .Values.global.pilotCertProvider }}
+        - name: CA_ADDR
+        {{- if .Values.global.caAddress }}
+          value: {{ .Values.global.caAddress }}
+        {{- else }}
+          value: istiod{{- if not (eq .Values.revision "") }}-{{ .Values.revision }}{{- end }}.{{ .Values.global.istioNamespace }}.svc:15012
+        {{- end }}
+        - name: POD_NAME
+          valueFrom:
+            fieldRef:
+              fieldPath: metadata.name
+        - name: POD_NAMESPACE
+          valueFrom:
+            fieldRef:
+              fieldPath: metadata.namespace
+        - name: INSTANCE_IP
+          valueFrom:
+            fieldRef:
+              fieldPath: status.podIP
+        - name: SERVICE_ACCOUNT
+          valueFrom:
+            fieldRef:
+              fieldPath: spec.serviceAccountName
+        - name: HOST_IP
+          valueFrom:
+            fieldRef:
+              fieldPath: status.hostIP
+        - name: CANONICAL_SERVICE
+          valueFrom:
+            fieldRef:
+              fieldPath: metadata.labels['service.istio.io/canonical-name']
+        - name: CANONICAL_REVISION
+          valueFrom:
+            fieldRef:
+              fieldPath: metadata.labels['service.istio.io/canonical-revision']
+        - name: PROXY_CONFIG
+          value: |
+                 {{ protoToJSON .ProxyConfig }}
+        - name: ISTIO_META_POD_PORTS
+          value: |-
+            [
+            {{- $first := true }}
+            {{- range $index1, $c := .Spec.Containers }}
+              {{- range $index2, $p := $c.Ports }}
+                {{- if (structToJSON $p) }}
+                {{if not $first}},{{end}}{{ structToJSON $p }}
+                {{- $first = false }}
+                {{- end }}
+              {{- end}}
+            {{- end}}
+            ]
+        - name: ISTIO_META_APP_CONTAINERS
+          value: "{{- range $index, $container := .Spec.Containers }}{{- if ne $index 0}},{{- end}}{{ $container.Name }}{{- end}}"
+        - name: ISTIO_META_CLUSTER_ID
+          value: "{{ valueOrDefault .Values.global.multiCluster.clusterName `Kubernetes` }}"
+        - name: ISTIO_META_INTERCEPTION_MODE
+          value: "{{ or (index .ObjectMeta.Annotations `sidecar.istio.io/interceptionMode`) .ProxyConfig.InterceptionMode.String }}"
+        {{- if .Values.global.network }}
+        - name: ISTIO_META_NETWORK
+          value: "{{ .Values.global.network }}"
+        {{- end }}
+        {{ if .ObjectMeta.Annotations }}
+        - name: ISTIO_METAJSON_ANNOTATIONS
+          value: |
+                 {{ toJSON .ObjectMeta.Annotations }}
+        {{ end }}
+        {{- if .DeploymentMeta.Name }}
+        - name: ISTIO_META_WORKLOAD_NAME
+          value: {{ .DeploymentMeta.Name }}
+        {{ end }}
+        {{- if and .TypeMeta.APIVersion .DeploymentMeta.Name }}
+        - name: ISTIO_META_OWNER
+          value: kubernetes://apis/{{ .TypeMeta.APIVersion }}/namespaces/{{ valueOrDefault .DeploymentMeta.Namespace `default` }}/{{ toLower .TypeMeta.Kind}}s/{{ .DeploymentMeta.Name }}
+        {{- end}}
+        {{- if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
+        - name: ISTIO_BOOTSTRAP_OVERRIDE
+          value: "/etc/istio/custom-bootstrap/custom_bootstrap.json"
+        {{- end }}
+        {{- if .Values.global.meshID }}
+        - name: ISTIO_META_MESH_ID
+          value: "{{ .Values.global.meshID }}"
+        {{- else if .Values.global.trustDomain }}
+        - name: ISTIO_META_MESH_ID
+          value: "{{ .Values.global.trustDomain }}"
+        {{- end }}
+        {{- if and (eq .Values.global.proxy.tracer "datadog") (isset .ObjectMeta.Annotations `apm.datadoghq.com/env`) }}
+        {{- range $key, $value := fromJSON (index .ObjectMeta.Annotations `apm.datadoghq.com/env`) }}
+        - name: {{ $key }}
+          value: "{{ $value }}"
+        {{- end }}
+        {{- end }}
+        {{- range $key, $value := .ProxyConfig.ProxyMetadata }}
+        - name: {{ $key }}
+          value: "{{ $value }}"
+        {{- end }}
+        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
+        {{ if ne (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) `0` }}
+        readinessProbe:
+          httpGet:
+            path: /healthz/ready
+            port: 15021
+          initialDelaySeconds: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/initialDelaySeconds` .Values.global.proxy.readinessInitialDelaySeconds }}
+          periodSeconds: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/periodSeconds` .Values.global.proxy.readinessPeriodSeconds }}
+          failureThreshold: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/failureThreshold` .Values.global.proxy.readinessFailureThreshold }}
+        {{ end -}}
+        securityContext:
+          allowPrivilegeEscalation: {{ .Values.global.proxy.privileged }}
+          capabilities:
+            {{ if or (eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY`) (eq (annotation .ObjectMeta `sidecar.istio.io/capNetBindService` .Values.global.proxy.capNetBindService) `true`) -}}
+            add:
+            {{ if eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY` -}}
+            - NET_ADMIN
+            {{- end }}
+            {{ if eq (annotation .ObjectMeta `sidecar.istio.io/capNetBindService` .Values.global.proxy.capNetBindService) `true` -}}
+            - NET_BIND_SERVICE
+            {{- end }}
+            {{- end }}
+            drop:
+            - ALL
+          privileged: {{ .Values.global.proxy.privileged }}
+          readOnlyRootFilesystem: {{ not .Values.global.proxy.enableCoreDump }}
+          runAsGroup: 1337
+          fsGroup: 1337
+          {{ if or (eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY`) (eq (annotation .ObjectMeta `sidecar.istio.io/capNetBindService` .Values.global.proxy.capNetBindService) `true`) -}}
+          runAsNonRoot: false
+          runAsUser: 0
+          {{- else -}}
+          runAsNonRoot: true
+          runAsUser: 1337
+          {{- end }}
+        resources:
+      {{- if or (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit`) }}
+        {{- if or (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) }}
+          requests:
+            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) -}}
+            cpu: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU` }}"
+            {{ end }}
+            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) -}}
+            memory: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory` }}"
+            {{ end }}
+        {{- end }}
+        {{- if or (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit`) }}
+          limits:
+            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit`) -}}
+            cpu: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit` }}"
+            {{ end }}
+            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit`) -}}
+            memory: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit` }}"
+            {{ end }}
+        {{- end }}
+      {{- else }}
+        {{- if .Values.global.proxy.resources }}
+          {{ toYaml .Values.global.proxy.resources | indent 4 }}
+        {{- end }}
+      {{- end }}
+        volumeMounts:
+        {{- if eq .Values.global.pilotCertProvider "istiod" }}
+        - mountPath: /var/run/secrets/istio
+          name: istiod-ca-cert
+        {{- end }}
+        - mountPath: /var/lib/istio/data
+          name: istio-data
+        {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
+        - mountPath: /etc/istio/custom-bootstrap
+          name: custom-bootstrap-volume
+        {{- end }}
+        # SDS channel between istioagent and Envoy
+        - mountPath: /etc/istio/proxy
+          name: istio-envoy
+        {{- if eq .Values.global.jwtPolicy "third-party-jwt" }}
+        - mountPath: /var/run/secrets/tokens
+          name: istio-token
+        {{- end }}
+        {{- if .Values.global.mountMtlsCerts }}
+        # Use the key and cert mounted to /etc/certs/ for the in-cluster mTLS communications.
+        - mountPath: /etc/certs/
+          name: istio-certs
+          readOnly: true
+        {{- end }}
+        - name: istio-podinfo
+          mountPath: /etc/istio/pod
+         {{- if and (eq .Values.global.proxy.tracer "lightstep") .ProxyConfig.GetTracing.GetTlsSettings }}
+        - mountPath: {{ directory .ProxyConfig.GetTracing.GetTlsSettings.GetCaCertificates }}
+          name: lightstep-certs
+          readOnly: true
+        {{- end }}
+          {{- if isset .ObjectMeta.Annotations `sidecar.istio.io/userVolumeMount` }}
+          {{ range $index, $value := fromJSON (index .ObjectMeta.Annotations `sidecar.istio.io/userVolumeMount`) }}
+        - name: "{{  $index }}"
+          {{ toYaml $value | indent 4 }}
+          {{ end }}
+          {{- end }}
+      {{- if .ProxyConfig.ProxyMetadata.ISTIO_META_DNS_CAPTURE }}
+      dnsConfig:
+        options:
+        - name: "ndots"
+          value: "4"
+      {{- end }}
+      volumes:
+      {{- if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
+      - name: custom-bootstrap-volume
+        configMap:
+          name: {{ annotation .ObjectMeta `sidecar.istio.io/bootstrapOverride` "" }}
+      {{- end }}
+      # SDS channel between istioagent and Envoy
+      - emptyDir:
+          medium: Memory
+        name: istio-envoy
+      - name: istio-data
+        emptyDir: {}
+      - name: istio-podinfo
+        downwardAPI:
+          items:
+            - path: "labels"
+              fieldRef:
+                fieldPath: metadata.labels
+            - path: "annotations"
+              fieldRef:
+                fieldPath: metadata.annotations
+      {{- if eq .Values.global.jwtPolicy "third-party-jwt" }}
+      - name: istio-token
+        projected:
+          sources:
+          - serviceAccountToken:
+              path: istio-token
+              expirationSeconds: 43200
+              audience: {{ .Values.global.sds.token.aud }}
+      {{- end }}
+      {{- if eq .Values.global.pilotCertProvider "istiod" }}
+      - name: istiod-ca-cert
+        configMap:
+          name: istio-ca-root-cert
+      {{- end }}
+      {{- if .Values.global.mountMtlsCerts }}
+      # Use the key and cert mounted to /etc/certs/ for the in-cluster mTLS communications.
+      - name: istio-certs
+        secret:
+          optional: true
+          {{ if eq .Spec.ServiceAccountName "" }}
+          secretName: istio.default
+          {{ else -}}
+          secretName: {{  printf "istio.%s" .Spec.ServiceAccountName }}
+          {{  end -}}
+      {{- end }}
+        {{- if isset .ObjectMeta.Annotations `sidecar.istio.io/userVolume` }}
+        {{range $index, $value := fromJSON (index .ObjectMeta.Annotations `sidecar.istio.io/userVolume`) }}
+      - name: "{{ $index }}"
+        {{ toYaml $value | indent 2 }}
+        {{ end }}
+        {{ end }}
+      {{- if and (eq .Values.global.proxy.tracer "lightstep") .ProxyConfig.GetTracing.GetTlsSettings }}
+      - name: lightstep-certs
+        secret:
+          optional: true
+          secretName: lightstep.cacert
+      {{- end }}
+      {{- if .Values.global.podDNSSearchNamespaces }}
+      dnsConfig:
+        searches:
+          {{- range .Values.global.podDNSSearchNamespaces }}
+          - {{ render . }}
+          {{- end }}
+      {{- end }}
+      podRedirectAnnot:
+      {{- if and (.Values.istio_cni.enabled) (not .Values.istio_cni.chained) }}
+      {{ if isset .ObjectMeta.Annotations `k8s.v1.cni.cncf.io/networks` }}
+        k8s.v1.cni.cncf.io/networks: "{{ index .ObjectMeta.Annotations `k8s.v1.cni.cncf.io/networks`}}, istio-cni"
+      {{- else }}
+        k8s.v1.cni.cncf.io/networks: "istio-cni"
+      {{- end }}
+      {{- end }}
+        sidecar.istio.io/interceptionMode: "{{ annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode }}"
+        traffic.sidecar.istio.io/includeOutboundIPRanges: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundIPRanges` .Values.global.proxy.includeIPRanges }}"
+        traffic.sidecar.istio.io/excludeOutboundIPRanges: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundIPRanges` .Values.global.proxy.excludeIPRanges }}"
+        traffic.sidecar.istio.io/includeInboundPorts: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeInboundPorts` (includeInboundPorts .Spec.Containers) }}"
+        traffic.sidecar.istio.io/excludeInboundPorts: "{{ excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}"
+      {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/includeOutboundPorts`) (ne (valueOrDefault .Values.global.proxy.includeOutboundPorts "") "") }}
+        traffic.sidecar.istio.io/includeOutboundPorts: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundPorts` .Values.global.proxy.includeOutboundPorts }}"
+      {{- end }}
+      {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/excludeOutboundPorts`) (ne .Values.global.proxy.excludeOutboundPorts "") }}
+        traffic.sidecar.istio.io/excludeOutboundPorts: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundPorts` .Values.global.proxy.excludeOutboundPorts }}"
+      {{- end }}
+        traffic.sidecar.istio.io/kubevirtInterfaces: "{{ index .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces` }}"
+      {{- if .Values.global.imagePullSecrets }}
+      imagePullSecrets:
+        {{- range .Values.global.imagePullSecrets }}
+        - name: {{ . }}
+        {{- end }}
+      {{- end }}
+---
+apiVersion: admissionregistration.k8s.io/v1beta1
+kind: MutatingWebhookConfiguration
+metadata:
+  name: istio-sidecar-injector
+
+  labels:
+    istio.io/rev: default
+    app: sidecar-injector
+    release: istio
+webhooks:
+  - name: sidecar-injector.istio.io
+    clientConfig:
+      service:
+        name: istiod
+        namespace: istio-system
+        path: "/inject"
+      caBundle: ""
+    sideEffects: None
+    rules:
+      - operations: [ "CREATE" ]
+        apiGroups: [""]
+        apiVersions: ["v1"]
+        resources: ["pods"]
+    failurePolicy: Fail
+    admissionReviewVersions: ["v1beta1", "v1"]
+    namespaceSelector:
+      matchLabels:
+        istio-injection: enabled
+---
+apiVersion: apps/v1
+kind: Deployment
+metadata:
+  labels:
+    app: istio-ingressgateway
+    istio: ingressgateway
+    release: istio
+  name: istio-ingressgateway
+  namespace: istio-system
+spec:
+  selector:
+    matchLabels:
+      app: istio-ingressgateway
+      istio: ingressgateway
+  strategy:
+    rollingUpdate:
+      maxSurge: 100%
+      maxUnavailable: 25%
+  template:
+    metadata:
+      annotations:
+        prometheus.io/path: /stats/prometheus
+        prometheus.io/port: "15090"
+        prometheus.io/scrape: "true"
+        sidecar.istio.io/inject: "false"
+      labels:
+        app: istio-ingressgateway
+        chart: gateways
+        heritage: Tiller
+        istio: ingressgateway
+        release: istio
+        service.istio.io/canonical-name: istio-ingressgateway
+        service.istio.io/canonical-revision: latest
+    spec:
+      affinity:
+        nodeAffinity:
+          preferredDuringSchedulingIgnoredDuringExecution:
+          - preference:
+              matchExpressions:
+              - key: kubernetes.io/arch
+                operator: In
+                values:
+                - amd64
+            weight: 2
+          - preference:
+              matchExpressions:
+              - key: kubernetes.io/arch
+                operator: In
+                values:
+                - ppc64le
+            weight: 2
+          - preference:
+              matchExpressions:
+              - key: kubernetes.io/arch
+                operator: In
+                values:
+                - s390x
+            weight: 2
+          requiredDuringSchedulingIgnoredDuringExecution:
+            nodeSelectorTerms:
+            - matchExpressions:
+              - key: kubernetes.io/arch
+                operator: In
+                values:
+                - amd64
+                - ppc64le
+                - s390x
+      containers:
+      - args:
+        - proxy
+        - router
+        - --domain
+        - $(POD_NAMESPACE).svc.cluster.local
+        - --proxyLogLevel=warning
+        - --proxyComponentLogLevel=misc:error
+        - --log_output_level=default:info
+        - --serviceCluster
+        - istio-ingressgateway
+        - --trust-domain=cluster.local
+        env:
+        - name: JWT_POLICY
+          value: third-party-jwt
+        - name: PILOT_CERT_PROVIDER
+          value: istiod
+        - name: CA_ADDR
+          value: istiod.istio-system.svc:15012
+        - name: NODE_NAME
+          valueFrom:
+            fieldRef:
+              apiVersion: v1
+              fieldPath: spec.nodeName
+        - name: POD_NAME
+          valueFrom:
+            fieldRef:
+              apiVersion: v1
+              fieldPath: metadata.name
+        - name: POD_NAMESPACE
+          valueFrom:
+            fieldRef:
+              apiVersion: v1
+              fieldPath: metadata.namespace
+        - name: INSTANCE_IP
+          valueFrom:
+            fieldRef:
+              apiVersion: v1
+              fieldPath: status.podIP
+        - name: HOST_IP
+          valueFrom:
+            fieldRef:
+              apiVersion: v1
+              fieldPath: status.hostIP
+        - name: SERVICE_ACCOUNT
+          valueFrom:
+            fieldRef:
+              fieldPath: spec.serviceAccountName
+        - name: CANONICAL_SERVICE
+          valueFrom:
+            fieldRef:
+              fieldPath: metadata.labels['service.istio.io/canonical-name']
+        - name: CANONICAL_REVISION
+          valueFrom:
+            fieldRef:
+              fieldPath: metadata.labels['service.istio.io/canonical-revision']
+        - name: ISTIO_META_WORKLOAD_NAME
+          value: istio-ingressgateway
+        - name: ISTIO_META_OWNER
+          value: kubernetes://apis/apps/v1/namespaces/istio-system/deployments/istio-ingressgateway
+        - name: ISTIO_META_MESH_ID
+          value: cluster.local
+        - name: ISTIO_META_ROUTER_MODE
+          value: sni-dnat
+        - name: ISTIO_META_CLUSTER_ID
+          value: Kubernetes
+        image: docker.io/istio/proxyv2:1.7.4
+        name: istio-proxy
+        ports:
+        - containerPort: 15021
+        - containerPort: 8080
+        - containerPort: 8443
+        - containerPort: 15443
+        - containerPort: 15090
+          name: http-envoy-prom
+          protocol: TCP
+        readinessProbe:
+          failureThreshold: 30
+          httpGet:
+            path: /healthz/ready
+            port: 15021
+            scheme: HTTP
+          initialDelaySeconds: 1
+          periodSeconds: 2
+          successThreshold: 1
+          timeoutSeconds: 1
+        resources:
+          limits:
+            cpu: 2000m
+            memory: 1024Mi
+          requests:
+            cpu: 100m
+            memory: 128Mi
+        securityContext:
+          allowPrivilegeEscalation: false
+          capabilities:
+            drop:
+            - ALL
+          privileged: false
+          readOnlyRootFilesystem: true
+        volumeMounts:
+        - mountPath: /etc/istio/proxy
+          name: istio-envoy
+        - mountPath: /etc/istio/config
+          name: config-volume
+        - mountPath: /var/run/secrets/istio
+          name: istiod-ca-cert
+        - mountPath: /var/run/secrets/tokens
+          name: istio-token
+          readOnly: true
+        - mountPath: /var/run/ingress_gateway
+          name: gatewaysdsudspath
+        - mountPath: /etc/istio/pod
+          name: podinfo
+        - mountPath: /etc/istio/ingressgateway-certs
+          name: ingressgateway-certs
+          readOnly: true
+        - mountPath: /etc/istio/ingressgateway-ca-certs
+          name: ingressgateway-ca-certs
+          readOnly: true
+      securityContext:
+        fsGroup: 1337
+        runAsGroup: 1337
+        runAsNonRoot: true
+        runAsUser: 1337
+      serviceAccountName: istio-ingressgateway-service-account
+      volumes:
+      - configMap:
+          name: istio-ca-root-cert
+        name: istiod-ca-cert
+      - downwardAPI:
+          items:
+          - fieldRef:
+              fieldPath: metadata.labels
+            path: labels
+          - fieldRef:
+              fieldPath: metadata.annotations
+            path: annotations
+        name: podinfo
+      - emptyDir: {}
+        name: istio-envoy
+      - emptyDir: {}
+        name: gatewaysdsudspath
+      - name: istio-token
+        projected:
+          sources:
+          - serviceAccountToken:
+              audience: istio-ca
+              expirationSeconds: 43200
+              path: istio-token
+      - configMap:
+          name: istio
+          optional: true
+        name: config-volume
+      - name: ingressgateway-certs
+        secret:
+          optional: true
+          secretName: istio-ingressgateway-certs
+      - name: ingressgateway-ca-certs
+        secret:
+          optional: true
+          secretName: istio-ingressgateway-ca-certs
+---
+apiVersion: apps/v1
+kind: Deployment
+metadata:
+  labels:
+    app: istiod
+    istio: pilot
+    istio.io/rev: default
+    release: istio
+  name: istiod
+  namespace: istio-system
+spec:
+  selector:
+    matchLabels:
+      istio: pilot
+  strategy:
+    rollingUpdate:
+      maxSurge: 100%
+      maxUnavailable: 25%
+  template:
+    metadata:
+      annotations:
+        prometheus.io/port: "15014"
+        prometheus.io/scrape: "true"
+        sidecar.istio.io/inject: "false"
+      labels:
+        app: istiod
+        istio: pilot
+        istio.io/rev: default
+    spec:
+      containers:
+      - args:
+        - discovery
+        - --monitoringAddr=:15014
+        - --log_output_level=default:info
+        - --domain
+        - cluster.local
+        - --trust-domain=cluster.local
+        - --keepaliveMaxServerConnectionAge
+        - 30m
+        env:
+        - name: REVISION
+          value: default
+        - name: JWT_POLICY
+          value: third-party-jwt
+        - name: PILOT_CERT_PROVIDER
+          value: istiod
+        - name: POD_NAME
+          valueFrom:
+            fieldRef:
+              apiVersion: v1
+              fieldPath: metadata.name
+        - name: POD_NAMESPACE
+          valueFrom:
+            fieldRef:
+              apiVersion: v1
+              fieldPath: metadata.namespace
+        - name: SERVICE_ACCOUNT
+          valueFrom:
+            fieldRef:
+              apiVersion: v1
+              fieldPath: spec.serviceAccountName
+        - name: KUBECONFIG
+          value: /var/run/secrets/remote/config
+        - name: PILOT_TRACE_SAMPLING
+          value: "1"
+        - name: PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_OUTBOUND
+          value: "true"
+        - name: PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_INBOUND
+          value: "true"
+        - name: INJECTION_WEBHOOK_CONFIG_NAME
+          value: istio-sidecar-injector
+        - name: ISTIOD_ADDR
+          value: istiod.istio-system.svc:15012
+        - name: PILOT_ENABLE_ANALYSIS
+          value: "false"
+        - name: CLUSTER_ID
+          value: Kubernetes
+        - name: CENTRAL_ISTIOD
+          value: "false"
+        image: docker.io/istio/pilot:1.7.4
+        name: discovery
+        ports:
+        - containerPort: 8080
+        - containerPort: 15010
+        - containerPort: 15017
+        - containerPort: 15053
+        readinessProbe:
+          httpGet:
+            path: /ready
+            port: 8080
+          initialDelaySeconds: 1
+          periodSeconds: 3
+          timeoutSeconds: 5
+        resources:
+          requests:
+            cpu: 500m
+            memory: 2048Mi
+        securityContext:
+          capabilities:
+            drop:
+            - ALL
+          runAsGroup: 1337
+          runAsNonRoot: true
+          runAsUser: 1337
+        volumeMounts:
+        - mountPath: /etc/istio/config
+          name: config-volume
+        - mountPath: /var/run/secrets/tokens
+          name: istio-token
+          readOnly: true
+        - mountPath: /var/run/secrets/istio-dns
+          name: local-certs
+        - mountPath: /etc/cacerts
+          name: cacerts
+          readOnly: true
+        - mountPath: /var/run/secrets/remote
+          name: istio-kubeconfig
+          readOnly: true
+        - mountPath: /var/lib/istio/inject
+          name: inject
+          readOnly: true
+      securityContext:
+        fsGroup: 1337
+      serviceAccountName: istiod-service-account
+      volumes:
+      - emptyDir:
+          medium: Memory
+        name: local-certs
+      - name: istio-token
+        projected:
+          sources:
+          - serviceAccountToken:
+              audience: istio-ca
+              expirationSeconds: 43200
+              path: istio-token
+      - name: cacerts
+        secret:
+          optional: true
+          secretName: cacerts
+      - name: istio-kubeconfig
+        secret:
+          optional: true
+          secretName: istio-kubeconfig
+      - configMap:
+          name: istio-sidecar-injector
+        name: inject
+      - configMap:
+          name: istio
+        name: config-volume
+---
+apiVersion: policy/v1beta1
+kind: PodDisruptionBudget
+metadata:
+  name: istio-ingressgateway
+  namespace: istio-system
+  labels:
+    app: istio-ingressgateway
+    istio: ingressgateway
+    release: istio
+spec:
+  minAvailable: 1
+  selector:
+    matchLabels:
+      app: istio-ingressgateway
+      istio: ingressgateway
+---
+apiVersion: policy/v1beta1
+kind: PodDisruptionBudget
+metadata:
+  name: istiod
+  namespace: istio-system
+  labels:
+    app: istiod
+    istio.io/rev: default
+    release: istio
+    istio: pilot
+spec:
+  minAvailable: 1
+  selector:
+    matchLabels:
+      app: istiod
+      istio: pilot
+---
+apiVersion: rbac.authorization.k8s.io/v1
+kind: Role
+metadata:
+  name: istio-ingressgateway-sds
+  namespace: istio-system
+  labels:
+    release: istio
+rules:
+- apiGroups: [""]
+  resources: ["secrets"]
+  verbs: ["get", "watch", "list"]
+---
+apiVersion: rbac.authorization.k8s.io/v1
+kind: Role
+metadata:
+  name: istiod-istio-system
+  namespace: istio-system
+  labels:
+    app: istiod
+    release: istio
+rules:
+- apiGroups: ["networking.istio.io"]
+  verbs: ["create"]
+  resources: ["gateways"]
+
+- apiGroups: [""]
+  resources: ["secrets"]
+  # TODO lock this down to istio-ca-cert if not using the DNS cert mesh config
+  verbs: ["create", "get", "watch", "list", "update", "delete"]
+---
+apiVersion: rbac.authorization.k8s.io/v1
+kind: RoleBinding
+metadata:
+  name: istio-ingressgateway-sds
+  namespace: istio-system
+  labels:
+    release: istio
+roleRef:
+  apiGroup: rbac.authorization.k8s.io
+  kind: Role
+  name: istio-ingressgateway-sds
+subjects:
+- kind: ServiceAccount
+  name: istio-ingressgateway-service-account
+---
+apiVersion: rbac.authorization.k8s.io/v1
+kind: RoleBinding
+metadata:
+  name: istiod-istio-system
+  namespace: istio-system
+  labels:
+    app: pilot
+    release: istio
+roleRef:
+  apiGroup: rbac.authorization.k8s.io
+  kind: Role
+  name: istiod-istio-system
+subjects:
+  - kind: ServiceAccount
+    name: istiod-service-account
+    namespace: istio-system
+---
+apiVersion: autoscaling/v2beta1
+kind: HorizontalPodAutoscaler
+metadata:
+  labels:
+    app: istio-ingressgateway
+    istio: ingressgateway
+    release: istio
+  name: istio-ingressgateway
+  namespace: istio-system
+spec:
+  maxReplicas: 5
+  metrics:
+  - resource:
+      name: cpu
+      targetAverageUtilization: 80
+    type: Resource
+  minReplicas: 1
+  scaleTargetRef:
+    apiVersion: apps/v1
+    kind: Deployment
+    name: istio-ingressgateway
+---
+apiVersion: autoscaling/v2beta1
+kind: HorizontalPodAutoscaler
+metadata:
+  name: istiod
+  namespace: istio-system
+  labels:
+    app: istiod
+    release: istio
+    istio.io/rev: default
+spec:
+  maxReplicas: 5
+  minReplicas: 1
+  scaleTargetRef:
+    apiVersion: apps/v1
+    kind: Deployment
+    name: istiod
+  metrics:
+  - type: Resource
+    resource:
+      name: cpu
+      targetAverageUtilization: 80
+---
+apiVersion: v1
+kind: Service
+metadata:
+  annotations: null
+  labels:
+    app: istio-ingressgateway
+    istio: ingressgateway
+    release: istio
+  name: istio-ingressgateway
+  namespace: istio-system
+spec:
+  ports:
+  - name: status-port
+    port: 15021
+    targetPort: 15021
+  - name: http2
+    port: 80
+    targetPort: 8080
+  - name: https
+    port: 443
+    targetPort: 8443
+  - name: tls
+    port: 15443
+    targetPort: 15443
+  selector:
+    app: istio-ingressgateway
+    istio: ingressgateway
+  type: LoadBalancer
+---
+apiVersion: v1
+kind: Service
+metadata:
+  name: istiod
+  namespace: istio-system
+  labels:
+    istio.io/rev: default
+    app: istiod
+    istio: pilot
+    release: istio
+spec:
+  ports:
+    - port: 15010
+      name: grpc-xds # plaintext
+    - port: 15012
+      name: https-dns # mTLS with k8s-signed cert
+    - port: 443
+      name: https-webhook # validation and injection
+      targetPort: 15017
+    - port: 15014
+      name: http-monitoring # prometheus stats
+    - name: dns-tls
+      port: 853
+      targetPort: 15053
+      protocol: TCP
+  selector:
+    app: istiod
+    # Label used by the 'default' service. For versioned deployments we match with app and version.
+    # This avoids default deployment picking the canary
+    istio: pilot
+---
diff --git a/infrastructure/istio/kustomization.yaml b/infrastructure/istio/kustomization.yaml
new file mode 100644
index 0000000..72ccf7c
--- /dev/null
+++ b/infrastructure/istio/kustomization.yaml
@@ -0,0 +1,6 @@
+apiVersion: kustomize.config.k8s.io/v1beta1
+kind: Kustomization
+resources:
+  - namespace.yaml
+  - istio.yaml
+  - prometheus.yaml
\ No newline at end of file
diff --git a/infrastructure/istio/namespace.yaml b/infrastructure/istio/namespace.yaml
new file mode 100644
index 0000000..d5eee5a
--- /dev/null
+++ b/infrastructure/istio/namespace.yaml
@@ -0,0 +1,4 @@
+apiVersion: v1
+kind: Namespace
+metadata:
+  name: istio-system
\ No newline at end of file
diff --git a/infrastructure/istio/prometheus.yaml b/infrastructure/istio/prometheus.yaml
new file mode 100644
index 0000000..615620d
--- /dev/null
+++ b/infrastructure/istio/prometheus.yaml
@@ -0,0 +1,478 @@
+apiVersion: v1
+items:
+- apiVersion: v1
+  kind: ServiceAccount
+  metadata:
+    annotations:
+      kubectl.kubernetes.io/last-applied-configuration: |
+        {"apiVersion":"v1","kind":"ServiceAccount","metadata":{"annotations":{},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"},"name":"prometheus","namespace":"istio-system"}}
+    labels:
+      app: prometheus
+      chart: prometheus-11.16.2
+      component: server
+      heritage: Helm
+      release: prometheus
+    name: prometheus
+    namespace: istio-system
+- apiVersion: v1
+  data:
+    alerting_rules.yml: |
+      {}
+    alerts: |
+      {}
+    prometheus.yml: |
+      global:
+        evaluation_interval: 1m
+        scrape_interval: 15s
+        scrape_timeout: 10s
+      rule_files:
+      - /etc/config/recording_rules.yml
+      - /etc/config/alerting_rules.yml
+      - /etc/config/rules
+      - /etc/config/alerts
+      scrape_configs:
+      - job_name: prometheus
+        static_configs:
+        - targets:
+          - localhost:9090
+      - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
+        job_name: kubernetes-apiservers
+        kubernetes_sd_configs:
+        - role: endpoints
+        relabel_configs:
+        - action: keep
+          regex: default;kubernetes;https
+          source_labels:
+          - __meta_kubernetes_namespace
+          - __meta_kubernetes_service_name
+          - __meta_kubernetes_endpoint_port_name
+        scheme: https
+        tls_config:
+          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
+          insecure_skip_verify: true
+      - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
+        job_name: kubernetes-nodes
+        kubernetes_sd_configs:
+        - role: node
+        relabel_configs:
+        - action: labelmap
+          regex: __meta_kubernetes_node_label_(.+)
+        - replacement: kubernetes.default.svc:443
+          target_label: __address__
+        - regex: (.+)
+          replacement: /api/v1/nodes/$1/proxy/metrics
+          source_labels:
+          - __meta_kubernetes_node_name
+          target_label: __metrics_path__
+        scheme: https
+        tls_config:
+          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
+          insecure_skip_verify: true
+      - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
+        job_name: kubernetes-nodes-cadvisor
+        kubernetes_sd_configs:
+        - role: node
+        relabel_configs:
+        - action: labelmap
+          regex: __meta_kubernetes_node_label_(.+)
+        - replacement: kubernetes.default.svc:443
+          target_label: __address__
+        - regex: (.+)
+          replacement: /api/v1/nodes/$1/proxy/metrics/cadvisor
+          source_labels:
+          - __meta_kubernetes_node_name
+          target_label: __metrics_path__
+        scheme: https
+        tls_config:
+          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
+          insecure_skip_verify: true
+      - job_name: kubernetes-service-endpoints
+        kubernetes_sd_configs:
+        - role: endpoints
+        relabel_configs:
+        - action: keep
+          regex: true
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_scrape
+        - action: replace
+          regex: (https?)
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_scheme
+          target_label: __scheme__
+        - action: replace
+          regex: (.+)
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_path
+          target_label: __metrics_path__
+        - action: replace
+          regex: ([^:]+)(?::\d+)?;(\d+)
+          replacement: $1:$2
+          source_labels:
+          - __address__
+          - __meta_kubernetes_service_annotation_prometheus_io_port
+          target_label: __address__
+        - action: labelmap
+          regex: __meta_kubernetes_service_label_(.+)
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_namespace
+          target_label: kubernetes_namespace
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_service_name
+          target_label: kubernetes_name
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_pod_node_name
+          target_label: kubernetes_node
+      - job_name: kubernetes-service-endpoints-slow
+        kubernetes_sd_configs:
+        - role: endpoints
+        relabel_configs:
+        - action: keep
+          regex: true
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_scrape_slow
+        - action: replace
+          regex: (https?)
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_scheme
+          target_label: __scheme__
+        - action: replace
+          regex: (.+)
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_path
+          target_label: __metrics_path__
+        - action: replace
+          regex: ([^:]+)(?::\d+)?;(\d+)
+          replacement: $1:$2
+          source_labels:
+          - __address__
+          - __meta_kubernetes_service_annotation_prometheus_io_port
+          target_label: __address__
+        - action: labelmap
+          regex: __meta_kubernetes_service_label_(.+)
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_namespace
+          target_label: kubernetes_namespace
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_service_name
+          target_label: kubernetes_name
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_pod_node_name
+          target_label: kubernetes_node
+        scrape_interval: 5m
+        scrape_timeout: 30s
+      - honor_labels: true
+        job_name: prometheus-pushgateway
+        kubernetes_sd_configs:
+        - role: service
+        relabel_configs:
+        - action: keep
+          regex: pushgateway
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_probe
+      - job_name: kubernetes-services
+        kubernetes_sd_configs:
+        - role: service
+        metrics_path: /probe
+        params:
+          module:
+          - http_2xx
+        relabel_configs:
+        - action: keep
+          regex: true
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_probe
+        - source_labels:
+          - __address__
+          target_label: __param_target
+        - replacement: blackbox
+          target_label: __address__
+        - source_labels:
+          - __param_target
+          target_label: instance
+        - action: labelmap
+          regex: __meta_kubernetes_service_label_(.+)
+        - source_labels:
+          - __meta_kubernetes_namespace
+          target_label: kubernetes_namespace
+        - source_labels:
+          - __meta_kubernetes_service_name
+          target_label: kubernetes_name
+      - job_name: kubernetes-pods
+        kubernetes_sd_configs:
+        - role: pod
+        relabel_configs:
+        - action: keep
+          regex: true
+          source_labels:
+          - __meta_kubernetes_pod_annotation_prometheus_io_scrape
+        - action: replace
+          regex: (.+)
+          source_labels:
+          - __meta_kubernetes_pod_annotation_prometheus_io_path
+          target_label: __metrics_path__
+        - action: replace
+          regex: ([^:]+)(?::\d+)?;(\d+)
+          replacement: $1:$2
+          source_labels:
+          - __address__
+          - __meta_kubernetes_pod_annotation_prometheus_io_port
+          target_label: __address__
+        - action: labelmap
+          regex: __meta_kubernetes_pod_label_(.+)
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_namespace
+          target_label: kubernetes_namespace
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_pod_name
+          target_label: kubernetes_pod_name
+        - action: drop
+          regex: Pending|Succeeded|Failed
+          source_labels:
+          - __meta_kubernetes_pod_phase
+      - job_name: kubernetes-pods-slow
+        kubernetes_sd_configs:
+        - role: pod
+        relabel_configs:
+        - action: keep
+          regex: true
+          source_labels:
+          - __meta_kubernetes_pod_annotation_prometheus_io_scrape_slow
+        - action: replace
+          regex: (.+)
+          source_labels:
+          - __meta_kubernetes_pod_annotation_prometheus_io_path
+          target_label: __metrics_path__
+        - action: replace
+          regex: ([^:]+)(?::\d+)?;(\d+)
+          replacement: $1:$2
+          source_labels:
+          - __address__
+          - __meta_kubernetes_pod_annotation_prometheus_io_port
+          target_label: __address__
+        - action: labelmap
+          regex: __meta_kubernetes_pod_label_(.+)
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_namespace
+          target_label: kubernetes_namespace
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_pod_name
+          target_label: kubernetes_pod_name
+        - action: drop
+          regex: Pending|Succeeded|Failed
+          source_labels:
+          - __meta_kubernetes_pod_phase
+        scrape_interval: 5m
+        scrape_timeout: 30s
+    recording_rules.yml: |
+      {}
+    rules: |
+      {}
+  kind: ConfigMap
+  metadata:
+    annotations:
+      kubectl.kubernetes.io/last-applied-configuration: |
+        {"apiVersion":"v1","data":{"alerting_rules.yml":"{}\n","alerts":"{}\n","prometheus.yml":"global:\n  evaluation_interval: 1m\n  scrape_interval: 15s\n  scrape_timeout: 10s\nrule_files:\n- /etc/config/recording_rules.yml\n- /etc/config/alerting_rules.yml\n- /etc/config/rules\n- /etc/config/alerts\nscrape_configs:\n- job_name: prometheus\n  static_configs:\n  - targets:\n    - localhost:9090\n- bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n  job_name: kubernetes-apiservers\n  kubernetes_sd_configs:\n  - role: endpoints\n  relabel_configs:\n  - action: keep\n    regex: default;kubernetes;https\n    source_labels:\n    - __meta_kubernetes_namespace\n    - __meta_kubernetes_service_name\n    - __meta_kubernetes_endpoint_port_name\n  scheme: https\n  tls_config:\n    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n    insecure_skip_verify: true\n- bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n  job_name: kubernetes-nodes\n  kubernetes_sd_configs:\n  - role: node\n  relabel_configs:\n  - action: labelmap\n    regex: __meta_kubernetes_node_label_(.+)\n  - replacement: kubernetes.default.svc:443\n    target_label: __address__\n  - regex: (.+)\n    replacement: /api/v1/nodes/$1/proxy/metrics\n    source_labels:\n    - __meta_kubernetes_node_name\n    target_label: __metrics_path__\n  scheme: https\n  tls_config:\n    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n    insecure_skip_verify: true\n- bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n  job_name: kubernetes-nodes-cadvisor\n  kubernetes_sd_configs:\n  - role: node\n  relabel_configs:\n  - action: labelmap\n    regex: __meta_kubernetes_node_label_(.+)\n  - replacement: kubernetes.default.svc:443\n    target_label: __address__\n  - regex: (.+)\n    replacement: /api/v1/nodes/$1/proxy/metrics/cadvisor\n    source_labels:\n    - __meta_kubernetes_node_name\n    target_label: __metrics_path__\n  scheme: https\n  tls_config:\n    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n    insecure_skip_verify: true\n- job_name: kubernetes-service-endpoints\n  kubernetes_sd_configs:\n  - role: endpoints\n  relabel_configs:\n  - action: keep\n    regex: true\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_scrape\n  - action: replace\n    regex: (https?)\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_scheme\n    target_label: __scheme__\n  - action: replace\n    regex: (.+)\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_path\n    target_label: __metrics_path__\n  - action: replace\n    regex: ([^:]+)(?::\\d+)?;(\\d+)\n    replacement: $1:$2\n    source_labels:\n    - __address__\n    - __meta_kubernetes_service_annotation_prometheus_io_port\n    target_label: __address__\n  - action: labelmap\n    regex: __meta_kubernetes_service_label_(.+)\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_namespace\n    target_label: kubernetes_namespace\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_service_name\n    target_label: kubernetes_name\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_pod_node_name\n    target_label: kubernetes_node\n- job_name: kubernetes-service-endpoints-slow\n  kubernetes_sd_configs:\n  - role: endpoints\n  relabel_configs:\n  - action: keep\n    regex: true\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_scrape_slow\n  - action: replace\n    regex: (https?)\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_scheme\n    target_label: __scheme__\n  - action: replace\n    regex: (.+)\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_path\n    target_label: __metrics_path__\n  - action: replace\n    regex: ([^:]+)(?::\\d+)?;(\\d+)\n    replacement: $1:$2\n    source_labels:\n    - __address__\n    - __meta_kubernetes_service_annotation_prometheus_io_port\n    target_label: __address__\n  - action: labelmap\n    regex: __meta_kubernetes_service_label_(.+)\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_namespace\n    target_label: kubernetes_namespace\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_service_name\n    target_label: kubernetes_name\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_pod_node_name\n    target_label: kubernetes_node\n  scrape_interval: 5m\n  scrape_timeout: 30s\n- honor_labels: true\n  job_name: prometheus-pushgateway\n  kubernetes_sd_configs:\n  - role: service\n  relabel_configs:\n  - action: keep\n    regex: pushgateway\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_probe\n- job_name: kubernetes-services\n  kubernetes_sd_configs:\n  - role: service\n  metrics_path: /probe\n  params:\n    module:\n    - http_2xx\n  relabel_configs:\n  - action: keep\n    regex: true\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_probe\n  - source_labels:\n    - __address__\n    target_label: __param_target\n  - replacement: blackbox\n    target_label: __address__\n  - source_labels:\n    - __param_target\n    target_label: instance\n  - action: labelmap\n    regex: __meta_kubernetes_service_label_(.+)\n  - source_labels:\n    - __meta_kubernetes_namespace\n    target_label: kubernetes_namespace\n  - source_labels:\n    - __meta_kubernetes_service_name\n    target_label: kubernetes_name\n- job_name: kubernetes-pods\n  kubernetes_sd_configs:\n  - role: pod\n  relabel_configs:\n  - action: keep\n    regex: true\n    source_labels:\n    - __meta_kubernetes_pod_annotation_prometheus_io_scrape\n  - action: replace\n    regex: (.+)\n    source_labels:\n    - __meta_kubernetes_pod_annotation_prometheus_io_path\n    target_label: __metrics_path__\n  - action: replace\n    regex: ([^:]+)(?::\\d+)?;(\\d+)\n    replacement: $1:$2\n    source_labels:\n    - __address__\n    - __meta_kubernetes_pod_annotation_prometheus_io_port\n    target_label: __address__\n  - action: labelmap\n    regex: __meta_kubernetes_pod_label_(.+)\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_namespace\n    target_label: kubernetes_namespace\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_pod_name\n    target_label: kubernetes_pod_name\n  - action: drop\n    regex: Pending|Succeeded|Failed\n    source_labels:\n    - __meta_kubernetes_pod_phase\n- job_name: kubernetes-pods-slow\n  kubernetes_sd_configs:\n  - role: pod\n  relabel_configs:\n  - action: keep\n    regex: true\n    source_labels:\n    - __meta_kubernetes_pod_annotation_prometheus_io_scrape_slow\n  - action: replace\n    regex: (.+)\n    source_labels:\n    - __meta_kubernetes_pod_annotation_prometheus_io_path\n    target_label: __metrics_path__\n  - action: replace\n    regex: ([^:]+)(?::\\d+)?;(\\d+)\n    replacement: $1:$2\n    source_labels:\n    - __address__\n    - __meta_kubernetes_pod_annotation_prometheus_io_port\n    target_label: __address__\n  - action: labelmap\n    regex: __meta_kubernetes_pod_label_(.+)\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_namespace\n    target_label: kubernetes_namespace\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_pod_name\n    target_label: kubernetes_pod_name\n  - action: drop\n    regex: Pending|Succeeded|Failed\n    source_labels:\n    - __meta_kubernetes_pod_phase\n  scrape_interval: 5m\n  scrape_timeout: 30s\n","recording_rules.yml":"{}\n","rules":"{}\n"},"kind":"ConfigMap","metadata":{"annotations":{},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"},"name":"prometheus","namespace":"istio-system"}}
+    labels:
+      app: prometheus
+      chart: prometheus-11.16.2
+      component: server
+      heritage: Helm
+      release: prometheus
+    name: prometheus
+    namespace: istio-system
+- apiVersion: rbac.authorization.k8s.io/v1
+  kind: ClusterRole
+  metadata:
+    annotations:
+      kubectl.kubernetes.io/last-applied-configuration: |
+        {"apiVersion":"rbac.authorization.k8s.io/v1","kind":"ClusterRole","metadata":{"annotations":{},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"},"name":"prometheus"},"rules":[{"apiGroups":[""],"resources":["nodes","nodes/proxy","nodes/metrics","services","endpoints","pods","ingresses","configmaps"],"verbs":["get","list","watch"]},{"apiGroups":["extensions","networking.k8s.io"],"resources":["ingresses/status","ingresses"],"verbs":["get","list","watch"]},{"nonResourceURLs":["/metrics"],"verbs":["get"]}]}
+    labels:
+      app: prometheus
+      chart: prometheus-11.16.2
+      component: server
+      heritage: Helm
+      release: prometheus
+    name: prometheus
+  rules:
+  - apiGroups:
+    - ""
+    resources:
+    - nodes
+    - nodes/proxy
+    - nodes/metrics
+    - services
+    - endpoints
+    - pods
+    - ingresses
+    - configmaps
+    verbs:
+    - get
+    - list
+    - watch
+  - apiGroups:
+    - extensions
+    - networking.k8s.io
+    resources:
+    - ingresses/status
+    - ingresses
+    verbs:
+    - get
+    - list
+    - watch
+  - nonResourceURLs:
+    - /metrics
+    verbs:
+    - get
+- apiVersion: rbac.authorization.k8s.io/v1
+  kind: ClusterRoleBinding
+  metadata:
+    annotations:
+      kubectl.kubernetes.io/last-applied-configuration: |
+        {"apiVersion":"rbac.authorization.k8s.io/v1","kind":"ClusterRoleBinding","metadata":{"annotations":{},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"},"name":"prometheus"},"roleRef":{"apiGroup":"rbac.authorization.k8s.io","kind":"ClusterRole","name":"prometheus"},"subjects":[{"kind":"ServiceAccount","name":"prometheus","namespace":"istio-system"}]}
+    labels:
+      app: prometheus
+      chart: prometheus-11.16.2
+      component: server
+      heritage: Helm
+      release: prometheus
+    name: prometheus
+  roleRef:
+    apiGroup: rbac.authorization.k8s.io
+    kind: ClusterRole
+    name: prometheus
+  subjects:
+  - kind: ServiceAccount
+    name: prometheus
+    namespace: istio-system
+- apiVersion: v1
+  kind: Service
+  metadata:
+    annotations:
+      kubectl.kubernetes.io/last-applied-configuration: |
+        {"apiVersion":"v1","kind":"Service","metadata":{"annotations":{},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"},"name":"prometheus","namespace":"istio-system"},"spec":{"ports":[{"name":"http","port":9090,"protocol":"TCP","targetPort":9090}],"selector":{"app":"prometheus","component":"server","release":"prometheus"},"sessionAffinity":"None","type":"ClusterIP"}}
+    labels:
+      app: prometheus
+      chart: prometheus-11.16.2
+      component: server
+      heritage: Helm
+      release: prometheus
+    name: prometheus
+    namespace: istio-system
+  spec:
+    ports:
+    - name: http
+      port: 9090
+      protocol: TCP
+      targetPort: 9090
+    selector:
+      app: prometheus
+      component: server
+      release: prometheus
+    sessionAffinity: None
+    type: ClusterIP
+- apiVersion: apps/v1
+  kind: Deployment
+  metadata:
+    annotations:
+      kubectl.kubernetes.io/last-applied-configuration: |
+        {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"},"name":"prometheus","namespace":"istio-system"},"spec":{"replicas":1,"selector":{"matchLabels":{"app":"prometheus","component":"server","release":"prometheus"}},"template":{"metadata":{"annotations":{"sidecar.istio.io/inject":"false"},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"}},"spec":{"containers":[{"args":["--volume-dir=/etc/config","--webhook-url=http://127.0.0.1:9090/-/reload"],"image":"jimmidyson/configmap-reload:v0.4.0","imagePullPolicy":"IfNotPresent","name":"prometheus-server-configmap-reload","resources":{},"volumeMounts":[{"mountPath":"/etc/config","name":"config-volume","readOnly":true}]},{"args":["--storage.tsdb.retention.time=15d","--config.file=/etc/config/prometheus.yml","--storage.tsdb.path=/data","--web.console.libraries=/etc/prometheus/console_libraries","--web.console.templates=/etc/prometheus/consoles","--web.enable-lifecycle"],"image":"prom/prometheus:v2.21.0","imagePullPolicy":"IfNotPresent","livenessProbe":{"failureThreshold":3,"httpGet":{"path":"/-/healthy","port":9090},"initialDelaySeconds":30,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":30},"name":"prometheus-server","ports":[{"containerPort":9090}],"readinessProbe":{"failureThreshold":3,"httpGet":{"path":"/-/ready","port":9090},"initialDelaySeconds":0,"periodSeconds":5,"successThreshold":1,"timeoutSeconds":30},"resources":{},"volumeMounts":[{"mountPath":"/etc/config","name":"config-volume"},{"mountPath":"/data","name":"storage-volume","subPath":""}]}],"securityContext":{"fsGroup":65534,"runAsGroup":65534,"runAsNonRoot":true,"runAsUser":65534},"serviceAccountName":"prometheus","terminationGracePeriodSeconds":300,"volumes":[{"configMap":{"name":"prometheus"},"name":"config-volume"},{"emptyDir":{},"name":"storage-volume"}]}}}}
+    labels:
+      app: prometheus
+      chart: prometheus-11.16.2
+      component: server
+      heritage: Helm
+      release: prometheus
+    name: prometheus
+    namespace: istio-system
+  spec:
+    replicas: 1
+    selector:
+      matchLabels:
+        app: prometheus
+        component: server
+        release: prometheus
+    template:
+      metadata:
+        annotations:
+          sidecar.istio.io/inject: "false"
+        labels:
+          app: prometheus
+          chart: prometheus-11.16.2
+          component: server
+          heritage: Helm
+          release: prometheus
+      spec:
+        containers:
+        - args:
+          - --volume-dir=/etc/config
+          - --webhook-url=http://127.0.0.1:9090/-/reload
+          image: jimmidyson/configmap-reload:v0.4.0
+          imagePullPolicy: IfNotPresent
+          name: prometheus-server-configmap-reload
+          resources: {}
+          volumeMounts:
+          - mountPath: /etc/config
+            name: config-volume
+            readOnly: true
+        - args:
+          - --storage.tsdb.retention.time=15d
+          - --config.file=/etc/config/prometheus.yml
+          - --storage.tsdb.path=/data
+          - --web.console.libraries=/etc/prometheus/console_libraries
+          - --web.console.templates=/etc/prometheus/consoles
+          - --web.enable-lifecycle
+          image: prom/prometheus:v2.21.0
+          imagePullPolicy: IfNotPresent
+          livenessProbe:
+            failureThreshold: 3
+            httpGet:
+              path: /-/healthy
+              port: 9090
+            initialDelaySeconds: 30
+            periodSeconds: 15
+            successThreshold: 1
+            timeoutSeconds: 30
+          name: prometheus-server
+          ports:
+          - containerPort: 9090
+          readinessProbe:
+            failureThreshold: 3
+            httpGet:
+              path: /-/ready
+              port: 9090
+            initialDelaySeconds: 0
+            periodSeconds: 5
+            successThreshold: 1
+            timeoutSeconds: 30
+          resources: {}
+          volumeMounts:
+          - mountPath: /etc/config
+            name: config-volume
+          - mountPath: /data
+            name: storage-volume
+            subPath: ""
+        securityContext:
+          fsGroup: 65534
+          runAsGroup: 65534
+          runAsNonRoot: true
+          runAsUser: 65534
+        serviceAccountName: prometheus
+        terminationGracePeriodSeconds: 300
+        volumes:
+        - configMap:
+            name: prometheus
+          name: config-volume
+        - emptyDir: {}
+          name: storage-volume
+kind: List
+metadata: {}
diff --git a/infrastructure/kustomization.yaml b/infrastructure/kustomization.yaml
index 97ad349..53b90aa 100644
--- a/infrastructure/kustomization.yaml
+++ b/infrastructure/kustomization.yaml
@@ -1,4 +1,4 @@
 apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
 resources:
- - appmesh
\ No newline at end of file
+ - istio
\ No newline at end of file
diff --git a/prometheus.yaml b/prometheus.yaml
new file mode 100644
index 0000000..615620d
--- /dev/null
+++ b/prometheus.yaml
@@ -0,0 +1,478 @@
+apiVersion: v1
+items:
+- apiVersion: v1
+  kind: ServiceAccount
+  metadata:
+    annotations:
+      kubectl.kubernetes.io/last-applied-configuration: |
+        {"apiVersion":"v1","kind":"ServiceAccount","metadata":{"annotations":{},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"},"name":"prometheus","namespace":"istio-system"}}
+    labels:
+      app: prometheus
+      chart: prometheus-11.16.2
+      component: server
+      heritage: Helm
+      release: prometheus
+    name: prometheus
+    namespace: istio-system
+- apiVersion: v1
+  data:
+    alerting_rules.yml: |
+      {}
+    alerts: |
+      {}
+    prometheus.yml: |
+      global:
+        evaluation_interval: 1m
+        scrape_interval: 15s
+        scrape_timeout: 10s
+      rule_files:
+      - /etc/config/recording_rules.yml
+      - /etc/config/alerting_rules.yml
+      - /etc/config/rules
+      - /etc/config/alerts
+      scrape_configs:
+      - job_name: prometheus
+        static_configs:
+        - targets:
+          - localhost:9090
+      - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
+        job_name: kubernetes-apiservers
+        kubernetes_sd_configs:
+        - role: endpoints
+        relabel_configs:
+        - action: keep
+          regex: default;kubernetes;https
+          source_labels:
+          - __meta_kubernetes_namespace
+          - __meta_kubernetes_service_name
+          - __meta_kubernetes_endpoint_port_name
+        scheme: https
+        tls_config:
+          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
+          insecure_skip_verify: true
+      - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
+        job_name: kubernetes-nodes
+        kubernetes_sd_configs:
+        - role: node
+        relabel_configs:
+        - action: labelmap
+          regex: __meta_kubernetes_node_label_(.+)
+        - replacement: kubernetes.default.svc:443
+          target_label: __address__
+        - regex: (.+)
+          replacement: /api/v1/nodes/$1/proxy/metrics
+          source_labels:
+          - __meta_kubernetes_node_name
+          target_label: __metrics_path__
+        scheme: https
+        tls_config:
+          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
+          insecure_skip_verify: true
+      - bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
+        job_name: kubernetes-nodes-cadvisor
+        kubernetes_sd_configs:
+        - role: node
+        relabel_configs:
+        - action: labelmap
+          regex: __meta_kubernetes_node_label_(.+)
+        - replacement: kubernetes.default.svc:443
+          target_label: __address__
+        - regex: (.+)
+          replacement: /api/v1/nodes/$1/proxy/metrics/cadvisor
+          source_labels:
+          - __meta_kubernetes_node_name
+          target_label: __metrics_path__
+        scheme: https
+        tls_config:
+          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
+          insecure_skip_verify: true
+      - job_name: kubernetes-service-endpoints
+        kubernetes_sd_configs:
+        - role: endpoints
+        relabel_configs:
+        - action: keep
+          regex: true
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_scrape
+        - action: replace
+          regex: (https?)
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_scheme
+          target_label: __scheme__
+        - action: replace
+          regex: (.+)
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_path
+          target_label: __metrics_path__
+        - action: replace
+          regex: ([^:]+)(?::\d+)?;(\d+)
+          replacement: $1:$2
+          source_labels:
+          - __address__
+          - __meta_kubernetes_service_annotation_prometheus_io_port
+          target_label: __address__
+        - action: labelmap
+          regex: __meta_kubernetes_service_label_(.+)
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_namespace
+          target_label: kubernetes_namespace
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_service_name
+          target_label: kubernetes_name
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_pod_node_name
+          target_label: kubernetes_node
+      - job_name: kubernetes-service-endpoints-slow
+        kubernetes_sd_configs:
+        - role: endpoints
+        relabel_configs:
+        - action: keep
+          regex: true
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_scrape_slow
+        - action: replace
+          regex: (https?)
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_scheme
+          target_label: __scheme__
+        - action: replace
+          regex: (.+)
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_path
+          target_label: __metrics_path__
+        - action: replace
+          regex: ([^:]+)(?::\d+)?;(\d+)
+          replacement: $1:$2
+          source_labels:
+          - __address__
+          - __meta_kubernetes_service_annotation_prometheus_io_port
+          target_label: __address__
+        - action: labelmap
+          regex: __meta_kubernetes_service_label_(.+)
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_namespace
+          target_label: kubernetes_namespace
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_service_name
+          target_label: kubernetes_name
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_pod_node_name
+          target_label: kubernetes_node
+        scrape_interval: 5m
+        scrape_timeout: 30s
+      - honor_labels: true
+        job_name: prometheus-pushgateway
+        kubernetes_sd_configs:
+        - role: service
+        relabel_configs:
+        - action: keep
+          regex: pushgateway
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_probe
+      - job_name: kubernetes-services
+        kubernetes_sd_configs:
+        - role: service
+        metrics_path: /probe
+        params:
+          module:
+          - http_2xx
+        relabel_configs:
+        - action: keep
+          regex: true
+          source_labels:
+          - __meta_kubernetes_service_annotation_prometheus_io_probe
+        - source_labels:
+          - __address__
+          target_label: __param_target
+        - replacement: blackbox
+          target_label: __address__
+        - source_labels:
+          - __param_target
+          target_label: instance
+        - action: labelmap
+          regex: __meta_kubernetes_service_label_(.+)
+        - source_labels:
+          - __meta_kubernetes_namespace
+          target_label: kubernetes_namespace
+        - source_labels:
+          - __meta_kubernetes_service_name
+          target_label: kubernetes_name
+      - job_name: kubernetes-pods
+        kubernetes_sd_configs:
+        - role: pod
+        relabel_configs:
+        - action: keep
+          regex: true
+          source_labels:
+          - __meta_kubernetes_pod_annotation_prometheus_io_scrape
+        - action: replace
+          regex: (.+)
+          source_labels:
+          - __meta_kubernetes_pod_annotation_prometheus_io_path
+          target_label: __metrics_path__
+        - action: replace
+          regex: ([^:]+)(?::\d+)?;(\d+)
+          replacement: $1:$2
+          source_labels:
+          - __address__
+          - __meta_kubernetes_pod_annotation_prometheus_io_port
+          target_label: __address__
+        - action: labelmap
+          regex: __meta_kubernetes_pod_label_(.+)
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_namespace
+          target_label: kubernetes_namespace
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_pod_name
+          target_label: kubernetes_pod_name
+        - action: drop
+          regex: Pending|Succeeded|Failed
+          source_labels:
+          - __meta_kubernetes_pod_phase
+      - job_name: kubernetes-pods-slow
+        kubernetes_sd_configs:
+        - role: pod
+        relabel_configs:
+        - action: keep
+          regex: true
+          source_labels:
+          - __meta_kubernetes_pod_annotation_prometheus_io_scrape_slow
+        - action: replace
+          regex: (.+)
+          source_labels:
+          - __meta_kubernetes_pod_annotation_prometheus_io_path
+          target_label: __metrics_path__
+        - action: replace
+          regex: ([^:]+)(?::\d+)?;(\d+)
+          replacement: $1:$2
+          source_labels:
+          - __address__
+          - __meta_kubernetes_pod_annotation_prometheus_io_port
+          target_label: __address__
+        - action: labelmap
+          regex: __meta_kubernetes_pod_label_(.+)
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_namespace
+          target_label: kubernetes_namespace
+        - action: replace
+          source_labels:
+          - __meta_kubernetes_pod_name
+          target_label: kubernetes_pod_name
+        - action: drop
+          regex: Pending|Succeeded|Failed
+          source_labels:
+          - __meta_kubernetes_pod_phase
+        scrape_interval: 5m
+        scrape_timeout: 30s
+    recording_rules.yml: |
+      {}
+    rules: |
+      {}
+  kind: ConfigMap
+  metadata:
+    annotations:
+      kubectl.kubernetes.io/last-applied-configuration: |
+        {"apiVersion":"v1","data":{"alerting_rules.yml":"{}\n","alerts":"{}\n","prometheus.yml":"global:\n  evaluation_interval: 1m\n  scrape_interval: 15s\n  scrape_timeout: 10s\nrule_files:\n- /etc/config/recording_rules.yml\n- /etc/config/alerting_rules.yml\n- /etc/config/rules\n- /etc/config/alerts\nscrape_configs:\n- job_name: prometheus\n  static_configs:\n  - targets:\n    - localhost:9090\n- bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n  job_name: kubernetes-apiservers\n  kubernetes_sd_configs:\n  - role: endpoints\n  relabel_configs:\n  - action: keep\n    regex: default;kubernetes;https\n    source_labels:\n    - __meta_kubernetes_namespace\n    - __meta_kubernetes_service_name\n    - __meta_kubernetes_endpoint_port_name\n  scheme: https\n  tls_config:\n    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n    insecure_skip_verify: true\n- bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n  job_name: kubernetes-nodes\n  kubernetes_sd_configs:\n  - role: node\n  relabel_configs:\n  - action: labelmap\n    regex: __meta_kubernetes_node_label_(.+)\n  - replacement: kubernetes.default.svc:443\n    target_label: __address__\n  - regex: (.+)\n    replacement: /api/v1/nodes/$1/proxy/metrics\n    source_labels:\n    - __meta_kubernetes_node_name\n    target_label: __metrics_path__\n  scheme: https\n  tls_config:\n    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n    insecure_skip_verify: true\n- bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\n  job_name: kubernetes-nodes-cadvisor\n  kubernetes_sd_configs:\n  - role: node\n  relabel_configs:\n  - action: labelmap\n    regex: __meta_kubernetes_node_label_(.+)\n  - replacement: kubernetes.default.svc:443\n    target_label: __address__\n  - regex: (.+)\n    replacement: /api/v1/nodes/$1/proxy/metrics/cadvisor\n    source_labels:\n    - __meta_kubernetes_node_name\n    target_label: __metrics_path__\n  scheme: https\n  tls_config:\n    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\n    insecure_skip_verify: true\n- job_name: kubernetes-service-endpoints\n  kubernetes_sd_configs:\n  - role: endpoints\n  relabel_configs:\n  - action: keep\n    regex: true\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_scrape\n  - action: replace\n    regex: (https?)\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_scheme\n    target_label: __scheme__\n  - action: replace\n    regex: (.+)\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_path\n    target_label: __metrics_path__\n  - action: replace\n    regex: ([^:]+)(?::\\d+)?;(\\d+)\n    replacement: $1:$2\n    source_labels:\n    - __address__\n    - __meta_kubernetes_service_annotation_prometheus_io_port\n    target_label: __address__\n  - action: labelmap\n    regex: __meta_kubernetes_service_label_(.+)\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_namespace\n    target_label: kubernetes_namespace\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_service_name\n    target_label: kubernetes_name\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_pod_node_name\n    target_label: kubernetes_node\n- job_name: kubernetes-service-endpoints-slow\n  kubernetes_sd_configs:\n  - role: endpoints\n  relabel_configs:\n  - action: keep\n    regex: true\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_scrape_slow\n  - action: replace\n    regex: (https?)\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_scheme\n    target_label: __scheme__\n  - action: replace\n    regex: (.+)\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_path\n    target_label: __metrics_path__\n  - action: replace\n    regex: ([^:]+)(?::\\d+)?;(\\d+)\n    replacement: $1:$2\n    source_labels:\n    - __address__\n    - __meta_kubernetes_service_annotation_prometheus_io_port\n    target_label: __address__\n  - action: labelmap\n    regex: __meta_kubernetes_service_label_(.+)\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_namespace\n    target_label: kubernetes_namespace\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_service_name\n    target_label: kubernetes_name\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_pod_node_name\n    target_label: kubernetes_node\n  scrape_interval: 5m\n  scrape_timeout: 30s\n- honor_labels: true\n  job_name: prometheus-pushgateway\n  kubernetes_sd_configs:\n  - role: service\n  relabel_configs:\n  - action: keep\n    regex: pushgateway\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_probe\n- job_name: kubernetes-services\n  kubernetes_sd_configs:\n  - role: service\n  metrics_path: /probe\n  params:\n    module:\n    - http_2xx\n  relabel_configs:\n  - action: keep\n    regex: true\n    source_labels:\n    - __meta_kubernetes_service_annotation_prometheus_io_probe\n  - source_labels:\n    - __address__\n    target_label: __param_target\n  - replacement: blackbox\n    target_label: __address__\n  - source_labels:\n    - __param_target\n    target_label: instance\n  - action: labelmap\n    regex: __meta_kubernetes_service_label_(.+)\n  - source_labels:\n    - __meta_kubernetes_namespace\n    target_label: kubernetes_namespace\n  - source_labels:\n    - __meta_kubernetes_service_name\n    target_label: kubernetes_name\n- job_name: kubernetes-pods\n  kubernetes_sd_configs:\n  - role: pod\n  relabel_configs:\n  - action: keep\n    regex: true\n    source_labels:\n    - __meta_kubernetes_pod_annotation_prometheus_io_scrape\n  - action: replace\n    regex: (.+)\n    source_labels:\n    - __meta_kubernetes_pod_annotation_prometheus_io_path\n    target_label: __metrics_path__\n  - action: replace\n    regex: ([^:]+)(?::\\d+)?;(\\d+)\n    replacement: $1:$2\n    source_labels:\n    - __address__\n    - __meta_kubernetes_pod_annotation_prometheus_io_port\n    target_label: __address__\n  - action: labelmap\n    regex: __meta_kubernetes_pod_label_(.+)\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_namespace\n    target_label: kubernetes_namespace\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_pod_name\n    target_label: kubernetes_pod_name\n  - action: drop\n    regex: Pending|Succeeded|Failed\n    source_labels:\n    - __meta_kubernetes_pod_phase\n- job_name: kubernetes-pods-slow\n  kubernetes_sd_configs:\n  - role: pod\n  relabel_configs:\n  - action: keep\n    regex: true\n    source_labels:\n    - __meta_kubernetes_pod_annotation_prometheus_io_scrape_slow\n  - action: replace\n    regex: (.+)\n    source_labels:\n    - __meta_kubernetes_pod_annotation_prometheus_io_path\n    target_label: __metrics_path__\n  - action: replace\n    regex: ([^:]+)(?::\\d+)?;(\\d+)\n    replacement: $1:$2\n    source_labels:\n    - __address__\n    - __meta_kubernetes_pod_annotation_prometheus_io_port\n    target_label: __address__\n  - action: labelmap\n    regex: __meta_kubernetes_pod_label_(.+)\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_namespace\n    target_label: kubernetes_namespace\n  - action: replace\n    source_labels:\n    - __meta_kubernetes_pod_name\n    target_label: kubernetes_pod_name\n  - action: drop\n    regex: Pending|Succeeded|Failed\n    source_labels:\n    - __meta_kubernetes_pod_phase\n  scrape_interval: 5m\n  scrape_timeout: 30s\n","recording_rules.yml":"{}\n","rules":"{}\n"},"kind":"ConfigMap","metadata":{"annotations":{},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"},"name":"prometheus","namespace":"istio-system"}}
+    labels:
+      app: prometheus
+      chart: prometheus-11.16.2
+      component: server
+      heritage: Helm
+      release: prometheus
+    name: prometheus
+    namespace: istio-system
+- apiVersion: rbac.authorization.k8s.io/v1
+  kind: ClusterRole
+  metadata:
+    annotations:
+      kubectl.kubernetes.io/last-applied-configuration: |
+        {"apiVersion":"rbac.authorization.k8s.io/v1","kind":"ClusterRole","metadata":{"annotations":{},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"},"name":"prometheus"},"rules":[{"apiGroups":[""],"resources":["nodes","nodes/proxy","nodes/metrics","services","endpoints","pods","ingresses","configmaps"],"verbs":["get","list","watch"]},{"apiGroups":["extensions","networking.k8s.io"],"resources":["ingresses/status","ingresses"],"verbs":["get","list","watch"]},{"nonResourceURLs":["/metrics"],"verbs":["get"]}]}
+    labels:
+      app: prometheus
+      chart: prometheus-11.16.2
+      component: server
+      heritage: Helm
+      release: prometheus
+    name: prometheus
+  rules:
+  - apiGroups:
+    - ""
+    resources:
+    - nodes
+    - nodes/proxy
+    - nodes/metrics
+    - services
+    - endpoints
+    - pods
+    - ingresses
+    - configmaps
+    verbs:
+    - get
+    - list
+    - watch
+  - apiGroups:
+    - extensions
+    - networking.k8s.io
+    resources:
+    - ingresses/status
+    - ingresses
+    verbs:
+    - get
+    - list
+    - watch
+  - nonResourceURLs:
+    - /metrics
+    verbs:
+    - get
+- apiVersion: rbac.authorization.k8s.io/v1
+  kind: ClusterRoleBinding
+  metadata:
+    annotations:
+      kubectl.kubernetes.io/last-applied-configuration: |
+        {"apiVersion":"rbac.authorization.k8s.io/v1","kind":"ClusterRoleBinding","metadata":{"annotations":{},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"},"name":"prometheus"},"roleRef":{"apiGroup":"rbac.authorization.k8s.io","kind":"ClusterRole","name":"prometheus"},"subjects":[{"kind":"ServiceAccount","name":"prometheus","namespace":"istio-system"}]}
+    labels:
+      app: prometheus
+      chart: prometheus-11.16.2
+      component: server
+      heritage: Helm
+      release: prometheus
+    name: prometheus
+  roleRef:
+    apiGroup: rbac.authorization.k8s.io
+    kind: ClusterRole
+    name: prometheus
+  subjects:
+  - kind: ServiceAccount
+    name: prometheus
+    namespace: istio-system
+- apiVersion: v1
+  kind: Service
+  metadata:
+    annotations:
+      kubectl.kubernetes.io/last-applied-configuration: |
+        {"apiVersion":"v1","kind":"Service","metadata":{"annotations":{},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"},"name":"prometheus","namespace":"istio-system"},"spec":{"ports":[{"name":"http","port":9090,"protocol":"TCP","targetPort":9090}],"selector":{"app":"prometheus","component":"server","release":"prometheus"},"sessionAffinity":"None","type":"ClusterIP"}}
+    labels:
+      app: prometheus
+      chart: prometheus-11.16.2
+      component: server
+      heritage: Helm
+      release: prometheus
+    name: prometheus
+    namespace: istio-system
+  spec:
+    ports:
+    - name: http
+      port: 9090
+      protocol: TCP
+      targetPort: 9090
+    selector:
+      app: prometheus
+      component: server
+      release: prometheus
+    sessionAffinity: None
+    type: ClusterIP
+- apiVersion: apps/v1
+  kind: Deployment
+  metadata:
+    annotations:
+      kubectl.kubernetes.io/last-applied-configuration: |
+        {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"},"name":"prometheus","namespace":"istio-system"},"spec":{"replicas":1,"selector":{"matchLabels":{"app":"prometheus","component":"server","release":"prometheus"}},"template":{"metadata":{"annotations":{"sidecar.istio.io/inject":"false"},"labels":{"app":"prometheus","chart":"prometheus-11.16.2","component":"server","heritage":"Helm","release":"prometheus"}},"spec":{"containers":[{"args":["--volume-dir=/etc/config","--webhook-url=http://127.0.0.1:9090/-/reload"],"image":"jimmidyson/configmap-reload:v0.4.0","imagePullPolicy":"IfNotPresent","name":"prometheus-server-configmap-reload","resources":{},"volumeMounts":[{"mountPath":"/etc/config","name":"config-volume","readOnly":true}]},{"args":["--storage.tsdb.retention.time=15d","--config.file=/etc/config/prometheus.yml","--storage.tsdb.path=/data","--web.console.libraries=/etc/prometheus/console_libraries","--web.console.templates=/etc/prometheus/consoles","--web.enable-lifecycle"],"image":"prom/prometheus:v2.21.0","imagePullPolicy":"IfNotPresent","livenessProbe":{"failureThreshold":3,"httpGet":{"path":"/-/healthy","port":9090},"initialDelaySeconds":30,"periodSeconds":15,"successThreshold":1,"timeoutSeconds":30},"name":"prometheus-server","ports":[{"containerPort":9090}],"readinessProbe":{"failureThreshold":3,"httpGet":{"path":"/-/ready","port":9090},"initialDelaySeconds":0,"periodSeconds":5,"successThreshold":1,"timeoutSeconds":30},"resources":{},"volumeMounts":[{"mountPath":"/etc/config","name":"config-volume"},{"mountPath":"/data","name":"storage-volume","subPath":""}]}],"securityContext":{"fsGroup":65534,"runAsGroup":65534,"runAsNonRoot":true,"runAsUser":65534},"serviceAccountName":"prometheus","terminationGracePeriodSeconds":300,"volumes":[{"configMap":{"name":"prometheus"},"name":"config-volume"},{"emptyDir":{},"name":"storage-volume"}]}}}}
+    labels:
+      app: prometheus
+      chart: prometheus-11.16.2
+      component: server
+      heritage: Helm
+      release: prometheus
+    name: prometheus
+    namespace: istio-system
+  spec:
+    replicas: 1
+    selector:
+      matchLabels:
+        app: prometheus
+        component: server
+        release: prometheus
+    template:
+      metadata:
+        annotations:
+          sidecar.istio.io/inject: "false"
+        labels:
+          app: prometheus
+          chart: prometheus-11.16.2
+          component: server
+          heritage: Helm
+          release: prometheus
+      spec:
+        containers:
+        - args:
+          - --volume-dir=/etc/config
+          - --webhook-url=http://127.0.0.1:9090/-/reload
+          image: jimmidyson/configmap-reload:v0.4.0
+          imagePullPolicy: IfNotPresent
+          name: prometheus-server-configmap-reload
+          resources: {}
+          volumeMounts:
+          - mountPath: /etc/config
+            name: config-volume
+            readOnly: true
+        - args:
+          - --storage.tsdb.retention.time=15d
+          - --config.file=/etc/config/prometheus.yml
+          - --storage.tsdb.path=/data
+          - --web.console.libraries=/etc/prometheus/console_libraries
+          - --web.console.templates=/etc/prometheus/consoles
+          - --web.enable-lifecycle
+          image: prom/prometheus:v2.21.0
+          imagePullPolicy: IfNotPresent
+          livenessProbe:
+            failureThreshold: 3
+            httpGet:
+              path: /-/healthy
+              port: 9090
+            initialDelaySeconds: 30
+            periodSeconds: 15
+            successThreshold: 1
+            timeoutSeconds: 30
+          name: prometheus-server
+          ports:
+          - containerPort: 9090
+          readinessProbe:
+            failureThreshold: 3
+            httpGet:
+              path: /-/ready
+              port: 9090
+            initialDelaySeconds: 0
+            periodSeconds: 5
+            successThreshold: 1
+            timeoutSeconds: 30
+          resources: {}
+          volumeMounts:
+          - mountPath: /etc/config
+            name: config-volume
+          - mountPath: /data
+            name: storage-volume
+            subPath: ""
+        securityContext:
+          fsGroup: 65534
+          runAsGroup: 65534
+          runAsNonRoot: true
+          runAsUser: 65534
+        serviceAccountName: prometheus
+        terminationGracePeriodSeconds: 300
+        volumes:
+        - configMap:
+            name: prometheus
+          name: config-volume
+        - emptyDir: {}
+          name: storage-volume
+kind: List
+metadata: {}
-- 
2.27.0

From 737e50c250c04c3892c20d7dbc856b5895379c91 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 03:03:15 -0400
Subject: [PATCH] Add app mesh config yaml

---
 infrastructure/istio/flagger.yaml       | 11 ++++++++++-
 infrastructure/istio/istio-repo.yaml    |  8 --------
 infrastructure/istio/kustomization.yaml |  3 ++-
 3 files changed, 12 insertions(+), 10 deletions(-)
 delete mode 100644 infrastructure/istio/istio-repo.yaml

diff --git a/infrastructure/istio/flagger.yaml b/infrastructure/istio/flagger.yaml
index e79117b..e570450 100644
--- a/infrastructure/istio/flagger.yaml
+++ b/infrastructure/istio/flagger.yaml
@@ -1,3 +1,12 @@
+apiVersion: source.toolkit.fluxcd.io/v1beta1
+kind: HelmRepository
+metadata:
+  name: flagger
+  namespace: istio-system
+spec:
+  interval: 1m
+  url: https://flagger.app
+---  
 apiVersion: helm.toolkit.fluxcd.io/v2beta1
 kind: HelmRelease
 metadata:
@@ -17,5 +26,5 @@ spec:
     remediation:
       retries: 3
   values:
-    meshProvider:istio
+    meshProvider: istio
     metricsServer: http://prometheus.istio-system.svc.cluster.local:9090
\ No newline at end of file
diff --git a/infrastructure/istio/istio-repo.yaml b/infrastructure/istio/istio-repo.yaml
deleted file mode 100644
index 47c5804..0000000
--- a/infrastructure/istio/istio-repo.yaml
+++ /dev/null
@@ -1,8 +0,0 @@
-apiVersion: source.toolkit.fluxcd.io/v1beta1
-kind: HelmRepository
-metadata:
-  name: flagger
-  namespace: istio-system
-spec:
-  interval: 1m
-  url: https://flagger.app
\ No newline at end of file
diff --git a/infrastructure/istio/kustomization.yaml b/infrastructure/istio/kustomization.yaml
index 72ccf7c..78b5325 100644
--- a/infrastructure/istio/kustomization.yaml
+++ b/infrastructure/istio/kustomization.yaml
@@ -3,4 +3,5 @@ kind: Kustomization
 resources:
   - namespace.yaml
   - istio.yaml
-  - prometheus.yaml
\ No newline at end of file
+  - prometheus.yaml
+  - flagger.yaml
\ No newline at end of file
-- 
2.27.0

From c3077678f47df6e19b172ab9f40e4f8bb80fb45c Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 03:05:21 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/gateway.yaml | 15 +++++++++++++++
 1 file changed, 15 insertions(+)
 create mode 100644 app/gateway.yaml

diff --git a/app/gateway.yaml b/app/gateway.yaml
new file mode 100644
index 0000000..9b46088
--- /dev/null
+++ b/app/gateway.yaml
@@ -0,0 +1,15 @@
+apiVersion: networking.istio.io/v1alpha3
+kind: Gateway
+metadata:
+  name: public-gateway
+  namespace: istio-system
+spec:
+  selector:
+    istio: ingressgateway
+  servers:
+    - port:
+        number: 80
+        name: http
+        protocol: HTTP
+      hosts:
+        - "*"
\ No newline at end of file
-- 
2.27.0

From e20623a0db75c23c384ff1f02b64bd20658433a8 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 03:08:16 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/kustomization.yaml          |  1 +
 app/podinfo/podinfo-canary.yaml | 61 ++++++++++++++++++---------------
 2 files changed, 35 insertions(+), 27 deletions(-)

diff --git a/app/kustomization.yaml b/app/kustomization.yaml
index 98c6729..a0f3cfd 100644
--- a/app/kustomization.yaml
+++ b/app/kustomization.yaml
@@ -2,4 +2,5 @@ apiVersion: kustomize.config.k8s.io/v1beta1
 kind: Kustomization
 resources:
  - namespace.yaml
+ - gateway.yaml
  - podinfo
\ No newline at end of file
diff --git a/app/podinfo/podinfo-canary.yaml b/app/podinfo/podinfo-canary.yaml
index 0405433..aceae14 100644
--- a/app/podinfo/podinfo-canary.yaml
+++ b/app/podinfo/podinfo-canary.yaml
@@ -2,62 +2,69 @@ apiVersion: flagger.app/v1beta1
 kind: Canary
 metadata:
   name: podinfo
+  namespace: test
 spec:
-  provider: appmesh:v1beta2
   targetRef:
     apiVersion: apps/v1
     kind: Deployment
     name: podinfo
+  progressDeadlineSeconds: 60
+
   autoscalerRef:
     apiVersion: autoscaling/v2beta2
     kind: HorizontalPodAutoscaler
     name: podinfo
-  progressDeadlineSeconds: 60
   service:
     port: 9898
-    timeout: 15s
+    targetPort: 9898
+    gateways:
+    - public-gateway.istio-system.svc.cluster.local
+    hosts:
+    - "*"
+
+    trafficPolicy:
+      tls:
+        mode: DISABLE
+
     retries:
       attempts: 3
-      perTryTimeout: 5s
-      retryOn: "gateway-error,client-error,stream-error"
-    match:
-      - uri:
-          prefix: /
-    rewrite:
-      uri: /
-  # define the canary analysis timing and KPIs
+      perTryTimeout: 1s
+      retryOn: "gateway-error,connect-failure,refused-stream"
   analysis:
     # schedule interval (default 60s)
-    interval: 5s
+    interval: 1m
     # max number of failed metric checks before rollback
     threshold: 5
     # max traffic percentage routed to canary
     # percentage (0-100)
-    maxWeight: 30
+    maxWeight: 50
     # canary increment step
     # percentage (0-100)
-    stepWeight: 5
-    # App Mesh Prometheus checks
+    stepWeight: 10
     metrics:
-      - name: request-success-rate
-        thresholdRange:
-          min: 99
-        interval: 5s
-      - name: request-duration
-        thresholdRange:
-          max: 500
-        interval: 5s
+    - name: request-success-rate
+      # minimum req success rate (non 5xx responses)
+      # percentage (0-100)
+      thresholdRange:
+        min: 99
+      interval: 1m
+    - name: request-duration
+      # maximum req duration P99
+      # milliseconds
+      thresholdRange:
+        max: 500
+      interval: 30s
     # testing (optional)
     # webhooks:
     #   - name: acceptance-test
     #     type: pre-rollout
-    #     url: http://flagger-loadtester.$(NAMESPACE)/
+    #     url: http://flagger-loadtester.test/
     #     timeout: 30s
     #     metadata:
     #       type: bash
-    #       cmd: "curl -sd 'test' http://podinfo-canary.$(NAMESPACE):9898/token | grep token"
+    #       cmd: "curl -sd 'test' http://podinfo-canary:9898/token | grep token"
     #   - name: load-test
-    #     url: http://flagger-loadtester.$(NAMESPACE)/
+    #     url: http://flagger-loadtester.test/
     #     timeout: 5s
     #     metadata:
-    #       cmd: "hey -z 1m -q 10 -c 2 http://podinfo-canary.$(NAMESPACE):9898/"
\ No newline at end of file
+    #       cmd: "hey -z 1m -q 10 -c 2 http://podinfo-canary.test:9898/"
\ No newline at end of file
-- 
2.27.0

From ec95da7708b53d9d898cf6861cecaafc34cc2425 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 03:14:06 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/podinfo-canary.yaml |  4 ----
 app/podinfo/podinfo.yaml        | 21 ---------------------
 2 files changed, 25 deletions(-)

diff --git a/app/podinfo/podinfo-canary.yaml b/app/podinfo/podinfo-canary.yaml
index aceae14..8bfc1be 100644
--- a/app/podinfo/podinfo-canary.yaml
+++ b/app/podinfo/podinfo-canary.yaml
@@ -10,10 +10,6 @@ spec:
     name: podinfo
   progressDeadlineSeconds: 60
 
-  autoscalerRef:
-    apiVersion: autoscaling/v2beta2
-    kind: HorizontalPodAutoscaler
-    name: podinfo
   service:
     port: 9898
     targetPort: 9898
diff --git a/app/podinfo/podinfo.yaml b/app/podinfo/podinfo.yaml
index c7d64c4..b84cb4f 100644
--- a/app/podinfo/podinfo.yaml
+++ b/app/podinfo/podinfo.yaml
@@ -53,24 +53,3 @@ spec:
             - localhost:9898/readyz
           initialDelaySeconds: 5
           timeoutSeconds: 5
-# ---
-# apiVersion: autoscaling/v2beta2
-# kind: HorizontalPodAutoscaler
-# metadata:
-#   name: podinfo
-# spec:
-#   scaleTargetRef:
-#     apiVersion: apps/v1
-#     kind: Deployment
-#     name: podinfo
-#   minReplicas: 1
-#   maxReplicas: 4
-#   metrics:
-#     - type: Resource
-#       resource:
-#         name: cpu
-#         target:
-#           type: Utilization
-#           # scale up if usage is above
-#           # 99% of the requested CPU (100m)
-#           averageUtilization: 99
\ No newline at end of file
-- 
2.27.0

From 54244fee83b47c61207f46190bc6c0a74989ed5f Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 03:28:33 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/podinfo-canary.yaml | 11 ++++++++---
 1 file changed, 8 insertions(+), 3 deletions(-)

diff --git a/app/podinfo/podinfo-canary.yaml b/app/podinfo/podinfo-canary.yaml
index 8bfc1be..1ef436e 100644
--- a/app/podinfo/podinfo-canary.yaml
+++ b/app/podinfo/podinfo-canary.yaml
@@ -17,6 +17,11 @@ spec:
     - public-gateway.istio-system.svc.cluster.local
     hosts:
     - "*"
+    match:
+      - uri:
+          prefix: /
+    rewrite:
+      uri: /
 
     trafficPolicy:
       tls:
@@ -28,7 +33,7 @@ spec:
       retryOn: "gateway-error,connect-failure,refused-stream"
   analysis:
     # schedule interval (default 60s)
-    interval: 1m
+    interval: 5s
     # max number of failed metric checks before rollback
     threshold: 5
     # max traffic percentage routed to canary
@@ -43,13 +48,13 @@ spec:
       # percentage (0-100)
       thresholdRange:
         min: 99
-      interval: 1m
+      interval: 5s
     - name: request-duration
       # maximum req duration P99
       # milliseconds
       thresholdRange:
         max: 500
-      interval: 30s
+      interval: 5s
     # testing (optional)
     # webhooks:
     #   - name: acceptance-test
-- 
2.27.0

From 5526affbf02860ba99457c337967c3962a9b0d3c Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 03:39:08 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/podinfo-canary.yaml | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/app/podinfo/podinfo-canary.yaml b/app/podinfo/podinfo-canary.yaml
index 1ef436e..42c8747 100644
--- a/app/podinfo/podinfo-canary.yaml
+++ b/app/podinfo/podinfo-canary.yaml
@@ -48,13 +48,13 @@ spec:
       # percentage (0-100)
       thresholdRange:
         min: 99
-      interval: 5s
+      interval: 10s
     - name: request-duration
       # maximum req duration P99
       # milliseconds
       thresholdRange:
         max: 500
-      interval: 5s
+      interval: 10s
     # testing (optional)
     # webhooks:
     #   - name: acceptance-test
-- 
2.27.0

From a1b7e7518eb3d7fd9650d64dd2db7b31b4759196 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 07:34:45 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/kustomization.yaml                      |    3 +-
 app/podinfo/podinfo-canary.yaml             |   26 +-
 app/podinfo/podinfo.yaml                    |    2 +-
 app/tester/deployment.yaml                  |   61 +
 app/tester/kustomization.yaml               |    5 +
 app/tester/service.yaml                     |   15 +
 clusters/dev/flux-system/image_sync.yaml    |   41 +
 clusters/dev/flux-system/kustomization.yaml |    3 +
 clusters/dev/flux-system/notification.yaml  |   26 +
 infrastructure/istio/istio.yaml             | 9012 +------------------
 10 files changed, 372 insertions(+), 8822 deletions(-)
 create mode 100644 app/tester/deployment.yaml
 create mode 100644 app/tester/kustomization.yaml
 create mode 100644 app/tester/service.yaml
 create mode 100644 clusters/dev/flux-system/image_sync.yaml
 create mode 100644 clusters/dev/flux-system/notification.yaml

diff --git a/app/kustomization.yaml b/app/kustomization.yaml
index a0f3cfd..f15f239 100644
--- a/app/kustomization.yaml
+++ b/app/kustomization.yaml
@@ -3,4 +3,5 @@ kind: Kustomization
 resources:
  - namespace.yaml
  - gateway.yaml
- - podinfo
\ No newline at end of file
+ - podinfo
+ - tester
\ No newline at end of file
diff --git a/app/podinfo/podinfo-canary.yaml b/app/podinfo/podinfo-canary.yaml
index 42c8747..cbe81af 100644
--- a/app/podinfo/podinfo-canary.yaml
+++ b/app/podinfo/podinfo-canary.yaml
@@ -56,16 +56,16 @@ spec:
         max: 500
       interval: 10s
     # testing (optional)
-    # webhooks:
-    #   - name: acceptance-test
-    #     type: pre-rollout
-    #     url: http://flagger-loadtester.test/
-    #     timeout: 30s
-    #     metadata:
-    #       type: bash
-    #       cmd: "curl -sd 'test' http://podinfo-canary:9898/token | grep token"
-    #   - name: load-test
-    #     url: http://flagger-loadtester.test/
-    #     timeout: 5s
-    #     metadata:
-    #       cmd: "hey -z 1m -q 10 -c 2 http://podinfo-canary.test:9898/"
\ No newline at end of file
+    webhooks:
+      - name: acceptance-test
+        type: pre-rollout
+        url: http://flagger-loadtester.test/
+        timeout: 30s
+        metadata:
+          type: bash
+          cmd: "curl -sd 'test' http://podinfo-canary.dev:9898/token | grep token"
+      - name: load-test
+        url: http://flagger-loadtester.test/
+        timeout: 5s
+        metadata:
+          cmd: "hey -z 1m -q 10 -c 2 http://podinfo-canary.dev:9898/"
\ No newline at end of file
diff --git a/app/podinfo/podinfo.yaml b/app/podinfo/podinfo.yaml
index b84cb4f..2dce128 100644
--- a/app/podinfo/podinfo.yaml
+++ b/app/podinfo/podinfo.yaml
@@ -16,7 +16,7 @@ spec:
     spec:
       containers:
       - name: podinfod
-        image: ghcr.io/stefanprodan/podinfo:5.0.0 # {"$imagepolicy": "flux-system:podinfo"}
+        image: ghcr.io/stefanprodan/podinfo:3.0.0 # {"$imagepolicy": "flux-system:podinfo"}
         imagePullPolicy: IfNotPresent
         ports:
         - name: http
diff --git a/app/tester/deployment.yaml b/app/tester/deployment.yaml
new file mode 100644
index 0000000..5dfd1e0
--- /dev/null
+++ b/app/tester/deployment.yaml
@@ -0,0 +1,61 @@
+apiVersion: apps/v1
+kind: Deployment
+metadata:
+  name: flagger-loadtester
+  labels:
+    app: flagger-loadtester
+spec:
+  selector:
+    matchLabels:
+      app: flagger-loadtester
+  template:
+    metadata:
+      labels:
+        app: flagger-loadtester
+      annotations:
+        prometheus.io/scrape: "true"
+        prometheus.io/port: "8080"
+        openservicemesh.io/inbound-port-exclusion-list: "80, 8080"
+    spec:
+      containers:
+        - name: loadtester
+          image: ghcr.io/fluxcd/flagger-loadtester:0.18.0
+          imagePullPolicy: IfNotPresent
+          ports:
+            - name: http
+              containerPort: 8080
+          command:
+            - ./loadtester
+            - -port=8080
+            - -log-level=info
+            - -timeout=1h
+          livenessProbe:
+            exec:
+              command:
+                - wget
+                - --quiet
+                - --tries=1
+                - --timeout=4
+                - --spider
+                - http://localhost:8080/healthz
+            timeoutSeconds: 5
+          readinessProbe:
+            exec:
+              command:
+                - wget
+                - --quiet
+                - --tries=1
+                - --timeout=4
+                - --spider
+                - http://localhost:8080/healthz
+            timeoutSeconds: 5
+          resources:
+            limits:
+              memory: "512Mi"
+              cpu: "1000m"
+            requests:
+              memory: "32Mi"
+              cpu: "10m"
+          securityContext:
+            readOnlyRootFilesystem: true
+            runAsUser: 10001
diff --git a/app/tester/kustomization.yaml b/app/tester/kustomization.yaml
new file mode 100644
index 0000000..70e99cd
--- /dev/null
+++ b/app/tester/kustomization.yaml
@@ -0,0 +1,5 @@
+namespace: test
+resources:
+  - service.yaml
+  - deployment.yaml
+
diff --git a/app/tester/service.yaml b/app/tester/service.yaml
new file mode 100644
index 0000000..0093b31
--- /dev/null
+++ b/app/tester/service.yaml
@@ -0,0 +1,15 @@
+apiVersion: v1
+kind: Service
+metadata:
+  name: flagger-loadtester
+  labels:
+    app: flagger-loadtester
+spec:
+  type: ClusterIP
+  selector:
+    app: flagger-loadtester
+  ports:
+    - name: http
+      port: 80
+      protocol: TCP
+      targetPort: http
diff --git a/clusters/dev/flux-system/image_sync.yaml b/clusters/dev/flux-system/image_sync.yaml
new file mode 100644
index 0000000..00cbae2
--- /dev/null
+++ b/clusters/dev/flux-system/image_sync.yaml
@@ -0,0 +1,41 @@
+apiVersion: image.toolkit.fluxcd.io/v1alpha1
+kind: ImageRepository
+metadata:
+  name: podinfo
+  namespace: flux-system
+spec:
+  image: ghcr.io/stefanprodan/podinfo
+  interval: 1m0s
+---
+apiVersion: image.toolkit.fluxcd.io/v1alpha1
+kind: ImagePolicy
+metadata:
+  name: podinfo
+  namespace: flux-system
+spec:
+  imageRepositoryRef:
+    name: podinfo
+  policy:
+    semver:
+      range: 5.0.x  
+---
+apiVersion: image.toolkit.fluxcd.io/v1alpha1
+kind: ImageUpdateAutomation
+metadata:
+  name: flux-system
+  namespace: flux-system
+spec:
+  checkout:
+    branch: main
+    gitRepositoryRef:
+      name: flux-system
+  commit:
+    authorEmail: fluxcdbot@users.noreply.github.com
+    authorName: fluxcdbot
+    messageTemplate: '{{range .Updated.Images}}{{println .}}{{end}}'
+  interval: 1m0s
+  push:
+    branch: main
+  update:
+    path: ./
+    strategy: Setters      
\ No newline at end of file
diff --git a/clusters/dev/flux-system/kustomization.yaml b/clusters/dev/flux-system/kustomization.yaml
index 705bb94..c4858c3 100644
--- a/clusters/dev/flux-system/kustomization.yaml
+++ b/clusters/dev/flux-system/kustomization.yaml
@@ -3,5 +3,8 @@ kind: Kustomization
 resources:
 - gotk-components.yaml
 - gotk-sync.yaml
+- image_sync.yaml
+- notification.yaml
 - infrastructure.yaml
 - app.yaml
+
diff --git a/clusters/dev/flux-system/notification.yaml b/clusters/dev/flux-system/notification.yaml
new file mode 100644
index 0000000..6ed2626
--- /dev/null
+++ b/clusters/dev/flux-system/notification.yaml
@@ -0,0 +1,26 @@
+apiVersion: notification.toolkit.fluxcd.io/v1beta1
+kind: Provider
+metadata:
+  name: discord
+  namespace: flux-system
+spec:
+  type: discord
+  channel: deployments
+  username: flux-demo-bot
+  secretRef:
+    name: discord-url
+---
+apiVersion: notification.toolkit.fluxcd.io/v1beta1
+kind: Alert
+metadata:
+  name: deployment-notification
+  namespace: flux-system
+spec:
+  providerRef:
+    name: discord
+  eventSeverity: info
+  eventSources:
+    - kind: GitRepository
+      name: '*'
+    - kind: Kustomization
+      name: '*'     
\ No newline at end of file
diff --git a/infrastructure/istio/istio.yaml b/infrastructure/istio/istio.yaml
index 81ee60d..7a4a7a5 100644
--- a/infrastructure/istio/istio.yaml
+++ b/infrastructure/istio/istio.yaml
@@ -1,5822 +1,34 @@
-kind: CustomResourceDefinition
-apiVersion: apiextensions.k8s.io/v1
-metadata:
-  name: adapters.config.istio.io
-  labels:
-    app: mixer
-    package: adapter
-    istio: mixer-adapter
-    chart: istio
-    heritage: Tiller
-    release: istio
-  annotations:
-    "helm.sh/resource-policy": keep
-spec:
-  group: config.istio.io
-  names:
-    kind: adapter
-    plural: adapters
-    singular: adapter
-    categories:
-      - istio-io
-      - policy-istio-io
-  scope: Namespaced
-  versions:
-    - name: v1alpha2
-      schema:
-        openAPIV3Schema:
-          properties:
-            spec:
-              x-kubernetes-preserve-unknown-fields: true
-              type: object
-            status:
-              x-kubernetes-preserve-unknown-fields: true
-              type: object
-          type: object
-      served: true
-      storage: true
-      subresources:
-        status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: mixer
-    chart: istio
-    heritage: Tiller
-    istio: core
-    package: istio.io.mixer
-    release: istio
-  name: attributemanifests.config.istio.io
-spec:
-  group: config.istio.io
-  names:
-    categories:
-    - istio-io
-    - policy-istio-io
-    kind: attributemanifest
-    listKind: attributemanifestList
-    plural: attributemanifests
-    singular: attributemanifest
-  scope: Namespaced
-  versions:
-  - name: v1alpha2
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Describes the rules used to configure Mixer''s policy and
-              telemetry features. See more details at: https://istio.io/docs/reference/config/policy-and-telemetry/istio.policy.v1beta1.html'
-            properties:
-              attributes:
-                additionalProperties:
-                  properties:
-                    description:
-                      description: A human-readable description of the attribute's
-                        purpose.
-                      format: string
-                      type: string
-                    valueType:
-                      description: The type of data carried by this attribute.
-                      enum:
-                      - VALUE_TYPE_UNSPECIFIED
-                      - STRING
-                      - INT64
-                      - DOUBLE
-                      - BOOL
-                      - TIMESTAMP
-                      - IP_ADDRESS
-                      - EMAIL_ADDRESS
-                      - URI
-                      - DNS_NAME
-                      - DURATION
-                      - STRING_MAP
-                      type: string
-                  type: object
-                description: The set of attributes this Istio component will be responsible
-                  for producing at runtime.
-                type: object
-              name:
-                description: Name of the component producing these attributes.
-                format: string
-                type: string
-              revision:
-                description: The revision of this document.
-                format: string
-                type: string
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: istio-pilot
-    chart: istio
-    heritage: Tiller
-    istio: security
-    release: istio
-  name: authorizationpolicies.security.istio.io
-spec:
-  group: security.istio.io
-  names:
-    categories:
-    - istio-io
-    - security-istio-io
-    kind: AuthorizationPolicy
-    listKind: AuthorizationPolicyList
-    plural: authorizationpolicies
-    singular: authorizationpolicy
-  scope: Namespaced
-  versions:
-  - name: v1beta1
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Configuration for access control on workloads. See more
-              details at: https://istio.io/docs/reference/config/security/authorization-policy.html'
-            properties:
-              action:
-                description: Optional.
-                enum:
-                - ALLOW
-                - DENY
-                - AUDIT
-                type: string
-              rules:
-                description: Optional.
-                items:
-                  properties:
-                    from:
-                      description: Optional.
-                      items:
-                        properties:
-                          source:
-                            description: Source specifies the source of a request.
-                            properties:
-                              ipBlocks:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              namespaces:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              notIpBlocks:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              notNamespaces:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              notPrincipals:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              notRequestPrincipals:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              principals:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              requestPrincipals:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                            type: object
-                        type: object
-                      type: array
-                    to:
-                      description: Optional.
-                      items:
-                        properties:
-                          operation:
-                            description: Operation specifies the operation of a request.
-                            properties:
-                              hosts:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              methods:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              notHosts:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              notMethods:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              notPaths:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              notPorts:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              paths:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              ports:
-                                description: Optional.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                            type: object
-                        type: object
-                      type: array
-                    when:
-                      description: Optional.
-                      items:
-                        properties:
-                          key:
-                            description: The name of an Istio attribute.
-                            format: string
-                            type: string
-                          notValues:
-                            description: Optional.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                          values:
-                            description: Optional.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                        type: object
-                      type: array
-                  type: object
-                type: array
-              selector:
-                description: Optional.
-                properties:
-                  matchLabels:
-                    additionalProperties:
-                      format: string
-                      type: string
-                    type: object
-                type: object
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: istio-pilot
-    chart: istio
-    heritage: Tiller
-    release: istio
-  name: destinationrules.networking.istio.io
-spec:
-  group: networking.istio.io
-  names:
-    categories:
-    - istio-io
-    - networking-istio-io
-    kind: DestinationRule
-    listKind: DestinationRuleList
-    plural: destinationrules
-    shortNames:
-    - dr
-    singular: destinationrule
-  scope: Namespaced
-  versions:
-  - additionalPrinterColumns:
-    - description: The name of a service from the service registry
-      jsonPath: .spec.host
-      name: Host
-      type: string
-    - description: 'CreationTimestamp is a timestamp representing the server time
-        when this object was created. It is not guaranteed to be set in happens-before
-        order across separate operations. Clients may not set this value. It is represented
-        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
-        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
-      jsonPath: .metadata.creationTimestamp
-      name: Age
-      type: date
-    name: v1alpha3
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Configuration affecting load balancing, outlier detection,
-              etc. See more details at: https://istio.io/docs/reference/config/networking/destination-rule.html'
-            properties:
-              exportTo:
-                description: A list of namespaces to which this destination rule is
-                  exported.
-                items:
-                  format: string
-                  type: string
-                type: array
-              host:
-                description: The name of a service from the service registry.
-                format: string
-                type: string
-              subsets:
-                items:
-                  properties:
-                    labels:
-                      additionalProperties:
-                        format: string
-                        type: string
-                      type: object
-                    name:
-                      description: Name of the subset.
-                      format: string
-                      type: string
-                    trafficPolicy:
-                      description: Traffic policies that apply to this subset.
-                      properties:
-                        connectionPool:
-                          properties:
-                            http:
-                              description: HTTP connection pool settings.
-                              properties:
-                                h2UpgradePolicy:
-                                  description: Specify if http1.1 connection should
-                                    be upgraded to http2 for the associated destination.
-                                  enum:
-                                  - DEFAULT
-                                  - DO_NOT_UPGRADE
-                                  - UPGRADE
-                                  type: string
-                                http1MaxPendingRequests:
-                                  description: Maximum number of pending HTTP requests
-                                    to a destination.
-                                  format: int32
-                                  type: integer
-                                http2MaxRequests:
-                                  description: Maximum number of requests to a backend.
-                                  format: int32
-                                  type: integer
-                                idleTimeout:
-                                  description: The idle timeout for upstream connection
-                                    pool connections.
-                                  type: string
-                                maxRequestsPerConnection:
-                                  description: Maximum number of requests per connection
-                                    to a backend.
-                                  format: int32
-                                  type: integer
-                                maxRetries:
-                                  format: int32
-                                  type: integer
-                              type: object
-                            tcp:
-                              description: Settings common to both HTTP and TCP upstream
-                                connections.
-                              properties:
-                                connectTimeout:
-                                  description: TCP connection timeout.
-                                  type: string
-                                maxConnections:
-                                  description: Maximum number of HTTP1 /TCP connections
-                                    to a destination host.
-                                  format: int32
-                                  type: integer
-                                tcpKeepalive:
-                                  description: If set then set SO_KEEPALIVE on the
-                                    socket to enable TCP Keepalives.
-                                  properties:
-                                    interval:
-                                      description: The time duration between keep-alive
-                                        probes.
-                                      type: string
-                                    probes:
-                                      type: integer
-                                    time:
-                                      type: string
-                                  type: object
-                              type: object
-                          type: object
-                        loadBalancer:
-                          description: Settings controlling the load balancer algorithms.
-                          oneOf:
-                          - not:
-                              anyOf:
-                              - required:
-                                - simple
-                              - properties:
-                                  consistentHash:
-                                    oneOf:
-                                    - not:
-                                        anyOf:
-                                        - required:
-                                          - httpHeaderName
-                                        - required:
-                                          - httpCookie
-                                        - required:
-                                          - useSourceIp
-                                        - required:
-                                          - httpQueryParameterName
-                                    - required:
-                                      - httpHeaderName
-                                    - required:
-                                      - httpCookie
-                                    - required:
-                                      - useSourceIp
-                                    - required:
-                                      - httpQueryParameterName
-                                required:
-                                - consistentHash
-                          - required:
-                            - simple
-                          - properties:
-                              consistentHash:
-                                oneOf:
-                                - not:
-                                    anyOf:
-                                    - required:
-                                      - httpHeaderName
-                                    - required:
-                                      - httpCookie
-                                    - required:
-                                      - useSourceIp
-                                    - required:
-                                      - httpQueryParameterName
-                                - required:
-                                  - httpHeaderName
-                                - required:
-                                  - httpCookie
-                                - required:
-                                  - useSourceIp
-                                - required:
-                                  - httpQueryParameterName
-                            required:
-                            - consistentHash
-                          properties:
-                            consistentHash:
-                              properties:
-                                httpCookie:
-                                  description: Hash based on HTTP cookie.
-                                  properties:
-                                    name:
-                                      description: Name of the cookie.
-                                      format: string
-                                      type: string
-                                    path:
-                                      description: Path to set for the cookie.
-                                      format: string
-                                      type: string
-                                    ttl:
-                                      description: Lifetime of the cookie.
-                                      type: string
-                                  type: object
-                                httpHeaderName:
-                                  description: Hash based on a specific HTTP header.
-                                  format: string
-                                  type: string
-                                httpQueryParameterName:
-                                  description: Hash based on a specific HTTP query
-                                    parameter.
-                                  format: string
-                                  type: string
-                                minimumRingSize:
-                                  type: integer
-                                useSourceIp:
-                                  description: Hash based on the source IP address.
-                                  type: boolean
-                              type: object
-                            localityLbSetting:
-                              properties:
-                                distribute:
-                                  description: 'Optional: only one of distribute or
-                                    failover can be set.'
-                                  items:
-                                    properties:
-                                      from:
-                                        description: Originating locality, '/' separated,
-                                          e.g.
-                                        format: string
-                                        type: string
-                                      to:
-                                        additionalProperties:
-                                          type: integer
-                                        description: Map of upstream localities to
-                                          traffic distribution weights.
-                                        type: object
-                                    type: object
-                                  type: array
-                                enabled:
-                                  description: enable locality load balancing, this
-                                    is DestinationRule-level and will override mesh
-                                    wide settings in entirety.
-                                  nullable: true
-                                  type: boolean
-                                failover:
-                                  description: 'Optional: only failover or distribute
-                                    can be set.'
-                                  items:
-                                    properties:
-                                      from:
-                                        description: Originating region.
-                                        format: string
-                                        type: string
-                                      to:
-                                        format: string
-                                        type: string
-                                    type: object
-                                  type: array
-                              type: object
-                            simple:
-                              enum:
-                              - ROUND_ROBIN
-                              - LEAST_CONN
-                              - RANDOM
-                              - PASSTHROUGH
-                              type: string
-                          type: object
-                        outlierDetection:
-                          properties:
-                            baseEjectionTime:
-                              description: Minimum ejection duration.
-                              type: string
-                            consecutive5xxErrors:
-                              description: Number of 5xx errors before a host is ejected
-                                from the connection pool.
-                              nullable: true
-                              type: integer
-                            consecutiveErrors:
-                              format: int32
-                              type: integer
-                            consecutiveGatewayErrors:
-                              description: Number of gateway errors before a host
-                                is ejected from the connection pool.
-                              nullable: true
-                              type: integer
-                            interval:
-                              description: Time interval between ejection sweep analysis.
-                              type: string
-                            maxEjectionPercent:
-                              format: int32
-                              type: integer
-                            minHealthPercent:
-                              format: int32
-                              type: integer
-                          type: object
-                        portLevelSettings:
-                          description: Traffic policies specific to individual ports.
-                          items:
-                            properties:
-                              connectionPool:
-                                properties:
-                                  http:
-                                    description: HTTP connection pool settings.
-                                    properties:
-                                      h2UpgradePolicy:
-                                        description: Specify if http1.1 connection
-                                          should be upgraded to http2 for the associated
-                                          destination.
-                                        enum:
-                                        - DEFAULT
-                                        - DO_NOT_UPGRADE
-                                        - UPGRADE
-                                        type: string
-                                      http1MaxPendingRequests:
-                                        description: Maximum number of pending HTTP
-                                          requests to a destination.
-                                        format: int32
-                                        type: integer
-                                      http2MaxRequests:
-                                        description: Maximum number of requests to
-                                          a backend.
-                                        format: int32
-                                        type: integer
-                                      idleTimeout:
-                                        description: The idle timeout for upstream
-                                          connection pool connections.
-                                        type: string
-                                      maxRequestsPerConnection:
-                                        description: Maximum number of requests per
-                                          connection to a backend.
-                                        format: int32
-                                        type: integer
-                                      maxRetries:
-                                        format: int32
-                                        type: integer
-                                    type: object
-                                  tcp:
-                                    description: Settings common to both HTTP and
-                                      TCP upstream connections.
-                                    properties:
-                                      connectTimeout:
-                                        description: TCP connection timeout.
-                                        type: string
-                                      maxConnections:
-                                        description: Maximum number of HTTP1 /TCP
-                                          connections to a destination host.
-                                        format: int32
-                                        type: integer
-                                      tcpKeepalive:
-                                        description: If set then set SO_KEEPALIVE
-                                          on the socket to enable TCP Keepalives.
-                                        properties:
-                                          interval:
-                                            description: The time duration between
-                                              keep-alive probes.
-                                            type: string
-                                          probes:
-                                            type: integer
-                                          time:
-                                            type: string
-                                        type: object
-                                    type: object
-                                type: object
-                              loadBalancer:
-                                description: Settings controlling the load balancer
-                                  algorithms.
-                                oneOf:
-                                - not:
-                                    anyOf:
-                                    - required:
-                                      - simple
-                                    - properties:
-                                        consistentHash:
-                                          oneOf:
-                                          - not:
-                                              anyOf:
-                                              - required:
-                                                - httpHeaderName
-                                              - required:
-                                                - httpCookie
-                                              - required:
-                                                - useSourceIp
-                                              - required:
-                                                - httpQueryParameterName
-                                          - required:
-                                            - httpHeaderName
-                                          - required:
-                                            - httpCookie
-                                          - required:
-                                            - useSourceIp
-                                          - required:
-                                            - httpQueryParameterName
-                                      required:
-                                      - consistentHash
-                                - required:
-                                  - simple
-                                - properties:
-                                    consistentHash:
-                                      oneOf:
-                                      - not:
-                                          anyOf:
-                                          - required:
-                                            - httpHeaderName
-                                          - required:
-                                            - httpCookie
-                                          - required:
-                                            - useSourceIp
-                                          - required:
-                                            - httpQueryParameterName
-                                      - required:
-                                        - httpHeaderName
-                                      - required:
-                                        - httpCookie
-                                      - required:
-                                        - useSourceIp
-                                      - required:
-                                        - httpQueryParameterName
-                                  required:
-                                  - consistentHash
-                                properties:
-                                  consistentHash:
-                                    properties:
-                                      httpCookie:
-                                        description: Hash based on HTTP cookie.
-                                        properties:
-                                          name:
-                                            description: Name of the cookie.
-                                            format: string
-                                            type: string
-                                          path:
-                                            description: Path to set for the cookie.
-                                            format: string
-                                            type: string
-                                          ttl:
-                                            description: Lifetime of the cookie.
-                                            type: string
-                                        type: object
-                                      httpHeaderName:
-                                        description: Hash based on a specific HTTP
-                                          header.
-                                        format: string
-                                        type: string
-                                      httpQueryParameterName:
-                                        description: Hash based on a specific HTTP
-                                          query parameter.
-                                        format: string
-                                        type: string
-                                      minimumRingSize:
-                                        type: integer
-                                      useSourceIp:
-                                        description: Hash based on the source IP address.
-                                        type: boolean
-                                    type: object
-                                  localityLbSetting:
-                                    properties:
-                                      distribute:
-                                        description: 'Optional: only one of distribute
-                                          or failover can be set.'
-                                        items:
-                                          properties:
-                                            from:
-                                              description: Originating locality, '/'
-                                                separated, e.g.
-                                              format: string
-                                              type: string
-                                            to:
-                                              additionalProperties:
-                                                type: integer
-                                              description: Map of upstream localities
-                                                to traffic distribution weights.
-                                              type: object
-                                          type: object
-                                        type: array
-                                      enabled:
-                                        description: enable locality load balancing,
-                                          this is DestinationRule-level and will override
-                                          mesh wide settings in entirety.
-                                        nullable: true
-                                        type: boolean
-                                      failover:
-                                        description: 'Optional: only failover or distribute
-                                          can be set.'
-                                        items:
-                                          properties:
-                                            from:
-                                              description: Originating region.
-                                              format: string
-                                              type: string
-                                            to:
-                                              format: string
-                                              type: string
-                                          type: object
-                                        type: array
-                                    type: object
-                                  simple:
-                                    enum:
-                                    - ROUND_ROBIN
-                                    - LEAST_CONN
-                                    - RANDOM
-                                    - PASSTHROUGH
-                                    type: string
-                                type: object
-                              outlierDetection:
-                                properties:
-                                  baseEjectionTime:
-                                    description: Minimum ejection duration.
-                                    type: string
-                                  consecutive5xxErrors:
-                                    description: Number of 5xx errors before a host
-                                      is ejected from the connection pool.
-                                    nullable: true
-                                    type: integer
-                                  consecutiveErrors:
-                                    format: int32
-                                    type: integer
-                                  consecutiveGatewayErrors:
-                                    description: Number of gateway errors before a
-                                      host is ejected from the connection pool.
-                                    nullable: true
-                                    type: integer
-                                  interval:
-                                    description: Time interval between ejection sweep
-                                      analysis.
-                                    type: string
-                                  maxEjectionPercent:
-                                    format: int32
-                                    type: integer
-                                  minHealthPercent:
-                                    format: int32
-                                    type: integer
-                                type: object
-                              port:
-                                properties:
-                                  number:
-                                    type: integer
-                                type: object
-                              tls:
-                                description: TLS related settings for connections
-                                  to the upstream service.
-                                properties:
-                                  caCertificates:
-                                    format: string
-                                    type: string
-                                  clientCertificate:
-                                    description: REQUIRED if mode is `MUTUAL`.
-                                    format: string
-                                    type: string
-                                  credentialName:
-                                    format: string
-                                    type: string
-                                  mode:
-                                    enum:
-                                    - DISABLE
-                                    - SIMPLE
-                                    - MUTUAL
-                                    - ISTIO_MUTUAL
-                                    type: string
-                                  privateKey:
-                                    description: REQUIRED if mode is `MUTUAL`.
-                                    format: string
-                                    type: string
-                                  sni:
-                                    description: SNI string to present to the server
-                                      during TLS handshake.
-                                    format: string
-                                    type: string
-                                  subjectAltNames:
-                                    items:
-                                      format: string
-                                      type: string
-                                    type: array
-                                type: object
-                            type: object
-                          type: array
-                        tls:
-                          description: TLS related settings for connections to the
-                            upstream service.
-                          properties:
-                            caCertificates:
-                              format: string
-                              type: string
-                            clientCertificate:
-                              description: REQUIRED if mode is `MUTUAL`.
-                              format: string
-                              type: string
-                            credentialName:
-                              format: string
-                              type: string
-                            mode:
-                              enum:
-                              - DISABLE
-                              - SIMPLE
-                              - MUTUAL
-                              - ISTIO_MUTUAL
-                              type: string
-                            privateKey:
-                              description: REQUIRED if mode is `MUTUAL`.
-                              format: string
-                              type: string
-                            sni:
-                              description: SNI string to present to the server during
-                                TLS handshake.
-                              format: string
-                              type: string
-                            subjectAltNames:
-                              items:
-                                format: string
-                                type: string
-                              type: array
-                          type: object
-                      type: object
-                  type: object
-                type: array
-              trafficPolicy:
-                properties:
-                  connectionPool:
-                    properties:
-                      http:
-                        description: HTTP connection pool settings.
-                        properties:
-                          h2UpgradePolicy:
-                            description: Specify if http1.1 connection should be upgraded
-                              to http2 for the associated destination.
-                            enum:
-                            - DEFAULT
-                            - DO_NOT_UPGRADE
-                            - UPGRADE
-                            type: string
-                          http1MaxPendingRequests:
-                            description: Maximum number of pending HTTP requests to
-                              a destination.
-                            format: int32
-                            type: integer
-                          http2MaxRequests:
-                            description: Maximum number of requests to a backend.
-                            format: int32
-                            type: integer
-                          idleTimeout:
-                            description: The idle timeout for upstream connection
-                              pool connections.
-                            type: string
-                          maxRequestsPerConnection:
-                            description: Maximum number of requests per connection
-                              to a backend.
-                            format: int32
-                            type: integer
-                          maxRetries:
-                            format: int32
-                            type: integer
-                        type: object
-                      tcp:
-                        description: Settings common to both HTTP and TCP upstream
-                          connections.
-                        properties:
-                          connectTimeout:
-                            description: TCP connection timeout.
-                            type: string
-                          maxConnections:
-                            description: Maximum number of HTTP1 /TCP connections
-                              to a destination host.
-                            format: int32
-                            type: integer
-                          tcpKeepalive:
-                            description: If set then set SO_KEEPALIVE on the socket
-                              to enable TCP Keepalives.
-                            properties:
-                              interval:
-                                description: The time duration between keep-alive
-                                  probes.
-                                type: string
-                              probes:
-                                type: integer
-                              time:
-                                type: string
-                            type: object
-                        type: object
-                    type: object
-                  loadBalancer:
-                    description: Settings controlling the load balancer algorithms.
-                    oneOf:
-                    - not:
-                        anyOf:
-                        - required:
-                          - simple
-                        - properties:
-                            consistentHash:
-                              oneOf:
-                              - not:
-                                  anyOf:
-                                  - required:
-                                    - httpHeaderName
-                                  - required:
-                                    - httpCookie
-                                  - required:
-                                    - useSourceIp
-                                  - required:
-                                    - httpQueryParameterName
-                              - required:
-                                - httpHeaderName
-                              - required:
-                                - httpCookie
-                              - required:
-                                - useSourceIp
-                              - required:
-                                - httpQueryParameterName
-                          required:
-                          - consistentHash
-                    - required:
-                      - simple
-                    - properties:
-                        consistentHash:
-                          oneOf:
-                          - not:
-                              anyOf:
-                              - required:
-                                - httpHeaderName
-                              - required:
-                                - httpCookie
-                              - required:
-                                - useSourceIp
-                              - required:
-                                - httpQueryParameterName
-                          - required:
-                            - httpHeaderName
-                          - required:
-                            - httpCookie
-                          - required:
-                            - useSourceIp
-                          - required:
-                            - httpQueryParameterName
-                      required:
-                      - consistentHash
-                    properties:
-                      consistentHash:
-                        properties:
-                          httpCookie:
-                            description: Hash based on HTTP cookie.
-                            properties:
-                              name:
-                                description: Name of the cookie.
-                                format: string
-                                type: string
-                              path:
-                                description: Path to set for the cookie.
-                                format: string
-                                type: string
-                              ttl:
-                                description: Lifetime of the cookie.
-                                type: string
-                            type: object
-                          httpHeaderName:
-                            description: Hash based on a specific HTTP header.
-                            format: string
-                            type: string
-                          httpQueryParameterName:
-                            description: Hash based on a specific HTTP query parameter.
-                            format: string
-                            type: string
-                          minimumRingSize:
-                            type: integer
-                          useSourceIp:
-                            description: Hash based on the source IP address.
-                            type: boolean
-                        type: object
-                      localityLbSetting:
-                        properties:
-                          distribute:
-                            description: 'Optional: only one of distribute or failover
-                              can be set.'
-                            items:
-                              properties:
-                                from:
-                                  description: Originating locality, '/' separated,
-                                    e.g.
-                                  format: string
-                                  type: string
-                                to:
-                                  additionalProperties:
-                                    type: integer
-                                  description: Map of upstream localities to traffic
-                                    distribution weights.
-                                  type: object
-                              type: object
-                            type: array
-                          enabled:
-                            description: enable locality load balancing, this is DestinationRule-level
-                              and will override mesh wide settings in entirety.
-                            nullable: true
-                            type: boolean
-                          failover:
-                            description: 'Optional: only failover or distribute can
-                              be set.'
-                            items:
-                              properties:
-                                from:
-                                  description: Originating region.
-                                  format: string
-                                  type: string
-                                to:
-                                  format: string
-                                  type: string
-                              type: object
-                            type: array
-                        type: object
-                      simple:
-                        enum:
-                        - ROUND_ROBIN
-                        - LEAST_CONN
-                        - RANDOM
-                        - PASSTHROUGH
-                        type: string
-                    type: object
-                  outlierDetection:
-                    properties:
-                      baseEjectionTime:
-                        description: Minimum ejection duration.
-                        type: string
-                      consecutive5xxErrors:
-                        description: Number of 5xx errors before a host is ejected
-                          from the connection pool.
-                        nullable: true
-                        type: integer
-                      consecutiveErrors:
-                        format: int32
-                        type: integer
-                      consecutiveGatewayErrors:
-                        description: Number of gateway errors before a host is ejected
-                          from the connection pool.
-                        nullable: true
-                        type: integer
-                      interval:
-                        description: Time interval between ejection sweep analysis.
-                        type: string
-                      maxEjectionPercent:
-                        format: int32
-                        type: integer
-                      minHealthPercent:
-                        format: int32
-                        type: integer
-                    type: object
-                  portLevelSettings:
-                    description: Traffic policies specific to individual ports.
-                    items:
-                      properties:
-                        connectionPool:
-                          properties:
-                            http:
-                              description: HTTP connection pool settings.
-                              properties:
-                                h2UpgradePolicy:
-                                  description: Specify if http1.1 connection should
-                                    be upgraded to http2 for the associated destination.
-                                  enum:
-                                  - DEFAULT
-                                  - DO_NOT_UPGRADE
-                                  - UPGRADE
-                                  type: string
-                                http1MaxPendingRequests:
-                                  description: Maximum number of pending HTTP requests
-                                    to a destination.
-                                  format: int32
-                                  type: integer
-                                http2MaxRequests:
-                                  description: Maximum number of requests to a backend.
-                                  format: int32
-                                  type: integer
-                                idleTimeout:
-                                  description: The idle timeout for upstream connection
-                                    pool connections.
-                                  type: string
-                                maxRequestsPerConnection:
-                                  description: Maximum number of requests per connection
-                                    to a backend.
-                                  format: int32
-                                  type: integer
-                                maxRetries:
-                                  format: int32
-                                  type: integer
-                              type: object
-                            tcp:
-                              description: Settings common to both HTTP and TCP upstream
-                                connections.
-                              properties:
-                                connectTimeout:
-                                  description: TCP connection timeout.
-                                  type: string
-                                maxConnections:
-                                  description: Maximum number of HTTP1 /TCP connections
-                                    to a destination host.
-                                  format: int32
-                                  type: integer
-                                tcpKeepalive:
-                                  description: If set then set SO_KEEPALIVE on the
-                                    socket to enable TCP Keepalives.
-                                  properties:
-                                    interval:
-                                      description: The time duration between keep-alive
-                                        probes.
-                                      type: string
-                                    probes:
-                                      type: integer
-                                    time:
-                                      type: string
-                                  type: object
-                              type: object
-                          type: object
-                        loadBalancer:
-                          description: Settings controlling the load balancer algorithms.
-                          oneOf:
-                          - not:
-                              anyOf:
-                              - required:
-                                - simple
-                              - properties:
-                                  consistentHash:
-                                    oneOf:
-                                    - not:
-                                        anyOf:
-                                        - required:
-                                          - httpHeaderName
-                                        - required:
-                                          - httpCookie
-                                        - required:
-                                          - useSourceIp
-                                        - required:
-                                          - httpQueryParameterName
-                                    - required:
-                                      - httpHeaderName
-                                    - required:
-                                      - httpCookie
-                                    - required:
-                                      - useSourceIp
-                                    - required:
-                                      - httpQueryParameterName
-                                required:
-                                - consistentHash
-                          - required:
-                            - simple
-                          - properties:
-                              consistentHash:
-                                oneOf:
-                                - not:
-                                    anyOf:
-                                    - required:
-                                      - httpHeaderName
-                                    - required:
-                                      - httpCookie
-                                    - required:
-                                      - useSourceIp
-                                    - required:
-                                      - httpQueryParameterName
-                                - required:
-                                  - httpHeaderName
-                                - required:
-                                  - httpCookie
-                                - required:
-                                  - useSourceIp
-                                - required:
-                                  - httpQueryParameterName
-                            required:
-                            - consistentHash
-                          properties:
-                            consistentHash:
-                              properties:
-                                httpCookie:
-                                  description: Hash based on HTTP cookie.
-                                  properties:
-                                    name:
-                                      description: Name of the cookie.
-                                      format: string
-                                      type: string
-                                    path:
-                                      description: Path to set for the cookie.
-                                      format: string
-                                      type: string
-                                    ttl:
-                                      description: Lifetime of the cookie.
-                                      type: string
-                                  type: object
-                                httpHeaderName:
-                                  description: Hash based on a specific HTTP header.
-                                  format: string
-                                  type: string
-                                httpQueryParameterName:
-                                  description: Hash based on a specific HTTP query
-                                    parameter.
-                                  format: string
-                                  type: string
-                                minimumRingSize:
-                                  type: integer
-                                useSourceIp:
-                                  description: Hash based on the source IP address.
-                                  type: boolean
-                              type: object
-                            localityLbSetting:
-                              properties:
-                                distribute:
-                                  description: 'Optional: only one of distribute or
-                                    failover can be set.'
-                                  items:
-                                    properties:
-                                      from:
-                                        description: Originating locality, '/' separated,
-                                          e.g.
-                                        format: string
-                                        type: string
-                                      to:
-                                        additionalProperties:
-                                          type: integer
-                                        description: Map of upstream localities to
-                                          traffic distribution weights.
-                                        type: object
-                                    type: object
-                                  type: array
-                                enabled:
-                                  description: enable locality load balancing, this
-                                    is DestinationRule-level and will override mesh
-                                    wide settings in entirety.
-                                  nullable: true
-                                  type: boolean
-                                failover:
-                                  description: 'Optional: only failover or distribute
-                                    can be set.'
-                                  items:
-                                    properties:
-                                      from:
-                                        description: Originating region.
-                                        format: string
-                                        type: string
-                                      to:
-                                        format: string
-                                        type: string
-                                    type: object
-                                  type: array
-                              type: object
-                            simple:
-                              enum:
-                              - ROUND_ROBIN
-                              - LEAST_CONN
-                              - RANDOM
-                              - PASSTHROUGH
-                              type: string
-                          type: object
-                        outlierDetection:
-                          properties:
-                            baseEjectionTime:
-                              description: Minimum ejection duration.
-                              type: string
-                            consecutive5xxErrors:
-                              description: Number of 5xx errors before a host is ejected
-                                from the connection pool.
-                              nullable: true
-                              type: integer
-                            consecutiveErrors:
-                              format: int32
-                              type: integer
-                            consecutiveGatewayErrors:
-                              description: Number of gateway errors before a host
-                                is ejected from the connection pool.
-                              nullable: true
-                              type: integer
-                            interval:
-                              description: Time interval between ejection sweep analysis.
-                              type: string
-                            maxEjectionPercent:
-                              format: int32
-                              type: integer
-                            minHealthPercent:
-                              format: int32
-                              type: integer
-                          type: object
-                        port:
-                          properties:
-                            number:
-                              type: integer
-                          type: object
-                        tls:
-                          description: TLS related settings for connections to the
-                            upstream service.
-                          properties:
-                            caCertificates:
-                              format: string
-                              type: string
-                            clientCertificate:
-                              description: REQUIRED if mode is `MUTUAL`.
-                              format: string
-                              type: string
-                            credentialName:
-                              format: string
-                              type: string
-                            mode:
-                              enum:
-                              - DISABLE
-                              - SIMPLE
-                              - MUTUAL
-                              - ISTIO_MUTUAL
-                              type: string
-                            privateKey:
-                              description: REQUIRED if mode is `MUTUAL`.
-                              format: string
-                              type: string
-                            sni:
-                              description: SNI string to present to the server during
-                                TLS handshake.
-                              format: string
-                              type: string
-                            subjectAltNames:
-                              items:
-                                format: string
-                                type: string
-                              type: array
-                          type: object
-                      type: object
-                    type: array
-                  tls:
-                    description: TLS related settings for connections to the upstream
-                      service.
-                    properties:
-                      caCertificates:
-                        format: string
-                        type: string
-                      clientCertificate:
-                        description: REQUIRED if mode is `MUTUAL`.
-                        format: string
-                        type: string
-                      credentialName:
-                        format: string
-                        type: string
-                      mode:
-                        enum:
-                        - DISABLE
-                        - SIMPLE
-                        - MUTUAL
-                        - ISTIO_MUTUAL
-                        type: string
-                      privateKey:
-                        description: REQUIRED if mode is `MUTUAL`.
-                        format: string
-                        type: string
-                      sni:
-                        description: SNI string to present to the server during TLS
-                          handshake.
-                        format: string
-                        type: string
-                      subjectAltNames:
-                        items:
-                          format: string
-                          type: string
-                        type: array
-                    type: object
-                type: object
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
-  - additionalPrinterColumns:
-    - description: The name of a service from the service registry
-      jsonPath: .spec.host
-      name: Host
-      type: string
-    - description: 'CreationTimestamp is a timestamp representing the server time
-        when this object was created. It is not guaranteed to be set in happens-before
-        order across separate operations. Clients may not set this value. It is represented
-        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
-        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
-      jsonPath: .metadata.creationTimestamp
-      name: Age
-      type: date
-    name: v1beta1
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Configuration affecting load balancing, outlier detection,
-              etc. See more details at: https://istio.io/docs/reference/config/networking/destination-rule.html'
-            properties:
-              exportTo:
-                description: A list of namespaces to which this destination rule is
-                  exported.
-                items:
-                  format: string
-                  type: string
-                type: array
-              host:
-                description: The name of a service from the service registry.
-                format: string
-                type: string
-              subsets:
-                items:
-                  properties:
-                    labels:
-                      additionalProperties:
-                        format: string
-                        type: string
-                      type: object
-                    name:
-                      description: Name of the subset.
-                      format: string
-                      type: string
-                    trafficPolicy:
-                      description: Traffic policies that apply to this subset.
-                      properties:
-                        connectionPool:
-                          properties:
-                            http:
-                              description: HTTP connection pool settings.
-                              properties:
-                                h2UpgradePolicy:
-                                  description: Specify if http1.1 connection should
-                                    be upgraded to http2 for the associated destination.
-                                  enum:
-                                  - DEFAULT
-                                  - DO_NOT_UPGRADE
-                                  - UPGRADE
-                                  type: string
-                                http1MaxPendingRequests:
-                                  description: Maximum number of pending HTTP requests
-                                    to a destination.
-                                  format: int32
-                                  type: integer
-                                http2MaxRequests:
-                                  description: Maximum number of requests to a backend.
-                                  format: int32
-                                  type: integer
-                                idleTimeout:
-                                  description: The idle timeout for upstream connection
-                                    pool connections.
-                                  type: string
-                                maxRequestsPerConnection:
-                                  description: Maximum number of requests per connection
-                                    to a backend.
-                                  format: int32
-                                  type: integer
-                                maxRetries:
-                                  format: int32
-                                  type: integer
-                              type: object
-                            tcp:
-                              description: Settings common to both HTTP and TCP upstream
-                                connections.
-                              properties:
-                                connectTimeout:
-                                  description: TCP connection timeout.
-                                  type: string
-                                maxConnections:
-                                  description: Maximum number of HTTP1 /TCP connections
-                                    to a destination host.
-                                  format: int32
-                                  type: integer
-                                tcpKeepalive:
-                                  description: If set then set SO_KEEPALIVE on the
-                                    socket to enable TCP Keepalives.
-                                  properties:
-                                    interval:
-                                      description: The time duration between keep-alive
-                                        probes.
-                                      type: string
-                                    probes:
-                                      type: integer
-                                    time:
-                                      type: string
-                                  type: object
-                              type: object
-                          type: object
-                        loadBalancer:
-                          description: Settings controlling the load balancer algorithms.
-                          oneOf:
-                          - not:
-                              anyOf:
-                              - required:
-                                - simple
-                              - properties:
-                                  consistentHash:
-                                    oneOf:
-                                    - not:
-                                        anyOf:
-                                        - required:
-                                          - httpHeaderName
-                                        - required:
-                                          - httpCookie
-                                        - required:
-                                          - useSourceIp
-                                        - required:
-                                          - httpQueryParameterName
-                                    - required:
-                                      - httpHeaderName
-                                    - required:
-                                      - httpCookie
-                                    - required:
-                                      - useSourceIp
-                                    - required:
-                                      - httpQueryParameterName
-                                required:
-                                - consistentHash
-                          - required:
-                            - simple
-                          - properties:
-                              consistentHash:
-                                oneOf:
-                                - not:
-                                    anyOf:
-                                    - required:
-                                      - httpHeaderName
-                                    - required:
-                                      - httpCookie
-                                    - required:
-                                      - useSourceIp
-                                    - required:
-                                      - httpQueryParameterName
-                                - required:
-                                  - httpHeaderName
-                                - required:
-                                  - httpCookie
-                                - required:
-                                  - useSourceIp
-                                - required:
-                                  - httpQueryParameterName
-                            required:
-                            - consistentHash
-                          properties:
-                            consistentHash:
-                              properties:
-                                httpCookie:
-                                  description: Hash based on HTTP cookie.
-                                  properties:
-                                    name:
-                                      description: Name of the cookie.
-                                      format: string
-                                      type: string
-                                    path:
-                                      description: Path to set for the cookie.
-                                      format: string
-                                      type: string
-                                    ttl:
-                                      description: Lifetime of the cookie.
-                                      type: string
-                                  type: object
-                                httpHeaderName:
-                                  description: Hash based on a specific HTTP header.
-                                  format: string
-                                  type: string
-                                httpQueryParameterName:
-                                  description: Hash based on a specific HTTP query
-                                    parameter.
-                                  format: string
-                                  type: string
-                                minimumRingSize:
-                                  type: integer
-                                useSourceIp:
-                                  description: Hash based on the source IP address.
-                                  type: boolean
-                              type: object
-                            localityLbSetting:
-                              properties:
-                                distribute:
-                                  description: 'Optional: only one of distribute or
-                                    failover can be set.'
-                                  items:
-                                    properties:
-                                      from:
-                                        description: Originating locality, '/' separated,
-                                          e.g.
-                                        format: string
-                                        type: string
-                                      to:
-                                        additionalProperties:
-                                          type: integer
-                                        description: Map of upstream localities to
-                                          traffic distribution weights.
-                                        type: object
-                                    type: object
-                                  type: array
-                                enabled:
-                                  description: enable locality load balancing, this
-                                    is DestinationRule-level and will override mesh
-                                    wide settings in entirety.
-                                  nullable: true
-                                  type: boolean
-                                failover:
-                                  description: 'Optional: only failover or distribute
-                                    can be set.'
-                                  items:
-                                    properties:
-                                      from:
-                                        description: Originating region.
-                                        format: string
-                                        type: string
-                                      to:
-                                        format: string
-                                        type: string
-                                    type: object
-                                  type: array
-                              type: object
-                            simple:
-                              enum:
-                              - ROUND_ROBIN
-                              - LEAST_CONN
-                              - RANDOM
-                              - PASSTHROUGH
-                              type: string
-                          type: object
-                        outlierDetection:
-                          properties:
-                            baseEjectionTime:
-                              description: Minimum ejection duration.
-                              type: string
-                            consecutive5xxErrors:
-                              description: Number of 5xx errors before a host is ejected
-                                from the connection pool.
-                              nullable: true
-                              type: integer
-                            consecutiveErrors:
-                              format: int32
-                              type: integer
-                            consecutiveGatewayErrors:
-                              description: Number of gateway errors before a host
-                                is ejected from the connection pool.
-                              nullable: true
-                              type: integer
-                            interval:
-                              description: Time interval between ejection sweep analysis.
-                              type: string
-                            maxEjectionPercent:
-                              format: int32
-                              type: integer
-                            minHealthPercent:
-                              format: int32
-                              type: integer
-                          type: object
-                        portLevelSettings:
-                          description: Traffic policies specific to individual ports.
-                          items:
-                            properties:
-                              connectionPool:
-                                properties:
-                                  http:
-                                    description: HTTP connection pool settings.
-                                    properties:
-                                      h2UpgradePolicy:
-                                        description: Specify if http1.1 connection
-                                          should be upgraded to http2 for the associated
-                                          destination.
-                                        enum:
-                                        - DEFAULT
-                                        - DO_NOT_UPGRADE
-                                        - UPGRADE
-                                        type: string
-                                      http1MaxPendingRequests:
-                                        description: Maximum number of pending HTTP
-                                          requests to a destination.
-                                        format: int32
-                                        type: integer
-                                      http2MaxRequests:
-                                        description: Maximum number of requests to
-                                          a backend.
-                                        format: int32
-                                        type: integer
-                                      idleTimeout:
-                                        description: The idle timeout for upstream
-                                          connection pool connections.
-                                        type: string
-                                      maxRequestsPerConnection:
-                                        description: Maximum number of requests per
-                                          connection to a backend.
-                                        format: int32
-                                        type: integer
-                                      maxRetries:
-                                        format: int32
-                                        type: integer
-                                    type: object
-                                  tcp:
-                                    description: Settings common to both HTTP and
-                                      TCP upstream connections.
-                                    properties:
-                                      connectTimeout:
-                                        description: TCP connection timeout.
-                                        type: string
-                                      maxConnections:
-                                        description: Maximum number of HTTP1 /TCP
-                                          connections to a destination host.
-                                        format: int32
-                                        type: integer
-                                      tcpKeepalive:
-                                        description: If set then set SO_KEEPALIVE
-                                          on the socket to enable TCP Keepalives.
-                                        properties:
-                                          interval:
-                                            description: The time duration between
-                                              keep-alive probes.
-                                            type: string
-                                          probes:
-                                            type: integer
-                                          time:
-                                            type: string
-                                        type: object
-                                    type: object
-                                type: object
-                              loadBalancer:
-                                description: Settings controlling the load balancer
-                                  algorithms.
-                                oneOf:
-                                - not:
-                                    anyOf:
-                                    - required:
-                                      - simple
-                                    - properties:
-                                        consistentHash:
-                                          oneOf:
-                                          - not:
-                                              anyOf:
-                                              - required:
-                                                - httpHeaderName
-                                              - required:
-                                                - httpCookie
-                                              - required:
-                                                - useSourceIp
-                                              - required:
-                                                - httpQueryParameterName
-                                          - required:
-                                            - httpHeaderName
-                                          - required:
-                                            - httpCookie
-                                          - required:
-                                            - useSourceIp
-                                          - required:
-                                            - httpQueryParameterName
-                                      required:
-                                      - consistentHash
-                                - required:
-                                  - simple
-                                - properties:
-                                    consistentHash:
-                                      oneOf:
-                                      - not:
-                                          anyOf:
-                                          - required:
-                                            - httpHeaderName
-                                          - required:
-                                            - httpCookie
-                                          - required:
-                                            - useSourceIp
-                                          - required:
-                                            - httpQueryParameterName
-                                      - required:
-                                        - httpHeaderName
-                                      - required:
-                                        - httpCookie
-                                      - required:
-                                        - useSourceIp
-                                      - required:
-                                        - httpQueryParameterName
-                                  required:
-                                  - consistentHash
-                                properties:
-                                  consistentHash:
-                                    properties:
-                                      httpCookie:
-                                        description: Hash based on HTTP cookie.
-                                        properties:
-                                          name:
-                                            description: Name of the cookie.
-                                            format: string
-                                            type: string
-                                          path:
-                                            description: Path to set for the cookie.
-                                            format: string
-                                            type: string
-                                          ttl:
-                                            description: Lifetime of the cookie.
-                                            type: string
-                                        type: object
-                                      httpHeaderName:
-                                        description: Hash based on a specific HTTP
-                                          header.
-                                        format: string
-                                        type: string
-                                      httpQueryParameterName:
-                                        description: Hash based on a specific HTTP
-                                          query parameter.
-                                        format: string
-                                        type: string
-                                      minimumRingSize:
-                                        type: integer
-                                      useSourceIp:
-                                        description: Hash based on the source IP address.
-                                        type: boolean
-                                    type: object
-                                  localityLbSetting:
-                                    properties:
-                                      distribute:
-                                        description: 'Optional: only one of distribute
-                                          or failover can be set.'
-                                        items:
-                                          properties:
-                                            from:
-                                              description: Originating locality, '/'
-                                                separated, e.g.
-                                              format: string
-                                              type: string
-                                            to:
-                                              additionalProperties:
-                                                type: integer
-                                              description: Map of upstream localities
-                                                to traffic distribution weights.
-                                              type: object
-                                          type: object
-                                        type: array
-                                      enabled:
-                                        description: enable locality load balancing,
-                                          this is DestinationRule-level and will override
-                                          mesh wide settings in entirety.
-                                        nullable: true
-                                        type: boolean
-                                      failover:
-                                        description: 'Optional: only failover or distribute
-                                          can be set.'
-                                        items:
-                                          properties:
-                                            from:
-                                              description: Originating region.
-                                              format: string
-                                              type: string
-                                            to:
-                                              format: string
-                                              type: string
-                                          type: object
-                                        type: array
-                                    type: object
-                                  simple:
-                                    enum:
-                                    - ROUND_ROBIN
-                                    - LEAST_CONN
-                                    - RANDOM
-                                    - PASSTHROUGH
-                                    type: string
-                                type: object
-                              outlierDetection:
-                                properties:
-                                  baseEjectionTime:
-                                    description: Minimum ejection duration.
-                                    type: string
-                                  consecutive5xxErrors:
-                                    description: Number of 5xx errors before a host
-                                      is ejected from the connection pool.
-                                    nullable: true
-                                    type: integer
-                                  consecutiveErrors:
-                                    format: int32
-                                    type: integer
-                                  consecutiveGatewayErrors:
-                                    description: Number of gateway errors before a
-                                      host is ejected from the connection pool.
-                                    nullable: true
-                                    type: integer
-                                  interval:
-                                    description: Time interval between ejection sweep
-                                      analysis.
-                                    type: string
-                                  maxEjectionPercent:
-                                    format: int32
-                                    type: integer
-                                  minHealthPercent:
-                                    format: int32
-                                    type: integer
-                                type: object
-                              port:
-                                properties:
-                                  number:
-                                    type: integer
-                                type: object
-                              tls:
-                                description: TLS related settings for connections
-                                  to the upstream service.
-                                properties:
-                                  caCertificates:
-                                    format: string
-                                    type: string
-                                  clientCertificate:
-                                    description: REQUIRED if mode is `MUTUAL`.
-                                    format: string
-                                    type: string
-                                  credentialName:
-                                    format: string
-                                    type: string
-                                  mode:
-                                    enum:
-                                    - DISABLE
-                                    - SIMPLE
-                                    - MUTUAL
-                                    - ISTIO_MUTUAL
-                                    type: string
-                                  privateKey:
-                                    description: REQUIRED if mode is `MUTUAL`.
-                                    format: string
-                                    type: string
-                                  sni:
-                                    description: SNI string to present to the server
-                                      during TLS handshake.
-                                    format: string
-                                    type: string
-                                  subjectAltNames:
-                                    items:
-                                      format: string
-                                      type: string
-                                    type: array
-                                type: object
-                            type: object
-                          type: array
-                        tls:
-                          description: TLS related settings for connections to the
-                            upstream service.
-                          properties:
-                            caCertificates:
-                              format: string
-                              type: string
-                            clientCertificate:
-                              description: REQUIRED if mode is `MUTUAL`.
-                              format: string
-                              type: string
-                            credentialName:
-                              format: string
-                              type: string
-                            mode:
-                              enum:
-                              - DISABLE
-                              - SIMPLE
-                              - MUTUAL
-                              - ISTIO_MUTUAL
-                              type: string
-                            privateKey:
-                              description: REQUIRED if mode is `MUTUAL`.
-                              format: string
-                              type: string
-                            sni:
-                              description: SNI string to present to the server during
-                                TLS handshake.
-                              format: string
-                              type: string
-                            subjectAltNames:
-                              items:
-                                format: string
-                                type: string
-                              type: array
-                          type: object
-                      type: object
-                  type: object
-                type: array
-              trafficPolicy:
-                properties:
-                  connectionPool:
-                    properties:
-                      http:
-                        description: HTTP connection pool settings.
-                        properties:
-                          h2UpgradePolicy:
-                            description: Specify if http1.1 connection should be upgraded
-                              to http2 for the associated destination.
-                            enum:
-                            - DEFAULT
-                            - DO_NOT_UPGRADE
-                            - UPGRADE
-                            type: string
-                          http1MaxPendingRequests:
-                            description: Maximum number of pending HTTP requests to
-                              a destination.
-                            format: int32
-                            type: integer
-                          http2MaxRequests:
-                            description: Maximum number of requests to a backend.
-                            format: int32
-                            type: integer
-                          idleTimeout:
-                            description: The idle timeout for upstream connection
-                              pool connections.
-                            type: string
-                          maxRequestsPerConnection:
-                            description: Maximum number of requests per connection
-                              to a backend.
-                            format: int32
-                            type: integer
-                          maxRetries:
-                            format: int32
-                            type: integer
-                        type: object
-                      tcp:
-                        description: Settings common to both HTTP and TCP upstream
-                          connections.
-                        properties:
-                          connectTimeout:
-                            description: TCP connection timeout.
-                            type: string
-                          maxConnections:
-                            description: Maximum number of HTTP1 /TCP connections
-                              to a destination host.
-                            format: int32
-                            type: integer
-                          tcpKeepalive:
-                            description: If set then set SO_KEEPALIVE on the socket
-                              to enable TCP Keepalives.
-                            properties:
-                              interval:
-                                description: The time duration between keep-alive
-                                  probes.
-                                type: string
-                              probes:
-                                type: integer
-                              time:
-                                type: string
-                            type: object
-                        type: object
-                    type: object
-                  loadBalancer:
-                    description: Settings controlling the load balancer algorithms.
-                    oneOf:
-                    - not:
-                        anyOf:
-                        - required:
-                          - simple
-                        - properties:
-                            consistentHash:
-                              oneOf:
-                              - not:
-                                  anyOf:
-                                  - required:
-                                    - httpHeaderName
-                                  - required:
-                                    - httpCookie
-                                  - required:
-                                    - useSourceIp
-                                  - required:
-                                    - httpQueryParameterName
-                              - required:
-                                - httpHeaderName
-                              - required:
-                                - httpCookie
-                              - required:
-                                - useSourceIp
-                              - required:
-                                - httpQueryParameterName
-                          required:
-                          - consistentHash
-                    - required:
-                      - simple
-                    - properties:
-                        consistentHash:
-                          oneOf:
-                          - not:
-                              anyOf:
-                              - required:
-                                - httpHeaderName
-                              - required:
-                                - httpCookie
-                              - required:
-                                - useSourceIp
-                              - required:
-                                - httpQueryParameterName
-                          - required:
-                            - httpHeaderName
-                          - required:
-                            - httpCookie
-                          - required:
-                            - useSourceIp
-                          - required:
-                            - httpQueryParameterName
-                      required:
-                      - consistentHash
-                    properties:
-                      consistentHash:
-                        properties:
-                          httpCookie:
-                            description: Hash based on HTTP cookie.
-                            properties:
-                              name:
-                                description: Name of the cookie.
-                                format: string
-                                type: string
-                              path:
-                                description: Path to set for the cookie.
-                                format: string
-                                type: string
-                              ttl:
-                                description: Lifetime of the cookie.
-                                type: string
-                            type: object
-                          httpHeaderName:
-                            description: Hash based on a specific HTTP header.
-                            format: string
-                            type: string
-                          httpQueryParameterName:
-                            description: Hash based on a specific HTTP query parameter.
-                            format: string
-                            type: string
-                          minimumRingSize:
-                            type: integer
-                          useSourceIp:
-                            description: Hash based on the source IP address.
-                            type: boolean
-                        type: object
-                      localityLbSetting:
-                        properties:
-                          distribute:
-                            description: 'Optional: only one of distribute or failover
-                              can be set.'
-                            items:
-                              properties:
-                                from:
-                                  description: Originating locality, '/' separated,
-                                    e.g.
-                                  format: string
-                                  type: string
-                                to:
-                                  additionalProperties:
-                                    type: integer
-                                  description: Map of upstream localities to traffic
-                                    distribution weights.
-                                  type: object
-                              type: object
-                            type: array
-                          enabled:
-                            description: enable locality load balancing, this is DestinationRule-level
-                              and will override mesh wide settings in entirety.
-                            nullable: true
-                            type: boolean
-                          failover:
-                            description: 'Optional: only failover or distribute can
-                              be set.'
-                            items:
-                              properties:
-                                from:
-                                  description: Originating region.
-                                  format: string
-                                  type: string
-                                to:
-                                  format: string
-                                  type: string
-                              type: object
-                            type: array
-                        type: object
-                      simple:
-                        enum:
-                        - ROUND_ROBIN
-                        - LEAST_CONN
-                        - RANDOM
-                        - PASSTHROUGH
-                        type: string
-                    type: object
-                  outlierDetection:
-                    properties:
-                      baseEjectionTime:
-                        description: Minimum ejection duration.
-                        type: string
-                      consecutive5xxErrors:
-                        description: Number of 5xx errors before a host is ejected
-                          from the connection pool.
-                        nullable: true
-                        type: integer
-                      consecutiveErrors:
-                        format: int32
-                        type: integer
-                      consecutiveGatewayErrors:
-                        description: Number of gateway errors before a host is ejected
-                          from the connection pool.
-                        nullable: true
-                        type: integer
-                      interval:
-                        description: Time interval between ejection sweep analysis.
-                        type: string
-                      maxEjectionPercent:
-                        format: int32
-                        type: integer
-                      minHealthPercent:
-                        format: int32
-                        type: integer
-                    type: object
-                  portLevelSettings:
-                    description: Traffic policies specific to individual ports.
-                    items:
-                      properties:
-                        connectionPool:
-                          properties:
-                            http:
-                              description: HTTP connection pool settings.
-                              properties:
-                                h2UpgradePolicy:
-                                  description: Specify if http1.1 connection should
-                                    be upgraded to http2 for the associated destination.
-                                  enum:
-                                  - DEFAULT
-                                  - DO_NOT_UPGRADE
-                                  - UPGRADE
-                                  type: string
-                                http1MaxPendingRequests:
-                                  description: Maximum number of pending HTTP requests
-                                    to a destination.
-                                  format: int32
-                                  type: integer
-                                http2MaxRequests:
-                                  description: Maximum number of requests to a backend.
-                                  format: int32
-                                  type: integer
-                                idleTimeout:
-                                  description: The idle timeout for upstream connection
-                                    pool connections.
-                                  type: string
-                                maxRequestsPerConnection:
-                                  description: Maximum number of requests per connection
-                                    to a backend.
-                                  format: int32
-                                  type: integer
-                                maxRetries:
-                                  format: int32
-                                  type: integer
-                              type: object
-                            tcp:
-                              description: Settings common to both HTTP and TCP upstream
-                                connections.
-                              properties:
-                                connectTimeout:
-                                  description: TCP connection timeout.
-                                  type: string
-                                maxConnections:
-                                  description: Maximum number of HTTP1 /TCP connections
-                                    to a destination host.
-                                  format: int32
-                                  type: integer
-                                tcpKeepalive:
-                                  description: If set then set SO_KEEPALIVE on the
-                                    socket to enable TCP Keepalives.
-                                  properties:
-                                    interval:
-                                      description: The time duration between keep-alive
-                                        probes.
-                                      type: string
-                                    probes:
-                                      type: integer
-                                    time:
-                                      type: string
-                                  type: object
-                              type: object
-                          type: object
-                        loadBalancer:
-                          description: Settings controlling the load balancer algorithms.
-                          oneOf:
-                          - not:
-                              anyOf:
-                              - required:
-                                - simple
-                              - properties:
-                                  consistentHash:
-                                    oneOf:
-                                    - not:
-                                        anyOf:
-                                        - required:
-                                          - httpHeaderName
-                                        - required:
-                                          - httpCookie
-                                        - required:
-                                          - useSourceIp
-                                        - required:
-                                          - httpQueryParameterName
-                                    - required:
-                                      - httpHeaderName
-                                    - required:
-                                      - httpCookie
-                                    - required:
-                                      - useSourceIp
-                                    - required:
-                                      - httpQueryParameterName
-                                required:
-                                - consistentHash
-                          - required:
-                            - simple
-                          - properties:
-                              consistentHash:
-                                oneOf:
-                                - not:
-                                    anyOf:
-                                    - required:
-                                      - httpHeaderName
-                                    - required:
-                                      - httpCookie
-                                    - required:
-                                      - useSourceIp
-                                    - required:
-                                      - httpQueryParameterName
-                                - required:
-                                  - httpHeaderName
-                                - required:
-                                  - httpCookie
-                                - required:
-                                  - useSourceIp
-                                - required:
-                                  - httpQueryParameterName
-                            required:
-                            - consistentHash
-                          properties:
-                            consistentHash:
-                              properties:
-                                httpCookie:
-                                  description: Hash based on HTTP cookie.
-                                  properties:
-                                    name:
-                                      description: Name of the cookie.
-                                      format: string
-                                      type: string
-                                    path:
-                                      description: Path to set for the cookie.
-                                      format: string
-                                      type: string
-                                    ttl:
-                                      description: Lifetime of the cookie.
-                                      type: string
-                                  type: object
-                                httpHeaderName:
-                                  description: Hash based on a specific HTTP header.
-                                  format: string
-                                  type: string
-                                httpQueryParameterName:
-                                  description: Hash based on a specific HTTP query
-                                    parameter.
-                                  format: string
-                                  type: string
-                                minimumRingSize:
-                                  type: integer
-                                useSourceIp:
-                                  description: Hash based on the source IP address.
-                                  type: boolean
-                              type: object
-                            localityLbSetting:
-                              properties:
-                                distribute:
-                                  description: 'Optional: only one of distribute or
-                                    failover can be set.'
-                                  items:
-                                    properties:
-                                      from:
-                                        description: Originating locality, '/' separated,
-                                          e.g.
-                                        format: string
-                                        type: string
-                                      to:
-                                        additionalProperties:
-                                          type: integer
-                                        description: Map of upstream localities to
-                                          traffic distribution weights.
-                                        type: object
-                                    type: object
-                                  type: array
-                                enabled:
-                                  description: enable locality load balancing, this
-                                    is DestinationRule-level and will override mesh
-                                    wide settings in entirety.
-                                  nullable: true
-                                  type: boolean
-                                failover:
-                                  description: 'Optional: only failover or distribute
-                                    can be set.'
-                                  items:
-                                    properties:
-                                      from:
-                                        description: Originating region.
-                                        format: string
-                                        type: string
-                                      to:
-                                        format: string
-                                        type: string
-                                    type: object
-                                  type: array
-                              type: object
-                            simple:
-                              enum:
-                              - ROUND_ROBIN
-                              - LEAST_CONN
-                              - RANDOM
-                              - PASSTHROUGH
-                              type: string
-                          type: object
-                        outlierDetection:
-                          properties:
-                            baseEjectionTime:
-                              description: Minimum ejection duration.
-                              type: string
-                            consecutive5xxErrors:
-                              description: Number of 5xx errors before a host is ejected
-                                from the connection pool.
-                              nullable: true
-                              type: integer
-                            consecutiveErrors:
-                              format: int32
-                              type: integer
-                            consecutiveGatewayErrors:
-                              description: Number of gateway errors before a host
-                                is ejected from the connection pool.
-                              nullable: true
-                              type: integer
-                            interval:
-                              description: Time interval between ejection sweep analysis.
-                              type: string
-                            maxEjectionPercent:
-                              format: int32
-                              type: integer
-                            minHealthPercent:
-                              format: int32
-                              type: integer
-                          type: object
-                        port:
-                          properties:
-                            number:
-                              type: integer
-                          type: object
-                        tls:
-                          description: TLS related settings for connections to the
-                            upstream service.
-                          properties:
-                            caCertificates:
-                              format: string
-                              type: string
-                            clientCertificate:
-                              description: REQUIRED if mode is `MUTUAL`.
-                              format: string
-                              type: string
-                            credentialName:
-                              format: string
-                              type: string
-                            mode:
-                              enum:
-                              - DISABLE
-                              - SIMPLE
-                              - MUTUAL
-                              - ISTIO_MUTUAL
-                              type: string
-                            privateKey:
-                              description: REQUIRED if mode is `MUTUAL`.
-                              format: string
-                              type: string
-                            sni:
-                              description: SNI string to present to the server during
-                                TLS handshake.
-                              format: string
-                              type: string
-                            subjectAltNames:
-                              items:
-                                format: string
-                                type: string
-                              type: array
-                          type: object
-                      type: object
-                    type: array
-                  tls:
-                    description: TLS related settings for connections to the upstream
-                      service.
-                    properties:
-                      caCertificates:
-                        format: string
-                        type: string
-                      clientCertificate:
-                        description: REQUIRED if mode is `MUTUAL`.
-                        format: string
-                        type: string
-                      credentialName:
-                        format: string
-                        type: string
-                      mode:
-                        enum:
-                        - DISABLE
-                        - SIMPLE
-                        - MUTUAL
-                        - ISTIO_MUTUAL
-                        type: string
-                      privateKey:
-                        description: REQUIRED if mode is `MUTUAL`.
-                        format: string
-                        type: string
-                      sni:
-                        description: SNI string to present to the server during TLS
-                          handshake.
-                        format: string
-                        type: string
-                      subjectAltNames:
-                        items:
-                          format: string
-                          type: string
-                        type: array
-                    type: object
-                type: object
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: false
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: istio-pilot
-    chart: istio
-    heritage: Tiller
-    release: istio
-  name: envoyfilters.networking.istio.io
-spec:
-  group: networking.istio.io
-  names:
-    categories:
-    - istio-io
-    - networking-istio-io
-    kind: EnvoyFilter
-    listKind: EnvoyFilterList
-    plural: envoyfilters
-    singular: envoyfilter
-  scope: Namespaced
-  versions:
-  - name: v1alpha3
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Customizing Envoy configuration generated by Istio. See
-              more details at: https://istio.io/docs/reference/config/networking/envoy-filter.html'
-            properties:
-              configPatches:
-                description: One or more patches with match conditions.
-                items:
-                  properties:
-                    applyTo:
-                      enum:
-                      - INVALID
-                      - LISTENER
-                      - FILTER_CHAIN
-                      - NETWORK_FILTER
-                      - HTTP_FILTER
-                      - ROUTE_CONFIGURATION
-                      - VIRTUAL_HOST
-                      - HTTP_ROUTE
-                      - CLUSTER
-                      type: string
-                    match:
-                      description: Match on listener/route configuration/cluster.
-                      oneOf:
-                      - not:
-                          anyOf:
-                          - required:
-                            - listener
-                          - required:
-                            - routeConfiguration
-                          - required:
-                            - cluster
-                      - required:
-                        - listener
-                      - required:
-                        - routeConfiguration
-                      - required:
-                        - cluster
-                      properties:
-                        cluster:
-                          description: Match on envoy cluster attributes.
-                          properties:
-                            name:
-                              description: The exact name of the cluster to match.
-                              format: string
-                              type: string
-                            portNumber:
-                              description: The service port for which this cluster
-                                was generated.
-                              type: integer
-                            service:
-                              description: The fully qualified service name for this
-                                cluster.
-                              format: string
-                              type: string
-                            subset:
-                              description: The subset associated with the service.
-                              format: string
-                              type: string
-                          type: object
-                        context:
-                          description: The specific config generation context to match
-                            on.
-                          enum:
-                          - ANY
-                          - SIDECAR_INBOUND
-                          - SIDECAR_OUTBOUND
-                          - GATEWAY
-                          type: string
-                        listener:
-                          description: Match on envoy listener attributes.
-                          properties:
-                            filterChain:
-                              description: Match a specific filter chain in a listener.
-                              properties:
-                                applicationProtocols:
-                                  description: Applies only to sidecars.
-                                  format: string
-                                  type: string
-                                filter:
-                                  description: The name of a specific filter to apply
-                                    the patch to.
-                                  properties:
-                                    name:
-                                      description: The filter name to match on.
-                                      format: string
-                                      type: string
-                                    subFilter:
-                                      properties:
-                                        name:
-                                          description: The filter name to match on.
-                                          format: string
-                                          type: string
-                                      type: object
-                                  type: object
-                                name:
-                                  description: The name assigned to the filter chain.
-                                  format: string
-                                  type: string
-                                sni:
-                                  description: The SNI value used by a filter chain's
-                                    match condition.
-                                  format: string
-                                  type: string
-                                transportProtocol:
-                                  description: Applies only to SIDECAR_INBOUND context.
-                                  format: string
-                                  type: string
-                              type: object
-                            name:
-                              description: Match a specific listener by its name.
-                              format: string
-                              type: string
-                            portName:
-                              format: string
-                              type: string
-                            portNumber:
-                              type: integer
-                          type: object
-                        proxy:
-                          description: Match on properties associated with a proxy.
-                          properties:
-                            metadata:
-                              additionalProperties:
-                                format: string
-                                type: string
-                              type: object
-                            proxyVersion:
-                              format: string
-                              type: string
-                          type: object
-                        routeConfiguration:
-                          description: Match on envoy HTTP route configuration attributes.
-                          properties:
-                            gateway:
-                              format: string
-                              type: string
-                            name:
-                              description: Route configuration name to match on.
-                              format: string
-                              type: string
-                            portName:
-                              description: Applicable only for GATEWAY context.
-                              format: string
-                              type: string
-                            portNumber:
-                              type: integer
-                            vhost:
-                              properties:
-                                name:
-                                  format: string
-                                  type: string
-                                route:
-                                  description: Match a specific route within the virtual
-                                    host.
-                                  properties:
-                                    action:
-                                      description: Match a route with specific action
-                                        type.
-                                      enum:
-                                      - ANY
-                                      - ROUTE
-                                      - REDIRECT
-                                      - DIRECT_RESPONSE
-                                      type: string
-                                    name:
-                                      format: string
-                                      type: string
-                                  type: object
-                              type: object
-                          type: object
-                      type: object
-                    patch:
-                      description: The patch to apply along with the operation.
-                      properties:
-                        operation:
-                          description: Determines how the patch should be applied.
-                          enum:
-                          - INVALID
-                          - MERGE
-                          - ADD
-                          - REMOVE
-                          - INSERT_BEFORE
-                          - INSERT_AFTER
-                          - INSERT_FIRST
-                          type: string
-                        value:
-                          description: The JSON config of the object being patched.
-                          type: object
-                          x-kubernetes-preserve-unknown-fields: true
-                      type: object
-                  type: object
-                type: array
-              workloadSelector:
-                properties:
-                  labels:
-                    additionalProperties:
-                      format: string
-                      type: string
-                    type: object
-                type: object
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: istio-pilot
-    chart: istio
-    heritage: Tiller
-    release: istio
-  name: gateways.networking.istio.io
-spec:
-  group: networking.istio.io
-  names:
-    categories:
-    - istio-io
-    - networking-istio-io
-    kind: Gateway
-    listKind: GatewayList
-    plural: gateways
-    shortNames:
-    - gw
-    singular: gateway
-  scope: Namespaced
-  versions:
-  - name: v1alpha3
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Configuration affecting edge load balancer. See more details
-              at: https://istio.io/docs/reference/config/networking/gateway.html'
-            properties:
-              selector:
-                additionalProperties:
-                  format: string
-                  type: string
-                type: object
-              servers:
-                description: A list of server specifications.
-                items:
-                  properties:
-                    bind:
-                      format: string
-                      type: string
-                    defaultEndpoint:
-                      format: string
-                      type: string
-                    hosts:
-                      description: One or more hosts exposed by this gateway.
-                      items:
-                        format: string
-                        type: string
-                      type: array
-                    name:
-                      description: An optional name of the server, when set must be
-                        unique across all servers.
-                      format: string
-                      type: string
-                    port:
-                      properties:
-                        name:
-                          description: Label assigned to the port.
-                          format: string
-                          type: string
-                        number:
-                          description: A valid non-negative integer port number.
-                          type: integer
-                        protocol:
-                          description: The protocol exposed on the port.
-                          format: string
-                          type: string
-                        targetPort:
-                          type: integer
-                      type: object
-                    tls:
-                      description: Set of TLS related options that govern the server's
-                        behavior.
-                      properties:
-                        caCertificates:
-                          description: REQUIRED if mode is `MUTUAL`.
-                          format: string
-                          type: string
-                        cipherSuites:
-                          description: 'Optional: If specified, only support the specified
-                            cipher list.'
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        credentialName:
-                          format: string
-                          type: string
-                        httpsRedirect:
-                          type: boolean
-                        maxProtocolVersion:
-                          description: 'Optional: Maximum TLS protocol version.'
-                          enum:
-                          - TLS_AUTO
-                          - TLSV1_0
-                          - TLSV1_1
-                          - TLSV1_2
-                          - TLSV1_3
-                          type: string
-                        minProtocolVersion:
-                          description: 'Optional: Minimum TLS protocol version.'
-                          enum:
-                          - TLS_AUTO
-                          - TLSV1_0
-                          - TLSV1_1
-                          - TLSV1_2
-                          - TLSV1_3
-                          type: string
-                        mode:
-                          enum:
-                          - PASSTHROUGH
-                          - SIMPLE
-                          - MUTUAL
-                          - AUTO_PASSTHROUGH
-                          - ISTIO_MUTUAL
-                          type: string
-                        privateKey:
-                          description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
-                          format: string
-                          type: string
-                        serverCertificate:
-                          description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
-                          format: string
-                          type: string
-                        subjectAltNames:
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        verifyCertificateHash:
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        verifyCertificateSpki:
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                      type: object
-                  type: object
-                type: array
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
-  - name: v1beta1
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Configuration affecting edge load balancer. See more details
-              at: https://istio.io/docs/reference/config/networking/gateway.html'
-            properties:
-              selector:
-                additionalProperties:
-                  format: string
-                  type: string
-                type: object
-              servers:
-                description: A list of server specifications.
-                items:
-                  properties:
-                    bind:
-                      format: string
-                      type: string
-                    defaultEndpoint:
-                      format: string
-                      type: string
-                    hosts:
-                      description: One or more hosts exposed by this gateway.
-                      items:
-                        format: string
-                        type: string
-                      type: array
-                    name:
-                      description: An optional name of the server, when set must be
-                        unique across all servers.
-                      format: string
-                      type: string
-                    port:
-                      properties:
-                        name:
-                          description: Label assigned to the port.
-                          format: string
-                          type: string
-                        number:
-                          description: A valid non-negative integer port number.
-                          type: integer
-                        protocol:
-                          description: The protocol exposed on the port.
-                          format: string
-                          type: string
-                        targetPort:
-                          type: integer
-                      type: object
-                    tls:
-                      description: Set of TLS related options that govern the server's
-                        behavior.
-                      properties:
-                        caCertificates:
-                          description: REQUIRED if mode is `MUTUAL`.
-                          format: string
-                          type: string
-                        cipherSuites:
-                          description: 'Optional: If specified, only support the specified
-                            cipher list.'
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        credentialName:
-                          format: string
-                          type: string
-                        httpsRedirect:
-                          type: boolean
-                        maxProtocolVersion:
-                          description: 'Optional: Maximum TLS protocol version.'
-                          enum:
-                          - TLS_AUTO
-                          - TLSV1_0
-                          - TLSV1_1
-                          - TLSV1_2
-                          - TLSV1_3
-                          type: string
-                        minProtocolVersion:
-                          description: 'Optional: Minimum TLS protocol version.'
-                          enum:
-                          - TLS_AUTO
-                          - TLSV1_0
-                          - TLSV1_1
-                          - TLSV1_2
-                          - TLSV1_3
-                          type: string
-                        mode:
-                          enum:
-                          - PASSTHROUGH
-                          - SIMPLE
-                          - MUTUAL
-                          - AUTO_PASSTHROUGH
-                          - ISTIO_MUTUAL
-                          type: string
-                        privateKey:
-                          description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
-                          format: string
-                          type: string
-                        serverCertificate:
-                          description: REQUIRED if mode is `SIMPLE` or `MUTUAL`.
-                          format: string
-                          type: string
-                        subjectAltNames:
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        verifyCertificateHash:
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        verifyCertificateSpki:
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                      type: object
-                  type: object
-                type: array
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: false
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: mixer
-    chart: istio
-    heritage: Tiller
-    istio: mixer-handler
-    package: handler
-    release: istio
-  name: handlers.config.istio.io
-spec:
-  group: config.istio.io
-  names:
-    categories:
-    - istio-io
-    - policy-istio-io
-    kind: handler
-    listKind: handlerList
-    plural: handlers
-    singular: handler
-  scope: Namespaced
-  versions:
-  - name: v1alpha2
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: Handler allows the operator to configure a specific adapter
-              implementation.
-            properties:
-              adapter:
-                description: The name of a specific adapter implementation.
-                format: string
-                type: string
-              compiledAdapter:
-                description: The name of the compiled in adapter this handler instantiates.
-                format: string
-                type: string
-              connection:
-                description: Information on how to connect to the out-of-process adapter.
-                properties:
-                  address:
-                    description: The address of the backend.
-                    format: string
-                    type: string
-                  authentication:
-                    description: Auth config for the connection to the backend.
-                    oneOf:
-                    - not:
-                        anyOf:
-                        - properties:
-                            tls:
-                              allOf:
-                              - oneOf:
-                                - not:
-                                    anyOf:
-                                    - required:
-                                      - tokenPath
-                                    - required:
-                                      - oauth
-                                - required:
-                                  - tokenPath
-                                - required:
-                                  - oauth
-                              - oneOf:
-                                - not:
-                                    anyOf:
-                                    - required:
-                                      - authHeader
-                                    - required:
-                                      - customHeader
-                                - required:
-                                  - authHeader
-                                - required:
-                                  - customHeader
-                          required:
-                          - tls
-                        - required:
-                          - mutual
-                    - properties:
-                        tls:
-                          allOf:
-                          - oneOf:
-                            - not:
-                                anyOf:
-                                - required:
-                                  - tokenPath
-                                - required:
-                                  - oauth
-                            - required:
-                              - tokenPath
-                            - required:
-                              - oauth
-                          - oneOf:
-                            - not:
-                                anyOf:
-                                - required:
-                                  - authHeader
-                                - required:
-                                  - customHeader
-                            - required:
-                              - authHeader
-                            - required:
-                              - customHeader
-                      required:
-                      - tls
-                    - required:
-                      - mutual
-                    properties:
-                      mutual:
-                        properties:
-                          caCertificates:
-                            format: string
-                            type: string
-                          clientCertificate:
-                            description: The path to the file holding client certificate
-                              for mutual TLS.
-                            format: string
-                            type: string
-                          privateKey:
-                            description: The path to the file holding the private
-                              key for mutual TLS.
-                            format: string
-                            type: string
-                          serverName:
-                            description: Used to configure mixer mutual TLS client
-                              to supply server name for SNI.
-                            format: string
-                            type: string
-                        type: object
-                      tls:
-                        properties:
-                          authHeader:
-                            description: Access token is passed as authorization header.
-                            enum:
-                            - PLAIN
-                            - BEARER
-                            type: string
-                          caCertificates:
-                            format: string
-                            type: string
-                          customHeader:
-                            description: Customized header key to hold access token,
-                              e.g.
-                            format: string
-                            type: string
-                          oauth:
-                            description: Oauth config to fetch access token from auth
-                              provider.
-                            properties:
-                              clientId:
-                                description: OAuth client id for mixer.
-                                format: string
-                                type: string
-                              clientSecret:
-                                description: The path to the file holding the client
-                                  secret for oauth.
-                                format: string
-                                type: string
-                              endpointParams:
-                                additionalProperties:
-                                  format: string
-                                  type: string
-                                description: Additional parameters for requests to
-                                  the token endpoint.
-                                type: object
-                              scopes:
-                                description: List of requested permissions.
-                                items:
-                                  format: string
-                                  type: string
-                                type: array
-                              tokenUrl:
-                                description: The Resource server's token endpoint
-                                  URL.
-                                format: string
-                                type: string
-                            type: object
-                          serverName:
-                            format: string
-                            type: string
-                          tokenPath:
-                            format: string
-                            type: string
-                        type: object
-                    type: object
-                  timeout:
-                    description: Timeout for remote calls to the backend.
-                    type: string
-                type: object
-              name:
-                description: Must be unique in the entire Mixer configuration.
-                format: string
-                type: string
-              params:
-                description: Depends on adapter implementation.
-                type: object
-                x-kubernetes-preserve-unknown-fields: true
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: istio-mixer
-    chart: istio
-    heritage: Tiller
-    release: istio
-  name: httpapispecbindings.config.istio.io
-spec:
-  group: config.istio.io
-  names:
-    categories:
-    - istio-io
-    - apim-istio-io
-    kind: HTTPAPISpecBinding
-    listKind: HTTPAPISpecBindingList
-    plural: httpapispecbindings
-    singular: httpapispecbinding
-  scope: Namespaced
-  versions:
-  - name: v1alpha2
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            properties:
-              api_specs:
-                items:
-                  properties:
-                    name:
-                      description: The short name of the HTTPAPISpec.
-                      format: string
-                      type: string
-                    namespace:
-                      description: Optional namespace of the HTTPAPISpec.
-                      format: string
-                      type: string
-                  type: object
-                type: array
-              apiSpecs:
-                items:
-                  properties:
-                    name:
-                      description: The short name of the HTTPAPISpec.
-                      format: string
-                      type: string
-                    namespace:
-                      description: Optional namespace of the HTTPAPISpec.
-                      format: string
-                      type: string
-                  type: object
-                type: array
-              services:
-                description: One or more services to map the listed HTTPAPISpec onto.
-                items:
-                  properties:
-                    domain:
-                      description: Domain suffix used to construct the service FQDN
-                        in implementations that support such specification.
-                      format: string
-                      type: string
-                    labels:
-                      additionalProperties:
-                        format: string
-                        type: string
-                      description: Optional one or more labels that uniquely identify
-                        the service version.
-                      type: object
-                    name:
-                      description: The short name of the service such as "foo".
-                      format: string
-                      type: string
-                    namespace:
-                      description: Optional namespace of the service.
-                      format: string
-                      type: string
-                    service:
-                      description: The service FQDN.
-                      format: string
-                      type: string
-                  type: object
-                type: array
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: istio-mixer
-    chart: istio
-    heritage: Tiller
-    release: istio
-  name: httpapispecs.config.istio.io
-spec:
-  group: config.istio.io
-  names:
-    categories:
-    - istio-io
-    - apim-istio-io
-    kind: HTTPAPISpec
-    listKind: HTTPAPISpecList
-    plural: httpapispecs
-    singular: httpapispec
-  scope: Namespaced
-  versions:
-  - name: v1alpha2
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            properties:
-              api_keys:
-                items:
-                  oneOf:
-                  - not:
-                      anyOf:
-                      - required:
-                        - query
-                      - required:
-                        - header
-                      - required:
-                        - cookie
-                  - required:
-                    - query
-                  - required:
-                    - header
-                  - required:
-                    - cookie
-                  properties:
-                    cookie:
-                      format: string
-                      type: string
-                    header:
-                      description: API key is sent in a request header.
-                      format: string
-                      type: string
-                    query:
-                      description: API Key is sent as a query parameter.
-                      format: string
-                      type: string
-                  type: object
-                type: array
-              apiKeys:
-                items:
-                  oneOf:
-                  - not:
-                      anyOf:
-                      - required:
-                        - query
-                      - required:
-                        - header
-                      - required:
-                        - cookie
-                  - required:
-                    - query
-                  - required:
-                    - header
-                  - required:
-                    - cookie
-                  properties:
-                    cookie:
-                      format: string
-                      type: string
-                    header:
-                      description: API key is sent in a request header.
-                      format: string
-                      type: string
-                    query:
-                      description: API Key is sent as a query parameter.
-                      format: string
-                      type: string
-                  type: object
-                type: array
-              attributes:
-                properties:
-                  attributes:
-                    additionalProperties:
-                      oneOf:
-                      - not:
-                          anyOf:
-                          - required:
-                            - stringValue
-                          - required:
-                            - int64Value
-                          - required:
-                            - doubleValue
-                          - required:
-                            - boolValue
-                          - required:
-                            - bytesValue
-                          - required:
-                            - timestampValue
-                          - required:
-                            - durationValue
-                          - required:
-                            - stringMapValue
-                      - required:
-                        - stringValue
-                      - required:
-                        - int64Value
-                      - required:
-                        - doubleValue
-                      - required:
-                        - boolValue
-                      - required:
-                        - bytesValue
-                      - required:
-                        - timestampValue
-                      - required:
-                        - durationValue
-                      - required:
-                        - stringMapValue
-                      properties:
-                        boolValue:
-                          type: boolean
-                        bytesValue:
-                          format: binary
-                          type: string
-                        doubleValue:
-                          format: double
-                          type: number
-                        durationValue:
-                          type: string
-                        int64Value:
-                          format: int64
-                          type: integer
-                        stringMapValue:
-                          properties:
-                            entries:
-                              additionalProperties:
-                                format: string
-                                type: string
-                              description: Holds a set of name/value pairs.
-                              type: object
-                          type: object
-                        stringValue:
-                          format: string
-                          type: string
-                        timestampValue:
-                          format: dateTime
-                          type: string
-                      type: object
-                    description: A map of attribute name to its value.
-                    type: object
-                type: object
-              patterns:
-                description: List of HTTP patterns to match.
-                items:
-                  oneOf:
-                  - not:
-                      anyOf:
-                      - required:
-                        - uriTemplate
-                      - required:
-                        - regex
-                  - required:
-                    - uriTemplate
-                  - required:
-                    - regex
-                  properties:
-                    attributes:
-                      properties:
-                        attributes:
-                          additionalProperties:
-                            oneOf:
-                            - not:
-                                anyOf:
-                                - required:
-                                  - stringValue
-                                - required:
-                                  - int64Value
-                                - required:
-                                  - doubleValue
-                                - required:
-                                  - boolValue
-                                - required:
-                                  - bytesValue
-                                - required:
-                                  - timestampValue
-                                - required:
-                                  - durationValue
-                                - required:
-                                  - stringMapValue
-                            - required:
-                              - stringValue
-                            - required:
-                              - int64Value
-                            - required:
-                              - doubleValue
-                            - required:
-                              - boolValue
-                            - required:
-                              - bytesValue
-                            - required:
-                              - timestampValue
-                            - required:
-                              - durationValue
-                            - required:
-                              - stringMapValue
-                            properties:
-                              boolValue:
-                                type: boolean
-                              bytesValue:
-                                format: binary
-                                type: string
-                              doubleValue:
-                                format: double
-                                type: number
-                              durationValue:
-                                type: string
-                              int64Value:
-                                format: int64
-                                type: integer
-                              stringMapValue:
-                                properties:
-                                  entries:
-                                    additionalProperties:
-                                      format: string
-                                      type: string
-                                    description: Holds a set of name/value pairs.
-                                    type: object
-                                type: object
-                              stringValue:
-                                format: string
-                                type: string
-                              timestampValue:
-                                format: dateTime
-                                type: string
-                            type: object
-                          description: A map of attribute name to its value.
-                          type: object
-                      type: object
-                    httpMethod:
-                      format: string
-                      type: string
-                    regex:
-                      format: string
-                      type: string
-                    uriTemplate:
-                      format: string
-                      type: string
-                  type: object
-                type: array
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: mixer
-    chart: istio
-    heritage: Tiller
-    istio: mixer-instance
-    package: instance
-    release: istio
-  name: instances.config.istio.io
-spec:
-  group: config.istio.io
-  names:
-    categories:
-    - istio-io
-    - policy-istio-io
-    kind: instance
-    listKind: instanceList
-    plural: instances
-    singular: instance
-  scope: Namespaced
-  versions:
-  - name: v1alpha2
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: An Instance tells Mixer how to create instances for particular
-              template.
-            properties:
-              attributeBindings:
-                additionalProperties:
-                  format: string
-                  type: string
-                type: object
-              compiledTemplate:
-                description: The name of the compiled in template this instance creates
-                  instances for.
-                format: string
-                type: string
-              name:
-                format: string
-                type: string
-              params:
-                description: Depends on referenced template.
-                type: object
-                x-kubernetes-preserve-unknown-fields: true
-              template:
-                description: The name of the template this instance creates instances
-                  for.
-                format: string
-                type: string
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  name: istiooperators.install.istio.io
-  labels:
-    release: istio
-spec:
-  group: install.istio.io
-  names:
-    kind: IstioOperator
-    plural: istiooperators
-    singular: istiooperator
-    shortNames:
-      - iop
-  scope: Namespaced
-  versions:
-    - additionalPrinterColumns:
-        - description: Istio control plane revision
-          jsonPath: .spec.revision
-          name: Revision
-          type: string
-        - description: IOP current state
-          jsonPath: .status.status
-          type: string
-          name: Status
-        - jsonPath: .metadata.creationTimestamp
-          description:
-            "CreationTimestamp is a timestamp representing the server time when
-            this object was created. It is not guaranteed to be set in happens-before order
-            across separate operations. Clients may not set this value. It is represented
-            in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
-            lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata"
-          name: Age
-          type: date
-      name: v1alpha1
-      schema:
-        openAPIV3Schema:
-          properties:
-            apiVersion:
-              description:
-                "APIVersion defines the versioned schema of this representation
-                of an object. Servers should convert recognized schemas to the latest
-                internal value, and may reject unrecognized values.
-                More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#resources"
-              type: string
-            kind:
-              description:
-                "Kind is a string value representing the REST resource this
-                object represents. Servers may infer this from the endpoint the client
-                submits requests to. Cannot be updated. In CamelCase.
-                More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#types-kinds"
-              type: string
-            spec:
-              description:
-                "Specification of the desired state of the istio control plane resource.
-                More info: https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status"
-              x-kubernetes-preserve-unknown-fields: true
-              type: object
-            status:
-              description:
-                "Status describes each of istio control plane component status at the current time.
-                0 means NONE, 1 means UPDATING, 2 means HEALTHY, 3 means ERROR, 4 means RECONCILING.
-                More info: https://github.com/istio/api/blob/master/operator/v1alpha1/istio.operator.v1alpha1.pb.html &
-                https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#spec-and-status"
-              x-kubernetes-preserve-unknown-fields: true
-              type: object
-          type: object
-      served: true
-      storage: true
-      subresources:
-        status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: istio-pilot
-    chart: istio
-    heritage: Tiller
-    istio: security
-    release: istio
-  name: peerauthentications.security.istio.io
-spec:
-  group: security.istio.io
-  names:
-    categories:
-    - istio-io
-    - security-istio-io
-    kind: PeerAuthentication
-    listKind: PeerAuthenticationList
-    plural: peerauthentications
-    shortNames:
-    - pa
-    singular: peerauthentication
-  scope: Namespaced
-  versions:
-  - name: v1beta1
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: PeerAuthentication defines how traffic will be tunneled (or
-              not) to the sidecar.
-            properties:
-              mtls:
-                description: Mutual TLS settings for workload.
-                properties:
-                  mode:
-                    description: Defines the mTLS mode used for peer authentication.
-                    enum:
-                    - UNSET
-                    - DISABLE
-                    - PERMISSIVE
-                    - STRICT
-                    type: string
-                type: object
-              portLevelMtls:
-                additionalProperties:
-                  properties:
-                    mode:
-                      description: Defines the mTLS mode used for peer authentication.
-                      enum:
-                      - UNSET
-                      - DISABLE
-                      - PERMISSIVE
-                      - STRICT
-                      type: string
-                  type: object
-                description: Port specific mutual TLS settings.
-                type: object
-              selector:
-                description: The selector determines the workloads to apply the ChannelAuthentication
-                  on.
-                properties:
-                  matchLabels:
-                    additionalProperties:
-                      format: string
-                      type: string
-                    type: object
-                type: object
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: istio-mixer
-    chart: istio
-    heritage: Tiller
-    release: istio
-  name: quotaspecbindings.config.istio.io
-spec:
-  group: config.istio.io
-  names:
-    categories:
-    - istio-io
-    - apim-istio-io
-    kind: QuotaSpecBinding
-    listKind: QuotaSpecBindingList
-    plural: quotaspecbindings
-    singular: quotaspecbinding
-  scope: Namespaced
-  versions:
-  - name: v1alpha2
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            properties:
-              quotaSpecs:
-                items:
-                  properties:
-                    name:
-                      description: The short name of the QuotaSpec.
-                      format: string
-                      type: string
-                    namespace:
-                      description: Optional namespace of the QuotaSpec.
-                      format: string
-                      type: string
-                  type: object
-                type: array
-              services:
-                description: One or more services to map the listed QuotaSpec onto.
-                items:
-                  properties:
-                    domain:
-                      description: Domain suffix used to construct the service FQDN
-                        in implementations that support such specification.
-                      format: string
-                      type: string
-                    labels:
-                      additionalProperties:
-                        format: string
-                        type: string
-                      description: Optional one or more labels that uniquely identify
-                        the service version.
-                      type: object
-                    name:
-                      description: The short name of the service such as "foo".
-                      format: string
-                      type: string
-                    namespace:
-                      description: Optional namespace of the service.
-                      format: string
-                      type: string
-                    service:
-                      description: The service FQDN.
-                      format: string
-                      type: string
-                  type: object
-                type: array
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: istio-mixer
-    chart: istio
-    heritage: Tiller
-    release: istio
-  name: quotaspecs.config.istio.io
-spec:
-  group: config.istio.io
-  names:
-    categories:
-    - istio-io
-    - apim-istio-io
-    kind: QuotaSpec
-    listKind: QuotaSpecList
-    plural: quotaspecs
-    singular: quotaspec
-  scope: Namespaced
-  versions:
-  - name: v1alpha2
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: Determines the quotas used for individual requests.
-            properties:
-              rules:
-                description: A list of Quota rules.
-                items:
-                  properties:
-                    match:
-                      description: If empty, match all request.
-                      items:
-                        properties:
-                          clause:
-                            additionalProperties:
-                              oneOf:
-                              - not:
-                                  anyOf:
-                                  - required:
-                                    - exact
-                                  - required:
-                                    - prefix
-                                  - required:
-                                    - regex
-                              - required:
-                                - exact
-                              - required:
-                                - prefix
-                              - required:
-                                - regex
-                              properties:
-                                exact:
-                                  format: string
-                                  type: string
-                                prefix:
-                                  format: string
-                                  type: string
-                                regex:
-                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                  format: string
-                                  type: string
-                              type: object
-                            description: Map of attribute names to StringMatch type.
-                            type: object
-                        type: object
-                      type: array
-                    quotas:
-                      description: The list of quotas to charge.
-                      items:
-                        properties:
-                          charge:
-                            format: int32
-                            type: integer
-                          quota:
-                            format: string
-                            type: string
-                        type: object
-                      type: array
-                  type: object
-                type: array
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: istio-pilot
-    chart: istio
-    heritage: Tiller
-    istio: security
-    release: istio
-  name: requestauthentications.security.istio.io
-spec:
-  group: security.istio.io
-  names:
-    categories:
-    - istio-io
-    - security-istio-io
-    kind: RequestAuthentication
-    listKind: RequestAuthenticationList
-    plural: requestauthentications
-    shortNames:
-    - ra
-    singular: requestauthentication
-  scope: Namespaced
-  versions:
-  - name: v1beta1
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: RequestAuthentication defines what request authentication
-              methods are supported by a workload.
-            properties:
-              jwtRules:
-                description: Define the list of JWTs that can be validated at the
-                  selected workloads' proxy.
-                items:
-                  properties:
-                    audiences:
-                      items:
-                        format: string
-                        type: string
-                      type: array
-                    forwardOriginalToken:
-                      description: If set to true, the orginal token will be kept
-                        for the ustream request.
-                      type: boolean
-                    fromHeaders:
-                      description: List of header locations from which JWT is expected.
-                      items:
-                        properties:
-                          name:
-                            description: The HTTP header name.
-                            format: string
-                            type: string
-                          prefix:
-                            description: The prefix that should be stripped before
-                              decoding the token.
-                            format: string
-                            type: string
-                        type: object
-                      type: array
-                    fromParams:
-                      description: List of query parameters from which JWT is expected.
-                      items:
-                        format: string
-                        type: string
-                      type: array
-                    issuer:
-                      description: Identifies the issuer that issued the JWT.
-                      format: string
-                      type: string
-                    jwks:
-                      description: JSON Web Key Set of public keys to validate signature
-                        of the JWT.
-                      format: string
-                      type: string
-                    jwks_uri:
-                      format: string
-                      type: string
-                    jwksUri:
-                      format: string
-                      type: string
-                    outputPayloadToHeader:
-                      format: string
-                      type: string
-                  type: object
-                type: array
-              selector:
-                description: The selector determines the workloads to apply the RequestAuthentication
-                  on.
-                properties:
-                  matchLabels:
-                    additionalProperties:
-                      format: string
-                      type: string
-                    type: object
-                type: object
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: mixer
-    chart: istio
-    heritage: Tiller
-    istio: core
-    package: istio.io.mixer
-    release: istio
-  name: rules.config.istio.io
-spec:
-  group: config.istio.io
-  names:
-    categories:
-    - istio-io
-    - policy-istio-io
-    kind: rule
-    listKind: ruleList
-    plural: rules
-    singular: rule
-  scope: Namespaced
-  versions:
-  - name: v1alpha2
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Describes the rules used to configure Mixer''s policy and
-              telemetry features. See more details at: https://istio.io/docs/reference/config/policy-and-telemetry/istio.policy.v1beta1.html'
-            properties:
-              actions:
-                description: The actions that will be executed when match evaluates
-                  to `true`.
-                items:
-                  properties:
-                    handler:
-                      description: Fully qualified name of the handler to invoke.
-                      format: string
-                      type: string
-                    instances:
-                      items:
-                        format: string
-                        type: string
-                      type: array
-                    name:
-                      description: A handle to refer to the results of the action.
-                      format: string
-                      type: string
-                  type: object
-                type: array
-              match:
-                description: Match is an attribute based predicate.
-                format: string
-                type: string
-              requestHeaderOperations:
-                items:
-                  properties:
-                    name:
-                      description: Header name literal value.
-                      format: string
-                      type: string
-                    operation:
-                      description: Header operation type.
-                      enum:
-                      - REPLACE
-                      - REMOVE
-                      - APPEND
-                      type: string
-                    values:
-                      description: Header value expressions.
-                      items:
-                        format: string
-                        type: string
-                      type: array
-                  type: object
-                type: array
-              responseHeaderOperations:
-                items:
-                  properties:
-                    name:
-                      description: Header name literal value.
-                      format: string
-                      type: string
-                    operation:
-                      description: Header operation type.
-                      enum:
-                      - REPLACE
-                      - REMOVE
-                      - APPEND
-                      type: string
-                    values:
-                      description: Header value expressions.
-                      items:
-                        format: string
-                        type: string
-                      type: array
-                  type: object
-                type: array
-              sampling:
-                properties:
-                  random:
-                    description: Provides filtering of actions based on random selection
-                      per request.
-                    properties:
-                      attributeExpression:
-                        description: Specifies an attribute expression to use to override
-                          the numerator in the `percent_sampled` field.
-                        format: string
-                        type: string
-                      percentSampled:
-                        description: The default sampling rate, expressed as a percentage.
-                        properties:
-                          denominator:
-                            description: Specifies the denominator.
-                            enum:
-                            - HUNDRED
-                            - TEN_THOUSAND
-                            type: string
-                          numerator:
-                            description: Specifies the numerator.
-                            type: integer
-                        type: object
-                      useIndependentRandomness:
-                        description: By default sampling will be based on the value
-                          of the request header `x-request-id`.
-                        type: boolean
-                    type: object
-                  rateLimit:
-                    properties:
-                      maxUnsampledEntries:
-                        description: Number of entries to allow during the `sampling_duration`
-                          before sampling is enforced.
-                        format: int64
-                        type: integer
-                      samplingDuration:
-                        description: Window in which to enforce the sampling rate.
-                        type: string
-                      samplingRate:
-                        description: The rate at which to sample entries once the
-                          unsampled limit has been reached.
-                        format: int64
-                        type: integer
-                    type: object
-                type: object
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: istio-pilot
-    chart: istio
-    heritage: Tiller
-    release: istio
-  name: serviceentries.networking.istio.io
-spec:
-  group: networking.istio.io
-  names:
-    categories:
-    - istio-io
-    - networking-istio-io
-    kind: ServiceEntry
-    listKind: ServiceEntryList
-    plural: serviceentries
-    shortNames:
-    - se
-    singular: serviceentry
-  scope: Namespaced
-  versions:
-  - additionalPrinterColumns:
-    - description: The hosts associated with the ServiceEntry
-      jsonPath: .spec.hosts
-      name: Hosts
-      type: string
-    - description: Whether the service is external to the mesh or part of the mesh
-        (MESH_EXTERNAL or MESH_INTERNAL)
-      jsonPath: .spec.location
-      name: Location
-      type: string
-    - description: Service discovery mode for the hosts (NONE, STATIC, or DNS)
-      jsonPath: .spec.resolution
-      name: Resolution
-      type: string
-    - description: 'CreationTimestamp is a timestamp representing the server time
-        when this object was created. It is not guaranteed to be set in happens-before
-        order across separate operations. Clients may not set this value. It is represented
-        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
-        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
-      jsonPath: .metadata.creationTimestamp
-      name: Age
-      type: date
-    name: v1alpha3
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Configuration affecting service registry. See more details
-              at: https://istio.io/docs/reference/config/networking/service-entry.html'
-            properties:
-              addresses:
-                description: The virtual IP addresses associated with the service.
-                items:
-                  format: string
-                  type: string
-                type: array
-              endpoints:
-                description: One or more endpoints associated with the service.
-                items:
-                  properties:
-                    address:
-                      format: string
-                      type: string
-                    labels:
-                      additionalProperties:
-                        format: string
-                        type: string
-                      description: One or more labels associated with the endpoint.
-                      type: object
-                    locality:
-                      description: The locality associated with the endpoint.
-                      format: string
-                      type: string
-                    network:
-                      format: string
-                      type: string
-                    ports:
-                      additionalProperties:
-                        type: integer
-                      description: Set of ports associated with the endpoint.
-                      type: object
-                    serviceAccount:
-                      format: string
-                      type: string
-                    weight:
-                      description: The load balancing weight associated with the endpoint.
-                      type: integer
-                  type: object
-                type: array
-              exportTo:
-                description: A list of namespaces to which this service is exported.
-                items:
-                  format: string
-                  type: string
-                type: array
-              hosts:
-                description: The hosts associated with the ServiceEntry.
-                items:
-                  format: string
-                  type: string
-                type: array
-              location:
-                enum:
-                - MESH_EXTERNAL
-                - MESH_INTERNAL
-                type: string
-              ports:
-                description: The ports associated with the external service.
-                items:
-                  properties:
-                    name:
-                      description: Label assigned to the port.
-                      format: string
-                      type: string
-                    number:
-                      description: A valid non-negative integer port number.
-                      type: integer
-                    protocol:
-                      description: The protocol exposed on the port.
-                      format: string
-                      type: string
-                    targetPort:
-                      type: integer
-                  type: object
-                type: array
-              resolution:
-                description: Service discovery mode for the hosts.
-                enum:
-                - NONE
-                - STATIC
-                - DNS
-                type: string
-              subjectAltNames:
-                items:
-                  format: string
-                  type: string
-                type: array
-              workloadSelector:
-                description: Applicable only for MESH_INTERNAL services.
-                properties:
-                  labels:
-                    additionalProperties:
-                      format: string
-                      type: string
-                    type: object
-                type: object
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
-  - additionalPrinterColumns:
-    - description: The hosts associated with the ServiceEntry
-      jsonPath: .spec.hosts
-      name: Hosts
-      type: string
-    - description: Whether the service is external to the mesh or part of the mesh
-        (MESH_EXTERNAL or MESH_INTERNAL)
-      jsonPath: .spec.location
-      name: Location
-      type: string
-    - description: Service discovery mode for the hosts (NONE, STATIC, or DNS)
-      jsonPath: .spec.resolution
-      name: Resolution
-      type: string
-    - description: 'CreationTimestamp is a timestamp representing the server time
-        when this object was created. It is not guaranteed to be set in happens-before
-        order across separate operations. Clients may not set this value. It is represented
-        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
-        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
-      jsonPath: .metadata.creationTimestamp
-      name: Age
-      type: date
-    name: v1beta1
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Configuration affecting service registry. See more details
-              at: https://istio.io/docs/reference/config/networking/service-entry.html'
-            properties:
-              addresses:
-                description: The virtual IP addresses associated with the service.
-                items:
-                  format: string
-                  type: string
-                type: array
-              endpoints:
-                description: One or more endpoints associated with the service.
-                items:
-                  properties:
-                    address:
-                      format: string
-                      type: string
-                    labels:
-                      additionalProperties:
-                        format: string
-                        type: string
-                      description: One or more labels associated with the endpoint.
-                      type: object
-                    locality:
-                      description: The locality associated with the endpoint.
-                      format: string
-                      type: string
-                    network:
-                      format: string
-                      type: string
-                    ports:
-                      additionalProperties:
-                        type: integer
-                      description: Set of ports associated with the endpoint.
-                      type: object
-                    serviceAccount:
-                      format: string
-                      type: string
-                    weight:
-                      description: The load balancing weight associated with the endpoint.
-                      type: integer
-                  type: object
-                type: array
-              exportTo:
-                description: A list of namespaces to which this service is exported.
-                items:
-                  format: string
-                  type: string
-                type: array
-              hosts:
-                description: The hosts associated with the ServiceEntry.
-                items:
-                  format: string
-                  type: string
-                type: array
-              location:
-                enum:
-                - MESH_EXTERNAL
-                - MESH_INTERNAL
-                type: string
-              ports:
-                description: The ports associated with the external service.
-                items:
-                  properties:
-                    name:
-                      description: Label assigned to the port.
-                      format: string
-                      type: string
-                    number:
-                      description: A valid non-negative integer port number.
-                      type: integer
-                    protocol:
-                      description: The protocol exposed on the port.
-                      format: string
-                      type: string
-                    targetPort:
-                      type: integer
-                  type: object
-                type: array
-              resolution:
-                description: Service discovery mode for the hosts.
-                enum:
-                - NONE
-                - STATIC
-                - DNS
-                type: string
-              subjectAltNames:
-                items:
-                  format: string
-                  type: string
-                type: array
-              workloadSelector:
-                description: Applicable only for MESH_INTERNAL services.
-                properties:
-                  labels:
-                    additionalProperties:
-                      format: string
-                      type: string
-                    type: object
-                type: object
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: false
-    subresources:
-      status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: istio-pilot
-    chart: istio
-    heritage: Tiller
-    release: istio
-  name: sidecars.networking.istio.io
-spec:
-  group: networking.istio.io
-  names:
-    categories:
-    - istio-io
-    - networking-istio-io
-    kind: Sidecar
-    listKind: SidecarList
-    plural: sidecars
-    singular: sidecar
-  scope: Namespaced
-  versions:
-  - name: v1alpha3
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Configuration affecting network reachability of a sidecar.
-              See more details at: https://istio.io/docs/reference/config/networking/sidecar.html'
-            properties:
-              egress:
-                items:
-                  properties:
-                    bind:
-                      format: string
-                      type: string
-                    captureMode:
-                      enum:
-                      - DEFAULT
-                      - IPTABLES
-                      - NONE
-                      type: string
-                    hosts:
-                      items:
-                        format: string
-                        type: string
-                      type: array
-                    port:
-                      description: The port associated with the listener.
-                      properties:
-                        name:
-                          description: Label assigned to the port.
-                          format: string
-                          type: string
-                        number:
-                          description: A valid non-negative integer port number.
-                          type: integer
-                        protocol:
-                          description: The protocol exposed on the port.
-                          format: string
-                          type: string
-                        targetPort:
-                          type: integer
-                      type: object
-                  type: object
-                type: array
-              ingress:
-                items:
-                  properties:
-                    bind:
-                      description: The IP to which the listener should be bound.
-                      format: string
-                      type: string
-                    captureMode:
-                      enum:
-                      - DEFAULT
-                      - IPTABLES
-                      - NONE
-                      type: string
-                    defaultEndpoint:
-                      format: string
-                      type: string
-                    port:
-                      description: The port associated with the listener.
-                      properties:
-                        name:
-                          description: Label assigned to the port.
-                          format: string
-                          type: string
-                        number:
-                          description: A valid non-negative integer port number.
-                          type: integer
-                        protocol:
-                          description: The protocol exposed on the port.
-                          format: string
-                          type: string
-                        targetPort:
-                          type: integer
-                      type: object
-                  type: object
-                type: array
-              outboundTrafficPolicy:
-                description: Configuration for the outbound traffic policy.
-                properties:
-                  egressProxy:
-                    properties:
-                      host:
-                        description: The name of a service from the service registry.
-                        format: string
-                        type: string
-                      port:
-                        description: Specifies the port on the host that is being
-                          addressed.
-                        properties:
-                          number:
-                            type: integer
-                        type: object
-                      subset:
-                        description: The name of a subset within the service.
-                        format: string
-                        type: string
-                    type: object
-                  mode:
-                    enum:
-                    - REGISTRY_ONLY
-                    - ALLOW_ANY
-                    type: string
-                type: object
-              workloadSelector:
-                properties:
-                  labels:
-                    additionalProperties:
-                      format: string
-                      type: string
-                    type: object
-                type: object
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
-  - name: v1beta1
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Configuration affecting network reachability of a sidecar.
-              See more details at: https://istio.io/docs/reference/config/networking/sidecar.html'
-            properties:
-              egress:
-                items:
-                  properties:
-                    bind:
-                      format: string
-                      type: string
-                    captureMode:
-                      enum:
-                      - DEFAULT
-                      - IPTABLES
-                      - NONE
-                      type: string
-                    hosts:
-                      items:
-                        format: string
-                        type: string
-                      type: array
-                    port:
-                      description: The port associated with the listener.
-                      properties:
-                        name:
-                          description: Label assigned to the port.
-                          format: string
-                          type: string
-                        number:
-                          description: A valid non-negative integer port number.
-                          type: integer
-                        protocol:
-                          description: The protocol exposed on the port.
-                          format: string
-                          type: string
-                        targetPort:
-                          type: integer
-                      type: object
-                  type: object
-                type: array
-              ingress:
-                items:
-                  properties:
-                    bind:
-                      description: The IP to which the listener should be bound.
-                      format: string
-                      type: string
-                    captureMode:
-                      enum:
-                      - DEFAULT
-                      - IPTABLES
-                      - NONE
-                      type: string
-                    defaultEndpoint:
-                      format: string
-                      type: string
-                    port:
-                      description: The port associated with the listener.
-                      properties:
-                        name:
-                          description: Label assigned to the port.
-                          format: string
-                          type: string
-                        number:
-                          description: A valid non-negative integer port number.
-                          type: integer
-                        protocol:
-                          description: The protocol exposed on the port.
-                          format: string
-                          type: string
-                        targetPort:
-                          type: integer
-                      type: object
-                  type: object
-                type: array
-              outboundTrafficPolicy:
-                description: Configuration for the outbound traffic policy.
-                properties:
-                  egressProxy:
-                    properties:
-                      host:
-                        description: The name of a service from the service registry.
-                        format: string
-                        type: string
-                      port:
-                        description: Specifies the port on the host that is being
-                          addressed.
-                        properties:
-                          number:
-                            type: integer
-                        type: object
-                      subset:
-                        description: The name of a subset within the service.
-                        format: string
-                        type: string
-                    type: object
-                  mode:
-                    enum:
-                    - REGISTRY_ONLY
-                    - ALLOW_ANY
-                    type: string
-                type: object
-              workloadSelector:
-                properties:
-                  labels:
-                    additionalProperties:
-                      format: string
-                      type: string
-                    type: object
-                type: object
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: false
-    subresources:
-      status: {}
----
-kind: CustomResourceDefinition
-apiVersion: apiextensions.k8s.io/v1
-metadata:
-  name: templates.config.istio.io
-  labels:
-    app: mixer
-    package: template
-    istio: mixer-template
-    chart: istio
-    heritage: Tiller
-    release: istio
-  annotations:
-    "helm.sh/resource-policy": keep
-spec:
-  group: config.istio.io
-  names:
-    kind: template
-    plural: templates
-    singular: template
-    categories:
-      - istio-io
-      - policy-istio-io
-  scope: Namespaced
-  versions:
-    - name: v1alpha2
-      schema:
-        openAPIV3Schema:
-          properties:
-            spec:
-              x-kubernetes-preserve-unknown-fields: true
-              type: object
-            status:
-              x-kubernetes-preserve-unknown-fields: true
-              type: object
-          type: object
-      served: true
-      storage: true
-      subresources:
-        status: {}
 ---
+# Source: crds/crd-operator.yaml
+# SYNC WITH manifests/charts/base/files
 apiVersion: apiextensions.k8s.io/v1
 kind: CustomResourceDefinition
 metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
+  name: istiooperators.install.istio.io
   labels:
-    app: istio-pilot
-    chart: istio
-    heritage: Tiller
     release: istio
-  name: virtualservices.networking.istio.io
 spec:
-  group: networking.istio.io
+  conversion:
+    strategy: None
+  group: install.istio.io
   names:
-    categories:
-    - istio-io
-    - networking-istio-io
-    kind: VirtualService
-    listKind: VirtualServiceList
-    plural: virtualservices
+    kind: IstioOperator
+    listKind: IstioOperatorList
+    plural: istiooperators
+    singular: istiooperator
     shortNames:
-    - vs
-    singular: virtualservice
+    - iop
+    - io
   scope: Namespaced
   versions:
   - additionalPrinterColumns:
-    - description: The names of gateways and sidecars that should apply these routes
-      jsonPath: .spec.gateways
-      name: Gateways
-      type: string
-    - description: The destination hosts to which traffic is being sent
-      jsonPath: .spec.hosts
-      name: Hosts
-      type: string
-    - description: 'CreationTimestamp is a timestamp representing the server time
-        when this object was created. It is not guaranteed to be set in happens-before
-        order across separate operations. Clients may not set this value. It is represented
-        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
-        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
-      jsonPath: .metadata.creationTimestamp
-      name: Age
-      type: date
-    name: v1alpha3
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Configuration affecting label/content routing, sni routing,
-              etc. See more details at: https://istio.io/docs/reference/config/networking/virtual-service.html'
-            properties:
-              exportTo:
-                description: A list of namespaces to which this virtual service is
-                  exported.
-                items:
-                  format: string
-                  type: string
-                type: array
-              gateways:
-                description: The names of gateways and sidecars that should apply
-                  these routes.
-                items:
-                  format: string
-                  type: string
-                type: array
-              hosts:
-                description: The destination hosts to which traffic is being sent.
-                items:
-                  format: string
-                  type: string
-                type: array
-              http:
-                description: An ordered list of route rules for HTTP traffic.
-                items:
-                  properties:
-                    corsPolicy:
-                      description: Cross-Origin Resource Sharing policy (CORS).
-                      properties:
-                        allowCredentials:
-                          nullable: true
-                          type: boolean
-                        allowHeaders:
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        allowMethods:
-                          description: List of HTTP methods allowed to access the
-                            resource.
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        allowOrigin:
-                          description: The list of origins that are allowed to perform
-                            CORS requests.
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        allowOrigins:
-                          description: String patterns that match allowed origins.
-                          items:
-                            oneOf:
-                            - not:
-                                anyOf:
-                                - required:
-                                  - exact
-                                - required:
-                                  - prefix
-                                - required:
-                                  - regex
-                            - required:
-                              - exact
-                            - required:
-                              - prefix
-                            - required:
-                              - regex
-                            properties:
-                              exact:
-                                format: string
-                                type: string
-                              prefix:
-                                format: string
-                                type: string
-                              regex:
-                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                format: string
-                                type: string
-                            type: object
-                          type: array
-                        exposeHeaders:
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        maxAge:
-                          type: string
-                      type: object
-                    delegate:
-                      properties:
-                        name:
-                          description: Name specifies the name of the delegate VirtualService.
-                          format: string
-                          type: string
-                        namespace:
-                          description: Namespace specifies the namespace where the
-                            delegate VirtualService resides.
-                          format: string
-                          type: string
-                      type: object
-                    fault:
-                      description: Fault injection policy to apply on HTTP traffic
-                        at the client side.
-                      properties:
-                        abort:
-                          oneOf:
-                          - not:
-                              anyOf:
-                              - required:
-                                - httpStatus
-                              - required:
-                                - grpcStatus
-                              - required:
-                                - http2Error
-                          - required:
-                            - httpStatus
-                          - required:
-                            - grpcStatus
-                          - required:
-                            - http2Error
-                          properties:
-                            grpcStatus:
-                              format: string
-                              type: string
-                            http2Error:
-                              format: string
-                              type: string
-                            httpStatus:
-                              description: HTTP status code to use to abort the Http
-                                request.
-                              format: int32
-                              type: integer
-                            percentage:
-                              description: Percentage of requests to be aborted with
-                                the error code provided.
-                              properties:
-                                value:
-                                  format: double
-                                  type: number
-                              type: object
-                          type: object
-                        delay:
-                          oneOf:
-                          - not:
-                              anyOf:
-                              - required:
-                                - fixedDelay
-                              - required:
-                                - exponentialDelay
-                          - required:
-                            - fixedDelay
-                          - required:
-                            - exponentialDelay
-                          properties:
-                            exponentialDelay:
-                              type: string
-                            fixedDelay:
-                              description: Add a fixed delay before forwarding the
-                                request.
-                              type: string
-                            percent:
-                              description: Percentage of requests on which the delay
-                                will be injected (0-100).
-                              format: int32
-                              type: integer
-                            percentage:
-                              description: Percentage of requests on which the delay
-                                will be injected.
-                              properties:
-                                value:
-                                  format: double
-                                  type: number
-                              type: object
-                          type: object
-                      type: object
-                    headers:
-                      properties:
-                        request:
-                          properties:
-                            add:
-                              additionalProperties:
-                                format: string
-                                type: string
-                              type: object
-                            remove:
-                              items:
-                                format: string
-                                type: string
-                              type: array
-                            set:
-                              additionalProperties:
-                                format: string
-                                type: string
-                              type: object
-                          type: object
-                        response:
-                          properties:
-                            add:
-                              additionalProperties:
-                                format: string
-                                type: string
-                              type: object
-                            remove:
-                              items:
-                                format: string
-                                type: string
-                              type: array
-                            set:
-                              additionalProperties:
-                                format: string
-                                type: string
-                              type: object
-                          type: object
-                      type: object
-                    match:
-                      items:
-                        properties:
-                          authority:
-                            oneOf:
-                            - not:
-                                anyOf:
-                                - required:
-                                  - exact
-                                - required:
-                                  - prefix
-                                - required:
-                                  - regex
-                            - required:
-                              - exact
-                            - required:
-                              - prefix
-                            - required:
-                              - regex
-                            properties:
-                              exact:
-                                format: string
-                                type: string
-                              prefix:
-                                format: string
-                                type: string
-                              regex:
-                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                format: string
-                                type: string
-                            type: object
-                          gateways:
-                            description: Names of gateways where the rule should be
-                              applied.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                          headers:
-                            additionalProperties:
-                              oneOf:
-                              - not:
-                                  anyOf:
-                                  - required:
-                                    - exact
-                                  - required:
-                                    - prefix
-                                  - required:
-                                    - regex
-                              - required:
-                                - exact
-                              - required:
-                                - prefix
-                              - required:
-                                - regex
-                              properties:
-                                exact:
-                                  format: string
-                                  type: string
-                                prefix:
-                                  format: string
-                                  type: string
-                                regex:
-                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                  format: string
-                                  type: string
-                              type: object
-                            type: object
-                          ignoreUriCase:
-                            description: Flag to specify whether the URI matching
-                              should be case-insensitive.
-                            type: boolean
-                          method:
-                            oneOf:
-                            - not:
-                                anyOf:
-                                - required:
-                                  - exact
-                                - required:
-                                  - prefix
-                                - required:
-                                  - regex
-                            - required:
-                              - exact
-                            - required:
-                              - prefix
-                            - required:
-                              - regex
-                            properties:
-                              exact:
-                                format: string
-                                type: string
-                              prefix:
-                                format: string
-                                type: string
-                              regex:
-                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                format: string
-                                type: string
-                            type: object
-                          name:
-                            description: The name assigned to a match.
-                            format: string
-                            type: string
-                          port:
-                            description: Specifies the ports on the host that is being
-                              addressed.
-                            type: integer
-                          queryParams:
-                            additionalProperties:
-                              oneOf:
-                              - not:
-                                  anyOf:
-                                  - required:
-                                    - exact
-                                  - required:
-                                    - prefix
-                                  - required:
-                                    - regex
-                              - required:
-                                - exact
-                              - required:
-                                - prefix
-                              - required:
-                                - regex
-                              properties:
-                                exact:
-                                  format: string
-                                  type: string
-                                prefix:
-                                  format: string
-                                  type: string
-                                regex:
-                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                  format: string
-                                  type: string
-                              type: object
-                            description: Query parameters for matching.
-                            type: object
-                          scheme:
-                            oneOf:
-                            - not:
-                                anyOf:
-                                - required:
-                                  - exact
-                                - required:
-                                  - prefix
-                                - required:
-                                  - regex
-                            - required:
-                              - exact
-                            - required:
-                              - prefix
-                            - required:
-                              - regex
-                            properties:
-                              exact:
-                                format: string
-                                type: string
-                              prefix:
-                                format: string
-                                type: string
-                              regex:
-                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                format: string
-                                type: string
-                            type: object
-                          sourceLabels:
-                            additionalProperties:
-                              format: string
-                              type: string
-                            type: object
-                          sourceNamespace:
-                            description: Source namespace constraining the applicability
-                              of a rule to workloads in that namespace.
-                            format: string
-                            type: string
-                          uri:
-                            oneOf:
-                            - not:
-                                anyOf:
-                                - required:
-                                  - exact
-                                - required:
-                                  - prefix
-                                - required:
-                                  - regex
-                            - required:
-                              - exact
-                            - required:
-                              - prefix
-                            - required:
-                              - regex
-                            properties:
-                              exact:
-                                format: string
-                                type: string
-                              prefix:
-                                format: string
-                                type: string
-                              regex:
-                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                format: string
-                                type: string
-                            type: object
-                          withoutHeaders:
-                            additionalProperties:
-                              oneOf:
-                              - not:
-                                  anyOf:
-                                  - required:
-                                    - exact
-                                  - required:
-                                    - prefix
-                                  - required:
-                                    - regex
-                              - required:
-                                - exact
-                              - required:
-                                - prefix
-                              - required:
-                                - regex
-                              properties:
-                                exact:
-                                  format: string
-                                  type: string
-                                prefix:
-                                  format: string
-                                  type: string
-                                regex:
-                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                  format: string
-                                  type: string
-                              type: object
-                            description: withoutHeader has the same syntax with the
-                              header, but has opposite meaning.
-                            type: object
-                        type: object
-                      type: array
-                    mirror:
-                      properties:
-                        host:
-                          description: The name of a service from the service registry.
-                          format: string
-                          type: string
-                        port:
-                          description: Specifies the port on the host that is being
-                            addressed.
-                          properties:
-                            number:
-                              type: integer
-                          type: object
-                        subset:
-                          description: The name of a subset within the service.
-                          format: string
-                          type: string
-                      type: object
-                    mirror_percent:
-                      description: Percentage of the traffic to be mirrored by the
-                        `mirror` field.
-                      nullable: true
-                      type: integer
-                    mirrorPercent:
-                      description: Percentage of the traffic to be mirrored by the
-                        `mirror` field.
-                      nullable: true
-                      type: integer
-                    mirrorPercentage:
-                      description: Percentage of the traffic to be mirrored by the
-                        `mirror` field.
-                      properties:
-                        value:
-                          format: double
-                          type: number
-                      type: object
-                    name:
-                      description: The name assigned to the route for debugging purposes.
-                      format: string
-                      type: string
-                    redirect:
-                      description: A HTTP rule can either redirect or forward (default)
-                        traffic.
-                      properties:
-                        authority:
-                          format: string
-                          type: string
-                        redirectCode:
-                          type: integer
-                        uri:
-                          format: string
-                          type: string
-                      type: object
-                    retries:
-                      description: Retry policy for HTTP requests.
-                      properties:
-                        attempts:
-                          description: Number of retries to be allowed for a given
-                            request.
-                          format: int32
-                          type: integer
-                        perTryTimeout:
-                          description: Timeout per retry attempt for a given request.
-                          type: string
-                        retryOn:
-                          description: Specifies the conditions under which retry
-                            takes place.
-                          format: string
-                          type: string
-                        retryRemoteLocalities:
-                          description: Flag to specify whether the retries should
-                            retry to other localities.
-                          nullable: true
-                          type: boolean
-                      type: object
-                    rewrite:
-                      description: Rewrite HTTP URIs and Authority headers.
-                      properties:
-                        authority:
-                          description: rewrite the Authority/Host header with this
-                            value.
-                          format: string
-                          type: string
-                        uri:
-                          format: string
-                          type: string
-                      type: object
-                    route:
-                      description: A HTTP rule can either redirect or forward (default)
-                        traffic.
-                      items:
-                        properties:
-                          destination:
-                            properties:
-                              host:
-                                description: The name of a service from the service
-                                  registry.
-                                format: string
-                                type: string
-                              port:
-                                description: Specifies the port on the host that is
-                                  being addressed.
-                                properties:
-                                  number:
-                                    type: integer
-                                type: object
-                              subset:
-                                description: The name of a subset within the service.
-                                format: string
-                                type: string
-                            type: object
-                          headers:
-                            properties:
-                              request:
-                                properties:
-                                  add:
-                                    additionalProperties:
-                                      format: string
-                                      type: string
-                                    type: object
-                                  remove:
-                                    items:
-                                      format: string
-                                      type: string
-                                    type: array
-                                  set:
-                                    additionalProperties:
-                                      format: string
-                                      type: string
-                                    type: object
-                                type: object
-                              response:
-                                properties:
-                                  add:
-                                    additionalProperties:
-                                      format: string
-                                      type: string
-                                    type: object
-                                  remove:
-                                    items:
-                                      format: string
-                                      type: string
-                                    type: array
-                                  set:
-                                    additionalProperties:
-                                      format: string
-                                      type: string
-                                    type: object
-                                type: object
-                            type: object
-                          weight:
-                            format: int32
-                            type: integer
-                        type: object
-                      type: array
-                    timeout:
-                      description: Timeout for HTTP requests, default is disabled.
-                      type: string
-                  type: object
-                type: array
-              tcp:
-                description: An ordered list of route rules for opaque TCP traffic.
-                items:
-                  properties:
-                    match:
-                      items:
-                        properties:
-                          destinationSubnets:
-                            description: IPv4 or IPv6 ip addresses of destination
-                              with optional subnet.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                          gateways:
-                            description: Names of gateways where the rule should be
-                              applied.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                          port:
-                            description: Specifies the port on the host that is being
-                              addressed.
-                            type: integer
-                          sourceLabels:
-                            additionalProperties:
-                              format: string
-                              type: string
-                            type: object
-                          sourceNamespace:
-                            description: Source namespace constraining the applicability
-                              of a rule to workloads in that namespace.
-                            format: string
-                            type: string
-                          sourceSubnet:
-                            description: IPv4 or IPv6 ip address of source with optional
-                              subnet.
-                            format: string
-                            type: string
-                        type: object
-                      type: array
-                    route:
-                      description: The destination to which the connection should
-                        be forwarded to.
-                      items:
-                        properties:
-                          destination:
-                            properties:
-                              host:
-                                description: The name of a service from the service
-                                  registry.
-                                format: string
-                                type: string
-                              port:
-                                description: Specifies the port on the host that is
-                                  being addressed.
-                                properties:
-                                  number:
-                                    type: integer
-                                type: object
-                              subset:
-                                description: The name of a subset within the service.
-                                format: string
-                                type: string
-                            type: object
-                          weight:
-                            format: int32
-                            type: integer
-                        type: object
-                      type: array
-                  type: object
-                type: array
-              tls:
-                items:
-                  properties:
-                    match:
-                      items:
-                        properties:
-                          destinationSubnets:
-                            description: IPv4 or IPv6 ip addresses of destination
-                              with optional subnet.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                          gateways:
-                            description: Names of gateways where the rule should be
-                              applied.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                          port:
-                            description: Specifies the port on the host that is being
-                              addressed.
-                            type: integer
-                          sniHosts:
-                            description: SNI (server name indicator) to match on.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                          sourceLabels:
-                            additionalProperties:
-                              format: string
-                              type: string
-                            type: object
-                          sourceNamespace:
-                            description: Source namespace constraining the applicability
-                              of a rule to workloads in that namespace.
-                            format: string
-                            type: string
-                        type: object
-                      type: array
-                    route:
-                      description: The destination to which the connection should
-                        be forwarded to.
-                      items:
-                        properties:
-                          destination:
-                            properties:
-                              host:
-                                description: The name of a service from the service
-                                  registry.
-                                format: string
-                                type: string
-                              port:
-                                description: Specifies the port on the host that is
-                                  being addressed.
-                                properties:
-                                  number:
-                                    type: integer
-                                type: object
-                              subset:
-                                description: The name of a subset within the service.
-                                format: string
-                                type: string
-                            type: object
-                          weight:
-                            format: int32
-                            type: integer
-                        type: object
-                      type: array
-                  type: object
-                type: array
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: true
-    subresources:
-      status: {}
-  - additionalPrinterColumns:
-    - description: The names of gateways and sidecars that should apply these routes
-      jsonPath: .spec.gateways
-      name: Gateways
+    - description: Istio control plane revision
+      jsonPath: .spec.revision
+      name: Revision
       type: string
-    - description: The destination hosts to which traffic is being sent
-      jsonPath: .spec.hosts
-      name: Hosts
+    - description: IOP current state
+      jsonPath: .status.status
+      name: Status
       type: string
     - description: 'CreationTimestamp is a timestamp representing the server time
         when this object was created. It is not guaranteed to be set in happens-before
@@ -5826,3048 +38,234 @@ spec:
       jsonPath: .metadata.creationTimestamp
       name: Age
       type: date
-    name: v1beta1
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Configuration affecting label/content routing, sni routing,
-              etc. See more details at: https://istio.io/docs/reference/config/networking/virtual-service.html'
-            properties:
-              exportTo:
-                description: A list of namespaces to which this virtual service is
-                  exported.
-                items:
-                  format: string
-                  type: string
-                type: array
-              gateways:
-                description: The names of gateways and sidecars that should apply
-                  these routes.
-                items:
-                  format: string
-                  type: string
-                type: array
-              hosts:
-                description: The destination hosts to which traffic is being sent.
-                items:
-                  format: string
-                  type: string
-                type: array
-              http:
-                description: An ordered list of route rules for HTTP traffic.
-                items:
-                  properties:
-                    corsPolicy:
-                      description: Cross-Origin Resource Sharing policy (CORS).
-                      properties:
-                        allowCredentials:
-                          nullable: true
-                          type: boolean
-                        allowHeaders:
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        allowMethods:
-                          description: List of HTTP methods allowed to access the
-                            resource.
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        allowOrigin:
-                          description: The list of origins that are allowed to perform
-                            CORS requests.
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        allowOrigins:
-                          description: String patterns that match allowed origins.
-                          items:
-                            oneOf:
-                            - not:
-                                anyOf:
-                                - required:
-                                  - exact
-                                - required:
-                                  - prefix
-                                - required:
-                                  - regex
-                            - required:
-                              - exact
-                            - required:
-                              - prefix
-                            - required:
-                              - regex
-                            properties:
-                              exact:
-                                format: string
-                                type: string
-                              prefix:
-                                format: string
-                                type: string
-                              regex:
-                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                format: string
-                                type: string
-                            type: object
-                          type: array
-                        exposeHeaders:
-                          items:
-                            format: string
-                            type: string
-                          type: array
-                        maxAge:
-                          type: string
-                      type: object
-                    delegate:
-                      properties:
-                        name:
-                          description: Name specifies the name of the delegate VirtualService.
-                          format: string
-                          type: string
-                        namespace:
-                          description: Namespace specifies the namespace where the
-                            delegate VirtualService resides.
-                          format: string
-                          type: string
-                      type: object
-                    fault:
-                      description: Fault injection policy to apply on HTTP traffic
-                        at the client side.
-                      properties:
-                        abort:
-                          oneOf:
-                          - not:
-                              anyOf:
-                              - required:
-                                - httpStatus
-                              - required:
-                                - grpcStatus
-                              - required:
-                                - http2Error
-                          - required:
-                            - httpStatus
-                          - required:
-                            - grpcStatus
-                          - required:
-                            - http2Error
-                          properties:
-                            grpcStatus:
-                              format: string
-                              type: string
-                            http2Error:
-                              format: string
-                              type: string
-                            httpStatus:
-                              description: HTTP status code to use to abort the Http
-                                request.
-                              format: int32
-                              type: integer
-                            percentage:
-                              description: Percentage of requests to be aborted with
-                                the error code provided.
-                              properties:
-                                value:
-                                  format: double
-                                  type: number
-                              type: object
-                          type: object
-                        delay:
-                          oneOf:
-                          - not:
-                              anyOf:
-                              - required:
-                                - fixedDelay
-                              - required:
-                                - exponentialDelay
-                          - required:
-                            - fixedDelay
-                          - required:
-                            - exponentialDelay
-                          properties:
-                            exponentialDelay:
-                              type: string
-                            fixedDelay:
-                              description: Add a fixed delay before forwarding the
-                                request.
-                              type: string
-                            percent:
-                              description: Percentage of requests on which the delay
-                                will be injected (0-100).
-                              format: int32
-                              type: integer
-                            percentage:
-                              description: Percentage of requests on which the delay
-                                will be injected.
-                              properties:
-                                value:
-                                  format: double
-                                  type: number
-                              type: object
-                          type: object
-                      type: object
-                    headers:
-                      properties:
-                        request:
-                          properties:
-                            add:
-                              additionalProperties:
-                                format: string
-                                type: string
-                              type: object
-                            remove:
-                              items:
-                                format: string
-                                type: string
-                              type: array
-                            set:
-                              additionalProperties:
-                                format: string
-                                type: string
-                              type: object
-                          type: object
-                        response:
-                          properties:
-                            add:
-                              additionalProperties:
-                                format: string
-                                type: string
-                              type: object
-                            remove:
-                              items:
-                                format: string
-                                type: string
-                              type: array
-                            set:
-                              additionalProperties:
-                                format: string
-                                type: string
-                              type: object
-                          type: object
-                      type: object
-                    match:
-                      items:
-                        properties:
-                          authority:
-                            oneOf:
-                            - not:
-                                anyOf:
-                                - required:
-                                  - exact
-                                - required:
-                                  - prefix
-                                - required:
-                                  - regex
-                            - required:
-                              - exact
-                            - required:
-                              - prefix
-                            - required:
-                              - regex
-                            properties:
-                              exact:
-                                format: string
-                                type: string
-                              prefix:
-                                format: string
-                                type: string
-                              regex:
-                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                format: string
-                                type: string
-                            type: object
-                          gateways:
-                            description: Names of gateways where the rule should be
-                              applied.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                          headers:
-                            additionalProperties:
-                              oneOf:
-                              - not:
-                                  anyOf:
-                                  - required:
-                                    - exact
-                                  - required:
-                                    - prefix
-                                  - required:
-                                    - regex
-                              - required:
-                                - exact
-                              - required:
-                                - prefix
-                              - required:
-                                - regex
-                              properties:
-                                exact:
-                                  format: string
-                                  type: string
-                                prefix:
-                                  format: string
-                                  type: string
-                                regex:
-                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                  format: string
-                                  type: string
-                              type: object
-                            type: object
-                          ignoreUriCase:
-                            description: Flag to specify whether the URI matching
-                              should be case-insensitive.
-                            type: boolean
-                          method:
-                            oneOf:
-                            - not:
-                                anyOf:
-                                - required:
-                                  - exact
-                                - required:
-                                  - prefix
-                                - required:
-                                  - regex
-                            - required:
-                              - exact
-                            - required:
-                              - prefix
-                            - required:
-                              - regex
-                            properties:
-                              exact:
-                                format: string
-                                type: string
-                              prefix:
-                                format: string
-                                type: string
-                              regex:
-                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                format: string
-                                type: string
-                            type: object
-                          name:
-                            description: The name assigned to a match.
-                            format: string
-                            type: string
-                          port:
-                            description: Specifies the ports on the host that is being
-                              addressed.
-                            type: integer
-                          queryParams:
-                            additionalProperties:
-                              oneOf:
-                              - not:
-                                  anyOf:
-                                  - required:
-                                    - exact
-                                  - required:
-                                    - prefix
-                                  - required:
-                                    - regex
-                              - required:
-                                - exact
-                              - required:
-                                - prefix
-                              - required:
-                                - regex
-                              properties:
-                                exact:
-                                  format: string
-                                  type: string
-                                prefix:
-                                  format: string
-                                  type: string
-                                regex:
-                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                  format: string
-                                  type: string
-                              type: object
-                            description: Query parameters for matching.
-                            type: object
-                          scheme:
-                            oneOf:
-                            - not:
-                                anyOf:
-                                - required:
-                                  - exact
-                                - required:
-                                  - prefix
-                                - required:
-                                  - regex
-                            - required:
-                              - exact
-                            - required:
-                              - prefix
-                            - required:
-                              - regex
-                            properties:
-                              exact:
-                                format: string
-                                type: string
-                              prefix:
-                                format: string
-                                type: string
-                              regex:
-                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                format: string
-                                type: string
-                            type: object
-                          sourceLabels:
-                            additionalProperties:
-                              format: string
-                              type: string
-                            type: object
-                          sourceNamespace:
-                            description: Source namespace constraining the applicability
-                              of a rule to workloads in that namespace.
-                            format: string
-                            type: string
-                          uri:
-                            oneOf:
-                            - not:
-                                anyOf:
-                                - required:
-                                  - exact
-                                - required:
-                                  - prefix
-                                - required:
-                                  - regex
-                            - required:
-                              - exact
-                            - required:
-                              - prefix
-                            - required:
-                              - regex
-                            properties:
-                              exact:
-                                format: string
-                                type: string
-                              prefix:
-                                format: string
-                                type: string
-                              regex:
-                                description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                format: string
-                                type: string
-                            type: object
-                          withoutHeaders:
-                            additionalProperties:
-                              oneOf:
-                              - not:
-                                  anyOf:
-                                  - required:
-                                    - exact
-                                  - required:
-                                    - prefix
-                                  - required:
-                                    - regex
-                              - required:
-                                - exact
-                              - required:
-                                - prefix
-                              - required:
-                                - regex
-                              properties:
-                                exact:
-                                  format: string
-                                  type: string
-                                prefix:
-                                  format: string
-                                  type: string
-                                regex:
-                                  description: RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).
-                                  format: string
-                                  type: string
-                              type: object
-                            description: withoutHeader has the same syntax with the
-                              header, but has opposite meaning.
-                            type: object
-                        type: object
-                      type: array
-                    mirror:
-                      properties:
-                        host:
-                          description: The name of a service from the service registry.
-                          format: string
-                          type: string
-                        port:
-                          description: Specifies the port on the host that is being
-                            addressed.
-                          properties:
-                            number:
-                              type: integer
-                          type: object
-                        subset:
-                          description: The name of a subset within the service.
-                          format: string
-                          type: string
-                      type: object
-                    mirror_percent:
-                      description: Percentage of the traffic to be mirrored by the
-                        `mirror` field.
-                      nullable: true
-                      type: integer
-                    mirrorPercent:
-                      description: Percentage of the traffic to be mirrored by the
-                        `mirror` field.
-                      nullable: true
-                      type: integer
-                    mirrorPercentage:
-                      description: Percentage of the traffic to be mirrored by the
-                        `mirror` field.
-                      properties:
-                        value:
-                          format: double
-                          type: number
-                      type: object
-                    name:
-                      description: The name assigned to the route for debugging purposes.
-                      format: string
-                      type: string
-                    redirect:
-                      description: A HTTP rule can either redirect or forward (default)
-                        traffic.
-                      properties:
-                        authority:
-                          format: string
-                          type: string
-                        redirectCode:
-                          type: integer
-                        uri:
-                          format: string
-                          type: string
-                      type: object
-                    retries:
-                      description: Retry policy for HTTP requests.
-                      properties:
-                        attempts:
-                          description: Number of retries to be allowed for a given
-                            request.
-                          format: int32
-                          type: integer
-                        perTryTimeout:
-                          description: Timeout per retry attempt for a given request.
-                          type: string
-                        retryOn:
-                          description: Specifies the conditions under which retry
-                            takes place.
-                          format: string
-                          type: string
-                        retryRemoteLocalities:
-                          description: Flag to specify whether the retries should
-                            retry to other localities.
-                          nullable: true
-                          type: boolean
-                      type: object
-                    rewrite:
-                      description: Rewrite HTTP URIs and Authority headers.
-                      properties:
-                        authority:
-                          description: rewrite the Authority/Host header with this
-                            value.
-                          format: string
-                          type: string
-                        uri:
-                          format: string
-                          type: string
-                      type: object
-                    route:
-                      description: A HTTP rule can either redirect or forward (default)
-                        traffic.
-                      items:
-                        properties:
-                          destination:
-                            properties:
-                              host:
-                                description: The name of a service from the service
-                                  registry.
-                                format: string
-                                type: string
-                              port:
-                                description: Specifies the port on the host that is
-                                  being addressed.
-                                properties:
-                                  number:
-                                    type: integer
-                                type: object
-                              subset:
-                                description: The name of a subset within the service.
-                                format: string
-                                type: string
-                            type: object
-                          headers:
-                            properties:
-                              request:
-                                properties:
-                                  add:
-                                    additionalProperties:
-                                      format: string
-                                      type: string
-                                    type: object
-                                  remove:
-                                    items:
-                                      format: string
-                                      type: string
-                                    type: array
-                                  set:
-                                    additionalProperties:
-                                      format: string
-                                      type: string
-                                    type: object
-                                type: object
-                              response:
-                                properties:
-                                  add:
-                                    additionalProperties:
-                                      format: string
-                                      type: string
-                                    type: object
-                                  remove:
-                                    items:
-                                      format: string
-                                      type: string
-                                    type: array
-                                  set:
-                                    additionalProperties:
-                                      format: string
-                                      type: string
-                                    type: object
-                                type: object
-                            type: object
-                          weight:
-                            format: int32
-                            type: integer
-                        type: object
-                      type: array
-                    timeout:
-                      description: Timeout for HTTP requests, default is disabled.
-                      type: string
-                  type: object
-                type: array
-              tcp:
-                description: An ordered list of route rules for opaque TCP traffic.
-                items:
-                  properties:
-                    match:
-                      items:
-                        properties:
-                          destinationSubnets:
-                            description: IPv4 or IPv6 ip addresses of destination
-                              with optional subnet.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                          gateways:
-                            description: Names of gateways where the rule should be
-                              applied.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                          port:
-                            description: Specifies the port on the host that is being
-                              addressed.
-                            type: integer
-                          sourceLabels:
-                            additionalProperties:
-                              format: string
-                              type: string
-                            type: object
-                          sourceNamespace:
-                            description: Source namespace constraining the applicability
-                              of a rule to workloads in that namespace.
-                            format: string
-                            type: string
-                          sourceSubnet:
-                            description: IPv4 or IPv6 ip address of source with optional
-                              subnet.
-                            format: string
-                            type: string
-                        type: object
-                      type: array
-                    route:
-                      description: The destination to which the connection should
-                        be forwarded to.
-                      items:
-                        properties:
-                          destination:
-                            properties:
-                              host:
-                                description: The name of a service from the service
-                                  registry.
-                                format: string
-                                type: string
-                              port:
-                                description: Specifies the port on the host that is
-                                  being addressed.
-                                properties:
-                                  number:
-                                    type: integer
-                                type: object
-                              subset:
-                                description: The name of a subset within the service.
-                                format: string
-                                type: string
-                            type: object
-                          weight:
-                            format: int32
-                            type: integer
-                        type: object
-                      type: array
-                  type: object
-                type: array
-              tls:
-                items:
-                  properties:
-                    match:
-                      items:
-                        properties:
-                          destinationSubnets:
-                            description: IPv4 or IPv6 ip addresses of destination
-                              with optional subnet.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                          gateways:
-                            description: Names of gateways where the rule should be
-                              applied.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                          port:
-                            description: Specifies the port on the host that is being
-                              addressed.
-                            type: integer
-                          sniHosts:
-                            description: SNI (server name indicator) to match on.
-                            items:
-                              format: string
-                              type: string
-                            type: array
-                          sourceLabels:
-                            additionalProperties:
-                              format: string
-                              type: string
-                            type: object
-                          sourceNamespace:
-                            description: Source namespace constraining the applicability
-                              of a rule to workloads in that namespace.
-                            format: string
-                            type: string
-                        type: object
-                      type: array
-                    route:
-                      description: The destination to which the connection should
-                        be forwarded to.
-                      items:
-                        properties:
-                          destination:
-                            properties:
-                              host:
-                                description: The name of a service from the service
-                                  registry.
-                                format: string
-                                type: string
-                              port:
-                                description: Specifies the port on the host that is
-                                  being addressed.
-                                properties:
-                                  number:
-                                    type: integer
-                                type: object
-                              subset:
-                                description: The name of a subset within the service.
-                                format: string
-                                type: string
-                            type: object
-                          weight:
-                            format: int32
-                            type: integer
-                        type: object
-                      type: array
-                  type: object
-                type: array
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: false
+    name: v1alpha1
     subresources:
       status: {}
----
-apiVersion: apiextensions.k8s.io/v1
-kind: CustomResourceDefinition
-metadata:
-  annotations:
-    "helm.sh/resource-policy": keep
-  labels:
-    app: istio-pilot
-    chart: istio
-    heritage: Tiller
-    release: istio
-  name: workloadentries.networking.istio.io
-spec:
-  group: networking.istio.io
-  names:
-    categories:
-    - istio-io
-    - networking-istio-io
-    kind: WorkloadEntry
-    listKind: WorkloadEntryList
-    plural: workloadentries
-    shortNames:
-    - we
-    singular: workloadentry
-  scope: Namespaced
-  versions:
-  - additionalPrinterColumns:
-    - description: 'CreationTimestamp is a timestamp representing the server time
-        when this object was created. It is not guaranteed to be set in happens-before
-        order across separate operations. Clients may not set this value. It is represented
-        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
-        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
-      jsonPath: .metadata.creationTimestamp
-      name: Age
-      type: date
-    - description: Address associated with the network endpoint.
-      jsonPath: .spec.address
-      name: Address
-      type: string
-    name: v1alpha3
     schema:
       openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Configuration affecting VMs onboarded into the mesh. See
-              more details at: https://istio.io/docs/reference/config/networking/workload-entry.html'
-            properties:
-              address:
-                format: string
-                type: string
-              labels:
-                additionalProperties:
-                  format: string
-                  type: string
-                description: One or more labels associated with the endpoint.
-                type: object
-              locality:
-                description: The locality associated with the endpoint.
-                format: string
-                type: string
-              network:
-                format: string
-                type: string
-              ports:
-                additionalProperties:
-                  type: integer
-                description: Set of ports associated with the endpoint.
-                type: object
-              serviceAccount:
-                format: string
-                type: string
-              weight:
-                description: The load balancing weight associated with the endpoint.
-                type: integer
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
         type: object
+        x-kubernetes-preserve-unknown-fields: true
     served: true
     storage: true
-    subresources:
-      status: {}
-  - additionalPrinterColumns:
-    - description: 'CreationTimestamp is a timestamp representing the server time
-        when this object was created. It is not guaranteed to be set in happens-before
-        order across separate operations. Clients may not set this value. It is represented
-        in RFC3339 form and is in UTC. Populated by the system. Read-only. Null for
-        lists. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata'
-      jsonPath: .metadata.creationTimestamp
-      name: Age
-      type: date
-    - description: Address associated with the network endpoint.
-      jsonPath: .spec.address
-      name: Address
-      type: string
-    name: v1beta1
-    schema:
-      openAPIV3Schema:
-        properties:
-          spec:
-            description: 'Configuration affecting VMs onboarded into the mesh. See
-              more details at: https://istio.io/docs/reference/config/networking/workload-entry.html'
-            properties:
-              address:
-                format: string
-                type: string
-              labels:
-                additionalProperties:
-                  format: string
-                  type: string
-                description: One or more labels associated with the endpoint.
-                type: object
-              locality:
-                description: The locality associated with the endpoint.
-                format: string
-                type: string
-              network:
-                format: string
-                type: string
-              ports:
-                additionalProperties:
-                  type: integer
-                description: Set of ports associated with the endpoint.
-                type: object
-              serviceAccount:
-                format: string
-                type: string
-              weight:
-                description: The load balancing weight associated with the endpoint.
-                type: integer
-            type: object
-          status:
-            type: object
-            x-kubernetes-preserve-unknown-fields: true
-        type: object
-    served: true
-    storage: false
-    subresources:
-      status: {}
 ---
-apiVersion: v1
-kind: ServiceAccount
-metadata:
-  name: istio-ingressgateway-service-account
-  namespace: istio-system
-  labels:
-    app: istio-ingressgateway
-    istio: ingressgateway
-    release: istio
+
 ---
+# Source: istio-operator/templates/namespace.yaml
 apiVersion: v1
-kind: ServiceAccount
+kind: Namespace
 metadata:
-  name: istio-reader-service-account
-  namespace: istio-system
+  name: istio-operator
   labels:
-    app: istio-reader
-    release: istio
+    istio-operator-managed: Reconcile
+    istio-injection: disabled
 ---
+# Source: istio-operator/templates/service_account.yaml
 apiVersion: v1
 kind: ServiceAccount
 metadata:
-  name: istiod-service-account
-  namespace: istio-system
-  labels:
-    app: istiod
-    release: istio
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: ClusterRole
-metadata:
-  name: istio-reader-istio-system
-  labels:
-    app: istio-reader
-    release: istio
-rules:
-  - apiGroups:
-      - "config.istio.io"
-      - "security.istio.io"
-      - "networking.istio.io"
-      - "authentication.istio.io"
-    resources: ["*"]
-    verbs: ["get", "list", "watch"]
-  - apiGroups: [""]
-    resources: ["endpoints", "pods", "services", "nodes", "replicationcontrollers", "namespaces"]
-    verbs: ["get", "list", "watch"]
-  - apiGroups: ["apps"]
-    resources: ["replicasets"]
-    verbs: ["get", "list", "watch"]
+  namespace: istio-operator
+  name: istio-operator
 ---
+# Source: istio-operator/templates/clusterrole.yaml
 apiVersion: rbac.authorization.k8s.io/v1
 kind: ClusterRole
 metadata:
-  name: istiod-istio-system
-  labels:
-    app: istiod
-    release: istio
+  creationTimestamp: null
+  name: istio-operator
 rules:
-  # sidecar injection controller
-  - apiGroups: ["admissionregistration.k8s.io"]
-    resources: ["mutatingwebhookconfigurations"]
-    verbs: ["get", "list", "watch", "patch"]
-
-  # configuration validation webhook controller
-  - apiGroups: ["admissionregistration.k8s.io"]
-    resources: ["validatingwebhookconfigurations"]
-    verbs: ["get", "list", "watch", "update"]
-
-  # istio configuration
-  - apiGroups: ["config.istio.io", "security.istio.io", "networking.istio.io", "authentication.istio.io"]
-    verbs: ["get", "watch", "list"]
-    resources: ["*"]
-
-  # auto-detect installed CRD definitions
-  - apiGroups: ["apiextensions.k8s.io"]
-    resources: ["customresourcedefinitions"]
-    verbs: ["get", "list", "watch"]
-
-  # discovery and routing
-  - apiGroups: [""]
-    resources: ["pods", "nodes", "services", "namespaces", "endpoints"]
-    verbs: ["get", "list", "watch"]
-  - apiGroups: ["discovery.k8s.io"]
-    resources: ["endpointslices"]
-    verbs: ["get", "list", "watch"]
-
-  # ingress controller
-  - apiGroups: ["networking.k8s.io"]
-    resources: ["ingresses", "ingressclasses"]
-    verbs: ["get", "list", "watch"]
-  - apiGroups: ["networking.k8s.io"]
-    resources: ["ingresses/status"]
-    verbs: ["*"]
-
-  # required for CA's namespace controller
-  - apiGroups: [""]
-    resources: ["configmaps"]
-    verbs: ["create", "get", "list", "watch", "update"]
-
-  # Istiod and bootstrap.
-  - apiGroups: ["certificates.k8s.io"]
-    resources:
-      - "certificatesigningrequests"
-      - "certificatesigningrequests/approval"
-      - "certificatesigningrequests/status"
-    verbs: ["update", "create", "get", "delete", "watch"]
-  - apiGroups: ["certificates.k8s.io"]
-    resources:
-      - "signers"
-    resourceNames:
-    - "kubernetes.io/legacy-unknown"
-    verbs: ["approve"]
-
-  # Used by Istiod to verify the JWT tokens
-  - apiGroups: ["authentication.k8s.io"]
-    resources: ["tokenreviews"]
-    verbs: ["create"]
-
-  # Use for Kubernetes Service APIs
-  - apiGroups: ["networking.x-k8s.io"]
-    resources: ["*"]
-    verbs: ["get", "watch", "list"]
-
-  # Needed for multicluster secret reading, possibly ingress certs in the future
-  - apiGroups: [""]
-    resources: ["secrets"]
-    verbs: ["get", "watch", "list"]
----
-apiVersion: rbac.authorization.k8s.io/v1
+# istio groups
+- apiGroups:
+  - authentication.istio.io
+  resources:
+  - '*'
+  verbs:
+  - '*'
+- apiGroups:
+  - config.istio.io
+  resources:
+  - '*'
+  verbs:
+  - '*'
+- apiGroups:
+  - install.istio.io
+  resources:
+  - '*'
+  verbs:
+  - '*'
+- apiGroups:
+  - networking.istio.io
+  resources:
+  - '*'
+  verbs:
+  - '*'
+- apiGroups:
+  - security.istio.io
+  resources:
+  - '*'
+  verbs:
+  - '*'
+# k8s groups
+- apiGroups:
+  - admissionregistration.k8s.io
+  resources:
+  - mutatingwebhookconfigurations
+  - validatingwebhookconfigurations
+  verbs:
+  - '*'
+- apiGroups:
+  - apiextensions.k8s.io
+  resources:
+  - customresourcedefinitions.apiextensions.k8s.io
+  - customresourcedefinitions
+  verbs:
+  - '*'
+- apiGroups:
+  - apps
+  - extensions
+  resources:
+  - daemonsets
+  - deployments
+  - deployments/finalizers
+  - replicasets
+  verbs:
+  - '*'
+- apiGroups:
+  - autoscaling
+  resources:
+  - horizontalpodautoscalers
+  verbs:
+  - '*'
+- apiGroups:
+  - monitoring.coreos.com
+  resources:
+  - servicemonitors
+  verbs:
+  - get
+  - create
+  - update
+- apiGroups:
+  - policy
+  resources:
+  - poddisruptionbudgets
+  verbs:
+  - '*'
+- apiGroups:
+  - rbac.authorization.k8s.io
+  resources:
+  - clusterrolebindings
+  - clusterroles
+  - roles
+  - rolebindings
+  verbs:
+  - '*'
+- apiGroups:
+  - coordination.k8s.io
+  resources:
+  - leases
+  verbs:
+  - get
+  - create
+  - update
+- apiGroups:
+  - ""
+  resources:
+  - configmaps
+  - endpoints
+  - events
+  - namespaces
+  - pods
+  - pods/proxy
+  - persistentvolumeclaims
+  - secrets
+  - services
+  - serviceaccounts
+  verbs:
+  - '*'
+---
+# Source: istio-operator/templates/clusterrole_binding.yaml
 kind: ClusterRoleBinding
-metadata:
-  name: istio-reader-istio-system
-  labels:
-    app: istio-reader
-    release: istio
-roleRef:
-  apiGroup: rbac.authorization.k8s.io
-  kind: ClusterRole
-  name: istio-reader-istio-system
-subjects:
-  - kind: ServiceAccount
-    name: istio-reader-service-account
-    namespace: istio-system
----
 apiVersion: rbac.authorization.k8s.io/v1
-kind: ClusterRoleBinding
 metadata:
-  name: istiod-pilot-istio-system
-  labels:
-    app: pilot
-    release: istio
+  name: istio-operator
+subjects:
+- kind: ServiceAccount
+  name: istio-operator
+  namespace: istio-operator
 roleRef:
-  apiGroup: rbac.authorization.k8s.io
   kind: ClusterRole
-  name: istiod-istio-system
-subjects:
-  - kind: ServiceAccount
-    name: istiod-service-account
-    namespace: istio-system
----
-apiVersion: admissionregistration.k8s.io/v1beta1
-kind: ValidatingWebhookConfiguration
-metadata:
-  name: istiod-istio-system
-  labels:
-    app: istiod
-    release: istio
-    istio: istiod
-webhooks:
-  - name: validation.istio.io
-    clientConfig:
-      service:
-        name: istiod
-        namespace: istio-system
-        path: "/validate"
-      caBundle: "" # patched at runtime when the webhook is ready.
-    rules:
-      - operations:
-        - CREATE
-        - UPDATE
-        apiGroups:
-        - config.istio.io
-        - security.istio.io
-        - authentication.istio.io
-        - networking.istio.io
-        apiVersions:
-        - "*"
-        resources:
-        - "*"
-    # Fail open until the validation webhook is ready. The webhook controller
-    # will update this to `Fail` and patch in the `caBundle` when the webhook
-    # endpoint is ready.
-    failurePolicy: Ignore
-    sideEffects: None
-    admissionReviewVersions: ["v1beta1", "v1"]
----
-apiVersion: networking.istio.io/v1alpha3
-kind: EnvoyFilter
-metadata:
-  name: metadata-exchange-1.6
-  namespace: istio-system
-  labels:
-    istio.io/rev: default
-spec:
-  configPatches:
-    - applyTo: HTTP_FILTER
-      match:
-        context: ANY # inbound, outbound, and gateway
-        proxy:
-          proxyVersion: '^1\.6.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.http_connection_manager"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.metadata_exchange
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
-            value:
-              config:
-                configuration: |
-                  {}
-                vm_config:
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: envoy.wasm.metadata_exchange
----
-apiVersion: networking.istio.io/v1alpha3
-kind: EnvoyFilter
-metadata:
-  name: metadata-exchange-1.7
-  namespace: istio-system
-  labels:
-    istio.io/rev: default
-spec:
-  configPatches:
-    - applyTo: HTTP_FILTER
-      match:
-        context: SIDECAR_INBOUND
-        proxy:
-          proxyVersion: '^1\.7.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.http_connection_manager"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.metadata_exchange
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
-            value:
-              config:
-                configuration:
-                  "@type": "type.googleapis.com/google.protobuf.StringValue"
-                  value: |
-                    {}
-                vm_config:
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: envoy.wasm.metadata_exchange
-    - applyTo: HTTP_FILTER
-      match:
-        context: SIDECAR_OUTBOUND
-        proxy:
-          proxyVersion: '^1\.7.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.http_connection_manager"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.metadata_exchange
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
-            value:
-              config:
-                configuration:
-                  "@type": "type.googleapis.com/google.protobuf.StringValue"
-                  value: |
-                    {}
-                vm_config:
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: envoy.wasm.metadata_exchange
-    - applyTo: HTTP_FILTER
-      match:
-        context: GATEWAY
-        proxy:
-          proxyVersion: '^1\.7.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.http_connection_manager"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.metadata_exchange
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
-            value:
-              config:
-                configuration:
-                  "@type": "type.googleapis.com/google.protobuf.StringValue"
-                  value: |
-                    {}
-                vm_config:
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: envoy.wasm.metadata_exchange
----
-apiVersion: networking.istio.io/v1alpha3
-kind: EnvoyFilter
-metadata:
-  name: stats-filter-1.6
-  namespace: istio-system
-  labels:
-    istio.io/rev: default
-spec:
-  configPatches:
-    - applyTo: HTTP_FILTER
-      match:
-        context: SIDECAR_OUTBOUND
-        proxy:
-          proxyVersion: '^1\.6.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.http_connection_manager"
-              subFilter:
-                name: "envoy.router"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.stats
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
-            value:
-              config:
-                root_id: stats_outbound
-                configuration: |
-                  {
-                    "debug": "false",
-                    "stat_prefix": "istio"
-                  }
-                vm_config:
-                  vm_id: stats_outbound
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: envoy.wasm.stats
-    - applyTo: HTTP_FILTER
-      match:
-        context: SIDECAR_INBOUND
-        proxy:
-          proxyVersion: '^1\.6.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.http_connection_manager"
-              subFilter:
-                name: "envoy.router"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.stats
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
-            value:
-              config:
-                root_id: stats_inbound
-                configuration: |
-                  {
-                    "debug": "false",
-                    "stat_prefix": "istio"
-                  }
-                vm_config:
-                  vm_id: stats_inbound
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: envoy.wasm.stats
-    - applyTo: HTTP_FILTER
-      match:
-        context: GATEWAY
-        proxy:
-          proxyVersion: '^1\.6.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.http_connection_manager"
-              subFilter:
-                name: "envoy.router"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.stats
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
-            value:
-              config:
-                root_id: stats_outbound
-                configuration: |
-                  {
-                    "debug": "false",
-                    "stat_prefix": "istio",
-                    "disable_host_header_fallback": true
-                  }
-                vm_config:
-                  vm_id: stats_outbound
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: envoy.wasm.stats
----
-apiVersion: networking.istio.io/v1alpha3
-kind: EnvoyFilter
-metadata:
-  name: stats-filter-1.7
-  namespace: istio-system
-  labels:
-    istio.io/rev: default
-spec:
-  configPatches:
-    - applyTo: HTTP_FILTER
-      match:
-        context: SIDECAR_OUTBOUND
-        proxy:
-          proxyVersion: '^1\.7.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.http_connection_manager"
-              subFilter:
-                name: "envoy.router"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.stats
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
-            value:
-              config:
-                root_id: stats_outbound
-                configuration:
-                  "@type": "type.googleapis.com/google.protobuf.StringValue"
-                  value: |
-                    {
-                      "debug": "false",
-                      "stat_prefix": "istio"
-                    }
-                vm_config:
-                  vm_id: stats_outbound
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: envoy.wasm.stats
-    - applyTo: HTTP_FILTER
-      match:
-        context: SIDECAR_INBOUND
-        proxy:
-          proxyVersion: '^1\.7.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.http_connection_manager"
-              subFilter:
-                name: "envoy.router"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.stats
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
-            value:
-              config:
-                root_id: stats_inbound
-                configuration:
-                  "@type": "type.googleapis.com/google.protobuf.StringValue"
-                  value: |
-                    {
-                      "debug": "false",
-                      "stat_prefix": "istio"
-                    }
-                vm_config:
-                  vm_id: stats_inbound
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: envoy.wasm.stats
-    - applyTo: HTTP_FILTER
-      match:
-        context: GATEWAY
-        proxy:
-          proxyVersion: '^1\.7.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.http_connection_manager"
-              subFilter:
-                name: "envoy.router"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.stats
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm
-            value:
-              config:
-                root_id: stats_outbound
-                configuration:
-                  "@type": "type.googleapis.com/google.protobuf.StringValue"
-                  value: |
-                    {
-                      "debug": "false",
-                      "stat_prefix": "istio",
-                      "disable_host_header_fallback": true
-                    }
-                vm_config:
-                  vm_id: stats_outbound
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: envoy.wasm.stats
----
-apiVersion: networking.istio.io/v1alpha3
-kind: EnvoyFilter
-metadata:
-  name: tcp-metadata-exchange-1.6
-  namespace: istio-system
-  labels:
-    istio.io/rev: default
-spec:
-  configPatches:
-    - applyTo: NETWORK_FILTER
-      match:
-        context: SIDECAR_INBOUND
-        proxy:
-          proxyVersion: '^1\.6.*'
-        listener: {}
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.metadata_exchange
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
-            value:
-              protocol: istio-peer-exchange
-    - applyTo: CLUSTER
-      match:
-        context: SIDECAR_OUTBOUND
-        proxy:
-          proxyVersion: '^1\.6.*'
-        cluster: {}
-      patch:
-        operation: MERGE
-        value:
-          filters:
-          - name: istio.metadata_exchange
-            typed_config:
-              "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-              type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
-              value:
-                protocol: istio-peer-exchange
-    - applyTo: CLUSTER
-      match:
-        context: GATEWAY
-        proxy:
-          proxyVersion: '^1\.6.*'
-        cluster: {}
-      patch:
-        operation: MERGE
-        value:
-          filters:
-          - name: istio.metadata_exchange
-            typed_config:
-              "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-              type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
-              value:
-                protocol: istio-peer-exchange
----
-apiVersion: networking.istio.io/v1alpha3
-kind: EnvoyFilter
-metadata:
-  name: tcp-metadata-exchange-1.7
-  namespace: istio-system
-  labels:
-    istio.io/rev: default
-spec:
-  configPatches:
-    - applyTo: NETWORK_FILTER
-      match:
-        context: SIDECAR_INBOUND
-        proxy:
-          proxyVersion: '^1\.7.*'
-        listener: {}
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.metadata_exchange
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
-            value:
-              protocol: istio-peer-exchange
-    - applyTo: CLUSTER
-      match:
-        context: SIDECAR_OUTBOUND
-        proxy:
-          proxyVersion: '^1\.7.*'
-        cluster: {}
-      patch:
-        operation: MERGE
-        value:
-          filters:
-          - name: istio.metadata_exchange
-            typed_config:
-              "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-              type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
-              value:
-                protocol: istio-peer-exchange
-    - applyTo: CLUSTER
-      match:
-        context: GATEWAY
-        proxy:
-          proxyVersion: '^1\.7.*'
-        cluster: {}
-      patch:
-        operation: MERGE
-        value:
-          filters:
-          - name: istio.metadata_exchange
-            typed_config:
-              "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-              type_url: type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange
-              value:
-                protocol: istio-peer-exchange
----
-apiVersion: networking.istio.io/v1alpha3
-kind: EnvoyFilter
-metadata:
-  name: tcp-stats-filter-1.6
-  namespace: istio-system
-  labels:
-    istio.io/rev: default
-spec:
-  configPatches:
-    - applyTo: NETWORK_FILTER
-      match:
-        context: SIDECAR_INBOUND
-        proxy:
-          proxyVersion: '^1\.6.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.tcp_proxy"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.stats
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
-            value:
-              config:
-                root_id: stats_inbound
-                configuration: |
-                  {
-                    "debug": "false",
-                    "stat_prefix": "istio"
-                  }
-                vm_config:
-                  vm_id: tcp_stats_inbound
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: "envoy.wasm.stats"
-    - applyTo: NETWORK_FILTER
-      match:
-        context: SIDECAR_OUTBOUND
-        proxy:
-          proxyVersion: '^1\.6.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.tcp_proxy"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.stats
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
-            value:
-              config:
-                root_id: stats_outbound
-                configuration: |
-                  {
-                    "debug": "false",
-                    "stat_prefix": "istio"
-                  }
-                vm_config:
-                  vm_id: tcp_stats_outbound
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: "envoy.wasm.stats"
-    - applyTo: NETWORK_FILTER
-      match:
-        context: GATEWAY
-        proxy:
-          proxyVersion: '^1\.6.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.tcp_proxy"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.stats
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
-            value:
-              config:
-                root_id: stats_outbound
-                configuration: |
-                  {
-                    "debug": "false",
-                    "stat_prefix": "istio"
-                  }
-                vm_config:
-                  vm_id: tcp_stats_outbound
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: "envoy.wasm.stats"
----
-apiVersion: networking.istio.io/v1alpha3
-kind: EnvoyFilter
-metadata:
-  name: tcp-stats-filter-1.7
-  namespace: istio-system
-  labels:
-    istio.io/rev: default
-spec:
-  configPatches:
-    - applyTo: NETWORK_FILTER
-      match:
-        context: SIDECAR_INBOUND
-        proxy:
-          proxyVersion: '^1\.7.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.tcp_proxy"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.stats
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
-            value:
-              config:
-                root_id: stats_inbound
-                configuration:
-                  "@type": "type.googleapis.com/google.protobuf.StringValue"
-                  value: |
-                    {
-                      "debug": "false",
-                      "stat_prefix": "istio"
-                    }
-                vm_config:
-                  vm_id: tcp_stats_inbound
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: "envoy.wasm.stats"
-    - applyTo: NETWORK_FILTER
-      match:
-        context: SIDECAR_OUTBOUND
-        proxy:
-          proxyVersion: '^1\.7.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.tcp_proxy"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.stats
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
-            value:
-              config:
-                root_id: stats_outbound
-                configuration:
-                  "@type": "type.googleapis.com/google.protobuf.StringValue"
-                  value: |
-                    {
-                      "debug": "false",
-                      "stat_prefix": "istio"
-                    }
-                vm_config:
-                  vm_id: tcp_stats_outbound
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: "envoy.wasm.stats"
-    - applyTo: NETWORK_FILTER
-      match:
-        context: GATEWAY
-        proxy:
-          proxyVersion: '^1\.7.*'
-        listener:
-          filterChain:
-            filter:
-              name: "envoy.tcp_proxy"
-      patch:
-        operation: INSERT_BEFORE
-        value:
-          name: istio.stats
-          typed_config:
-            "@type": type.googleapis.com/udpa.type.v1.TypedStruct
-            type_url: type.googleapis.com/envoy.extensions.filters.network.wasm.v3.Wasm
-            value:
-              config:
-                root_id: stats_outbound
-                configuration:
-                  "@type": "type.googleapis.com/google.protobuf.StringValue"
-                  value: |
-                    {
-                      "debug": "false",
-                      "stat_prefix": "istio"
-                    }
-                vm_config:
-                  vm_id: tcp_stats_outbound
-                  runtime: envoy.wasm.runtime.null
-                  code:
-                    local:
-                      inline_string: "envoy.wasm.stats"
----
-apiVersion: v1
-kind: ConfigMap
-metadata:
-  name: istio
-  namespace: istio-system
-  labels:
-    istio.io/rev: default
-    release: istio
-data:
-
-  # Configuration file for the mesh networks to be used by the Split Horizon EDS.
-  meshNetworks: |-
-    networks: {}
-
-  mesh: |-
-    defaultConfig:
-      discoveryAddress: istiod.istio-system.svc:15012
-      proxyMetadata:
-        DNS_AGENT: ""
-      tracing:
-        zipkin:
-          address: zipkin.istio-system:9411
-    disableMixerHttpReports: true
-    enablePrometheusMerge: true
-    rootNamespace: istio-system
-    trustDomain: cluster.local
+  name: istio-operator
+  apiGroup: rbac.authorization.k8s.io
 ---
+# Source: istio-operator/templates/service.yaml
 apiVersion: v1
-kind: ConfigMap
-metadata:
-  name: istio-sidecar-injector
-  namespace: istio-system
-  labels:
-    istio.io/rev: default
-    release: istio
-data:
-
-  values: |-
-    {
-      "global": {
-        "arch": {
-          "amd64": 2,
-          "ppc64le": 2,
-          "s390x": 2
-        },
-        "caAddress": "",
-        "centralIstiod": false,
-        "configValidation": true,
-        "controlPlaneSecurityEnabled": true,
-        "createRemoteSvcEndpoints": false,
-        "defaultNodeSelector": {},
-        "defaultPodDisruptionBudget": {
-          "enabled": true
-        },
-        "defaultResources": {
-          "requests": {
-            "cpu": "10m"
-          }
-        },
-        "enableHelmTest": false,
-        "enabled": true,
-        "hub": "docker.io/istio",
-        "imagePullPolicy": "",
-        "imagePullSecrets": [],
-        "istioNamespace": "istio-system",
-        "istiod": {
-          "enableAnalysis": false
-        },
-        "jwtPolicy": "third-party-jwt",
-        "logAsJson": false,
-        "logging": {
-          "level": "default:info"
-        },
-        "meshExpansion": {
-          "enabled": false,
-          "useILB": false
-        },
-        "meshID": "",
-        "meshNetworks": {},
-        "mountMtlsCerts": false,
-        "multiCluster": {
-          "clusterName": "",
-          "enabled": false
-        },
-        "namespace": "istio-system",
-        "network": "",
-        "omitSidecarInjectorConfigMap": false,
-        "oneNamespace": false,
-        "operatorManageWebhooks": false,
-        "pilotCertProvider": "istiod",
-        "policyNamespace": "istio-system",
-        "priorityClassName": "",
-        "proxy": {
-          "autoInject": "enabled",
-          "clusterDomain": "cluster.local",
-          "componentLogLevel": "misc:error",
-          "enableCoreDump": false,
-          "excludeIPRanges": "",
-          "excludeInboundPorts": "",
-          "excludeOutboundPorts": "",
-          "holdApplicationUntilProxyStarts": false,
-          "image": "proxyv2",
-          "includeIPRanges": "*",
-          "logLevel": "warning",
-          "privileged": false,
-          "readinessFailureThreshold": 30,
-          "readinessInitialDelaySeconds": 1,
-          "readinessPeriodSeconds": 2,
-          "resources": {
-            "limits": {
-              "cpu": "2000m",
-              "memory": "1024Mi"
-            },
-            "requests": {
-              "cpu": "100m",
-              "memory": "128Mi"
-            }
-          },
-          "statusPort": 15020,
-          "tracer": "zipkin"
-        },
-        "proxy_init": {
-          "image": "proxyv2",
-          "resources": {
-            "limits": {
-              "cpu": "2000m",
-              "memory": "1024Mi"
-            },
-            "requests": {
-              "cpu": "10m",
-              "memory": "10Mi"
-            }
-          }
-        },
-        "remotePilotAddress": "",
-        "remotePolicyAddress": "",
-        "remoteTelemetryAddress": "",
-        "sds": {
-          "token": {
-            "aud": "istio-ca"
-          }
-        },
-        "sts": {
-          "servicePort": 0
-        },
-        "tag": "1.7.4",
-        "telemetryNamespace": "istio-system",
-        "tracer": {
-          "datadog": {
-            "address": "$(HOST_IP):8126"
-          },
-          "lightstep": {
-            "accessToken": "",
-            "address": ""
-          },
-          "stackdriver": {
-            "debug": false,
-            "maxNumberOfAnnotations": 200,
-            "maxNumberOfAttributes": 200,
-            "maxNumberOfMessageEvents": 200
-          },
-          "zipkin": {
-            "address": ""
-          }
-        },
-        "trustDomain": "cluster.local",
-        "useMCP": false
-      },
-      "istio_cni": {
-        "enabled": false
-      },
-      "revision": "",
-      "sidecarInjectorWebhook": {
-        "alwaysInjectSelector": [],
-        "enableNamespacesByDefault": false,
-        "injectLabel": "istio-injection",
-        "injectedAnnotations": {},
-        "neverInjectSelector": [],
-        "objectSelector": {
-          "autoInject": true,
-          "enabled": false
-        },
-        "rewriteAppHTTPProbe": true
-      }
-    }
-
-  # To disable injection: use omitSidecarInjectorConfigMap, which disables the webhook patching
-  # and istiod webhook functionality.
-  #
-  # New fields should not use Values - it is a 'primary' config object, users should be able
-  # to fine tune it or use it with kube-inject.
-  config: |-
-    policy: enabled
-    alwaysInjectSelector:
-      []
-    neverInjectSelector:
-      []
-    injectedAnnotations:
-
-    template: |
-      rewriteAppHTTPProbe: {{ valueOrDefault .Values.sidecarInjectorWebhook.rewriteAppHTTPProbe false }}
-      initContainers:
-      {{ if ne (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `NONE` }}
-      {{ if .Values.istio_cni.enabled -}}
-      - name: istio-validation
-      {{ else -}}
-      - name: istio-init
-      {{ end -}}
-      {{- if contains "/" .Values.global.proxy_init.image }}
-        image: "{{ .Values.global.proxy_init.image }}"
-      {{- else }}
-        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy_init.image }}:{{ .Values.global.tag }}"
-      {{- end }}
-        args:
-        - istio-iptables
-        - "-p"
-        - 15001
-        - "-z"
-        - "15006"
-        - "-u"
-        - 1337
-        - "-m"
-        - "{{ annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode }}"
-        - "-i"
-        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundIPRanges` .Values.global.proxy.includeIPRanges }}"
-        - "-x"
-        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundIPRanges` .Values.global.proxy.excludeIPRanges }}"
-        - "-b"
-        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeInboundPorts` `*` }}"
-        - "-d"
-      {{- if excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}
-        - "15090,15021,{{ excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}"
-      {{- else }}
-        - "15090,15021"
-      {{- end }}
-        {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/includeOutboundPorts`) (ne (valueOrDefault .Values.global.proxy.includeOutboundPorts "") "") -}}
-        - "-q"
-        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundPorts` .Values.global.proxy.includeOutboundPorts }}"
-        {{ end -}}
-        {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/excludeOutboundPorts`) (ne (valueOrDefault .Values.global.proxy.excludeOutboundPorts "") "") -}}
-        - "-o"
-        - "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundPorts` .Values.global.proxy.excludeOutboundPorts }}"
-        {{ end -}}
-        {{ if (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces`) -}}
-        - "-k"
-        - "{{ index .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces` }}"
-        {{ end -}}
-        {{ if .Values.istio_cni.enabled -}}
-        - "--run-validation"
-        - "--skip-rule-apply"
-        {{ end -}}
-        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
-      {{- if .ProxyConfig.ProxyMetadata }}
-        env:
-        {{- range $key, $value := .ProxyConfig.ProxyMetadata }}
-        - name: {{ $key }}
-          value: "{{ $value }}"
-        {{- end }}
-      {{- end }}
-      {{- if .Values.global.proxy_init.resources }}
-        resources:
-          {{ toYaml .Values.global.proxy_init.resources | indent 4 }}
-      {{- else }}
-        resources: {}
-      {{- end }}
-        securityContext:
-          allowPrivilegeEscalation: {{ .Values.global.proxy.privileged }}
-          privileged: {{ .Values.global.proxy.privileged }}
-          capabilities:
-        {{- if not .Values.istio_cni.enabled }}
-            add:
-            - NET_ADMIN
-            - NET_RAW
-        {{- end }}
-            drop:
-            - ALL
-        {{- if not .Values.istio_cni.enabled }}
-          readOnlyRootFilesystem: false
-          runAsGroup: 0
-          runAsNonRoot: false
-          runAsUser: 0
-        {{- else }}
-          readOnlyRootFilesystem: true
-          runAsGroup: 1337
-          runAsUser: 1337
-          runAsNonRoot: true
-        {{- end }}
-        restartPolicy: Always
-      {{ end -}}
-      {{- if eq .Values.global.proxy.enableCoreDump true }}
-      - name: enable-core-dump
-        args:
-        - -c
-        - sysctl -w kernel.core_pattern=/var/lib/istio/data/core.proxy && ulimit -c unlimited
-        command:
-          - /bin/sh
-      {{- if contains "/" .Values.global.proxy_init.image }}
-        image: "{{ .Values.global.proxy_init.image }}"
-      {{- else }}
-        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy_init.image }}:{{ .Values.global.tag }}"
-      {{- end }}
-        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
-        resources: {}
-        securityContext:
-          allowPrivilegeEscalation: true
-          capabilities:
-            add:
-            - SYS_ADMIN
-            drop:
-            - ALL
-          privileged: true
-          readOnlyRootFilesystem: false
-          runAsGroup: 0
-          runAsNonRoot: false
-          runAsUser: 0
-      {{ end }}
-      containers:
-      - name: istio-proxy
-      {{- if contains "/" (annotation .ObjectMeta `sidecar.istio.io/proxyImage` .Values.global.proxy.image) }}
-        image: "{{ annotation .ObjectMeta `sidecar.istio.io/proxyImage` .Values.global.proxy.image }}"
-      {{- else }}
-        image: "{{ .Values.global.hub }}/{{ .Values.global.proxy.image }}:{{ .Values.global.tag }}"
-      {{- end }}
-        ports:
-        - containerPort: 15090
-          protocol: TCP
-          name: http-envoy-prom
-        args:
-        - proxy
-        - sidecar
-        - --domain
-        - $(POD_NAMESPACE).svc.{{ .Values.global.proxy.clusterDomain }}
-        - --serviceCluster
-        {{ if ne "" (index .ObjectMeta.Labels "app") -}}
-        - "{{ index .ObjectMeta.Labels `app` }}.$(POD_NAMESPACE)"
-        {{ else -}}
-        - "{{ valueOrDefault .DeploymentMeta.Name `istio-proxy` }}.{{ valueOrDefault .DeploymentMeta.Namespace `default` }}"
-        {{ end -}}
-        - --proxyLogLevel={{ annotation .ObjectMeta `sidecar.istio.io/logLevel` .Values.global.proxy.logLevel}}
-        - --proxyComponentLogLevel={{ annotation .ObjectMeta `sidecar.istio.io/componentLogLevel` .Values.global.proxy.componentLogLevel}}
-      {{- if .Values.global.sts.servicePort }}
-        - --stsPort={{ .Values.global.sts.servicePort }}
-      {{- end }}
-      {{- if .Values.global.trustDomain }}
-        - --trust-domain={{ .Values.global.trustDomain }}
-      {{- end }}
-      {{- if .Values.global.logAsJson }}
-        - --log_as_json
-      {{- end }}
-      {{- if gt .ProxyConfig.Concurrency.GetValue 0 }}
-        - --concurrency
-        - "{{ .ProxyConfig.Concurrency.GetValue }}"
-      {{- end -}}
-      {{- if .Values.global.proxy.lifecycle }}
-        lifecycle:
-          {{ toYaml .Values.global.proxy.lifecycle | indent 4 }}
-      {{- else if .Values.global.proxy.holdApplicationUntilProxyStarts}}
-        lifecycle:
-          postStart:
-            exec:
-              command:
-              - pilot-agent
-              - wait
-      {{- end }}
-        env:
-        - name: JWT_POLICY
-          value: {{ .Values.global.jwtPolicy }}
-        - name: PILOT_CERT_PROVIDER
-          value: {{ .Values.global.pilotCertProvider }}
-        - name: CA_ADDR
-        {{- if .Values.global.caAddress }}
-          value: {{ .Values.global.caAddress }}
-        {{- else }}
-          value: istiod{{- if not (eq .Values.revision "") }}-{{ .Values.revision }}{{- end }}.{{ .Values.global.istioNamespace }}.svc:15012
-        {{- end }}
-        - name: POD_NAME
-          valueFrom:
-            fieldRef:
-              fieldPath: metadata.name
-        - name: POD_NAMESPACE
-          valueFrom:
-            fieldRef:
-              fieldPath: metadata.namespace
-        - name: INSTANCE_IP
-          valueFrom:
-            fieldRef:
-              fieldPath: status.podIP
-        - name: SERVICE_ACCOUNT
-          valueFrom:
-            fieldRef:
-              fieldPath: spec.serviceAccountName
-        - name: HOST_IP
-          valueFrom:
-            fieldRef:
-              fieldPath: status.hostIP
-        - name: CANONICAL_SERVICE
-          valueFrom:
-            fieldRef:
-              fieldPath: metadata.labels['service.istio.io/canonical-name']
-        - name: CANONICAL_REVISION
-          valueFrom:
-            fieldRef:
-              fieldPath: metadata.labels['service.istio.io/canonical-revision']
-        - name: PROXY_CONFIG
-          value: |
-                 {{ protoToJSON .ProxyConfig }}
-        - name: ISTIO_META_POD_PORTS
-          value: |-
-            [
-            {{- $first := true }}
-            {{- range $index1, $c := .Spec.Containers }}
-              {{- range $index2, $p := $c.Ports }}
-                {{- if (structToJSON $p) }}
-                {{if not $first}},{{end}}{{ structToJSON $p }}
-                {{- $first = false }}
-                {{- end }}
-              {{- end}}
-            {{- end}}
-            ]
-        - name: ISTIO_META_APP_CONTAINERS
-          value: "{{- range $index, $container := .Spec.Containers }}{{- if ne $index 0}},{{- end}}{{ $container.Name }}{{- end}}"
-        - name: ISTIO_META_CLUSTER_ID
-          value: "{{ valueOrDefault .Values.global.multiCluster.clusterName `Kubernetes` }}"
-        - name: ISTIO_META_INTERCEPTION_MODE
-          value: "{{ or (index .ObjectMeta.Annotations `sidecar.istio.io/interceptionMode`) .ProxyConfig.InterceptionMode.String }}"
-        {{- if .Values.global.network }}
-        - name: ISTIO_META_NETWORK
-          value: "{{ .Values.global.network }}"
-        {{- end }}
-        {{ if .ObjectMeta.Annotations }}
-        - name: ISTIO_METAJSON_ANNOTATIONS
-          value: |
-                 {{ toJSON .ObjectMeta.Annotations }}
-        {{ end }}
-        {{- if .DeploymentMeta.Name }}
-        - name: ISTIO_META_WORKLOAD_NAME
-          value: {{ .DeploymentMeta.Name }}
-        {{ end }}
-        {{- if and .TypeMeta.APIVersion .DeploymentMeta.Name }}
-        - name: ISTIO_META_OWNER
-          value: kubernetes://apis/{{ .TypeMeta.APIVersion }}/namespaces/{{ valueOrDefault .DeploymentMeta.Namespace `default` }}/{{ toLower .TypeMeta.Kind}}s/{{ .DeploymentMeta.Name }}
-        {{- end}}
-        {{- if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
-        - name: ISTIO_BOOTSTRAP_OVERRIDE
-          value: "/etc/istio/custom-bootstrap/custom_bootstrap.json"
-        {{- end }}
-        {{- if .Values.global.meshID }}
-        - name: ISTIO_META_MESH_ID
-          value: "{{ .Values.global.meshID }}"
-        {{- else if .Values.global.trustDomain }}
-        - name: ISTIO_META_MESH_ID
-          value: "{{ .Values.global.trustDomain }}"
-        {{- end }}
-        {{- if and (eq .Values.global.proxy.tracer "datadog") (isset .ObjectMeta.Annotations `apm.datadoghq.com/env`) }}
-        {{- range $key, $value := fromJSON (index .ObjectMeta.Annotations `apm.datadoghq.com/env`) }}
-        - name: {{ $key }}
-          value: "{{ $value }}"
-        {{- end }}
-        {{- end }}
-        {{- range $key, $value := .ProxyConfig.ProxyMetadata }}
-        - name: {{ $key }}
-          value: "{{ $value }}"
-        {{- end }}
-        imagePullPolicy: "{{ valueOrDefault .Values.global.imagePullPolicy `Always` }}"
-        {{ if ne (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) `0` }}
-        readinessProbe:
-          httpGet:
-            path: /healthz/ready
-            port: 15021
-          initialDelaySeconds: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/initialDelaySeconds` .Values.global.proxy.readinessInitialDelaySeconds }}
-          periodSeconds: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/periodSeconds` .Values.global.proxy.readinessPeriodSeconds }}
-          failureThreshold: {{ annotation .ObjectMeta `readiness.status.sidecar.istio.io/failureThreshold` .Values.global.proxy.readinessFailureThreshold }}
-        {{ end -}}
-        securityContext:
-          allowPrivilegeEscalation: {{ .Values.global.proxy.privileged }}
-          capabilities:
-            {{ if or (eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY`) (eq (annotation .ObjectMeta `sidecar.istio.io/capNetBindService` .Values.global.proxy.capNetBindService) `true`) -}}
-            add:
-            {{ if eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY` -}}
-            - NET_ADMIN
-            {{- end }}
-            {{ if eq (annotation .ObjectMeta `sidecar.istio.io/capNetBindService` .Values.global.proxy.capNetBindService) `true` -}}
-            - NET_BIND_SERVICE
-            {{- end }}
-            {{- end }}
-            drop:
-            - ALL
-          privileged: {{ .Values.global.proxy.privileged }}
-          readOnlyRootFilesystem: {{ not .Values.global.proxy.enableCoreDump }}
-          runAsGroup: 1337
-          fsGroup: 1337
-          {{ if or (eq (annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode) `TPROXY`) (eq (annotation .ObjectMeta `sidecar.istio.io/capNetBindService` .Values.global.proxy.capNetBindService) `true`) -}}
-          runAsNonRoot: false
-          runAsUser: 0
-          {{- else -}}
-          runAsNonRoot: true
-          runAsUser: 1337
-          {{- end }}
-        resources:
-      {{- if or (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit`) }}
-        {{- if or (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) }}
-          requests:
-            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU`) -}}
-            cpu: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyCPU` }}"
-            {{ end }}
-            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory`) -}}
-            memory: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyMemory` }}"
-            {{ end }}
-        {{- end }}
-        {{- if or (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit`) (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit`) }}
-          limits:
-            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit`) -}}
-            cpu: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyCPULimit` }}"
-            {{ end }}
-            {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit`) -}}
-            memory: "{{ index .ObjectMeta.Annotations `sidecar.istio.io/proxyMemoryLimit` }}"
-            {{ end }}
-        {{- end }}
-      {{- else }}
-        {{- if .Values.global.proxy.resources }}
-          {{ toYaml .Values.global.proxy.resources | indent 4 }}
-        {{- end }}
-      {{- end }}
-        volumeMounts:
-        {{- if eq .Values.global.pilotCertProvider "istiod" }}
-        - mountPath: /var/run/secrets/istio
-          name: istiod-ca-cert
-        {{- end }}
-        - mountPath: /var/lib/istio/data
-          name: istio-data
-        {{ if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
-        - mountPath: /etc/istio/custom-bootstrap
-          name: custom-bootstrap-volume
-        {{- end }}
-        # SDS channel between istioagent and Envoy
-        - mountPath: /etc/istio/proxy
-          name: istio-envoy
-        {{- if eq .Values.global.jwtPolicy "third-party-jwt" }}
-        - mountPath: /var/run/secrets/tokens
-          name: istio-token
-        {{- end }}
-        {{- if .Values.global.mountMtlsCerts }}
-        # Use the key and cert mounted to /etc/certs/ for the in-cluster mTLS communications.
-        - mountPath: /etc/certs/
-          name: istio-certs
-          readOnly: true
-        {{- end }}
-        - name: istio-podinfo
-          mountPath: /etc/istio/pod
-         {{- if and (eq .Values.global.proxy.tracer "lightstep") .ProxyConfig.GetTracing.GetTlsSettings }}
-        - mountPath: {{ directory .ProxyConfig.GetTracing.GetTlsSettings.GetCaCertificates }}
-          name: lightstep-certs
-          readOnly: true
-        {{- end }}
-          {{- if isset .ObjectMeta.Annotations `sidecar.istio.io/userVolumeMount` }}
-          {{ range $index, $value := fromJSON (index .ObjectMeta.Annotations `sidecar.istio.io/userVolumeMount`) }}
-        - name: "{{  $index }}"
-          {{ toYaml $value | indent 4 }}
-          {{ end }}
-          {{- end }}
-      {{- if .ProxyConfig.ProxyMetadata.ISTIO_META_DNS_CAPTURE }}
-      dnsConfig:
-        options:
-        - name: "ndots"
-          value: "4"
-      {{- end }}
-      volumes:
-      {{- if (isset .ObjectMeta.Annotations `sidecar.istio.io/bootstrapOverride`) }}
-      - name: custom-bootstrap-volume
-        configMap:
-          name: {{ annotation .ObjectMeta `sidecar.istio.io/bootstrapOverride` "" }}
-      {{- end }}
-      # SDS channel between istioagent and Envoy
-      - emptyDir:
-          medium: Memory
-        name: istio-envoy
-      - name: istio-data
-        emptyDir: {}
-      - name: istio-podinfo
-        downwardAPI:
-          items:
-            - path: "labels"
-              fieldRef:
-                fieldPath: metadata.labels
-            - path: "annotations"
-              fieldRef:
-                fieldPath: metadata.annotations
-      {{- if eq .Values.global.jwtPolicy "third-party-jwt" }}
-      - name: istio-token
-        projected:
-          sources:
-          - serviceAccountToken:
-              path: istio-token
-              expirationSeconds: 43200
-              audience: {{ .Values.global.sds.token.aud }}
-      {{- end }}
-      {{- if eq .Values.global.pilotCertProvider "istiod" }}
-      - name: istiod-ca-cert
-        configMap:
-          name: istio-ca-root-cert
-      {{- end }}
-      {{- if .Values.global.mountMtlsCerts }}
-      # Use the key and cert mounted to /etc/certs/ for the in-cluster mTLS communications.
-      - name: istio-certs
-        secret:
-          optional: true
-          {{ if eq .Spec.ServiceAccountName "" }}
-          secretName: istio.default
-          {{ else -}}
-          secretName: {{  printf "istio.%s" .Spec.ServiceAccountName }}
-          {{  end -}}
-      {{- end }}
-        {{- if isset .ObjectMeta.Annotations `sidecar.istio.io/userVolume` }}
-        {{range $index, $value := fromJSON (index .ObjectMeta.Annotations `sidecar.istio.io/userVolume`) }}
-      - name: "{{ $index }}"
-        {{ toYaml $value | indent 2 }}
-        {{ end }}
-        {{ end }}
-      {{- if and (eq .Values.global.proxy.tracer "lightstep") .ProxyConfig.GetTracing.GetTlsSettings }}
-      - name: lightstep-certs
-        secret:
-          optional: true
-          secretName: lightstep.cacert
-      {{- end }}
-      {{- if .Values.global.podDNSSearchNamespaces }}
-      dnsConfig:
-        searches:
-          {{- range .Values.global.podDNSSearchNamespaces }}
-          - {{ render . }}
-          {{- end }}
-      {{- end }}
-      podRedirectAnnot:
-      {{- if and (.Values.istio_cni.enabled) (not .Values.istio_cni.chained) }}
-      {{ if isset .ObjectMeta.Annotations `k8s.v1.cni.cncf.io/networks` }}
-        k8s.v1.cni.cncf.io/networks: "{{ index .ObjectMeta.Annotations `k8s.v1.cni.cncf.io/networks`}}, istio-cni"
-      {{- else }}
-        k8s.v1.cni.cncf.io/networks: "istio-cni"
-      {{- end }}
-      {{- end }}
-        sidecar.istio.io/interceptionMode: "{{ annotation .ObjectMeta `sidecar.istio.io/interceptionMode` .ProxyConfig.InterceptionMode }}"
-        traffic.sidecar.istio.io/includeOutboundIPRanges: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundIPRanges` .Values.global.proxy.includeIPRanges }}"
-        traffic.sidecar.istio.io/excludeOutboundIPRanges: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundIPRanges` .Values.global.proxy.excludeIPRanges }}"
-        traffic.sidecar.istio.io/includeInboundPorts: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeInboundPorts` (includeInboundPorts .Spec.Containers) }}"
-        traffic.sidecar.istio.io/excludeInboundPorts: "{{ excludeInboundPort (annotation .ObjectMeta `status.sidecar.istio.io/port` .Values.global.proxy.statusPort) (annotation .ObjectMeta `traffic.sidecar.istio.io/excludeInboundPorts` .Values.global.proxy.excludeInboundPorts) }}"
-      {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/includeOutboundPorts`) (ne (valueOrDefault .Values.global.proxy.includeOutboundPorts "") "") }}
-        traffic.sidecar.istio.io/includeOutboundPorts: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/includeOutboundPorts` .Values.global.proxy.includeOutboundPorts }}"
-      {{- end }}
-      {{ if or (isset .ObjectMeta.Annotations `traffic.sidecar.istio.io/excludeOutboundPorts`) (ne .Values.global.proxy.excludeOutboundPorts "") }}
-        traffic.sidecar.istio.io/excludeOutboundPorts: "{{ annotation .ObjectMeta `traffic.sidecar.istio.io/excludeOutboundPorts` .Values.global.proxy.excludeOutboundPorts }}"
-      {{- end }}
-        traffic.sidecar.istio.io/kubevirtInterfaces: "{{ index .ObjectMeta.Annotations `traffic.sidecar.istio.io/kubevirtInterfaces` }}"
-      {{- if .Values.global.imagePullSecrets }}
-      imagePullSecrets:
-        {{- range .Values.global.imagePullSecrets }}
-        - name: {{ . }}
-        {{- end }}
-      {{- end }}
----
-apiVersion: admissionregistration.k8s.io/v1beta1
-kind: MutatingWebhookConfiguration
-metadata:
-  name: istio-sidecar-injector
-
-  labels:
-    istio.io/rev: default
-    app: sidecar-injector
-    release: istio
-webhooks:
-  - name: sidecar-injector.istio.io
-    clientConfig:
-      service:
-        name: istiod
-        namespace: istio-system
-        path: "/inject"
-      caBundle: ""
-    sideEffects: None
-    rules:
-      - operations: [ "CREATE" ]
-        apiGroups: [""]
-        apiVersions: ["v1"]
-        resources: ["pods"]
-    failurePolicy: Fail
-    admissionReviewVersions: ["v1beta1", "v1"]
-    namespaceSelector:
-      matchLabels:
-        istio-injection: enabled
----
-apiVersion: apps/v1
-kind: Deployment
+kind: Service
 metadata:
+  namespace: istio-operator
   labels:
-    app: istio-ingressgateway
-    istio: ingressgateway
-    release: istio
-  name: istio-ingressgateway
-  namespace: istio-system
+    name: istio-operator
+  name: istio-operator
 spec:
+  ports:
+  - name: http-metrics
+    port: 8383
+    targetPort: 8383
+    protocol: TCP
   selector:
-    matchLabels:
-      app: istio-ingressgateway
-      istio: ingressgateway
-  strategy:
-    rollingUpdate:
-      maxSurge: 100%
-      maxUnavailable: 25%
-  template:
-    metadata:
-      annotations:
-        prometheus.io/path: /stats/prometheus
-        prometheus.io/port: "15090"
-        prometheus.io/scrape: "true"
-        sidecar.istio.io/inject: "false"
-      labels:
-        app: istio-ingressgateway
-        chart: gateways
-        heritage: Tiller
-        istio: ingressgateway
-        release: istio
-        service.istio.io/canonical-name: istio-ingressgateway
-        service.istio.io/canonical-revision: latest
-    spec:
-      affinity:
-        nodeAffinity:
-          preferredDuringSchedulingIgnoredDuringExecution:
-          - preference:
-              matchExpressions:
-              - key: kubernetes.io/arch
-                operator: In
-                values:
-                - amd64
-            weight: 2
-          - preference:
-              matchExpressions:
-              - key: kubernetes.io/arch
-                operator: In
-                values:
-                - ppc64le
-            weight: 2
-          - preference:
-              matchExpressions:
-              - key: kubernetes.io/arch
-                operator: In
-                values:
-                - s390x
-            weight: 2
-          requiredDuringSchedulingIgnoredDuringExecution:
-            nodeSelectorTerms:
-            - matchExpressions:
-              - key: kubernetes.io/arch
-                operator: In
-                values:
-                - amd64
-                - ppc64le
-                - s390x
-      containers:
-      - args:
-        - proxy
-        - router
-        - --domain
-        - $(POD_NAMESPACE).svc.cluster.local
-        - --proxyLogLevel=warning
-        - --proxyComponentLogLevel=misc:error
-        - --log_output_level=default:info
-        - --serviceCluster
-        - istio-ingressgateway
-        - --trust-domain=cluster.local
-        env:
-        - name: JWT_POLICY
-          value: third-party-jwt
-        - name: PILOT_CERT_PROVIDER
-          value: istiod
-        - name: CA_ADDR
-          value: istiod.istio-system.svc:15012
-        - name: NODE_NAME
-          valueFrom:
-            fieldRef:
-              apiVersion: v1
-              fieldPath: spec.nodeName
-        - name: POD_NAME
-          valueFrom:
-            fieldRef:
-              apiVersion: v1
-              fieldPath: metadata.name
-        - name: POD_NAMESPACE
-          valueFrom:
-            fieldRef:
-              apiVersion: v1
-              fieldPath: metadata.namespace
-        - name: INSTANCE_IP
-          valueFrom:
-            fieldRef:
-              apiVersion: v1
-              fieldPath: status.podIP
-        - name: HOST_IP
-          valueFrom:
-            fieldRef:
-              apiVersion: v1
-              fieldPath: status.hostIP
-        - name: SERVICE_ACCOUNT
-          valueFrom:
-            fieldRef:
-              fieldPath: spec.serviceAccountName
-        - name: CANONICAL_SERVICE
-          valueFrom:
-            fieldRef:
-              fieldPath: metadata.labels['service.istio.io/canonical-name']
-        - name: CANONICAL_REVISION
-          valueFrom:
-            fieldRef:
-              fieldPath: metadata.labels['service.istio.io/canonical-revision']
-        - name: ISTIO_META_WORKLOAD_NAME
-          value: istio-ingressgateway
-        - name: ISTIO_META_OWNER
-          value: kubernetes://apis/apps/v1/namespaces/istio-system/deployments/istio-ingressgateway
-        - name: ISTIO_META_MESH_ID
-          value: cluster.local
-        - name: ISTIO_META_ROUTER_MODE
-          value: sni-dnat
-        - name: ISTIO_META_CLUSTER_ID
-          value: Kubernetes
-        image: docker.io/istio/proxyv2:1.7.4
-        name: istio-proxy
-        ports:
-        - containerPort: 15021
-        - containerPort: 8080
-        - containerPort: 8443
-        - containerPort: 15443
-        - containerPort: 15090
-          name: http-envoy-prom
-          protocol: TCP
-        readinessProbe:
-          failureThreshold: 30
-          httpGet:
-            path: /healthz/ready
-            port: 15021
-            scheme: HTTP
-          initialDelaySeconds: 1
-          periodSeconds: 2
-          successThreshold: 1
-          timeoutSeconds: 1
-        resources:
-          limits:
-            cpu: 2000m
-            memory: 1024Mi
-          requests:
-            cpu: 100m
-            memory: 128Mi
-        securityContext:
-          allowPrivilegeEscalation: false
-          capabilities:
-            drop:
-            - ALL
-          privileged: false
-          readOnlyRootFilesystem: true
-        volumeMounts:
-        - mountPath: /etc/istio/proxy
-          name: istio-envoy
-        - mountPath: /etc/istio/config
-          name: config-volume
-        - mountPath: /var/run/secrets/istio
-          name: istiod-ca-cert
-        - mountPath: /var/run/secrets/tokens
-          name: istio-token
-          readOnly: true
-        - mountPath: /var/run/ingress_gateway
-          name: gatewaysdsudspath
-        - mountPath: /etc/istio/pod
-          name: podinfo
-        - mountPath: /etc/istio/ingressgateway-certs
-          name: ingressgateway-certs
-          readOnly: true
-        - mountPath: /etc/istio/ingressgateway-ca-certs
-          name: ingressgateway-ca-certs
-          readOnly: true
-      securityContext:
-        fsGroup: 1337
-        runAsGroup: 1337
-        runAsNonRoot: true
-        runAsUser: 1337
-      serviceAccountName: istio-ingressgateway-service-account
-      volumes:
-      - configMap:
-          name: istio-ca-root-cert
-        name: istiod-ca-cert
-      - downwardAPI:
-          items:
-          - fieldRef:
-              fieldPath: metadata.labels
-            path: labels
-          - fieldRef:
-              fieldPath: metadata.annotations
-            path: annotations
-        name: podinfo
-      - emptyDir: {}
-        name: istio-envoy
-      - emptyDir: {}
-        name: gatewaysdsudspath
-      - name: istio-token
-        projected:
-          sources:
-          - serviceAccountToken:
-              audience: istio-ca
-              expirationSeconds: 43200
-              path: istio-token
-      - configMap:
-          name: istio
-          optional: true
-        name: config-volume
-      - name: ingressgateway-certs
-        secret:
-          optional: true
-          secretName: istio-ingressgateway-certs
-      - name: ingressgateway-ca-certs
-        secret:
-          optional: true
-          secretName: istio-ingressgateway-ca-certs
+    name: istio-operator
 ---
+# Source: istio-operator/templates/deployment.yaml
 apiVersion: apps/v1
 kind: Deployment
 metadata:
-  labels:
-    app: istiod
-    istio: pilot
-    istio.io/rev: default
-    release: istio
-  name: istiod
-  namespace: istio-system
+  namespace: istio-operator
+  name: istio-operator
 spec:
+  replicas: 1
   selector:
     matchLabels:
-      istio: pilot
-  strategy:
-    rollingUpdate:
-      maxSurge: 100%
-      maxUnavailable: 25%
+      name: istio-operator
   template:
     metadata:
-      annotations:
-        prometheus.io/port: "15014"
-        prometheus.io/scrape: "true"
-        sidecar.istio.io/inject: "false"
       labels:
-        app: istiod
-        istio: pilot
-        istio.io/rev: default
+        name: istio-operator
     spec:
+      serviceAccountName: istio-operator
       containers:
-      - args:
-        - discovery
-        - --monitoringAddr=:15014
-        - --log_output_level=default:info
-        - --domain
-        - cluster.local
-        - --trust-domain=cluster.local
-        - --keepaliveMaxServerConnectionAge
-        - 30m
-        env:
-        - name: REVISION
-          value: default
-        - name: JWT_POLICY
-          value: third-party-jwt
-        - name: PILOT_CERT_PROVIDER
-          value: istiod
-        - name: POD_NAME
-          valueFrom:
-            fieldRef:
-              apiVersion: v1
-              fieldPath: metadata.name
-        - name: POD_NAMESPACE
-          valueFrom:
-            fieldRef:
-              apiVersion: v1
-              fieldPath: metadata.namespace
-        - name: SERVICE_ACCOUNT
-          valueFrom:
-            fieldRef:
-              apiVersion: v1
-              fieldPath: spec.serviceAccountName
-        - name: KUBECONFIG
-          value: /var/run/secrets/remote/config
-        - name: PILOT_TRACE_SAMPLING
-          value: "1"
-        - name: PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_OUTBOUND
-          value: "true"
-        - name: PILOT_ENABLE_PROTOCOL_SNIFFING_FOR_INBOUND
-          value: "true"
-        - name: INJECTION_WEBHOOK_CONFIG_NAME
-          value: istio-sidecar-injector
-        - name: ISTIOD_ADDR
-          value: istiod.istio-system.svc:15012
-        - name: PILOT_ENABLE_ANALYSIS
-          value: "false"
-        - name: CLUSTER_ID
-          value: Kubernetes
-        - name: CENTRAL_ISTIOD
-          value: "false"
-        image: docker.io/istio/pilot:1.7.4
-        name: discovery
-        ports:
-        - containerPort: 8080
-        - containerPort: 15010
-        - containerPort: 15017
-        - containerPort: 15053
-        readinessProbe:
-          httpGet:
-            path: /ready
-            port: 8080
-          initialDelaySeconds: 1
-          periodSeconds: 3
-          timeoutSeconds: 5
-        resources:
-          requests:
-            cpu: 500m
-            memory: 2048Mi
-        securityContext:
-          capabilities:
-            drop:
-            - ALL
-          runAsGroup: 1337
-          runAsNonRoot: true
-          runAsUser: 1337
-        volumeMounts:
-        - mountPath: /etc/istio/config
-          name: config-volume
-        - mountPath: /var/run/secrets/tokens
-          name: istio-token
-          readOnly: true
-        - mountPath: /var/run/secrets/istio-dns
-          name: local-certs
-        - mountPath: /etc/cacerts
-          name: cacerts
-          readOnly: true
-        - mountPath: /var/run/secrets/remote
-          name: istio-kubeconfig
-          readOnly: true
-        - mountPath: /var/lib/istio/inject
-          name: inject
-          readOnly: true
-      securityContext:
-        fsGroup: 1337
-      serviceAccountName: istiod-service-account
-      volumes:
-      - emptyDir:
-          medium: Memory
-        name: local-certs
-      - name: istio-token
-        projected:
-          sources:
-          - serviceAccountToken:
-              audience: istio-ca
-              expirationSeconds: 43200
-              path: istio-token
-      - name: cacerts
-        secret:
-          optional: true
-          secretName: cacerts
-      - name: istio-kubeconfig
-        secret:
-          optional: true
-          secretName: istio-kubeconfig
-      - configMap:
-          name: istio-sidecar-injector
-        name: inject
-      - configMap:
-          name: istio
-        name: config-volume
----
-apiVersion: policy/v1beta1
-kind: PodDisruptionBudget
-metadata:
-  name: istio-ingressgateway
-  namespace: istio-system
-  labels:
-    app: istio-ingressgateway
-    istio: ingressgateway
-    release: istio
-spec:
-  minAvailable: 1
-  selector:
-    matchLabels:
-      app: istio-ingressgateway
-      istio: ingressgateway
----
-apiVersion: policy/v1beta1
-kind: PodDisruptionBudget
-metadata:
-  name: istiod
-  namespace: istio-system
-  labels:
-    app: istiod
-    istio.io/rev: default
-    release: istio
-    istio: pilot
-spec:
-  minAvailable: 1
-  selector:
-    matchLabels:
-      app: istiod
-      istio: pilot
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: Role
-metadata:
-  name: istio-ingressgateway-sds
-  namespace: istio-system
-  labels:
-    release: istio
-rules:
-- apiGroups: [""]
-  resources: ["secrets"]
-  verbs: ["get", "watch", "list"]
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: Role
-metadata:
-  name: istiod-istio-system
-  namespace: istio-system
-  labels:
-    app: istiod
-    release: istio
-rules:
-- apiGroups: ["networking.istio.io"]
-  verbs: ["create"]
-  resources: ["gateways"]
-
-- apiGroups: [""]
-  resources: ["secrets"]
-  # TODO lock this down to istio-ca-cert if not using the DNS cert mesh config
-  verbs: ["create", "get", "watch", "list", "update", "delete"]
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: RoleBinding
-metadata:
-  name: istio-ingressgateway-sds
-  namespace: istio-system
-  labels:
-    release: istio
-roleRef:
-  apiGroup: rbac.authorization.k8s.io
-  kind: Role
-  name: istio-ingressgateway-sds
-subjects:
-- kind: ServiceAccount
-  name: istio-ingressgateway-service-account
----
-apiVersion: rbac.authorization.k8s.io/v1
-kind: RoleBinding
-metadata:
-  name: istiod-istio-system
-  namespace: istio-system
-  labels:
-    app: pilot
-    release: istio
-roleRef:
-  apiGroup: rbac.authorization.k8s.io
-  kind: Role
-  name: istiod-istio-system
-subjects:
-  - kind: ServiceAccount
-    name: istiod-service-account
-    namespace: istio-system
----
-apiVersion: autoscaling/v2beta1
-kind: HorizontalPodAutoscaler
-metadata:
-  labels:
-    app: istio-ingressgateway
-    istio: ingressgateway
-    release: istio
-  name: istio-ingressgateway
-  namespace: istio-system
-spec:
-  maxReplicas: 5
-  metrics:
-  - resource:
-      name: cpu
-      targetAverageUtilization: 80
-    type: Resource
-  minReplicas: 1
-  scaleTargetRef:
-    apiVersion: apps/v1
-    kind: Deployment
-    name: istio-ingressgateway
----
-apiVersion: autoscaling/v2beta1
-kind: HorizontalPodAutoscaler
-metadata:
-  name: istiod
-  namespace: istio-system
-  labels:
-    app: istiod
-    release: istio
-    istio.io/rev: default
-spec:
-  maxReplicas: 5
-  minReplicas: 1
-  scaleTargetRef:
-    apiVersion: apps/v1
-    kind: Deployment
-    name: istiod
-  metrics:
-  - type: Resource
-    resource:
-      name: cpu
-      targetAverageUtilization: 80
----
-apiVersion: v1
-kind: Service
-metadata:
-  annotations: null
-  labels:
-    app: istio-ingressgateway
-    istio: ingressgateway
-    release: istio
-  name: istio-ingressgateway
-  namespace: istio-system
-spec:
-  ports:
-  - name: status-port
-    port: 15021
-    targetPort: 15021
-  - name: http2
-    port: 80
-    targetPort: 8080
-  - name: https
-    port: 443
-    targetPort: 8443
-  - name: tls
-    port: 15443
-    targetPort: 15443
-  selector:
-    app: istio-ingressgateway
-    istio: ingressgateway
-  type: LoadBalancer
----
-apiVersion: v1
-kind: Service
-metadata:
-  name: istiod
-  namespace: istio-system
-  labels:
-    istio.io/rev: default
-    app: istiod
-    istio: pilot
-    release: istio
-spec:
-  ports:
-    - port: 15010
-      name: grpc-xds # plaintext
-    - port: 15012
-      name: https-dns # mTLS with k8s-signed cert
-    - port: 443
-      name: https-webhook # validation and injection
-      targetPort: 15017
-    - port: 15014
-      name: http-monitoring # prometheus stats
-    - name: dns-tls
-      port: 853
-      targetPort: 15053
-      protocol: TCP
-  selector:
-    app: istiod
-    # Label used by the 'default' service. For versioned deployments we match with app and version.
-    # This avoids default deployment picking the canary
-    istio: pilot
----
+        - name: istio-operator
+          image: docker.io/istio/operator:1.11.2
+          command:
+          - operator
+          - server
+          securityContext:
+            allowPrivilegeEscalation: false
+            capabilities:
+              drop:
+              - ALL
+            privileged: false
+            readOnlyRootFilesystem: true
+            runAsGroup: 1337
+            runAsUser: 1337
+            runAsNonRoot: true
+          imagePullPolicy: IfNotPresent
+          resources:
+            limits:
+              cpu: 200m
+              memory: 256Mi
+            requests:
+              cpu: 50m
+              memory: 128Mi
+          env:
+            - name: WATCH_NAMESPACE
+              value: "istio-system"
+            - name: LEADER_ELECTION_NAMESPACE
+              value: "istio-operator"
+            - name: POD_NAME
+              valueFrom:
+                fieldRef:
+                  fieldPath: metadata.name
+            - name: OPERATOR_NAME
+              value: "istio-operator"
+            - name: WAIT_FOR_RESOURCES_TIMEOUT
+              value: "300s"
+            - name: REVISION
+              value: ""
\ No newline at end of file
-- 
2.27.0

From b6bf8a5763d3e9aba6b5f5c246da60c1db270a60 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 07:37:34 -0400
Subject: [PATCH] Add app mesh config yaml

---
 infrastructure/istio/istio.yaml | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/infrastructure/istio/istio.yaml b/infrastructure/istio/istio.yaml
index 7a4a7a5..0f3ac1f 100644
--- a/infrastructure/istio/istio.yaml
+++ b/infrastructure/istio/istio.yaml
@@ -268,4 +268,12 @@ spec:
             - name: WAIT_FOR_RESOURCES_TIMEOUT
               value: "300s"
             - name: REVISION
-              value: ""
\ No newline at end of file
+              value: ""
+---
+apiVersion: install.istio.io/v1alpha1
+kind: IstioOperator
+metadata:
+  namespace: istio-system
+  name: istio-default
+spec:
+  profile: default              
\ No newline at end of file
-- 
2.27.0

From 2837aa83c39995038d6ccd819e1578db7fb6fe7f Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 07:39:40 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/podinfo.yaml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app/podinfo/podinfo.yaml b/app/podinfo/podinfo.yaml
index 2dce128..b84cb4f 100644
--- a/app/podinfo/podinfo.yaml
+++ b/app/podinfo/podinfo.yaml
@@ -16,7 +16,7 @@ spec:
     spec:
       containers:
       - name: podinfod
-        image: ghcr.io/stefanprodan/podinfo:3.0.0 # {"$imagepolicy": "flux-system:podinfo"}
+        image: ghcr.io/stefanprodan/podinfo:5.0.0 # {"$imagepolicy": "flux-system:podinfo"}
         imagePullPolicy: IfNotPresent
         ports:
         - name: http
-- 
2.27.0

From 7924b550c834348616af7c0faa75eb347a014c62 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 07:47:06 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/podinfo-canary.yaml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app/podinfo/podinfo-canary.yaml b/app/podinfo/podinfo-canary.yaml
index cbe81af..016b822 100644
--- a/app/podinfo/podinfo-canary.yaml
+++ b/app/podinfo/podinfo-canary.yaml
@@ -68,4 +68,4 @@ spec:
         url: http://flagger-loadtester.test/
         timeout: 5s
         metadata:
-          cmd: "hey -z 1m -q 10 -c 2 http://podinfo-canary.dev:9898/"
\ No newline at end of file
+          cmd: "hey -n 200 -q 10 -c 2 http://podinfo-canary.dev:9898/"
\ No newline at end of file
-- 
2.27.0

From f7966bcef7b26cfdf818e933dc02b0092b117cbb Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 07:53:41 -0400
Subject: [PATCH] Add app mesh config yaml

---
 app/podinfo/podinfo-canary.yaml   | 26 +++++++-------
 infrastructure/istio/flagger.yaml | 57 ++++++++++++++++++++++++++++++-
 infrastructure/istio/istio.yaml   |  4 ++-
 3 files changed, 73 insertions(+), 14 deletions(-)

diff --git a/app/podinfo/podinfo-canary.yaml b/app/podinfo/podinfo-canary.yaml
index 016b822..b4fa922 100644
--- a/app/podinfo/podinfo-canary.yaml
+++ b/app/podinfo/podinfo-canary.yaml
@@ -43,18 +43,20 @@ spec:
     # percentage (0-100)
     stepWeight: 10
     metrics:
-    - name: request-success-rate
-      # minimum req success rate (non 5xx responses)
-      # percentage (0-100)
-      thresholdRange:
-        min: 99
-      interval: 10s
-    - name: request-duration
-      # maximum req duration P99
-      # milliseconds
-      thresholdRange:
-        max: 500
-      interval: 10s
+      - name: error-rate
+        templateRef:
+          name: error-rate
+          namespace: istio-system
+        thresholdRange:
+          max: 1
+        interval: 30s
+      - name: latency
+        templateRef:
+          name: latency
+          namespace: istio-system
+        thresholdRange:
+          max: 500
+        interval: 30s
     # testing (optional)
     webhooks:
       - name: acceptance-test
diff --git a/infrastructure/istio/flagger.yaml b/infrastructure/istio/flagger.yaml
index e570450..3877647 100644
--- a/infrastructure/istio/flagger.yaml
+++ b/infrastructure/istio/flagger.yaml
@@ -27,4 +27,59 @@ spec:
       retries: 3
   values:
     meshProvider: istio
-    metricsServer: http://prometheus.istio-system.svc.cluster.local:9090
\ No newline at end of file
+    metricsServer: http://prometheus.istio-system.svc.cluster.local:9090
+---
+apiVersion: flagger.app/v1beta1
+kind: MetricTemplate
+metadata:
+  name: error-rate
+  namespace: istio-system
+spec:
+  provider:
+    type: prometheus
+    address: http://prometheus.istio-system:9090
+  query: |
+    100 - sum(
+        rate(
+            istio_requests_total{
+                reporter="destination",
+                destination_workload_namespace="{{ namespace }}",
+                destination_workload=~"{{ target }}",
+                response_code!~"5.*"
+            }[{{ interval }}]
+        )
+    )
+    /
+    sum(
+        rate(
+            istio_requests_total{
+                reporter="destination",
+                destination_workload_namespace="{{ namespace }}",
+                destination_workload=~"{{ target }}"
+            }[{{ interval }}]
+        )
+    )
+    * 100
+---
+apiVersion: flagger.app/v1beta1
+kind: MetricTemplate
+metadata:
+  name: latency
+  namespace: istio-system
+spec:
+  provider:
+    type: prometheus
+    address: http://prometheus.istio-system:9090
+  query: |
+    histogram_quantile(
+        0.99,
+        sum(
+            rate(
+                istio_request_duration_milliseconds_bucket{
+                    reporter="destination",
+                    destination_workload_namespace="{{ namespace }}",
+                    destination_workload=~"{{ target }}"
+                }[{{ interval }}]
+            )
+        ) by (le)
+    )    
\ No newline at end of file
diff --git a/infrastructure/istio/istio.yaml b/infrastructure/istio/istio.yaml
index 0f3ac1f..8a33264 100644
--- a/infrastructure/istio/istio.yaml
+++ b/infrastructure/istio/istio.yaml
@@ -276,4 +276,6 @@ metadata:
   namespace: istio-system
   name: istio-default
 spec:
-  profile: default              
\ No newline at end of file
+  profile: default              
+---
+  
\ No newline at end of file
-- 
2.27.0

From d4156e11bfe88fdf5cf6e13d767f9333c5d1a959 Mon Sep 17 00:00:00 2001
From: Sivamuthu Kumar <sivamuthukumar07@gmail.com>
Date: Sun, 19 Sep 2021 08:23:07 -0400
Subject: [PATCH] Add app mesh config yaml

---
 README.md                                   | 13 +++++
 clusters/dev/flux-system/kustomization.yaml |  4 +-
 tmp.json                                    | 63 +++++++++++++++++++++
 3 files changed, 78 insertions(+), 2 deletions(-)
 create mode 100644 README.md
 create mode 100644 tmp.json

diff --git a/README.md b/README.md
new file mode 100644
index 0000000..dd05ad8
--- /dev/null
+++ b/README.md
@@ -0,0 +1,13 @@
+1. Create cluster
+    ```
+    eksctl create cluster -f cluster.yaml
+    ```
+
+2. Enable Flux in the EKSctl cluster
+    ```
+    eksctl enable flux -f cluster.yaml
+    ```
+
+
+kubectl -n flux-system create secret generic discord-url \
+--from-literal=address=https://discord.com/api/webhooks/889109343868452934/50WbD3TYBy1C8A7gZ9NmbGQ7H-W5TWjEymmh2QK-T5Zyk3VVNCROpB6xjewNTh9uGysD    s
\ No newline at end of file
diff --git a/clusters/dev/flux-system/kustomization.yaml b/clusters/dev/flux-system/kustomization.yaml
index c4858c3..b5c7c1a 100644
--- a/clusters/dev/flux-system/kustomization.yaml
+++ b/clusters/dev/flux-system/kustomization.yaml
@@ -3,8 +3,8 @@ kind: Kustomization
 resources:
 - gotk-components.yaml
 - gotk-sync.yaml
-- image_sync.yaml
-- notification.yaml
+# - image_sync.yaml
+# - notification.yaml
 - infrastructure.yaml
 - app.yaml
 
diff --git a/tmp.json b/tmp.json
new file mode 100644
index 0000000..a2f52c7
--- /dev/null
+++ b/tmp.json
@@ -0,0 +1,63 @@
+{
+    "apiVersion": "v1",
+    "kind": "Namespace",
+    "metadata": {
+        "annotations": {
+            "kubectl.kubernetes.io/last-applied-configuration": "{\"apiVersion\":\"v1\",\"kind\":\"Namespace\",\"metadata\":{\"annotations\":{\"kustomize.toolkit.fluxcd.io/checksum\":\"429a99f367a0d8edbe2c4fc3fb97ecc27352ae4f\"},\"labels\":{\"kustomize.toolkit.fluxcd.io/name\":\"infrastructure\",\"kustomize.toolkit.fluxcd.io/namespace\":\"flux-system\"},\"name\":\"istio-system\"}}\n",
+            "kustomize.toolkit.fluxcd.io/checksum": "429a99f367a0d8edbe2c4fc3fb97ecc27352ae4f"
+        },
+        "creationTimestamp": "2021-09-19T11:34:57Z",
+        "deletionTimestamp": "2021-09-19T12:02:50Z",
+        "labels": {
+            "kustomize.toolkit.fluxcd.io/name": "infrastructure",
+            "kustomize.toolkit.fluxcd.io/namespace": "flux-system"
+        },
+        "name": "istio-system",
+        "resourceVersion": "14162",
+        "uid": "fa6b8c2e-b47d-4d9c-a330-37b452bc4d81"
+    },
+    "spec": {
+        "finalizers": [
+        ]
+    },
+    "status": {
+        "conditions": [
+            {
+                "lastTransitionTime": "2021-09-19T12:02:56Z",
+                "message": "All resources successfully discovered",
+                "reason": "ResourcesDiscovered",
+                "status": "False",
+                "type": "NamespaceDeletionDiscoveryFailure"
+            },
+            {
+                "lastTransitionTime": "2021-09-19T12:02:56Z",
+                "message": "All legacy kube types successfully parsed",
+                "reason": "ParsedGroupVersions",
+                "status": "False",
+                "type": "NamespaceDeletionGroupVersionParsingFailure"
+            },
+            {
+                "lastTransitionTime": "2021-09-19T12:02:56Z",
+                "message": "All content successfully deleted, may be waiting on finalization",
+                "reason": "ContentDeleted",
+                "status": "False",
+                "type": "NamespaceDeletionContentFailure"
+            },
+            {
+                "lastTransitionTime": "2021-09-19T12:02:56Z",
+                "message": "Some resources are remaining: istiooperators.install.istio.io has 1 resource instances",
+                "reason": "SomeResourcesRemain",
+                "status": "True",
+                "type": "NamespaceContentRemaining"
+            },
+            {
+                "lastTransitionTime": "2021-09-19T12:02:56Z",
+                "message": "Some content in the namespace has finalizers remaining: istio-finalizer.install.istio.io in 1 resource instances",
+                "reason": "SomeFinalizersRemain",
+                "status": "True",
+                "type": "NamespaceFinalizersRemaining"
+            }
+        ],
+        "phase": "Terminating"
+    }
+}
-- 
2.27.0

